<!-- NAME: main.tpl -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
  <head>
    <title>L i n u x [inetdoc]: (Guides) </title>
    <meta HTTP-EQUIV="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="Content-Language" content="fr">
    <meta name="description" content="inet doc linux">
    <meta name="author" content="philippe.latu@linux-france.org">
    <meta name="copyright" content="(c)2000 Philippe Latu">
    <meta name="publisher" content="philippe.latu@linux-france.org">
    <meta name="keywords" content="documentation, ethernet, formation, guide, ieee, ifconfig, inet, interface, ip, iproute2, iptables, isdn, IUT, IUP, latu, linux, net, OSI, ping, reseau, RNIS, route, routage, TCP, TCP/IP, UDP">
    <meta name="audience" content="All, Tous">
    <meta name="robots" content="INDEX,FOLLOW">
    <link rel="STYLESHEET" type="text/css" href="/prj/inetdoc/style/docstyle.css">
    <script language="javascript" type="text/javascript">
      <!-- for javascript enabled browser's only
        if (top.location != location) top.location.href = location.href;
	
        function popup(form) {
          optionIndex = form.banner.SelectedIndex;
          if (optionIndex == 0) return;
          location.href = form.banner.options[form.banner.selectedIndex].value;
          }
      // end script hiding -->
    </script>
  </head>
<BODY BGCOLOR="#FFFFFF" TEXT="#990000" LINK="#990000" VLINK="#990000" ALINK="#990000" leftMargin="0" topMargin="0" marginheight="0" marginwidth="0">
<TABLE width=100% border=0 cellspacing=2 cellpadding=0 align=center>
  <TR>
    <TD width=25% bgcolor=#990000 align=center valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
      	</TR>
	<TR>
	  <TD bgcolor=#990000 align=center>
	    <a class="nodecor" href="/prj/inetdoc">
              <IMG src="/prj/inetdoc/images/upleft.png" border=0 width=158 height=96 hspace=10 alt="logo">
      	    </a>
	  <TD>
	</TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <!-- banner menu start -->
      <form>
        <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
	  <!-- 1st row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FF9966>
	      <TABLE width="100%" border="0" cellspacing="3" cellpadding="0" width="100%">
	        <TR>
		  <th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/">&nbsp;Accueil</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/articles/">&nbsp;Articles</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/courses/">&nbsp;Cours</a>
</th>
<th align="left" valign="top" bgcolor="white">
  <a class="reduced" href="/prj/inetdoc/i/net/guides/">&nbsp;Guides</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/formation/">&nbsp;Formation</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/download/">&nbsp;Téléchargement</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/source/">&nbsp;Source</a>
</th>

		</TR>
	      </TABLE>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 2nd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FFCC66>
	      <FONT color=#990000 size=-1 face="Arial, 'Myriad Web', Syntax, sans-serif"><B>
	       <SELECT name="banner" onChange="popup(this.form)">
	         <OPTION value="/prj/inetdoc/i/net/articles/model/tcpip.html">
  Modélisation TCP/IP
</OPTION>
<OPTION value="/prj/inetdoc/i/net/../../download/Advanced-routing-Howto.pdf">
  Téléchargement Linux 2.4 Advanced Routing HOWTO VF
</OPTION>
<OPTION value="/prj/inetdoc/i/net/guides/">
  Autres guides
</OPTION>

	       </SELECT>
	      </B></FONT>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 3rd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor="#990000" align="left" valign="middle" width="100%" height="100%">
	      <div class="browse"><font size=1>&nbsp;&nbsp;Références : <a href="http://netfilter.samba.org/" class="browse"><font size=1>Netfilter Home</font></a>&nbsp;|&nbsp;
<a href="http://lartc.org/" class="browse"><font size=1>Linux Advanced Routing & Traffic Control Home</font></a>&nbsp;|&nbsp;
<a href="http://www.linux-france.org/prj/inetdoc/download/Advanced-routing-Howto.pdf" class="browse"><font size=1>Version Française en PDF</font></a>&nbsp;
</font></div>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	</TABLE>
      </form>
      <!-- banner menu end -->
    </TD>
  </TR>
  <TR>
    <TD width=25% bgcolor=#330066 align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR>
	  <TD bgcolor=#330066 align=center>
	    &nbsp;<!-- no Toc section in guides/Advanced-routing-Howto/Advanced-routing-Howto.v0.9.html -->
      	    <br>
      	    <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
              <TR>
	  	<TD bgcolor=#000000 align=center>
	    	  <TABLE width=100% border=0 cellpadding=2 cellspacing=1>
              	    <TR>
	              <TH bgcolor=#FFCC66 align="center" valign="top" class="toc-title">
		        <a class="toc-title" href="mailto:philippe.latu@linux-france.org">
	        	  Contact<img src="/prj/inetdoc/images/envelope.gif" border=0 width=50 height=35 align="middle" alt="mail">
		  	</a>
		      </TH>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		        &nbsp;<a class="toc-item" href="/prj/inetdoc/log/">Carnet de bord</a>
		      </TD>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		  	&nbsp;<a class="toc-item" href="/prj/inetdoc/legal/">Notice légale</a>
		      </TD>
              	    </TR>
            	  </TABLE>
	  	</TD>
              </TR>
      	    </TABLE>
          </TD>
        </TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=8 align=center>
        <TR>
	  <TD bgcolor=#FFFFFF align=left valign=top>
            <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta name="generator" content=
"HTML Tidy for Linux/x86 (vers 1st February 2002), see www.w3.org">
<meta name="GENERATOR" content="LinuxDoc-Tools 0.9.18">
<title>HOWTO du routage avancé et du contrôle de trafic sous Linux:
Équilibrage de charge sur plusieurs interfaces</title>
<link href="Advanced-routing-Howto.v0.9-11.html" rel="next">
<link href="Advanced-routing-Howto.v0.9-9.html" rel="previous">
<link href="Advanced-routing-Howto.v0.9.html#toc10" rel="contents">
</head>
<body>
<a href="Advanced-routing-Howto.v0.9-11.html">Page suivante</a> <a
href="Advanced-routing-Howto.v0.9-9.html">Page précédente</a> <a
href="Advanced-routing-Howto.v0.9.html#toc10">Table des
matières</a> 

<hr>
<h2><a name="s10">10.</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc10">Équilibrage de charge sur
plusieurs interfaces</a></h2>

<p>Il y a plusieurs manières de faire ceci. Une des plus faciles et
des plus directes est 'TEQL' - True (ou Trivial) Link Equalizer.
Comme la plupart des éléments en relation avec la gestion de file
d'attente, l'équilibrage de charge est bidirectionnel. Les deux
équipements terminaux du lien ont besoin de participer pour un
effet optimal.</p>

<p>Imaginer la situation suivante&nbsp;:</p>

<blockquote>
<pre>
<code>                 +-------+   eth1   +-------+
                 |       |==========|       |
 'réseau 1' -----|   A   |          |   B   |---- 'réseau 2'
                 |       |==========|       |
                 +-------+   eth2   +-------+
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>A et B sont des routeurs que nous supposerons pour le moment
fonctionner sous Linux. Si le trafic va du réseau 1 vers le réseau
2, le routeur A a besoin de distribuer les paquets sur les deux
liens allant vers B. Le routeur B a besoin d'être configuré pour
accepter ceci. On a la même chose dans le sens inverse, pour les
paquets allant du réseau 2 vers le réseau 1. Le routeur B a besoin
d'envoyer les paquets à la fois sur eth1 et eth2.</p>

<p>La répartition est faite par un périphérique 'TEQL', comme ceci
(cela ne pouvait pas être plus simple)&nbsp;:</p>

<blockquote>
<pre>
<code># tc qdisc add dev eth1 root teql0
# tc qdisc add dev eth2 root teql0
# ip link set dev teql0 up
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>N'oubliez pas la commande 'ip link set up'&nbsp;!</p>

<p>Ceci a besoin d'être fait sur les deux hôtes. Le périphérique
teql0 est basiquement un distributeur tourniquet au dessus de eth1
et eth2 pour l'envoi des paquets. Aucunes données n'arrivent jamais
à travers un périphérique teql, mais apparaissent sur eth1 et
eth2.</p>

<p>Nous n'avons pour le moment que les périphériques et nous avons
également besoin d'un routage correct. L'une des possibilités pour
réaliser cela est d'assigner un réseau /31 sur chacun des liens,
ainsi que sur le périphérique teql0&nbsp;:</p>

<p>FIXME: Avons nous besoin de quelque chose comme
'nobroadcast'&nbsp;? Un /31 est trop petit pour contenir une
adresse réseau et une adresse de diffusion. Si cela ne marche pas
comme prévu, essayer un /30, et ajuster les adresses IP. Vous
pouvez même essayer sans attribuer d'adresses à eth1 et eth2.</p>

<p>Sur le router A:</p>

<blockquote>
<pre>
<code># ip addr add dev eth1 10.0.0.0/31
# ip addr add dev eth2 10.0.0.2/31
# ip addr add dev teql0 10.0.0.4/31
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>Sur le router B:</p>

<blockquote>
<pre>
<code># ip addr add dev eth1 10.0.0.1/31
# ip addr add dev eth2 10.0.0.3/31
# ip addr add dev teql0 10.0.0.5/31
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>Le routeur A devrait maintenant être capable de pinguer
10.0.0.1, 10.0.0.3 et 10.0.0.5 à travers les deux liens physiques
et le périphérique "égalisé". Le routeur A devrait maintenant être
capable de pinguer 10.0.0.0, 10.0.0.2 et 10.0.0.4 à travers les
liens.</p>

<p>Si cela marche, le routeur A peut prendre 10.0.0.5 comme route
vers le réseau 2 et le routeur B 10.0.0.4 comme route vers le
réseau 1. Pour le cas particulier où le réseau 1 est votre réseau
chez vous et où le réseau 2 est l'Internet, le routeur A peut
prendre 10.0.0.5 comme passerelle par défaut.</p>

<h2><a name="ss10.1">10.1</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc10.1">Avertissement</a></h2>

<p>Rien n'est aussi simple qu'il y parait. Eth1 et eth2 sur les
deux routeurs A et B doivent avoir le filtrage par chemin inverse
désactivé. Dans le cas contraire, ils rejeteront les paquets
destinés à des adresses autres que les leurs&nbsp;:</p>

<blockquote>
<pre>
<code># echo 0 &gt; /proc/net/ipv4/conf/eth1/rp_filter
# echo 0 &gt; /proc/net/ipv4/conf/eth2/rp_filter
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>Il y a un sale problème de réarrangement des paquets. Supposons
que six paquets aient besoin d'être envoyés de A vers B. Eth1 peut,
par exemple, traiter les paquets 1, 3 et 5 et eth2 les paquets 2, 4
et 6. Dans un monde idéal, le routeur B devrait recevoir ces
paquets dans l'ordre 1, 2, 3, 4, 5, 6. Mais le fait le plus
probable est que le noyau les reçoive comme ceci&nbsp;: 2, 1, 4, 3,
6, 5. Le problème est que cela va perturber TCP/IP. Alors qu'il n'y
a pas de problèmes pour les liens transportant différentes sessions
TCP/IP, vous ne serez pas capable de regrouper plusieurs liens et
obtenir par ftp un simple fichier beaucoup plus rapidement, à moins
que le système d'exploitation envoyant ou recevant ne soit Linux.
En effet, celui-ci n'est pas facilement perturbé par de simples
réarrangements.</p>

<p>Cependant, l'équilibrage de charge est une bonne idée pour de
nombreuses applications.</p>

<hr>
<a href="Advanced-routing-Howto.v0.9-11.html">Page suivante</a> <a
href="Advanced-routing-Howto.v0.9-9.html">Page précédente</a> <a
href="Advanced-routing-Howto.v0.9.html#toc10">Table des
matières</a>
</body>
</html>


	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
  <TR>
    <TD colspan=2 width=100% bgcolor=#990000 align=left>
      <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
        <TR>
	  <TD bgcolor=#990000 align=right>
	    <div class="filemodtime">
	      <i>Dernière modification le : 4 March 2002 12:04</i>
	    </div>
      	    <a style="text-decoration:none" href="http://www.php.net">
              <img src="/prj/inetdoc/images/php-small-trans-dark.gif" border=0 width=88 height=31 alt="php logo">
      	    </a>
      	    &nbsp;&nbsp;
      	    <a style="text-decoration:none" href="http://www.debian.org">
              <img src="/prj/inetdoc/images/openlogo-25.jpg" border=0 width=25 height=30 alt="debian logo">
      	    </a>
      	    &nbsp;&nbsp;
	    <!-- stat_code_start
	    <a style="text-decoration:none" href="http://www.estat.com/getstats?serial=21701747824">
	      <img src="http://perso.estat.com/cgi-bin/perso/21701747824?page=marque_perso" border=0>
	    </a>
	     stat_code_end -->
	    <!-- eStat -->
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      var _UJS=0;
	      //-->
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript" SRC="http://perso.estat.com/js/m.js">
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      if(_UJS) _estat('21701747824','Page_D_Accueil','Accueil');
	      //-->
	    </SCRIPT>
	    <!-- /eStat -->
	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
</TABLE>
</body>
</html>
<!-- END: main.tpl -->
