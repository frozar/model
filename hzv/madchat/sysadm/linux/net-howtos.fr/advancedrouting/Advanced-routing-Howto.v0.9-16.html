<!-- NAME: main.tpl -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
  <head>
    <title>L i n u x [inetdoc]: (Guides) </title>
    <meta HTTP-EQUIV="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="Content-Language" content="fr">
    <meta name="description" content="inet doc linux">
    <meta name="author" content="philippe.latu@linux-france.org">
    <meta name="copyright" content="(c)2000 Philippe Latu">
    <meta name="publisher" content="philippe.latu@linux-france.org">
    <meta name="keywords" content="documentation, ethernet, formation, guide, ieee, ifconfig, inet, interface, ip, iproute2, iptables, isdn, IUT, IUP, latu, linux, net, OSI, ping, reseau, RNIS, route, routage, TCP, TCP/IP, UDP">
    <meta name="audience" content="All, Tous">
    <meta name="robots" content="INDEX,FOLLOW">
    <link rel="STYLESHEET" type="text/css" href="/prj/inetdoc/style/docstyle.css">
    <script language="javascript" type="text/javascript">
      <!-- for javascript enabled browser's only
        if (top.location != location) top.location.href = location.href;
	
        function popup(form) {
          optionIndex = form.banner.SelectedIndex;
          if (optionIndex == 0) return;
          location.href = form.banner.options[form.banner.selectedIndex].value;
          }
      // end script hiding -->
    </script>
  </head>
<BODY BGCOLOR="#FFFFFF" TEXT="#990000" LINK="#990000" VLINK="#990000" ALINK="#990000" leftMargin="0" topMargin="0" marginheight="0" marginwidth="0">
<TABLE width=100% border=0 cellspacing=2 cellpadding=0 align=center>
  <TR>
    <TD width=25% bgcolor=#990000 align=center valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
      	</TR>
	<TR>
	  <TD bgcolor=#990000 align=center>
	    <a class="nodecor" href="/prj/inetdoc">
              <IMG src="/prj/inetdoc/images/upleft.png" border=0 width=158 height=96 hspace=10 alt="logo">
      	    </a>
	  <TD>
	</TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <!-- banner menu start -->
      <form>
        <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
	  <!-- 1st row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FF9966>
	      <TABLE width="100%" border="0" cellspacing="3" cellpadding="0" width="100%">
	        <TR>
		  <th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/">&nbsp;Accueil</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/articles/">&nbsp;Articles</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/courses/">&nbsp;Cours</a>
</th>
<th align="left" valign="top" bgcolor="white">
  <a class="reduced" href="/prj/inetdoc/i/net/guides/">&nbsp;Guides</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/formation/">&nbsp;Formation</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/download/">&nbsp;Téléchargement</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/source/">&nbsp;Source</a>
</th>

		</TR>
	      </TABLE>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 2nd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FFCC66>
	      <FONT color=#990000 size=-1 face="Arial, 'Myriad Web', Syntax, sans-serif"><B>
	       <SELECT name="banner" onChange="popup(this.form)">
	         <OPTION value="/prj/inetdoc/i/net/articles/model/tcpip.html">
  Modélisation TCP/IP
</OPTION>
<OPTION value="/prj/inetdoc/i/net/../../download/Advanced-routing-Howto.pdf">
  Téléchargement Linux 2.4 Advanced Routing HOWTO VF
</OPTION>
<OPTION value="/prj/inetdoc/i/net/guides/">
  Autres guides
</OPTION>

	       </SELECT>
	      </B></FONT>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 3rd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor="#990000" align="left" valign="middle" width="100%" height="100%">
	      <div class="browse"><font size=1>&nbsp;&nbsp;Références : <a href="http://netfilter.samba.org/" class="browse"><font size=1>Netfilter Home</font></a>&nbsp;|&nbsp;
<a href="http://lartc.org/" class="browse"><font size=1>Linux Advanced Routing & Traffic Control Home</font></a>&nbsp;|&nbsp;
<a href="http://www.linux-france.org/prj/inetdoc/download/Advanced-routing-Howto.pdf" class="browse"><font size=1>Version Française en PDF</font></a>&nbsp;
</font></div>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	</TABLE>
      </form>
      <!-- banner menu end -->
    </TD>
  </TR>
  <TR>
    <TD width=25% bgcolor=#330066 align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR>
	  <TD bgcolor=#330066 align=center>
	    &nbsp;<!-- no Toc section in guides/Advanced-routing-Howto/Advanced-routing-Howto.v0.9.html -->
      	    <br>
      	    <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
              <TR>
	  	<TD bgcolor=#000000 align=center>
	    	  <TABLE width=100% border=0 cellpadding=2 cellspacing=1>
              	    <TR>
	              <TH bgcolor=#FFCC66 align="center" valign="top" class="toc-title">
		        <a class="toc-title" href="mailto:philippe.latu@linux-france.org">
	        	  Contact<img src="/prj/inetdoc/images/envelope.gif" border=0 width=50 height=35 align="middle" alt="mail">
		  	</a>
		      </TH>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		        &nbsp;<a class="toc-item" href="/prj/inetdoc/log/">Carnet de bord</a>
		      </TD>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		  	&nbsp;<a class="toc-item" href="/prj/inetdoc/legal/">Notice légale</a>
		      </TD>
              	    </TR>
            	  </TABLE>
	  	</TD>
              </TR>
      	    </TABLE>
          </TD>
        </TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=8 align=center>
        <TR>
	  <TD bgcolor=#FFFFFF align=left valign=top>
            <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta name="generator" content=
"HTML Tidy for Linux/x86 (vers 1st February 2002), see www.w3.org">
<meta name="GENERATOR" content="LinuxDoc-Tools 0.9.18">
<title>HOWTO du routage avancé et du contrôle de trafic sous Linux:
Construire des ponts et des pseudo-ponts avec du Proxy ARP</title>
<link href="Advanced-routing-Howto.v0.9-17.html" rel="next">
<link href="Advanced-routing-Howto.v0.9-15.html" rel="previous">
<link href="Advanced-routing-Howto.v0.9.html#toc16" rel="contents">
</head>
<body>
<a href="Advanced-routing-Howto.v0.9-17.html">Page suivante</a> <a
href="Advanced-routing-Howto.v0.9-15.html">Page précédente</a> <a
href="Advanced-routing-Howto.v0.9.html#toc16">Table des
matières</a> 

<hr>
<h2><a name="s16">16.</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc16">Construire des ponts et
des pseudo-ponts avec du Proxy ARP</a></h2>

<p>Les ponts sont des périphériques qui peuvent être installés dans
un réseau sans aucune reconfiguration. Un commutateur réseau est
basiquement un pont multi-ports. Un pont est souvent un commutateur
avec 2 ports. Cependant, Linux supporte très bien plusieurs
interfaces dans un pont, le conduisant à fonctionner comme un vrai
commutateur.</p>

<p>Les ponts sont souvent déployés quant on est confronté à un
réseau défaillant qui a besoin d'être réparé sans aucune
modification. Dans la mesure où un pont est un équipement de niveau
2, la couche sous la couche IP, les routeurs et serveurs ne sont
pas conscients de son existence. Ceci signifie que vous pouvez
bloquer ou modifier certains paquets de manière transparente ou
mettre en forme le trafic.</p>

<p>Un autre élément positif est qu'un pont peut souvent être
remplacé par un câble croisé ou un hub quand il tombe en panne.</p>

<p>L'aspect négatif est que le mise en place d'un pont peut
engendrer beaucoup de confusion, à moins qu'il ne soit très bien
configuré. Le pont n'apparaît pas dans les traceroute, mais
pourtant des paquets disparaissent sans raison ou sont changés en
allant d'un point A à un point B. Vous devriez également vous
demander si une organisation qui "ne veut rien changer" fait le bon
choix.</p>

<p>Le "pont Linux 2.4" est documenté sur <a href=
"http://bridge.sourceforge.net/">cet page</a>.</p>

<h2><a name="ss16.1">16.1</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc16.1">Etat des ponts et
iptables</a></h2>

<p>Au moment de Linux 2.4.14, le pont et iptables ne se "voient"
pas l'un l'autre sans une aide. Si vous "pontez" les paquets de
eth0 à eth1, ils ne "passent" pas par iptables. Ceci signifie que
vous ne pouvez pas faire de filtrage, de translation d'adresse
(NAT), de dessosage ou quoique ce soit d'autres.</p>

<p>Il y a plusieurs projets continuant de corriger ceci, le
meilleur étant celui de l'auteur du code du pont Linux 2.4, Lennert
Buytenhek. il nous récemment informé qu'à partir de bridge-nf 0.0.2
(voir l'url ci-dessus), le code est stable et utilisable dans un
environnement de production. Il demande maintenant aux responsables
du noyau si et comment la mise à jour peut être ajoutée. Rester
branché&nbsp;!</p>

<p>Nous comptons que ce problème soit bientôt résolu.</p>

<h2><a name="ss16.2">16.2</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc16.2">Pont et mise en
forme</a></h2>

<p>Ca marche comme dans les réclames. Soyez sûr du coté attribué à
chaque interface. Autrement, il se peut que vous mettiez en forme
le trafic sortant au niveau de votre interface interne, ce qui ne
marchera pas. Utilisez tcpdump si nécessaire.</p>

<h2><a name="ss16.3">16.3</a> <a href=
"Advanced-routing-Howto.v0.9.html#toc16.3">Pseudo-pont avec du
Proxy-ARP</a></h2>

<p>Si vous voulez juste implémenter un pseudo-pont, allez jusqu'à
la section "Implémentez-le". Cependant, il est sage de lire un peu
la façon dont il fonctionne en pratique.</p>

<p>Un pseudo-pont travaille de manière un peu différente. Par
défaut, un pont transmet les paquets sans les altérer d'une
interface à une autre. Il ne regarde que l'adresse matérielle des
paquets pour déterminer où ils doivent aller. Ceci signifie que
vous pouvez "pontez" un trafic que Linux ne comprend pas, aussi
longtemps qu'il y a une adresse matérielle.</p>

<p>Un "pseudo-pont" travaille différemment et ressemble plus à un
routeur caché qu'à un pont. Mais, comme un pont, il a un impact
faible sur l'architecture du réseau.</p>

<p>Le fait qu'il ne soit pas un pont présente l'avantage que les
paquets traversent réellement le noyau, et peuvent être filtrés,
modifiés, redirigés ou reroutés.</p>

<p>Un pont réel peut également réaliser ces tours de force, mais il
a besoin d'un code spécial, comme le Ethernet Frame Diverter ou la
mise à jour mentionnée au-dessus.</p>

<p>Un autre avantage d'un pseudo-pont est qu'il ne transmet pas les
paquets qu'il ne comprend pas, nettoyant ainsi votre réseau de
beaucoup de cochonneries. Dans le cas où vous auriez besoin de ces
cochonneries (comme les paquets SAP ou Netbeui), utilisez un vrai
pont.</p>

<h3>ARP &amp; Proxy-ARP</h3>

<p>Quand un hôte veut dialoguer avec un autre hôte sur le même
segment physique, il envoie un paquet du Protocole de Résolution
d'Adresse (ARP) qui, en simplifiant quelque peu, est lu comme
ceci&nbsp;: "Qui a 10.0.0.1, le dire à 10.0.0.7". En réponse à
ceci, 10.0.0.1 renvoie un petit paquet "ici".</p>

<p>10.0.0.7 envoie alors des paquets à l'adresse matérielle
mentionnée dans le paquet "ici". Il met dans un cache cette adresse
matérielle pour un temps relativement long et, après l'expiration
du cache, repose sa question.</p>

<p>Quand on construit un pseudo-pont, on configure le pont pour
qu'il réponde à ces paquets ARP, les hôtes du réseau envoyant alors
leurs paquets au pont. Le pont traite alors ces paquets et les
envoie à l'interface adaptée.</p>

<p>Donc, en résumé, quand un hôte d'un coté du pont demande
l'adresse matérielle d'un hôte se situant de l'autre coté, le pont
répond avec un paquet qui dit "transmets le moi".</p>

<p>De cette façon, tout le trafic de données est transmis à la
bonne place et il traverse toujours le pont.</p>

<h3>Implémentez-le</h3>

<p>Les versions anciennes du noyau linux permettait de faire du
proxy ARP uniquement à une granularité sous réseaux. Ainsi, pour
configurer un pseudo-pont, il fallait spécifier les bonnes routes
vers les deux cotés du pont, et également créer les règles
proxy-ARP correspondantes. C'était pénible, déjà par la quantité de
texte qu'il fallait taper, puis parce qu'il était facile de se
tromper et créer des configurations erronées, où le pont répondait
à des requêtes pour des réseaux qu'il ne savait pas router.</p>

<p>Avec Linux 2.4 (et peut-être bien le 2.2), cette possibilité a
été retirée et a été remplacée par une option dans le répertoire
/proc, appelée "proxy-arp". La procédure pour construire un
pseudo-pont est maintenant&nbsp;:</p>

<ol>
<li>Assigner une adresse à chaque interface, la "gauche" et la
"droite"</li>

<li>Créer des routes pour que votre machine connaisse quels hôtes
résident à gauche et quels hôtes résident à droite</li>

<li>Activer le proxy-ARP sur chaque interface<br>
echo 1 &gt; /proc/sys/net/ipv4/conf/ethL/proxy_arp<br>
echo 1 &gt; /proc/sys/net/ipv4/conf/ethR/proxy_arp<br>
où L et R désignent les numéros de l'interface du coté gauche
(Left) et de celle du coté droit (Right)</li>
</ol>

<br>
<br>
 

<p>N'oubliez pas également d'activer l'option ip_forwarding&nbsp;!
Quant on convertit un vrai pont, il se peut que vous trouviez cette
option désactivée dans la mesure où il n'y en a pas besoin pour un
pont.</p>

<p>Une autre chose que vous devriez considérer lors de la
conversion est que vous aurez besoin d'effacer le cache arp des
ordinateurs du réseau. Le cache arp peut contenir d'anciennes
adresses matérielles du pont qui ne sont plus correctes.</p>

<p>Sur un Cisco, ceci est réalisé en utilisant la commande 'clear
arp-cache' et, sous linux, en utilisant 'arp -d ip.adresse'. Vous
pouvez aussi attendre l'expiration manuelle du cache, ce qui peut
être plutôt long.</p>

<p>Il se peut que vous découvriez également que votre réseau était
mal configuré si vous avez/aviez l'habitude de spécifier les routes
sans les masques de sous réseau. Certaines versions peuvent avoir
deviner correctement de maque ou mal deviner sans pour autant vous
le notifier. Quand vous faites du routage chirurgical comme décrit
plus haut, il est *vital* que vous vérifiez vos masques de
sous-réseau.</p>

<hr>
<a href="Advanced-routing-Howto.v0.9-17.html">Page suivante</a> <a
href="Advanced-routing-Howto.v0.9-15.html">Page précédente</a> <a
href="Advanced-routing-Howto.v0.9.html#toc16">Table des
matières</a>
</body>
</html>


	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
  <TR>
    <TD colspan=2 width=100% bgcolor=#990000 align=left>
      <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
        <TR>
	  <TD bgcolor=#990000 align=right>
	    <div class="filemodtime">
	      <i>Dernière modification le : 4 March 2002 12:04</i>
	    </div>
      	    <a style="text-decoration:none" href="http://www.php.net">
              <img src="/prj/inetdoc/images/php-small-trans-dark.gif" border=0 width=88 height=31 alt="php logo">
      	    </a>
      	    &nbsp;&nbsp;
      	    <a style="text-decoration:none" href="http://www.debian.org">
              <img src="/prj/inetdoc/images/openlogo-25.jpg" border=0 width=25 height=30 alt="debian logo">
      	    </a>
      	    &nbsp;&nbsp;
	    <!-- stat_code_start
	    <a style="text-decoration:none" href="http://www.estat.com/getstats?serial=21701747824">
	      <img src="http://perso.estat.com/cgi-bin/perso/21701747824?page=marque_perso" border=0>
	    </a>
	     stat_code_end -->
	    <!-- eStat -->
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      var _UJS=0;
	      //-->
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript" SRC="http://perso.estat.com/js/m.js">
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      if(_UJS) _estat('21701747824','Page_D_Accueil','Accueil');
	      //-->
	    </SCRIPT>
	    <!-- /eStat -->
	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
</TABLE>
</body>
</html>
<!-- END: main.tpl -->
