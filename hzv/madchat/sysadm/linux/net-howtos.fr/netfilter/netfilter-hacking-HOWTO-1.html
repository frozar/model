<!-- NAME: main.tpl -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
  <head>
    <title>L i n u x [inetdoc]: (Guides) </title>
    <meta HTTP-EQUIV="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="Content-Language" content="fr">
    <meta name="description" content="inet doc linux">
    <meta name="author" content="philippe.latu@linux-france.org">
    <meta name="copyright" content="(c)2000 Philippe Latu">
    <meta name="publisher" content="philippe.latu@linux-france.org">
    <meta name="keywords" content="documentation, ethernet, formation, guide, ieee, ifconfig, inet, interface, ip, iproute2, iptables, isdn, IUT, IUP, latu, linux, net, OSI, ping, reseau, RNIS, route, routage, TCP, TCP/IP, UDP">
    <meta name="audience" content="All, Tous">
    <meta name="robots" content="INDEX,FOLLOW">
    <link rel="STYLESHEET" type="text/css" href="/prj/inetdoc/style/docstyle.css">
    <script language="javascript" type="text/javascript">
      <!-- for javascript enabled browser's only
        if (top.location != location) top.location.href = location.href;
	
        function popup(form) {
          optionIndex = form.banner.SelectedIndex;
          if (optionIndex == 0) return;
          location.href = form.banner.options[form.banner.selectedIndex].value;
          }
      // end script hiding -->
    </script>
  </head>
<BODY BGCOLOR="#FFFFFF" TEXT="#990000" LINK="#990000" VLINK="#990000" ALINK="#990000" leftMargin="0" topMargin="0" marginheight="0" marginwidth="0">
<TABLE width=100% border=0 cellspacing=2 cellpadding=0 align=center>
  <TR>
    <TD width=25% bgcolor=#990000 align=center valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
      	</TR>
	<TR>
	  <TD bgcolor=#990000 align=center>
	    <a class="nodecor" href="/prj/inetdoc">
              <IMG src="/prj/inetdoc/images/upleft.png" border=0 width=158 height=96 hspace=10 alt="logo">
      	    </a>
	  <TD>
	</TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <!-- banner menu start -->
      <form>
        <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
	  <!-- 1st row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FF9966>
	      <TABLE width="100%" border="0" cellspacing="3" cellpadding="0" width="100%">
	        <TR>
		  <th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/">&nbsp;Accueil</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/articles/">&nbsp;Articles</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/courses/">&nbsp;Cours</a>
</th>
<th align="left" valign="top" bgcolor="white">
  <a class="reduced" href="/prj/inetdoc/i/net/guides/">&nbsp;Guides</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/formation/">&nbsp;Formation</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/download/">&nbsp;Téléchargement</a>
</th>
<th align="left" valign="top" bgcolor="#FFCC99">
  <a class="reduced" href="/prj/inetdoc/i/net/source/">&nbsp;Source</a>
</th>

		</TR>
	      </TABLE>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 2nd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor=#FFCC66>
	      <FONT color=#990000 size=-1 face="Arial, 'Myriad Web', Syntax, sans-serif"><B>
	       <SELECT name="banner" onChange="popup(this.form)">
	         <OPTION value="/prj/inetdoc/i/net/../../download/netfilter-hacking-HOWTO.pdf">
  Téléchargement netfilter hacking HOWTO VF
</OPTION>
<OPTION value="/prj/inetdoc/i/net/guides/">
  Autres guides
</OPTION>

	       </SELECT>
	      </B></FONT>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#FFFFFF><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <!-- 3rd row -->
	  <TR align=right> 
	    <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR>
	    <TD bgcolor="#990000" align="left" valign="middle" width="100%" height="100%">
	      <div class="browse"><font size=1>&nbsp;&nbsp;Références : <a href="http://netfilter.samba.org/" class="browse"><font size=1>Netfilter Home</font></a>&nbsp;
</font></div>
	    </TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#990000><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=4 alt=""></TD>
	  </TR>
	  <TR align=right> 
	    <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	  </TR>
	</TABLE>
      </form>
      <!-- banner menu end -->
    </TD>
  </TR>
  <TR>
    <TD width=25% bgcolor=#330066 align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=0 align=center>
        <TR align=right> 
	  <TD bgcolor=#FF9966><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=2 alt=""></TD>
	</TR>
	<TR align=right> 
	  <TD bgcolor=#330066><IMG src="/prj/inetdoc/images/blank.gif" width=1 height=1 alt=""></TD>
	</TR>
	<TR>
	  <TD bgcolor=#330066 align=center>
	    &nbsp;<!-- no Toc section in guides/netfilter-hacking-HOWTO/netfilter-hacking-HOWTO.html -->
      	    <br>
      	    <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
              <TR>
	  	<TD bgcolor=#000000 align=center>
	    	  <TABLE width=100% border=0 cellpadding=2 cellspacing=1>
              	    <TR>
	              <TH bgcolor=#FFCC66 align="center" valign="top" class="toc-title">
		        <a class="toc-title" href="mailto:philippe.latu@linux-france.org">
	        	  Contact<img src="/prj/inetdoc/images/envelope.gif" border=0 width=50 height=35 align="middle" alt="mail">
		  	</a>
		      </TH>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		        &nbsp;<a class="toc-item" href="/prj/inetdoc/log/">Carnet de bord</a>
		      </TD>
              	    </TR>
              	    <TR>
	              <TD bgcolor=#FFCC99 align=center valign=top class="toc-item">
		  	&nbsp;<a class="toc-item" href="/prj/inetdoc/legal/">Notice légale</a>
		      </TD>
              	    </TR>
            	  </TABLE>
	  	</TD>
              </TR>
      	    </TABLE>
          </TD>
        </TR>
      </TABLE>
    </TD>
    <TD width=75% bgcolor=#FFFFFF align=left valign=top>
      <TABLE width=100% border=0 cellspacing=0 cellpadding=8 align=center>
        <TR>
	  <TD bgcolor=#FFFFFF align=left valign=top>
            <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta name="generator" content=
"HTML Tidy for Linux/x86 (vers 1st March 2002), see www.w3.org">
<meta name="GENERATOR" content="LinuxDoc-Tools 0.9.21">
<title>Linux netfilter Hacking HOWTO: Introduction</title>
<link href="netfilter-hacking-HOWTO-2.html" rel="next">
<link href="netfilter-hacking-HOWTO.html#toc1" rel="contents">
</head>
<body>
<a href="netfilter-hacking-HOWTO-2.html">Page suivante</a> Page
précédente <a href="netfilter-hacking-HOWTO.html#toc1">Table des
matières</a> 

<hr>
<h2><a name="intro"></a> <a name="s1">1.</a> <a href=
"netfilter-hacking-HOWTO.html#toc1">Introduction</a></h2>

<p>Salut,</p>

<p>Ce document est un périple; quelques parties vous aiderons bien,
alors que dans d'autres vous serez presque seuls. Le meilleur
conseil que je puisse vous donner est d'attraper une grande bonne
tasse de café, ou de chocolat chaud, de vous prendre une chaise
confortable, et de lire le contenu de ce document avant de vous
aventurer tout seul dans le dangereux monde du "network
hacking".</p>

<p>Pour comprendre mieux l'usage de l'infrastructure au dessus de
netfilter, je vous recommande la lecture du "Packet Filtering
HOWTO" et du "NAT HOWTO". Pour plus d'informations sur la
programmation kernel, je vous suggère le "Rusty's Unreliable Guide
to Kernel Hacking" et le "Rusty's Ureliable Guide to Kernel
Locking".</p>

<p>(C) 2000 Paul `Rusty' Russell. Sous licence GNU GPL.</p>

<h2><a name="ss1.1">1.1</a> <a href=
"netfilter-hacking-HOWTO.html#toc1.1">Qu'est ce qu'est Netfilter
?</a></h2>

<p>Premièrement, Netfilter est un canevas pour modifier les paquets
réseaux, en dehors de l'interface de sockets Berkeley. Il est
composé de 4 parties. D'abord, chaque protocole définit des "hooks"
(accroches) (IPv4 en définit 5) qui sont des points bien déterminés
dans le trajet du paquet dans la pile de protocole. A chacun de ces
points, le protocole va appeler le canevas de Netfilter et lui
passer le paquet et le numéro de "hook".</p>

<p>Deuxièmement, des parties du kernel peuvent s'enregistrer pour
écouter à différents "hooks" pour chacun des protocoles. Donc quand
un paquet est passé au canevas Netfilter, ce dernier va vérifier si
quelqu'un s'est enregistré pour ce protocole et ce "hook". Si c'est
le cas, ils vont tous avoir une chance d'examiner (et aussi
modifier) le paquet dans l'ordre, et ensuite de : se débarrasser du
paquet (<code>NF_DROP</code>), de l'autoriser à passer
(<code>NF_ACCEPT</code>), de dire à netfilter d'oublier le paquet
(<code>NF_STOLEN</code>), ou de dire à Netfilter de queuter le
paquet en userspace (<code>NF_QUEUE</code>).</p>

<p>Troisièmement, les paquets qui ont été queues, sont récupérés
(par le driver ip_queue) pour les envoyer en userspace. Ces paquets
sont gérés asynchronement.</p>

<p>La partie finale consiste en commentaires cools dans le code et
de la documentation. C'est très important dans tous projets
expérimentaux. Le moto de netfilter est (volé sans aucune honte de
Cort Dougan) :</p>

<blockquote>
<pre>
<code>        ``So... how is this better than KDE?''  (``Alors ... en quoi c'est mieux que KDE ?'')
</code>
</pre>
</blockquote>

<br>
<br>
 

<p>(Ce moto a presque réussi sont chemin : `Whip me, beat me, make
me use ipchains' (`Fouettez moi, battez moi, faites moi utiliser
ipchains'))</p>

<p>Additionnellement à ce canevas nu, des modules divers ont été
écrits, pour fournir les mêmes fonctionnalités que les anciens
(pre-netfilter) kernels, et en particulier un système NAT
extensible, et un système de filtrage de paquets extensible lui
aussi (iptables).</p>

<h2><a name="ss1.2">1.2</a> <a href=
"netfilter-hacking-HOWTO.html#toc1.2">Qu'est ce qui n'allait pas
avec ce qu'on avait dans les 2.0 et</a> les 2.2 ?</h2>

<ol>
<li>Pas d'infrastructure établie pour passer des paquets au
userspace: 

<ul>
<li>La programmation kernel est difficile.</li>

<li>La programmation kernel doit être faite en C/C++</li>

<li>Les polices de filtrage dynamiques n'ont pas de place justifiée
dans le kernel.</li>

<li>2.2 a introduit la possibilité de copier des paquets vers le
userspace via netlink, mais re-injecter des paquets était lent, et
sujet aux vérifications de `sanité'. ex: la re-injection d'un
paquet se disant provenir d'une interface existante n'était pas
possible.</li>
</ul>
</li>

<li>Le proxy transparent était bordellique : 

<ul>
<li>On vérifie <b>tous</b> les paquets pour voir si il y une socket
attachée à cette adresse.</li>

<li>root a le droit d'attacher une socket à une adresse
étrangère.</li>

<li>Impossible de rediriger les paquets générés localement.</li>

<li>REDIRECT ne gère pas les réponses UDP : rediriger les paquets
UDP de named vers le port 1153 ne marche pas parce que quelques
clients n'aiment pas que la réponse arrive avec un port source
diffèrent de 53.</li>

<li>REDIRECT ne se synchronise pas avec l'allocation de port
TCP/UDP : un utilisateur peut avoir un port masqué par une règle
REDIRECT.</li>

<li>A été cassé au moins 2 fois pendant la série des 2.1.</li>

<li>Le code est extrêmement intrusif. Considérez les stats sur le
nombre de `#ifdef CONFIG_IP_TRANSPARENT_PROXY' dans le 2.2.1 : 34
occurrences dans 11 fichiers. Comparez cela à `CONFIG_IP_FIREWALL',
qui a 10 occurrences dans 5 fichiers.</li>
</ul>
</li>

<li>Créer une règle de filtrage de paquets indépendamment de
l'adresse de l'interface n'est pas possible: 

<ul>
<li>Obligation de savoir l'adresse de l'interface locale pour
distinguer les paquets générés localement ou les paquet terminant
en local, des paquets qui traversent seulement.</li>

<li>Même cela n'est pas suffisant dans les cas de redirection ou de
masquerading.</li>

<li>La chaîne FORWARD seule a les informations sur le paquet qui
sortent, ce qui veut dire que vous avez à deviner d'où le paquet
est venu, ou vous avez besoin d'une bonne connaissance de la
topologie du réseau que vous utilisez.</li>
</ul>
</li>

<li>Le masquerading est cloué sur le filtrage de paquets: 

<p>Les interactions entre le masquerading et le filtrage de paquets
rendent le firewalling complexe.</p>

<ul>
<li>Lors du filtrage dans INPUT, les paquets semblent être destinés
à la machine elle même.</li>

<li>Lors du filtrage dans FORWARD, les paquets démasqueradés ne
sont pas vu du tout.</li>

<li>Lors du filtrage dans OUTPUT, les paquets semblent venir de la
machine locale</li>
</ul>

<br>
<br>
</li>

<li>La manipulation du TOS, redirection, ``ICMP unreachable'' et le
marquage de paquets (qui peu affecter le port-forwarding, le
routage, et le QoS) sont cloués sur le code de filtrage de paquets
aussi.</li>

<li>Le code d'ipchains n'est ni modulaire, ni extensible (par
exemple: le filtrage basé sur la adresse MAC, le filtrage des
options, etc).</li>

<li>Le manque d'infrastructure suffisante a mené à la profusion de
différentes techniques : 

<ul>
<li>Masquerading, plus des modules pour certains protocoles.</li>

<li>La NAT rapide par le code de routage (n'a pas de module qui
gère certains protocoles).</li>

<li>Le port-forwarding, la redirection, et le auto-forwarding</li>
</ul>
</li>

<li>Incompatibilité entre CONFIG_NET_FASTROUTE et le filtrage de
paquets: 

<ul>
<li>Les paquets qui ne font que nous traverser doivent passer par
trois chaînes de toutes façons.</li>

<li>Impossible de dire si ces chaînes peuvent être évitées.</li>
</ul>
</li>

<li>L'inspection de paquets détruits est impossible à cause d'une
protection de routage (par exemple: la vérification d'adresse
source).</li>

<li>Impossible de lire automatiquement les compteurs sur les règle
de filtrage de paquets.</li>

<li>CONFIG_IP_ALWAYS_DEFRAG est une option à la compilation
seulement, rendant la vie difficile pour les distributions qui
veulent un kernel général.</li>
</ol>

<br>
<br>
 

<h2><a name="ss1.3">1.3</a> <a href=
"netfilter-hacking-HOWTO.html#toc1.3">Qui êtes vous ?</a></h2>

<p>Je suis le seul à être assez fou pour faire ça. En tant que
co-auteur de ipchains et maintenant mainteneur du Linux Kernel IP
Firewall, je vois beaucoup des problèmes que les gens ont avec le
système actuel, en même temps d'avoir des informations sur ce
qu'ils tentent de faire.</p>

<h2><a name="ss1.4">1.4</a> <a href=
"netfilter-hacking-HOWTO.html#toc1.4">Pourquoi ça plante ?</a></h2>

<p>Ah bon ?! Bah fallait voir comment c'était la semaine
<b>dernière</b> !</p>

<p>Parce que je ne suis pas un aussi bon programmeur que ce que
tout le monde espère, et je n'ai certainement pas testé tous les
scénarios, parce que je manque de temps/équipement et/ou
d'inspiration. J'ai effectivement une ``test-suite'', que je vous
encourage à améliorer.</p>

<hr>
<a href="netfilter-hacking-HOWTO-2.html">Page suivante</a> Page
précédente <a href="netfilter-hacking-HOWTO.html#toc1">Table des
matières</a>
</body>
</html>


	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
  <TR>
    <TD colspan=2 width=100% bgcolor=#990000 align=left>
      <TABLE width=100% border=0 cellpadding=0 cellspacing=4>
        <TR>
	  <TD bgcolor=#990000 align=right>
	    <div class="filemodtime">
	      <i>Dernière modification le : 30 May 2002 21:11</i>
	    </div>
      	    <a style="text-decoration:none" href="http://www.php.net">
              <img src="/prj/inetdoc/images/php-small-trans-dark.gif" border=0 width=88 height=31 alt="php logo">
      	    </a>
      	    &nbsp;&nbsp;
      	    <a style="text-decoration:none" href="http://www.debian.org">
              <img src="/prj/inetdoc/images/openlogo-25.jpg" border=0 width=25 height=30 alt="debian logo">
      	    </a>
      	    &nbsp;&nbsp;
	    <!-- stat_code_start
	    <a style="text-decoration:none" href="http://www.estat.com/getstats?serial=21701747824">
	      <img src="http://perso.estat.com/cgi-bin/perso/21701747824?page=marque_perso" border=0>
	    </a>
	     stat_code_end -->
	    <!-- eStat -->
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      var _UJS=0;
	      //-->
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript" SRC="http://perso.estat.com/js/m.js">
	    </SCRIPT>
	    <SCRIPT LANGUAGE="JavaScript">
	      <!--
	      if(_UJS) _estat('21701747824','Page_D_Accueil','Accueil');
	      //-->
	    </SCRIPT>
	    <!-- /eStat -->
	  </TD>
	</TR>
      </TABLE>
    </TD>
  </TR>
</TABLE>
</body>
</html>
<!-- END: main.tpl -->
