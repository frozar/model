%!PS-Adobe-3.0
%%Creator: groff version 1.10
%%CreationDate: Fri Mar 14 13:23:28 1997
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%DocumentSuppliedResources: procset grops 1.10 0
%%Pages: 8
%%PageOrder: Ascend
%%Orientation: Portrait
%%EndComments
%%BeginProlog
%%BeginResource: procset grops 1.10 0
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}bind def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/FL{
currentgray exch setgray fill setgray
}bind def
/BL/fill load def
/LW/setlinewidth load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
}bind def
/PEND{
clear
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Roman@0 ENC0/Times-Roman RE/Times-Italic@0 ENC0/Times-Italic RE
/Times-Bold@0 ENC0/Times-Bold RE
%%EndProlog
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF 3(AN)133.548 123 S(ew V)-3 E
(irtual Memory Implementation f)-.444 E(or Berk)-.3 E(eley)-.12 E/F1 9.6
/Times-Bold@0 SF(UNIX)3 E F0<ae>A/F2 10/Times-Italic@0 SF(Mar)238.63 147
Q(shall Kirk McK)-.1 E(usic)-.4 E(k)-.2 E(Mic)252.695 159 Q(hael J)-.15
E 2.5(.K)-.25 G(ar)-2.5 E(els)-.37 E/F3 10/Times-Roman@0 SF
(Computer Systems Research Group)216.48 177 Q(Computer Science Di)232.85
189 Q(vision)-.25 E
(Department of Electrical Engineering and Computer Science)166.36 201 Q
(Uni)219.725 213 Q -.15(ve)-.25 G(rsity of California, Berk).15 E(ele)
-.1 E(y)-.15 E(Berk)232.625 225 Q(ele)-.1 E 1.3 -.65(y, C)-.15 H 2.5
(alifornia 94720).65 F F2(ABSTRA)264.535 261 Q(CT)-.3 E F3 -.4(Wi)133
288.6 S .808(th the cost per byte of memory approaching that of the cos\
t per byte for disks,).4 F .477(and with \214le systems increasingly di\
stant from the host machines, a ne)108 300.6 R 2.977(wa)-.25 G .478
(pproach to the)-2.977 F 1.831
(implementation of virtual memory is necessary)108 312.6 R 4.331(.R)-.65
G 1.831(ather than preallocating sw)-4.331 F 1.831(ap space)-.1 F .583(\
which limits the maximum virtual memory that can be supported to the si\
ze of the sw)108 324.6 R(ap)-.1 E 1.265(area, the system should support\
 virtual memory up to the sum of the sizes of ph)108 336.6 R(ysical)-.05
E .519(memory plus sw)108 348.6 R .519(ap space. F)-.1 F .519
(or systems with a local sw)-.15 F .519(ap disk, b)-.1 F .52
(ut remote \214le systems, it)-.2 F .231
(may be useful to use some of the memory to k)108 360.6 R .231
(eep track of the contents of the sw)-.1 F .231(ap space)-.1 F(to a)108
372.6 Q -.2(vo)-.2 G
(id multiple fetches of the same data from the \214le system.).2 E 1.118
(The ne)133 388.2 R 3.618(wi)-.25 G 1.118
(mplementation should also add ne)-3.618 F 3.618(wf)-.25 G(unctionality)
-3.618 E 6.118(.P)-.65 G 1.118(rocesses should be)-6.118 F(allo)108
400.2 Q .15(wed to ha)-.25 F .45 -.15(ve l)-.2 H(ar).15 E .149(ge spars\
e address spaces, to map \214les into their address spaces, to map)-.18
F(de)108 412.2 Q .345(vice memory into their address spaces, and to sha\
re memory with other processes. The)-.25 F 1.028(shared address space m\
ay either be obtained by mapping a \214le into \(possibly dif)108 424.2
R(ferent\))-.25 E 1.734
(parts of their address space, or by arranging to share `)108 436.2 R
(`anon)-.74 E 1.734(ymous memory')-.15 F 4.234('\()-.74 G 1.734
(that is,)-4.234 F 1.151(memory that is zero \214ll on demand, and whos\
e contents are lost when the last process)108 448.2 R
(unmaps the memory\) with another process as is done in System V)108
460.2 Q(.)-1.29 E 1.073(One use of shared memory is to pro)133 475.8 R
1.073(vide a high-speed Inter)-.15 F 1.073(-Process Communica-)-.2 F .07
(tion \(IPC\) mechanism between tw)108 487.8 R 2.569(oo)-.1 G 2.569(rm)
-2.569 G .069(ore cooperating processes. T)-2.569 F 2.569(oi)-.8 G .069
(nsure the inte)-2.569 F(grity)-.15 E .237
(of data structures in a shared re)108 499.8 R .238
(gion, processes must be able to use semaphores to coordi-)-.15 F .737
(nate their access to these shared structures. In System V)108 511.8 R
3.237(,t)-1.29 G .737(hese semaphores are pro)-3.237 F(vided)-.15 E .584
(as a set of system calls. Unfortunately)108 523.8 R 3.084(,t)-.65 G
.584(he use of system calls reduces the throughput of)-3.084 F .389
(the shared memory IPC to that of e)108 535.8 R .389
(xisting IPC mechanisms.)-.15 F 1.988 -.8(We a)5.388 H .388
(re proposing a scheme).8 F .774
(that places the semaphores in the shared memory se)108 547.8 R .775
(gment, so that machines that ha)-.15 F 1.075 -.15(ve a)-.2 H .235(test\
-and-set instruction can handle the usual uncontested lock and unlock w\
ithout doing a)108 559.8 R .062(system call. Only in the unusual case o\
f trying to lock an already-lock)108 571.8 R .063(ed lock or in releas-)
-.1 F 1.205(ing a w)108 583.8 R 1.205
(anted lock will a system call be required.)-.1 F 1.204(The interf)6.205
F 1.204(ace will allo)-.1 F 3.704(wau)-.25 G(ser)-3.704 E(-le)-.2 E -.15
(ve)-.25 G(l).15 E 1.678
(implementation of the System V semaphore interf)108 595.8 R 1.679
(ace on most machines with a much)-.1 F(lo)108 607.8 Q
(wer runtime cost.)-.25 E EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-2-)282.17 48 Q/F1 10/Times-Bold@0 SF 2.5
(1. Moti)72 84 R -.1(va)-.1 G(tions f).1 E(or a New V)-.25 E
(irtual Memory System)-.37 E F0 1.08(The virtual memory system distrib)
97 99.6 R 1.079(uted with Berk)-.2 F(ele)-.1 E 3.579(yU)-.15 G 1.079
(NIX has serv)-3.579 F 1.079(ed its design goals admirably)-.15 F .424
(well o)72 111.6 R -.15(ve)-.15 G 2.924(rt).15 G .424
(he ten years of its e)-2.924 F 2.925(xistence. Ho)-.15 F(we)-.25 E -.15
(ve)-.25 G 2.925(rt).15 G .425(he relentless adv)-2.925 F .425
(ance of technology has be)-.25 F .425(gun to render)-.15 F 1.582
(it obsolete.)72 123.6 R 1.582(This section of the paper describes the \
current design, points out the current technological)6.582 F .266
(trends, and attempts to de\214ne the ne)72 135.6 R 2.767(wd)-.25 G .267
(esign considerations that should be tak)-2.767 F .267
(en into account in a ne)-.1 F 2.767(wv)-.25 G(ir)-2.767 E(-)-.2 E
(tual memory design.)72 147.6 Q F1 2.5(1.1. Implementation)72 171.6 R
(of 4.3BSD virtual memory)2.5 E F0 .14(All Berk)97 187.2 R(ele)-.1 E
2.64(yS)-.15 G(oftw)-2.64 E .14(are Distrib)-.1 F .14
(utions through 4.3BSD ha)-.2 F .44 -.15(ve u)-.2 H .14
(sed the same virtual memory design.).15 F(All)5.14 E 1.333
(processes, whether acti)72 199.2 R 1.633 -.15(ve o)-.25 H 3.833(rs).15
G 1.333(leeping, ha)-3.833 F 1.633 -.15(ve s)-.2 H 1.334
(ome amount of virtual address space associated with them.).15 F 1.596(\
This virtual address space is the combination of the amount of address \
space with which the)72 211.2 R 4.095(yi)-.15 G(nitially)-4.095 E .285
(started plus an)72 223.2 R 2.785(ys)-.15 G .285(tack or heap e)-2.785 F
.285(xpansions that the)-.15 F 2.785(yh)-.15 G -2.25 -.2(av e)-2.785 H
2.785(made. All)2.985 F .286(requests for address space are allocated)
2.785 F 1.262(from a)72 235.2 R -.25(va)-.2 G 1.261(ilable sw).25 F
1.261(ap space at the time that the)-.1 F 3.761(ya)-.15 G 1.261
(re \214rst made; if there is insuf)-3.761 F 1.261(\214cient sw)-.25 F
1.261(ap space left to)-.1 F 1.019
(honor the allocation, the system call requesting the address space f)72
247.2 R 1.02(ails synchronously)-.1 F 6.02(.T)-.65 G 1.02
(hus, the limit to)-6.02 F -.2(av)72 259.2 S
(ailable virtual memory is established by the amount of sw)-.05 E
(ap space allocated to the system.)-.1 E .224
(Memory pages are used in a sort of shell g)97 274.8 R .223
(ame to contain the contents of recently accessed locations.)-.05 F .08
(As a process \214rst references a location a ne)72 286.8 R 2.58(wp)-.25
G .08
(age is allocated and \214lled either with initialized data or zeros)
-2.58 F .667(\(for ne)72 298.8 R 3.167(ws)-.25 G .667
(tack and break pages\).)-3.167 F .667(As the supply of free pages be)
5.667 F .666(gins to run out, dirty pages are pushed to)-.15 F .671
(the pre)72 310.8 R .671(viously allocated sw)-.25 F .671
(ap space so that the)-.1 F 3.172(yc)-.15 G .672
(an be reused to contain ne)-3.172 F .672(wly f)-.25 F .672
(aulted pages.)-.1 F .672(If a pre)5.672 F(vi-)-.25 E .675
(ously accessed page that has been pushed to sw)72 322.8 R .674
(ap is once ag)-.1 F .674
(ain used, a free page is reallocated and \214lled)-.05 F(from the sw)72
334.8 Q(ap area [Babaoglu79], [Someren84].)-.1 E F1 2.5(1.2. Design)72
358.8 R(assumptions f)2.5 E(or 4.3BSD virtual memory)-.25 E F0 .563(The\
 design criteria for the current virtual memory implementation were mad\
e in 1979.)97 374.4 R .564(At that time)5.564 F .275
(the cost of memory w)72 386.4 R .275
(as about a thousand times greater per byte than magnetic disks.)-.1 F
.274(Most machines were)5.274 F .389
(used as centralized time sharing machines.)72 398.4 R .389
(These machines had f)5.389 F .39(ar more disk storage than the)-.1 F
2.89(yh)-.15 G .39(ad mem-)-2.89 F 1.415(ory and gi)72 410.4 R -.15(ve)
-.25 G 3.914(nt).15 G 1.414(he cost tradeof)-3.914 F 3.914(fb)-.25 G
1.414(etween memory and disk storage, w)-3.914 F 1.414(anted to mak)-.1
F 3.914(em)-.1 G 1.414(aximal use of the)-3.914 F(memory e)72 422.4 Q
-.15(ve)-.25 G 2.5(na).15 G 2.5(tt)-2.5 G(he cost of w)-2.5 E
(asting some of the disk space or generating e)-.1 E(xtra disk I/O.)-.15
E 1.89(The primary moti)97 438 R -.25(va)-.25 G 1.89
(tion for virtual memory w).25 F 1.89(as to allo)-.1 F 4.39(wt)-.25 G
1.89(he system to run indi)-4.39 F 1.89(vidual programs)-.25 F .915
(whose address space e)72 450 R .914
(xceeded the memory capacity of the machine.)-.15 F .914
(Thus the virtual memory capability)5.914 F(allo)72 462 Q .189
(wed programs to be run that could not ha)-.25 F .489 -.15(ve b)-.2 H
.189(een run on a sw).15 F .189(ap based system.)-.1 F .189
(Equally important in the)5.189 F(lar)72 474 Q .708
(ge central timesharing en)-.18 F .708(vironment w)-.4 F .708
(as the ability to allo)-.1 F 3.207(wt)-.25 G .707
(he sum of the memory requirements of all)-3.207 F(acti)72 486 Q .895
-.15(ve p)-.25 H .595(rocesses to e).15 F .595(xceed the amount of ph)
-.15 F .595(ysical memory on the machine.)-.05 F .595(The e)5.595 F .595
(xpected mode of opera-)-.15 F .218(tion for which the system w)72 498 R
.218(as tuned w)-.1 F .217(as to ha)-.1 F .517 -.15(ve t)-.2 H .217
(he sum of acti).15 F .517 -.15(ve v)-.25 H .217
(irtual memory be one and a half to tw).15 F(o)-.1 E(times the ph)72 510
Q(ysical memory on the machine.)-.05 E .974
(At the time that the virtual memory system w)97 525.6 R .975
(as designed, most machines ran with little or no net-)-.1 F -.1(wo)72
537.6 S 3.052(rking. All).1 F .551(the \214le systems were contained on\
 disks that were directly connected to the machine.)3.052 F(Simi-)5.551
E .129(larly all the disk space de)72 549.6 R -.2(vo)-.25 G .129
(ted to sw).2 F .129(ap space w)-.1 F .13(as also directly connected.)
-.1 F .13(Thus the speed and latenc)5.13 F 2.63(yw)-.15 G(ith)-2.63 E
1.01(which \214le systems could be accessed were roughly equi)72 561.6 R
-.25(va)-.25 G 1.01(lent to the speed and latenc).25 F 3.51(yw)-.15 G
1.01(ith which sw)-3.51 F(ap)-.1 E .505(space could be accessed.)72
573.6 R(Gi)5.505 E -.15(ve)-.25 G 3.005(nt).15 G .505
(he high cost of memory there w)-3.005 F .506(as little incenti)-.1 F
.806 -.15(ve t)-.25 H 3.006(oh).15 G -2.25 -.2(av e)-3.006 H .506(the k)
3.206 F .506(ernel k)-.1 F(eep)-.1 E .617
(track of the contents of the sw)72 585.6 R .617
(ap area once a process e)-.1 F .617
(xited since it could almost as easily and quickly be)-.15 F
(reread from the \214le system.)72 597.6 Q F1 2.5(1.3. New)72 621.6 R
(in\215uences)2.5 E F0 .283
(In the ten years since the current virtual memory system w)97 637.2 R
.284(as designed, man)-.1 F 2.784(yt)-.15 G .284(echnological adv)-2.784
F(ances)-.25 E(ha)72 649.2 Q .663 -.15(ve o)-.2 H 2.863(ccurred. One).15
F(ef)2.863 E .363(fect of the technological re)-.25 F -.2(vo)-.25 G .363
(lution is that the micro-processor has become po).2 F(werful)-.25 E
.068(enough to allo)72 661.2 R 2.568(wu)-.25 G .068(sers to ha)-2.568 F
.369 -.15(ve t)-.2 H .069(heir o).15 F .069(wn personal w)-.25 F 2.569
(orkstations. Thus)-.1 F .069(the computing en)2.569 F .069
(vironment is mo)-.4 F(ving)-.15 E -2.3 -.15(aw a)72 673.2 T 3.221(yf)
.15 G .721(rom a purely centralized time sharing model to an en)-3.221 F
.72(vironment in which users ha)-.4 F 1.02 -.15(ve a c)-.2 H .72
(omputer on).15 F .359(their desk.)72 685.2 R .359(This w)5.359 F .359
(orkstation is link)-.1 F .359(ed through a netw)-.1 F .36
(ork to a centralized pool of machines that pro)-.1 F .36(vide \214l-)
-.15 F .237(ing, computing, and spooling services.)72 697.2 R .237
(The w)5.237 F .237(orkstations tend to ha)-.1 F .537 -.15(ve a l)-.2 H
(ar).15 E .237(ge quantity of memory)-.18 F 2.736(,b)-.65 G .236
(ut little)-2.936 F .206(or no disk space.)72 709.2 R .206
(Because users do not w)5.206 F .206
(ant to be bothered with backing up their disks, and because of the)-.1
F(dif)72 721.2 Q .834(\214culty of ha)-.25 F .833(ving a centralized ad\
ministration backing up hundreds of small disks, these local disks are)
-.2 F EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-3-)282.17 48 Q .341
(typically used only for temporary storage and as sw)72 84 R .341
(ap space.)-.1 F .341(Long term storage is managed by the central)5.341
F(\214le serv)72 96 Q(er)-.15 E(.)-.55 E .74
(Another major technical adv)97 111.6 R .74(ance has been in all le)-.25
F -.15(ve)-.25 G .739(ls of storage capacity).15 F 5.739(.I)-.65 G 3.239
(nt)-5.739 G .739(he last ten years we)-3.239 F(ha)72 123.6 Q .713 -.15
(ve ex)-.2 H .413(perienced a f).15 F .413
(actor of four decrease in the cost per byte of disk storage.)-.1 F .414
(In this same period of time)5.414 F .184
(the cost per byte of memory has dropped by a f)72 135.6 R .184
(actor of a hundred!)-.1 F .183(Thus the cost per byte of memory com-)
5.184 F .022(pared to the cost per byte of disk is approaching a dif)72
147.6 R .022(ference of only about a f)-.25 F .023(actor of ten.)-.1 F
.023(The ef)5.023 F .023(fect of this)-.25 F .609(change is that the w)
72 159.6 R .609(ay in which a machine is used is be)-.1 F .609
(ginning to change dramatically)-.15 F 5.609(.A)-.65 G 3.109(st)-5.609 G
.609(he amount of)-3.109 F(ph)72 171.6 Q .006(ysical memory on machines\
 increases and the number of users per machine decreases, the e)-.05 F
.006(xpected mode)-.15 F .434
(of operation is changing from that of supporting more acti)72 183.6 R
.734 -.15(ve v)-.25 H .434(irtual memory than ph).15 F .433
(ysical memory to that)-.05 F(of ha)72 195.6 Q
(ving a surplus of memory that can be used for other purposes.)-.2 E
1.275(Because man)97 211.2 R 3.775(ym)-.15 G 1.275(achines will ha)
-3.775 F 1.576 -.15(ve m)-.2 H 1.276(ore ph).15 F 1.276
(ysical memory than the)-.05 F 3.776(yd)-.15 G 3.776(os)-3.776 G -.1(wa)
-3.776 G 3.776(ps).1 G 1.276(pace \(with diskless)-3.776 F -.1(wo)72
223.2 S .691(rkstations as an e).1 F .691(xtreme e)-.15 F .691(xample!\
\), it is no longer reasonable to limit the maximum virtual memory to)
-.15 F 1.032(the amount of sw)72 235.2 R 1.032
(ap space as is done in the current design.)-.1 F(Consequently)6.032 E
3.532(,t)-.65 G 1.032(he ne)-3.532 F 3.533(wd)-.25 G 1.033
(esign will allo)-3.533 F 3.533(wt)-.25 G(he)-3.533 E .258
(maximum virtual memory to be the sum of ph)72 247.2 R .258
(ysical memory plus sw)-.05 F .257(ap space.)-.1 F -.15(Fo)5.257 G 2.757
(rm).15 G .257(achines with no sw)-2.757 F(ap)-.1 E
(space, the maximum virtual memory will be go)72 259.2 Q -.15(ve)-.15 G
(rned by the amount of ph).15 E(ysical memory)-.05 E(.)-.65 E .914
(Another ef)97 274.8 R .914
(fect of the current technology is that the latenc)-.25 F 3.414(ya)-.15
G .915(nd o)-3.414 F -.15(ve)-.15 G .915
(rhead associated with accessing).15 F 1.002
(the \214le system is considerably higher since the access must be o)72
286.8 R -.15(ve)-.15 G 3.502(rt).15 G 1.001(he netw)-3.502 F 1.001
(ork rather than to a locally-)-.1 F .152(attached disk.)72 298.8 R .152
(One use of the surplus memory w)5.152 F .152
(ould be to maintain a cache of recently used \214les; repeated)-.1 F
1.226(uses of these \214les w)72 310.8 R 1.226(ould require at most a v)
-.1 F 1.225(eri\214cation from the \214le serv)-.15 F 1.225
(er that the data w)-.15 F 1.225(as up to date.)-.1 F .381
(Under the current design, \214le caching is done by the b)72 322.8 R
(uf)-.2 E .382(fer pool, while the free memory is maintained in a)-.25 F
1.145(separate pool.)72 334.8 R 1.145(The ne)6.145 F 3.645(wd)-.25 G
1.145(esign should ha)-3.645 F 1.445 -.15(ve o)-.2 H 1.144
(nly a single memory pool so that an).15 F 3.644(yf)-.15 G 1.144
(ree memory can be)-3.644 F(used to cache recently accessed \214les.)72
346.8 Q 1.764(Another portion of the memory will be used to k)97 362.4 R
1.764(eep track of the contents of the blocks on an)-.1 F(y)-.15 E .993
(locally-attached sw)72 374.4 R .993(ap space analogously to the w)-.1 F
.993(ay that memory pages are handled.)-.1 F .992(Thus inacti)5.993 F
1.292 -.15(ve s)-.25 H -.1(wa).15 G(p).1 E .291
(blocks can also be used to cache less-recently-used \214le data.)72
386.4 R .291(Since the sw)5.291 F .291
(ap disk is locally attached, it can)-.1 F .413
(be much more quickly accessed than a remotely located \214le system.)72
398.4 R .413(This design allo)5.413 F .413(ws the user to simply)-.25 F
.026(allocate their entire local disk to sw)72 410.4 R .026
(ap space, thus allo)-.1 F .026
(wing the system to decide what \214les should be cached)-.25 F .591
(to maximize its usefulness.)72 422.4 R .591(This design has tw)5.591 F
3.091(om)-.1 G .591(ajor bene\214ts.)-3.091 F .59(It relie)5.591 F -.15
(ve)-.25 G 3.09(st).15 G .59(he user of deciding what \214les)-3.09 F
.008(should be k)72 434.4 R .008(ept in a small local \214le system.)-.1
F .009(It also insures that all modi\214ed \214les are migrated back to\
 the \214le)5.008 F(serv)72 446.4 Q(er in a timely f)-.15 E(ashion, thu\
s eliminating the need to dump the local disk or push the \214les manua\
lly)-.1 E(.)-.65 E/F1 10/Times-Bold@0 SF 2.5(2. User)72 470.4 R
(Interface)2.5 E F0 .872(This section outlines our ne)97 486 R 3.372(wv)
-.25 G .872(irtual memory interf)-3.372 F .872
(ace as it is currently en)-.1 F 3.372(visioned. The)-.4 F .872
(details of)3.372 F(the system call interf)72 498 Q
(ace are contained in Appendix A.)-.1 E F1 2.5(2.1. Regions)72 522 R F0
1.638(The virtual memory interf)97 537.6 R 1.639
(ace is designed to support both lar)-.1 F 1.639
(ge, sparse address spaces as well as)-.18 F 1.17
(small, densely-used address spaces.)72 549.6 R 1.17(In this conte)6.17
F 1.169(xt, `)-.15 F(`small')-.74 E 3.669('i)-.74 G 3.669(sa)-3.669 G
3.669(na)-3.669 G 1.169(ddress space roughly the size of the)-3.669 F
(ph)72 561.6 Q 1.668(ysical memory on the machine, while `)-.05 F(`lar)
-.74 E(ge')-.18 E 4.169('m)-.74 G 1.669(ay e)-4.169 F 1.669
(xtend up to the maximum addressability of the)-.15 F 3.357(machine. A)
72 573.6 R .857(process may di)3.357 F .856
(vide its address space up into a number of re)-.25 F 3.356
(gions. Initially)-.15 F 3.356(ap)3.356 G .856(rocess be)-3.356 F(gins)
-.15 E .1(with four re)72 585.6 R .1
(gions; a shared read-only \214ll-on-demand re)-.15 F .1
(gion with its te)-.15 F .1(xt, a pri)-.15 F -.25(va)-.25 G .1
(te \214ll-on-demand re).25 F .1(gion for)-.15 F 1.271
(its initialized data, a pri)72 597.6 R -.25(va)-.25 G 1.271
(te zero-\214ll-on-demand re).25 F 1.27
(gion for its uninitialized data and heap, and a pri)-.15 F -.25(va)-.25
G(te).25 E .043(zero-\214ll-on-demand re)72 609.6 R .043
(gion for its stack.)-.15 F .043(In addition to these re)5.043 F .043
(gions, a process may allocate ne)-.15 F 2.544(wo)-.25 G 2.544(nes. The)
-2.544 F(re)72 621.6 Q 1.312(gions may not o)-.15 F -.15(ve)-.15 G 1.311
(rlap and the system may impose an alignment constraint, b).15 F 1.311
(ut the size of the re)-.2 F(gion)-.15 E(should not be limited be)72
633.6 Q(yond the constraints of the size of the virtual address space.)
-.15 E .074(Each ne)97 649.2 R 2.574(wr)-.25 G -.15(eg)-2.574 G .074
(ion may be mapped either as pri).15 F -.25(va)-.25 G .075
(te or shared.).25 F .075(When it is pri)5.075 F -.25(va)-.25 G .075
(tely mapped, changes to).25 F .331(the contents of the re)72 661.2 R
.331(gion are not re\215ected to an)-.15 F 2.831(yo)-.15 G .331
(ther process that map the same re)-2.831 F 2.831(gion. Re)-.15 F .331
(gions may be)-.15 F .457(mapped read-only or read-write.)72 673.2 R
.457(As an e)5.457 F .457(xample, a shared library w)-.15 F .458
(ould be implemented as tw)-.1 F 2.958(or)-.1 G -.15(eg)-2.958 G .458
(ions; a).15 F .294(shared read-only re)72 685.2 R .294(gion for the te)
-.15 F .294(xt, and a pri)-.15 F -.25(va)-.25 G .294(te read-write re)
.25 F .294(gion for the global v)-.15 F .293(ariables associated with)
-.25 F(the library)72 697.2 Q(.)-.65 E 2.812(Ar)97 712.8 S -.15(eg)
-2.812 G .312(ion may be allocated with one of se).15 F -.15(ve)-.25 G
.313(ral allocation strate).15 F 2.813(gies. It)-.15 F .313
(may map some memory hard-)2.813 F -.1(wa)72 724.8 S .879
(re on the machine such as a frame b).1 F(uf)-.2 E(fer)-.25 E 5.878(.S)
-.55 G .878(ince the hardw)-5.878 F .878
(are is responsible for storing the data, such)-.1 F EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-4-)282.17 48 Q(re)72 84 Q(gions must be e)-.15
E(xclusi)-.15 E .3 -.15(ve u)-.25 H(se if the).15 E 2.5(ya)-.15 G
(re pri)-2.5 E -.25(va)-.25 G(tely mapped.).25 E 2.948(Ar)97 99.6 S -.15
(eg)-2.948 G .448(ion can map all or part of a \214le.).15 F .449
(As the pages are \214rst accessed, the re)5.449 F .449
(gion is \214lled in with the)-.15 F .82
(appropriate part of the \214le.)72 111.6 R .82(If the re)5.82 F .819
(gion is mapped read-write and shared, changes to the contents of the)
-.15 F(re)72 123.6 Q .397
(gion are re\215ected back into the contents of the \214le.)-.15 F .397
(If the re)5.397 F .397(gion is read-write b)-.15 F .397(ut pri)-.2 F
-.25(va)-.25 G .397(te, changes to the).25 F(re)72 135.6 Q .055
(gion are copied to a pri)-.15 F -.25(va)-.25 G .055(te page that is no\
t visible to other processes mapping the \214le, and these modi\214ed)
.25 F(pages are not re\215ected back to the \214le.)72 147.6 Q 1.451
(The \214nal type of re)97 163.2 R 1.451(gion is `)-.15 F(`anon)-.74 E
1.451(ymous memory')-.15 F 3.951('. Uninitialed)-.74 F 1.452
(data uses such a re)3.952 F 1.452(gion, pri)-.15 F -.25(va)-.25 G(tely)
.25 E 2.193(mapped; it is zero-\214ll-on-demand and its contents are ab\
andoned when the last reference is dropped.)72 175.2 R(Unlik)72 187.2 Q
2.804(ear)-.1 G -.15(eg)-2.804 G .304
(ion that is mapped from a \214le, the contents of an anon).15 F .304
(ymous re)-.15 F .304(gion will ne)-.15 F -.15(ve)-.25 G 2.804(rb).15 G
2.804(er)-2.804 G .304(ead from or)-2.804 F 1.015
(written to a disk unless memory is short and part of the re)72 199.2 R
1.014(gion must be paged to a sw)-.15 F 1.014(ap area.)-.1 F 1.014
(If one of)6.014 F .069(these re)72 211.2 R .069
(gions is mapped shared, then all processes see the changes in the re)
-.15 F 2.57(gion. This)-.15 F(dif)2.57 E .07(ference has impor)-.25 F(-)
-.2 E .963(tant performance considerations; the o)72 223.2 R -.15(ve)
-.15 G .962
(rhead of reading, \215ushing, and possibly allocating a \214le is much)
.15 F(higher than simply zeroing memory)72 235.2 Q(.)-.65 E .701(If se)
97 250.8 R -.15(ve)-.25 G .701(ral processes wish to share a re).15 F
.701(gion, then the)-.15 F 3.201(ym)-.15 G .701(ust ha)-3.201 F 1.001
-.15(ve s)-.2 H .701(ome w).15 F .701(ay of rendezv)-.1 F 3.202
(ousing. F)-.2 F .702(or a)-.15 F .438(mapped \214le this is easy; the \
name of the \214le is used as the rendezv)72 262.8 R .437(ous point.)-.2
F(Ho)5.437 E(we)-.25 E -.15(ve)-.25 G 1.237 -.4(r, p).15 H .437
(rocesses may not).4 F .892
(need the semantics of mapped \214les nor be willing to pay the o)72
274.8 R -.15(ve)-.15 G .892(rhead associated with them.).15 F -.15(Fo)
5.892 G 3.392(ra).15 G(non)-3.392 E(y-)-.15 E .389(mous memory the)72
286.8 R 2.889(ym)-.15 G .389(ust use some other rendezv)-2.889 F .389
(ous point.)-.2 F .389(Our current interf)5.389 F .388(ace allo)-.1 F
.388(ws processes to asso-)-.25 F .34(ciate a descriptor with a re)72
298.8 R .341(gion, which it may then pass to other processes that wish \
to attach to the re)-.15 F(gion.)-.15 E .708(Such a descriptor may be b\
ound into the UNIX \214le system name space so that other processes can\
 \214nd it)72 310.8 R(just as the)72 322.8 Q 2.5(yw)-.15 G
(ould with a mapped \214le.)-2.6 E/F1 10/Times-Bold@0 SF 2.5(2.2. Shar)
72 346.8 R(ed memory as high speed inter)-.18 E(pr)-.1 E
(ocess communication)-.18 E F0 .663(The primary use en)97 362.4 R .663
(visioned for shared memory is to pro)-.4 F .664
(vide a high speed interprocess communica-)-.15 F 1.442
(tion \(IPC\) mechanism between cooperating processes.)72 374.4 R 1.442
(Existing IPC mechanisms \()6.442 F/F2 10/Times-Italic@0 SF(i.e)A(.)-.15
E F0 1.441(pipes, sock)3.941 F 1.441(ets, or)-.1 F .123
(streams\) require a system call to hand of)72 386.4 R 2.624(fas)-.25 G
.124(et of data destined for another process, and another system call)
-2.624 F .039(by the recipient process to recei)72 398.4 R .339 -.15
(ve t)-.25 H .039(he data.).15 F(Ev)5.039 E .038
(en if the data can be transferred by remapping the data pages)-.15 F
.368(to a)72 410.4 R -.2(vo)-.2 G .369(id a memory to memory cop).2 F
1.669 -.65(y, t)-.1 H .369(he o).65 F -.15(ve)-.15 G .369
(rhead of doing the system calls limits the throughput of all b).15 F
(ut)-.2 E .268(the lar)72 422.4 R .268(gest transfers.)-.18 F .268
(Shared memory)5.268 F 2.768(,b)-.65 G 2.768(yc)-2.768 G .268
(ontrast, allo)-2.768 F .267(ws processes to share data at an)-.25 F
2.767(yl)-.15 G -2.15 -.25(ev e)-2.767 H 2.767(lo).25 G 2.767(fg)-2.767
G(ranularity)-2.767 E(without system interv)72 434.4 Q(ention.)-.15 E
(Ho)97 450 Q(we)-.25 E -.15(ve)-.25 G 1.001 -.4(r, t).15 H 2.701(om).4 G
.201(aintain all b)-2.701 F .201(ut the simplest of data structures, th\
e processes must serialize their modi\214-)-.2 F .927
(cations to shared data structures if the)72 462 R 3.427(ya)-.15 G .927
(re to a)-3.427 F -.2(vo)-.2 G .927(id corrupting them.).2 F .927
(This serialization is typically done)5.927 F .988(with semaphores.)72
474 R(Unfortunately)5.988 E 3.488(,m)-.65 G .988
(ost implementations of semaphores are done with system calls.)-3.488 F
(Thus)5.989 E 2.053(processes are once ag)72 486 R 2.052
(ain limited by the need to do tw)-.05 F 4.552(os)-.1 G 2.052
(ystem calls per transaction, one to lock the)-4.552 F .747
(semaphore, the second to release it.)72 498 R .748(The net ef)5.748 F
.748(fect is that the shared memory model pro)-.25 F .748
(vides little if an)-.15 F(y)-.15 E(impro)72 510 Q -.15(ve)-.15 G
(ment in interprocess bandwidth.).15 E 1.75 -.8(To a)97 525.6 T(chie).8
E .45 -.15(ve a s)-.25 H .15(igni\214cant impro).15 F -.15(ve)-.15 G .15
(ment in interprocess bandwidth requires a lar).15 F .15
(ge decrease in the num-)-.18 F .775
(ber of system calls needed to achie)72 537.6 R 1.075 -.15(ve t)-.25 H
.775(he interaction.).15 F .776
(In pro\214ling applications that use serialization locks)5.775 F .377
(such as the UNIX k)72 549.6 R .377
(ernel, one typically \214nds that most locks are not contested.)-.1 F
.377(Thus if one can \214nd a w)5.377 F(ay)-.1 E .069(to a)72 561.6 R
-.2(vo)-.2 G .069(id doing a system call in the case in which a lock is\
 not contested, one w).2 F .07(ould e)-.1 F .07
(xpect to be able to dra-)-.15 F
(matically reduce the number of system calls needed to achie)72 573.6 Q
.3 -.15(ve s)-.25 H(erialization.).15 E .008(In our design, cooperating\
 processes manage their semaphores in their o)97 589.2 R .008
(wn address space.)-.25 F .008(In the typ-)5.008 F .919
(ical case, a process e)72 601.2 R -.15(xe)-.15 G .92(cutes an atomic t\
est-and-set instruction to acquire a lock, \214nds it free, and thus is)
.15 F .128(able to get it.)72 613.2 R .127(Only in the \(rare\) case wh\
ere the lock is already set does the process need to do a system call)
5.128 F .287(to w)72 625.2 R .287(ait for the lock to clear)-.1 F 5.287
(.W)-.55 G .287
(hen a process is \214nished with a lock, it can clear the lock itself.)
-5.287 F .288(Only if the)5.288 F -.74(``)72 637.2 S -1.2(WA).74 G(NT')
1.2 E 2.718<278d>-.74 G .217(ag for the lock has been set is it necessa\
ry for the process to do a system call to cause the other)-2.718 F
(process\(es\) to be a)72 649.2 Q -.1(wa)-.15 G -.1(ke).1 G(ned.).1 E
.313(Another issue that must be considered is portability)97 664.8 R
5.313(.S)-.65 G .313(ome computers require access to special hard-)
-5.313 F -.1(wa)72 676.8 S .523
(re to implement atomic interprocessor test-and-set.).1 F -.15(Fo)5.523
G 3.023(rs).15 G .523(uch machines the setting and clearing of locks)
-3.023 F -.1(wo)72 688.8 S .283(uld all ha).1 F .583 -.15(ve t)-.2 H
2.783(ob).15 G 2.783(ed)-2.783 G .284
(one with system calls; applications could still use the same interf)
-2.783 F .284(ace without change,)-.1 F(though the)72 700.8 Q 2.5(yw)
-.15 G(ould tend to run slo)-2.6 E(wly)-.25 E(.)-.65 E .302
(The other issue of compatibility is with System V')97 716.4 R 2.802(ss)
-.55 G .302(emaphore implementation.)-2.802 F .302(Since the System V)
5.302 F(interf)72 728.4 Q 1.89(ace has been in e)-.1 F 1.89
(xistence for se)-.15 F -.15(ve)-.25 G 1.89
(ral years, and applications ha).15 F 2.19 -.15(ve b)-.2 H 1.89(een b)
.15 F 1.89(uilt that depend on this)-.2 F EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-5-)282.17 48 Q(interf)72 84 Q .003
(ace, it is important that this interf)-.1 F .002(ace also be a)-.1 F
-.25(va)-.2 G 2.502(ilable. Although).25 F .002(the interf)2.502 F .002
(ace is based on system calls)-.1 F .75
(for both setting and clearing locks, the same interf)72 96 R .75
(ace can be obtained using our interf)-.1 F .75(ace without system)-.1 F
(calls in most cases.)72 108 Q .046(This implementation can be achie)97
123.6 R -.15(ve)-.25 G 2.546(da).15 G 2.546(sf)-2.546 G(ollo)-2.546 E
2.546(ws. System)-.25 F 2.546(Va)2.546 G(llo)-2.546 E .045
(ws entire sets of semaphores to be set)-.25 F(concurrently)72 135.6 Q
5.249(.I)-.65 G 2.749(fa)-5.249 G .549 -.15(ny o)-2.749 H 2.749(ft).15 G
.249(he locks are una)-2.749 F -.25(va)-.2 G .25
(ilable, the process is put to sleep until the).25 F 2.75(ya)-.15 G .25
(ll become a)-2.75 F -.25(va)-.2 G(ilable.).25 E .078(Under our paradig\
m, a single additional semaphore is de\214ned that serializes access to\
 the set of semaphores)72 147.6 R 1.499(being simulated.)72 159.6 R
1.499(Once obtained in the usual w)6.499 F(ay)-.1 E 3.999(,t)-.65 G 1.5
(he set of semaphores can be inspected to see if the)-3.999 F .932
(desired ones are a)72 171.6 R -.25(va)-.2 G 3.431(ilable. If).25 F(the)
3.431 E 3.431(ya)-.15 G .931(re a)-3.431 F -.25(va)-.2 G .931
(ilable, the).25 F 3.431(ya)-.15 G .931
(re set, the guardian semaphore is released and the)-3.431 F .673
(process proceeds.)72 183.6 R .673
(If one or more of the requested set is not a)5.673 F -.25(va)-.2 G .674
(ilable, the guardian semaphore is released).25 F 1.46
(and the process selects an una)72 195.6 R -.25(va)-.2 G 1.459
(ilable semaphores for which to w).25 F 3.959(ait. On)-.1 F 1.459
(being rea)3.959 F -.1(wa)-.15 G -.1(ke).1 G 1.459(ned, the whole).1 F
(selection process must be repeated.)72 207.6 Q .966(In all the abo)97
223.2 R 1.266 -.15(ve ex)-.15 H .966
(amples, there appears to be a race condition.).15 F .967
(Between the time that the process)5.967 F .399
(\214nds that a semaphore is lock)72 235.2 R .399(ed, and the time that\
 it manages to call the system to sleep on the semaphore)-.1 F .306
(another process may unlock the semaphore and issue a w)72 247.2 R(ak)
-.1 E .307(eup call.)-.1 F .307(Luckily the race can be a)5.307 F -.2
(vo)-.2 G 2.807(ided. The).2 F .499
(insight that is critical is that the process and the k)72 259.2 R .499
(ernel agree on the ph)-.1 F .499(ysical byte of memory that is being)
-.05 F .392(used for the semaphore.)72 271.2 R .393
(The system call to put a process to sleep tak)5.392 F .393
(es a pointer to the desired semaphore)-.1 F .307(as its ar)72 283.2 R
.307(gument so that once inside the k)-.18 F .306(ernel, the k)-.1 F
.306(ernel can repeat the test-and-set.)-.1 F .306
(If the lock has cleared)5.306 F .583(\(and possibly the w)72 295.2 R
(ak)-.1 E .583(eup issued\) between the time that the process did the t\
est-and-set and e)-.1 F -.15(ve)-.25 G .584(ntually got).15 F .356
(into the sleep request system call, then the k)72 307.2 R .355
(ernel immediately resumes the process rather than putting it to)-.1 F
2.895(sleep. Thus)72 319.2 R .395(the only problem to solv)2.895 F 2.895
(ei)-.15 G 2.895(sh)-2.895 G .895 -.25(ow t)-2.895 H .395(he k).25 F
.396(ernel interlocks between testing a semaphore and going)-.1 F
(to sleep; this problem has already been solv)72 331.2 Q(ed on e)-.15 E
(xisting systems.)-.15 E/F1 10/Times-Bold@0 SF 2.5(3. Refer)72 355.2 R
(ences)-.18 E F0 42.51([Babaoglu79] Babaoglu,)72 382.8 R .444
(O., and Jo)2.944 F 1.744 -.65(y, W)-.1 H .443(., `)-.27 F .443
(`Data Structures Added in the Berk)-.74 F(ele)-.1 E 2.943(yV)-.15 G
.443(irtual Mem-)-3.543 F 2.438
(ory Extensions to the UNIX Operating System')172 394.8 R 4.938('C)-.74
G 2.438(omputer Systems Research)-4.938 F 2.944
(Group, Dept of EECS, Uni)172 406.8 R -.15(ve)-.25 G 2.944
(rsity of California, Berk).15 F(ele)-.1 E 4.244 -.65(y, C)-.15 H 5.444
(A9).65 G 2.944(4720, USA,)-5.444 F(No)172 418.8 Q -.15(ve)-.15 G
(mber 1979.).15 E 45.29([Someren84] Someren,)72 434.4 R .099(J. v)2.598
F .099(an, `)-.25 F(`P)-.74 E .099(aging in Berk)-.15 F(ele)-.1 E 2.599
(yU)-.15 G(NIX')-2.599 E .099(', Laboratorium v)-.74 F .099(oor schak)
-.2 F(eltechniek)-.1 E 14.364(en techneik v)172 446.4 R 16.864
(.d. informatie)-.65 F -.15(ve)-.25 G(rwerk).15 E 14.364
(ende machines, Codenummer)-.1 F(051560-44\(1984\)01, February 1984.)172
458.4 Q F1 2.5(4. A)72 506.4 R(ppendix A \255 V)-.25 E
(irtual Memory Interface)-.37 E 2.5(4.1. Mapping)72 530.4 R(pages)2.5 E
F0 .728(The system supports sharing of data between processes by allo)97
546 R .728(wing pages to be mapped into mem-)-.25 F(ory)72 558 Q 6.166
(.T)-.65 G 1.166(hese mapped pages may be)-6.166 F/F2 10/Times-Italic@0
SF(shar)3.666 E(ed)-.37 E F0 1.166(with other processes or)3.666 F F2
(private)3.665 E F0 1.165(to the process.)3.665 F 1.165(Protection and)
6.165 F(sharing options are de\214ned in)72 570 Q F2(<sys/mman.h>)2.5 E
F0(as:)2.5 E(/* protections are chosen from these bits, or)108 588 Q
(-ed together */)-.2 E 2.5(#de\214ne PR)108 600 R -.4(OT)-.4 G 52.75
(_READ 0x04).4 F(/* pages can be read */)15 E 2.5(#de\214ne PR)108 612 R
-.4(OT)-.4 G 48.31(_WRITE 0x02).4 F(/* pages can be written */)15 E 2.5
(#de\214ne PR)108 624 R -.4(OT)-.4 G 53.86(_EXEC 0x01).4 F
(/* pages can be e)15 E -.15(xe)-.15 G(cuted */).15 E
(/* \215ags contain mapping type, sharing type and options */)108 648 Q
(/* mapping type; choose one */)108 660 Q(#de\214ne MAP_FILE)108 672 Q
2.5(0x0001 /*)66.95 F(mapped from a \214le or de)2.5 E(vice */)-.25 E
(#de\214ne MAP_ANON)108 684 Q 2.5(0x0002 /*)59.18 F
(allocated from memory)2.5 E 2.5(,s)-.65 G -.1(wa)-2.5 G 2.5(ps).1 G
(pace */)-2.5 E(#de\214ne MAP_TYPE)108 696 Q 4.17(0x000f /*)63.06 F
(mask for type \214eld */)2.5 E EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-6-)282.17 48 Q(/* sharing types; choose one */)
108 84 Q 2.5(#de\214ne MAP_SHARED)108 96 R 2.5(0x0010 /*)45.56 F
(share changes */)2.5 E 2.5(#de\214ne MAP_PRIV)108 108 R -1.11(AT)-1.35
G 45.8(E0)1.11 G 2.5(x0000 /*)-45.8 F(changes are pri)2.5 E -.25(va)-.25
G(te */).25 E(/* other \215ags */)108 132 Q(#de\214ne MAP_FIXED)108 144
Q 2.5(0x0020 /*)58.62 F(map addr must be e)2.5 E(xactly as requested */)
-.15 E(#de\214ne MAP_INHERIT)108 156 Q 2.5(0x0040 /*)48.07 F(re)2.5 E
(gion is retained after e)-.15 E -.15(xe)-.15 G 2.5(c*).15 G(/)-2.5 E
(#de\214ne MAP_HASSEMAPHORE)108 168 Q 2.5(0x0080 /*)7.5 F(re)2.5 E
(gion may contain semaphores */)-.15 E
(The cpu-dependent size of a page is returned by the)72 186 Q/F1 10
/Times-Italic@0 SF -.1(ge)2.5 G(tpa).1 E -.1(ge)-.1 G(size).1 E F0
(system call:)2.5 E(pagesize = getpagesize\(\);)108 204 Q
(result int pagesize;)108 216 Q(The call:)72 237.6 Q(maddr = mmap\(addr)
108 255.6 Q 2.5(,l)-.4 G(en, prot, \215ags, fd, pos\);)-2.5 E
(result caddr_t maddr; caddr_t addr; int *len, prot, \215ags, fd; of)108
267.6 Q(f_t pos;)-.25 E .503(causes the pages starting at)72 285.6 R F1
(addr)3.003 E F0 .504(and continuing for at most)3.003 F F1(len)3.004 E
F0 .504(bytes to be mapped from the object repre-)3.004 F .955
(sented by descriptor)72 297.6 R F1(fd)3.455 E F0 3.455(,s)C .955
(tarting at byte of)-3.455 F(fset)-.25 E F1(pos)3.455 E F0 5.955(.T)C
.955(he starting address of the re)-5.955 F .955
(gion is returned; for the)-.15 F(con)72 309.6 Q -.15(ve)-.4 G .272
(nience of the system, it may dif).15 F .272
(fer from that supplied unless the MAP_FIXED \215ag is gi)-.25 F -.15
(ve)-.25 G .273(n, in which).15 F .395(case the e)72 321.6 R .395
(xact address will be used or the call will f)-.15 F 2.894(ail. The)-.1
F .394(actual amount mapped is returned in)2.894 F F1(len)2.894 E F0
5.394(.T)C(he)-5.394 E F1(addr)72 333.6 Q F0(,)A F1(len)2.5 E F0 2.5(,a)
C(nd)-2.5 E F1(pos)2.5 E F0
(parameters must all be multiples of the pagesize.)2.5 E 2.5(As)5 G
(uccessful)-2.5 E F1(mmap)2.5 E F0(will delete an)2.5 E 2.5(yp)-.15 G
(re-)-2.5 E .298(vious mapping in the allocated address range.)72 345.6
R .298(The parameter)5.298 F F1(pr)2.798 E(ot)-.45 E F0 .298
(speci\214es the accessibility of the mapped)2.798 F 2.774(pages. The)72
357.6 R(parameter)2.774 E F1<8d61>2.774 E(gs)-.1 E F0 .274(speci\214es \
the type of object to be mapped, mapping options, and whether modi-)
2.774 F .428(\214cations made to this mapped cop)72 369.6 R 2.927(yo)-.1
G 2.927(ft)-2.927 G .427(he page are to be k)-2.927 F(ept)-.1 E F1
(private)2.927 E F0 2.927(,o)C 2.927(ra)-2.927 G .427(re to be)-2.927 F
F1(shar)2.927 E(ed)-.37 E F0 .427(with other refer)2.927 F(-)-.2 E 2.991
(ences. Possible)72 381.6 R .491(types include MAP_FILE, mapping a re)
2.991 F .492(gular \214le or character)-.15 F .492(-special de)-.2 F
.492(vice memory)-.25 F 2.992(,a)-.65 G(nd)-2.992 E .148
(MAP_ANON, which maps memory not associated with an)72 393.6 R 2.648(ys)
-.15 G .148(peci\214c \214le.)-2.648 F .148
(The \214le descriptor used for creat-)5.148 F(ing MAP_ANON re)72 405.6
Q(gions is used only for naming, and may be gi)-.15 E -.15(ve)-.25 G
2.501(na).15 G 2.501<73ad>-2.501 G 2.501(1i)-2.501 G 2.501(fn)-2.501 G
2.501(on)-2.501 G .001(ame is associated with the)-2.501 F(re)72 417.6 Q
5.361(gion.\207 The)-.15 F 2.861(MAP_INHERIT \215ag allo)5.361 F 2.861
(ws a re)-.25 F 2.861(gion to be inherited after an)-.15 F F1 -.2(ex)
5.36 G(ec).2 E F0 7.86(.T)C 2.86(he MAP_HAS-)-7.86 F
(SEMAPHORE \215ag allo)72 429.6 Q(ws special handling for re)-.25 E
(gions that may contain semaphores.)-.15 E 2.5(Af)97 445.2 S
(acility is pro)-2.6 E(vided to synchronize a mapped re)-.15 E
(gion with the \214le it maps; the call)-.15 E(msync\(addr)108 463.2 Q
2.5(,l)-.4 G(en\);)-2.5 E(caddr_t addr; int len;)108 475.2 Q .026
(writes an)72 493.2 R 2.526(ym)-.15 G .027(odi\214ed pages back to the \
\214lesystem and updates the \214le modi\214cation time.)-2.526 F(If)
5.027 E F1(len)2.527 E F0 .027(is 0, all mod-)2.527 F .586
(i\214ed pages within the re)72 505.2 R .586(gion containing)-.15 F F1
(addr)3.086 E F0 .586(will be \215ushed; if)3.086 F F1(len)3.086 E F0
.586(is non-zero, only the pages containing)3.086 F F1(addr)72 517.2 Q
F0(and)2.788 E F1(len)2.788 E F0 .288(succeeding locations will be e)
2.788 F 2.789(xamined. An)-.15 F 2.789(yr)-.15 G .289
(equired synchronization of memory caches will)-2.789 F 1.254(also tak)
72 529.2 R 3.754(ep)-.1 G 1.254(lace at this time.)-3.754 F 1.253(Files\
ystem operations on a \214le that is mapped for shared modi\214cations \
are)6.254 F(unpredictable e)72 541.2 Q(xcept after an)-.15 E F1(msync)
2.5 E F0(.)A 2.5(Am)97 556.8 S(apping can be remo)-2.5 E -.15(ve)-.15 G
2.5(db).15 G 2.5(yt)-2.5 G(he call)-2.5 E(munmap\(addr)108 574.8 Q 2.5
(,l)-.4 G(en\);)-2.5 E(caddr_t addr; int len;)108 586.8 Q .956(This cal\
l deletes the mappings for the speci\214ed address range, and causes fu\
rther references to addresses)72 604.8 R
(within the range to generate in)72 616.8 Q -.25(va)-.4 G
(lid memory references.).25 E/F2 10/Times-Bold@0 SF 2.5(4.2. P)72 640.8
R(age pr)-.1 E(otection contr)-.18 E(ol)-.18 E F0 2.5(Ap)97 656.4 S
(rocess can control the protection of pages using the call)-2.5 E .32 LW
144 688.2 72 688.2 DL/F3 8/Times-Roman@0 SF 2.007<8754>72 700 S .007
(he current design does not allo)-2.007 F 2.007(wap)-.2 G .006
(rocess to specify the location of sw)-2.007 F .006(ap space.)-.08 F
.006(In the future we may de\214ne)4.006 F 1.139
(an additional mapping type, MAP_SW)72 710 R(AP)-.96 E 3.139(,i)-.888 G
3.139(nw)-3.139 G 1.139(hich the \214le descriptor ar)-3.139 F 1.139
(gument speci\214es a \214le or de)-.144 F 1.139(vice to)-.2 F(which sw)
72 720 Q(apping should be done.)-.08 E EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-7-)282.17 48 Q(mprotect\(addr)108 84 Q 2.5(,l)
-.4 G(en, prot\);)-2.5 E(caddr_t addr; int len, prot;)108 96 Q .469
(This call changes the speci\214ed pages to ha)72 114 R .768 -.15(ve p)
-.2 H(rotection).15 E/F1 10/Times-Italic@0 SF(pr)2.968 E(ot)-.45 E F0
5.468(.N)1.666 G .468(ot all implementations will guarantee pro-)-5.468
F(tection on a page basis; the granularity of protection changes may be\
 as lar)72 126 Q(ge as an entire re)-.18 E(gion.)-.15 E/F2 10
/Times-Bold@0 SF 2.5(4.3. Gi)72 150 R(ving and getting advice)-.1 E F0
2.5(Ap)97 165.6 S(rocess that has kno)-2.5 E(wledge of its memory beha)
-.25 E(vior may use the)-.2 E F1(madvise)2.5 E F0(call:)2.5 E
(madvise\(addr)108 183.6 Q 2.5(,l)-.4 G(en, beha)-2.5 E(v\);)-.2 E
(caddr_t addr; int len, beha)108 195.6 Q(v;)-.2 E F1(Behav)72 213.6 Q F0
(describes e)2.5 E(xpected beha)-.15 E(vior)-.2 E 2.5(,a)-.4 G 2.5(sg)
-2.5 G -2.15 -.25(iv e)-2.5 H 2.5(ni).25 G(n)-2.5 E F1(<sys/mman.h>)2.5
E F0(:)A 2.5(#de\214ne MAD)108 231.6 R 21.28(V_NORMAL 0)-.4 F
(/* no further special treatment */)15 E 2.5(#de\214ne MAD)108 243.6 R
20.17(V_RANDOM 1)-.4 F(/* e)15 E(xpect random page references */)-.15 E
2.5(#de\214ne MAD)108 255.6 R(V_SEQ)-.4 E 2.5(UENTIAL 2)-.1 F(/* e)15 E
(xpect sequential references */)-.15 E 2.5(#de\214ne MAD)108 267.6 R
12.96(V_WILLNEED 3)-.4 F(/* will need these pages */)15 E 2.5
(#de\214ne MAD)108 279.6 R 10.18(V_DONTNEED 4)-.4 F(/* don')15 E 2.5(tn)
-.18 G(eed these pages */)-2.5 E 2.5(#de\214ne MAD)108 291.6 R(V_SP)-.4
E -.4(AC)-.92 G(EA).4 E -1.35(VA)-1.35 G 6.41(IL 5)1.35 F
(/* insure that resources are reserv)15 E(ed */)-.15 E(Finally)72 309.6
Q 2.5(,ap)-.65 G(rocess may obtain information about whether pages are \
core resident by using the call)-2.5 E(mincore\(addr)108 327.6 Q 2.5(,l)
-.4 G(en, v)-2.5 E(ec\))-.15 E(caddr_t addr; int len; result char *v)108
339.6 Q(ec;)-.15 E .419(Here the current core residenc)72 357.6 R 2.919
(yo)-.15 G 2.919(ft)-2.919 G .419
(he pages is returned in the character array)-2.919 F F1(vec)2.92 E F0
2.92(,w)C .42(ith a v)-2.92 F .42(alue of 1 mean-)-.25 F
(ing that the page is in-core.)72 369.6 Q F2 2.5(4.4. Synchr)72 393.6 R
(onization primiti)-.18 E -.1(ve)-.1 G(s).1 E F0(Primiti)97 409.2 Q -.15
(ve)-.25 G 3.124(sa).15 G .624(re pro)-3.124 F .624
(vided for synchronization using semaphores in shared memory)-.15 F
5.623(.S)-.65 G .623(emaphores must)-5.623 F 3.925
(lie within a MAP_SHARED re)72 421.2 R 3.925
(gion with at least modes PR)-.15 F -.4(OT)-.4 G 3.925(_READ and PR).4 F
-.4(OT)-.4 G 6.425(_WRITE. The).4 F .362
(MAP_HASSEMAPHORE \215ag must ha)72 433.2 R .662 -.15(ve b)-.2 H .361
(een speci\214ed when the re).15 F .361(gion w)-.15 F .361(as created.)
-.1 F 1.961 -.8(To a)5.361 H .361(cquire a lock a).8 F(process calls:)72
445.2 Q -.25(va)108 463.2 S(lue = mset\(sem, w).25 E(ait\))-.1 E
(result int v)108 475.2 Q(alue; semaphore *sem; int w)-.25 E(ait;)-.1 E
F1(Mset)72 493.2 Q F0(indi)3.287 E .787
(visibly tests and sets the semaphore)-.25 F F1(sem)3.287 E F0 5.787(.I)
C 3.287(ft)-5.787 G .787(he pre)-3.287 F .787(vious v)-.25 F .787
(alue is zero, the process has acquired)-.25 F .134(the lock and)72
505.2 R F1(mset)2.634 E F0 .133(returns true immediately)2.633 F 5.133
(.O)-.65 G .133(therwise, if the)-5.133 F F1(wait)2.633 E F0 .133
(\215ag is zero, f)2.633 F .133(ailure is returned.)-.1 F(If)5.133 E F1
(wait)2.633 E F0(is)2.633 E(true and the pre)72 517.2 Q(vious v)-.25 E
(alue is non-zero,)-.25 E F1(mset)2.5 E F0
(relinquishes the processor until noti\214ed that it should retry)2.5 E
(.)-.65 E 1.6 -.8(To r)72 532.8 T(elease a lock a process calls:).8 E
(mclear\(sem\))108 550.8 Q(semaphore *sem;)108 562.8 Q F1(Mclear)72
580.8 Q F0(indi)3.085 E .586(visibly tests and clears the semaphore)-.25
F F1(sem)3.086 E F0 5.586(.I)C 3.086(ft)-5.586 G .586(he `)-3.086 F(`W)
-.74 E(ANT')-1.2 E 3.086<278d>-.74 G .586(ag is zero in the pre)-3.086 F
.586(vious v)-.25 F(alue,)-.25 E F1(mclear)72 592.8 Q F0 1.1
(returns immediately)3.6 F 6.1(.I)-.65 G 3.6(ft)-6.1 G 1.1(he `)-3.6 F
(`W)-.74 E(ANT')-1.2 E 3.599<278d>-.74 G 1.099
(ag is non-zero in the pre)-3.599 F 1.099(vious v)-.25 F(alue,)-.25 E F1
(mclear)3.599 E F0 1.099(arranges for)3.599 F -.1(wa)72 604.8 S
(iting processes to retry before returning.).1 E -1 -.8(Tw o)97 620.4 T
.594(routines pro)3.894 F .594(vide services analogous to the k)-.15 F
(ernel)-.1 E F1(sleep)3.094 E F0(and)3.094 E F1(wak)3.094 E(eup)-.1 E F0
.595(functions interpreted in the)3.095 F .032(domain of shared memory)
72 632.4 R 5.032(.A)-.65 G .031
(process may relinquish the processor by calling)-2.501 F F1(msleep)
2.531 E F0 .031(with a set semaphore:)2.531 F(msleep\(sem\))108 650.4 Q
(semaphore *sem;)108 662.4 Q .165
(If the semaphore is still set when it is check)72 680.4 R .165
(ed by the k)-.1 F .166
(ernel, the process will be put in a sleeping state until)-.1 F
(some other process issues an)72 692.4 Q F1(mwak)2.5 E(eup)-.1 E F0
(for the same semaphore within the re)2.5 E(gion using the call:)-.15 E
EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(-8-)282.17 48 Q(mw)108 84 Q(ak)-.1 E(eup\(sem\))
-.1 E(semaphore *sem;)108 96 Q(An)72 114 Q/F1 10/Times-Italic@0 SF(mwak)
2.5 E(eup)-.1 E F0(may a)2.5 E -.1(wa)-.15 G -.1(ke).1 G 2.5(na).1 G
(ll sleepers on the semaphore, or may a)-2.5 E -.1(wa)-.15 G -.1(ke).1 G
2.5(no).1 G(nly the ne)-2.5 E(xt sleeper on a queue.)-.15 E EP
%%Trailer
end
%%EOF
