%!PS-Adobe-2.0
%%Creator: dvipsk 5.58f Copyright 1986, 1994 Radical Eye Software
%%Title: osdi.dvi
%%Pages: 14
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Bold Times-Roman Times-Italic Courier
%%DocumentPaperSizes: Letter
%%EndComments
%DVIPSCommandLine: dvips -o /tmp/osdi99.ps osdi
%DVIPSParameters: dpi=600, comments removed
%DVIPSSource:  TeX output 1998.08.06:1449
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginFont: Times-Bold
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "22 June 1996",
%   filename = "8r.enc",
%   email = "kb@@mail.tug.org",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "119     662    4424",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def
%%EndFont
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont load]cvx def}def
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{4 index mul add}def
/ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding exch def}def
end
%%EndProcSet
%%BeginProcSet: special.pro
TeXDict begin /SDict 200 dict N SDict begin /@SpecialDefaults{/hs 612 N
/vs 792 N /ho 0 N /vo 0 N /hsc 1 N /vsc 1 N /ang 0 N /CLIP 0 N /rwiSeen
false N /rhiSeen false N /letter{}N /note{}N /a4{}N /legal{}N}B
/@scaleunit 100 N /@hscale{@scaleunit div /hsc X}B /@vscale{@scaleunit
div /vsc X}B /@hsize{/hs X /CLIP 1 N}B /@vsize{/vs X /CLIP 1 N}B /@clip{
/CLIP 2 N}B /@hoffset{/ho X}B /@voffset{/vo X}B /@angle{/ang X}B /@rwi{
10 div /rwi X /rwiSeen true N}B /@rhi{10 div /rhi X /rhiSeen true N}B
/@llx{/llx X}B /@lly{/lly X}B /@urx{/urx X}B /@ury{/ury X}B /magscale
true def end /@MacSetUp{userdict /md known{userdict /md get type
/dicttype eq{userdict begin md length 10 add md maxlength ge{/md md dup
length 20 add dict copy def}if end md begin /letter{}N /note{}N /legal{}
N /od{txpose 1 0 mtx defaultmatrix dtransform S atan/pa X newpath
clippath mark{transform{itransform moveto}}{transform{itransform lineto}
}{6 -2 roll transform 6 -2 roll transform 6 -2 roll transform{
itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll curveto}}{{
closepath}}pathforall newpath counttomark array astore /gc xdf pop ct 39
0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}if}N
/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1 -1
scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3 get
ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip yflip
not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub neg 0
TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{noflips{TR
pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop 90 rotate 1
-1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg
TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr 1 get neg
sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr 2 get ppr
0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4 -1 roll add
2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S TR}if}N /cp
{pop pop showpage pm restore}N end}if}if}N /normalscale{Resolution 72
div VResolution 72 div neg scale magscale{DVImag dup scale}if 0 setgray}
N /psfts{S 65781.76 div N}N /startTexFig{/psf$SavedState save N userdict
maxlength dict begin /magscale true def normalscale currentpoint TR
/psf$ury psfts /psf$urx psfts /psf$lly psfts /psf$llx psfts /psf$y psfts
/psf$x psfts currentpoint /psf$cy X /psf$cx X /psf$sx psf$x psf$urx
psf$llx sub div N /psf$sy psf$y psf$ury psf$lly sub div N psf$sx psf$sy
scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub TR
/showpage{}N /erasepage{}N /copypage{}N /p 3 def @MacSetUp}N /doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N /endTexFig{end psf$SavedState restore}N /@beginspecial{SDict
begin /SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count /ocount X /dcount countdictstack N}N /@setspecial
{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if /showpage{}N /erasepage{}N /copypage{}N newpath
}N /@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{
end}repeat grestore SpecialSave restore end}N /@defspecial{SDict begin}
N /@fedspecial{end}B /li{lineto}B /rl{rlineto}B /rc{rcurveto}B /np{
/SaveX currentpoint /SaveY X N 1 setlinecap newpath}N /st{stroke SaveX
SaveY moveto}N /fil{fill SaveX SaveY moveto}N /ellipse{/endangle X
/startangle X /yrad X /xrad X /savematrix matrix currentmatrix N TR xrad
yrad scale 0 0 1 startangle endangle arc savematrix setmatrix}N end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 600 600 (osdi.dvi)
@start /Fa 134[42 42 60 42 46 28 32 37 1[46 42 46 69
23 46 1[23 46 42 28 37 46 37 46 42 10[60 60 55 3[51 65
1[78 55 2[32 65 2[55 60 60 1[60 6[28 5[42 42 42 42 1[23
21 28 21 4[28 39[{ TeXBase1Encoding ReEncodeFont }46
83.333337 /Times-Bold rf /Fb 134[37 1[55 37 42 23 32
32 1[42 42 42 60 23 2[23 42 42 23 37 42 37 42 42 8[51
69 51 60 46 42 1[60 51 60 55 69 3[28 60 60 51 51 60 55
51 51 6[28 42 42 42 2[42 2[42 1[23 21 28 21 2[28 28 28
36[42 2[{ TeXBase1Encoding ReEncodeFont }55 83.333337
/Times-Italic rf /Fc 104[66 29[33 33 48 33 33 18 26 22
1[33 33 33 52 18 33 1[18 33 33 22 29 33 29 33 29 9[63
2[41 5[48 59 41 4[48 1[41 3[48 10[33 3[33 33 33 1[17
22 45[{ TeXBase1Encoding ReEncodeFont }38 66.666667 /Times-Roman
rf /Fd 205[25 25 49[{ TeXBase1Encoding ReEncodeFont }2
50.000001 /Times-Roman rf /Fe 134[50 50 50 50 50 50 50
50 1[50 50 50 50 50 1[50 50 50 50 50 50 50 50 50 50 13[50
50 1[50 2[50 4[50 2[50 50 2[50 6[50 10[50 50 46[{
 TeXBase1Encoding ReEncodeFont }34 83.333337 /Courier
rf /Ff 205[29 29 49[{ TeXBase1Encoding ReEncodeFont }2
58.333334 /Times-Roman rf /Fg 104[83 42 1[37 37 24[37
42 42 60 42 42 23 32 28 42 42 42 42 65 23 42 23 23 42
42 28 37 42 37 42 37 3[28 1[28 51 60 60 78 60 60 51 46
55 60 46 60 60 74 51 60 32 28 60 60 46 51 60 55 55 60
1[37 3[23 23 42 42 42 42 42 42 42 42 42 42 23 21 28 21
2[28 28 28 35[46 46 2[{ TeXBase1Encoding ReEncodeFont }80
83.333337 /Times-Roman rf /Fh 134[50 1[72 50 55 33 39
44 1[55 50 55 83 28 55 1[28 1[50 33 44 55 44 55 50 9[100
72 72 66 55 72 1[61 78 1[94 66 2[39 3[66 72 72 66 72
10[50 50 50 50 50 50 1[28 25 33 45[{ TeXBase1Encoding ReEncodeFont }46
100.000003 /Times-Bold rf /Fi 136[45 1[45 45 45 45 5[45
45 2[45 45 1[45 45 45 1[45 32[45 17[45 1[45 44[{
 TeXBase1Encoding ReEncodeFont }16 75.000000 /Courier
rf /Fj 2 104 df<000007E000003FE00000FE000003F8000007F000000FE000000FC000
001FC000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000003F8000003F0000007E0000
00FC000003F800007FE00000FF0000007FE0000003F8000000FC0000007E0000003F0000
003F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001FC000000FC000000FE000
0007F0000003F8000000FE0000003FE0000007E01B4B7BB726>102
D<FC000000FFC0000007F0000001FC000000FE0000007F0000003F0000003F8000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000001FC000000FC0000007E0000003F0000001FC
0000007FC000001FE000007FC00001FC000003F0000007E000000FC000001FC000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F80
00001F8000001F8000001F8000001F8000003F8000003F0000007F000000FE000001FC00
0007F00000FFC00000FC0000001B4B7BB726>I E /Fk 134[44 2[44
50 28 39 39 1[50 50 50 72 3[28 50 50 28 44 1[44 1[50
9[83 1[72 1[50 3[72 1[83 55 7[72 66 12[50 2[50 1[50 50
1[25 1[25 44[{ TeXBase1Encoding ReEncodeFont }31 100.000003
/Times-Italic rf /Fl 138[50 28 39 33 2[50 50 1[28 50
2[50 2[44 50 2[44 16[55 2[89 5[72 2[72 66 20[25 46[{
 TeXBase1Encoding ReEncodeFont }18 100.000003 /Times-Roman
rf /Fm 134[60 2[60 1[40 47 53 1[66 60 66 100 3[33 66
1[40 53 1[53 1[60 6[80 3[86 86 7[113 8[86 86 21[40 45[{
 TeXBase1Encoding ReEncodeFont }22 119.999948 /Times-Bold
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: Letter

%%EndSetup
%%Page: 1 1
1 0 bop 667 218 a Fm(Zer)n(o-Copy)30 b(Data)f(Mo)o(v)o(ement)g
(Mechanisms)h(f)m(or)f(UVM)1038 559 y Fl(Charles)c(D.)g(Cranor)200
b(Gurudatta)24 b(M.)g(P)o(arulkar)1285 764 y Fk(Department)f(of)i
(Computer)f(Science)1497 880 y(W)-9 b(ashington)23 b(Univer)o(sity)1533
996 y(St.)31 b(Louis,)24 b(MO)h(63130)1374 1112 y Fj(f)p
Fi(chuck,guru)p Fj(g)p Fi(@arl.wustl.edu)715 1433 y Fh(Abstract)-75
1570 y Fg(W)-7 b(e)24 b(introduce)e(UVM,)h(a)h(ne)n(w)f(virtual)f
(memory)g(system)h(specif-)-75 1670 y(ically)31 b(designed)e(to)i(pro)o
(vide)e(the)i(I/O)g(and)f(IPC)h(systems)g(with)-75 1770
y(a)j(range)f(of)h(\003e)o(xible)f(data)g(mo)o(v)o(ement)f(mechanisms.)
65 b(Imple-)-75 1869 y(mented)17 b(in)h(the)g(NetBSD)h(operating)d
(system,)j(UVM)f(completely)-75 1969 y(replaces)24 b(the)h(Mach)f
(based)h(4.4BSD)f(VM)h(system.)39 b(UVM)25 b(pro-)-75
2069 y(vides)43 b(three)f(ne)n(w)h(virtual)f(memory)f(based)h(data)h
(mo)o(v)o(ement)-75 2168 y(mechanisms:)58 b(page)36 b(loanout,)k(page)c
(transfer)m(,)k(and)c(map)h(en-)-75 2268 y(try)f(passing.)71
b(P)o(age)36 b(loanout)e(and)i(page)f(transfer)g(allo)n(w)h(pro-)-75
2367 y(cesses)21 b(to)g(ef)n(\002ciently)e(lend)h(out)g(and)g(recei)n
(v)o(e)f(pages)h(of)g(memory)-5 b(,)-75 2467 y(thus)29
b(pro)o(viding)e(the)j(operating)d(system)j(with)g(data)f(mo)o(v)o
(ement)-75 2567 y(mechanisms)c(with)h(page-le)n(v)o(el)e(granularity)-5
b(.)40 b(Map)26 b(entry)f(pass-)-75 2666 y(ing)32 b(allo)n(ws)g
(processes)g(to)g(e)o(xchange)e(chunks)h(of)g(their)h(virtual)-75
2766 y(address)25 b(space,)g(thus)g(pro)o(viding)e(the)i(operating)e
(system)i(with)g(a)-75 2866 y(data)31 b(mo)o(v)o(ement)e(mechanism)h
(with)h(mapping-le)n(v)o(el)d(granular)n(-)-75 2965 y(ity)-5
b(.)33 b(In)23 b(addition)f(to)h(featuring)e(\003e)o(xible)i(data)g(mo)
o(v)o(ement)e(mech-)-75 3065 y(anisms,)26 b(UVM)e(also)h(impro)o(v)o
(es)e(virtual)h(memory)e(performance)-75 3164 y(o)o(v)o(er)g(BSD)j(VM)f
(in)g(traditional)e(areas)i(such)f(as)h(forking)e(and)h(pa-)-75
3264 y(geout.)-75 3517 y Fh(1)99 b(Intr)n(oduction)-75
3705 y Fg(Ne)n(w)32 b(computer)e(applications)g(in)i(areas)f(such)h(as)
g(multimedia,)-75 3805 y(imaging,)18 b(and)h(distrib)n(uted)f
(computing)f(e)o(xpect)i(the)g(highest)g(per)n(-)-75
3904 y(formance)e(from)g(an)i(operating)e(system')-5
b(s)19 b(I/O)g(and)f(IPC)h(systems.)-75 4004 y(Although)31
b(hardw)o(are)g(speeds)h(ha)n(v)o(e)g(impro)o(v)o(ed,)h(the)f
(operating)-75 4104 y(system)c(has)g(had)f(a)i(hard)e(time)h(k)o
(eeping)e(up)i([11)n(,)g(14].)48 b(Unnec-)-75 4203 y(essary)23
b(data)g(cop)o(ying)f(in)h(traditional)g(Unix-lik)o(e)f(operating)f
(sys-)-75 4303 y(tems)16 b(has)f(been)g(one)g(of)g(the)g(barriers)g(to)
h(high)e(performance.)21 b(Bulk)-75 4403 y(cop)o(ying)c(of)i(lar)o(ge)f
(chunks)g(of)g(data)h(is)h(e)o(xpensi)n(v)o(e)d(\227)j(the)f(proces-)
-75 4502 y(sor)28 b(must)f(spend)g(its)i(time)e(cop)o(ying)f(the)i
(data)f(from)g(the)g(source)-75 4602 y(b)n(uf)n(fer)22
b(to)i(the)g(destination)e(one)i(w)o(ord)f(at)h(a)g(time.)35
b(The)24 b(speed)f(of)-75 4701 y(this)i(process)g(is)g(limited)g(by)f
(the)h(bandwidth)e(of)i(main)f(memory)-5 b(.)-75 4801
y(Also,)33 b(as)f(these)f(b)n(uf)n(fers)e(are)i(often)f(lar)o(ger)f
(than)h(a)h(processor')-5 b(s)-75 4901 y(cache,)31 b(cop)o(ying)d(them)
h(causes)g(much)g(of)g(the)h(useful)f(informa-)-75 5000
y(tion)21 b(stored)f(in)h(the)g(cache)g(to)g(be)g(\003ushed)f(out)h(to)
g(mak)o(e)f(room)g(for)-75 5100 y(the)g(data)g(being)g(copied.)8
5201 y(Unnecessary)30 b(data)i(copies)f(are)h(often)f(reduced)f(by)h
(using)g(a)-75 5300 y(system')-5 b(s)26 b(virtual)f(memory)e(hardw)o
(are)h(to)i(share)f(or)g(remap)g(data)-75 5400 y(b)n(uf)n(fers.)30
b(The)22 b(virtual)f(memory)g(hardw)o(are)f(is)j(controlled)e(by)h(the)
2025 1433 y(heart)f(of)h(a)g(modern)e(operating)h(system)h(\227)g(the)g
(virtual)f(memory)2025 1533 y(system.)j(One)17 b(common)f(approach)f
(to)i(reducing)f(data)h(cop)o(ying)f(is)2025 1632 y(to)f(focus)g(on)g
(I/O)g(and)g(IPC)h(system)f(design)g(and)g(either)g(rely)f(on)h(e)o(x-)
2025 1732 y(isting)20 b(mechanisms)f(within)g(the)h(virtual)f(memory)f
(system)i(\(with)2025 1832 y(possible)29 b(super\002cial)f(changes\))g
(or)g(to)i(completely)d(bypass)i(the)2025 1931 y(high-le)n(v)o(el)19
b(virtual)h(memory)g(system)h(and)f(access)i(the)f(hardw)o(are)2025
2031 y(directly)15 b([2)o(,)g(7,)h(9)o(,)g(15)o(].)23
b(In)15 b(contrast,)h(our)e(approach)f(is)k(to)e(focus)g(on)2025
2130 y(the)23 b(internal)f(design)g(of)h(the)g(virtual)f(memory)f
(system)i(and)g(inte-)2025 2230 y(grate)d(highly-\003e)o(xible)e
(virtual)i(memory)f(based)h(data)h(mo)o(v)o(ement)2025
2330 y(into)g(it.)27 b(W)-7 b(e)22 b(introduce)d(UVM)i([6)o(],)g(a)g
(ne)n(w)g(virtual)f(memory)f(sys-)2025 2429 y(tem)26
b(speci\002cally)g(designed)f(to)h(pro)o(vide)e(the)i(I/O)h(and)e(IPC)i
(sys-)2025 2529 y(tems)21 b(with)f(a)h(range)e(of)h(\003e)o(xible)f
(data)h(mo)o(v)o(ement)e(mechanisms.)2108 2634 y(Implemented)34
b(in)i(the)g(NetBSD)g(operating)f(system,)k(UVM)2025
2733 y(completely)24 b(replaces)g(the)h(Mach)g(based)f(4.4BSD)h(VM)h
(system.)2025 2833 y(UVM)17 b(pro)o(vides)e(three)h(ne)n(w)h(virtual)f
(memory)f(based)i(data)f(mo)o(v)o(e-)2025 2932 y(ment)30
b(mechanisms:)43 b(page)30 b(loanout,)g(page)g(transfer)m(,)h(and)e
(map)2025 3032 y(entry)e(passing.)48 b(P)o(age)28 b(loanout)f(and)g
(page)h(transfer)f(allo)n(w)h(pro-)2025 3132 y(cesses)21
b(to)g(ef)n(\002ciently)e(lend)h(out)g(and)g(recei)n(v)o(e)f(pages)h
(of)g(memory)-5 b(,)2025 3231 y(thus)29 b(pro)o(viding)e(the)j
(operating)d(system)j(with)g(data)f(mo)o(v)o(ement)2025
3331 y(mechanisms)c(with)h(page-le)n(v)o(el)e(granularity)-5
b(.)40 b(Map)26 b(entry)f(pass-)2025 3431 y(ing)32 b(allo)n(ws)g
(processes)g(to)g(e)o(xchange)e(chunks)h(of)g(their)h(virtual)2025
3530 y(address)25 b(space,)g(thus)g(pro)o(viding)e(the)i(operating)e
(system)i(with)g(a)2025 3630 y(data)31 b(mo)o(v)o(ement)e(mechanism)h
(with)h(mapping-le)n(v)o(el)d(granular)n(-)2025 3729
y(ity)-5 b(.)33 b(In)23 b(addition)f(to)h(featuring)e(\003e)o(xible)i
(data)g(mo)o(v)o(ement)e(mech-)2025 3829 y(anisms,)26
b(UVM)e(also)h(impro)o(v)o(es)e(virtual)h(memory)e(performance)2025
3929 y(o)o(v)o(er)g(BSD)j(VM)f(in)g(traditional)e(areas)i(such)f(as)h
(forking)e(and)h(pa-)2025 4028 y(geout.)2108 4133 y(In)c(this)g(paper)f
(we)h(present)f(the)h(design,)f(implementation,)f(and)2025
4233 y(measurement)28 b(of)h(UVM')-5 b(s)29 b(data)h(mo)o(v)o(ement)d
(mechanisms.)51 b(In)2025 4332 y(Section)27 b(2)h(we)g(present)g
(background)c(and)j(related)g(w)o(ork.)47 b(Sec-)2025
4432 y(tion)27 b(3)h(contains)f(a)h(high-le)n(v)o(el)e(o)o(v)o(ervie)n
(w)f(of)j(UVM.)f(Section)g(4)2025 4532 y(contains)20
b(a)h(more)e(detailed)h(description)f(of)h(UVM')-5 b(s)21
b(data)f(mo)o(v)o(e-)2025 4631 y(ment)29 b(mechanisms.)53
b(In)30 b(Section)f(5)h(we)g(present)f(performance)2025
4731 y(measurements)19 b(for)g(these)h(mechanisms.)k(Finally)-5
b(,)20 b(we)g(conclude)2025 4830 y(in)g(Section)g(6.)2025
5105 y Fh(2)99 b(Backgr)n(ound)27 b(and)f(Related)f(W)-7
b(ork)2025 5300 y Fg(In)27 b(this)g(section)g(we)g(present)g
(background)c(information)i(on)i(the)2025 5400 y(virtual)21
b(memory)g(system)h(that)g(UVM)h(replaces:)28 b(BSD)23
b(VM.)f(W)-7 b(e)p eop
%%Page: 2 2
2 1 bop -75 -67 a Fg(also)23 b(e)o(xamine)e(other)h(related)g(w)o(ork.)
31 b(Such)23 b(w)o(ork)f(f)o(alls)h(into)f(tw)o(o)-75
33 y(cate)o(gories:)48 b(virtual)31 b(memory)f(system)i(designs,)j(and)
c(I/O)h(and)-75 132 y(IPC)21 b(system)f(designs.)-75
424 y Fh(2.1)99 b(BSD)26 b(VM)f(Ov)o(er)o(view)-75 598
y Fg(The)49 b(BSD)h(VM)f(system)h(is)g(di)n(vided)e(into)h(tw)o(o)g
(layers:)83 b(a)-75 698 y(lar)o(ge)28 b(machine-independent)c(layer)m
(,)29 b(and)f(a)h(smaller)g(machine-)-75 798 y(dependent)21
b(layer)-5 b(.)34 b(The)23 b(machine-independent)c(code)j(is)i(shared)
-75 897 y(by)16 b(all)h(BSD-supported)e(processors)h(and)g(contains)g
(the)h(code)e(that)-75 997 y(performs)24 b(the)h(high-le)n(v)o(el)e
(functions)h(of)h(the)g(VM)h(system.)40 b(The)-75 1096
y(machine-dependent)27 b(code)j(is)i(called)f(the)g(\223pmap\224)f
(\(for)g(phys-)-75 1196 y(ical)j(map\))e(layer)m(,)j(and)e(it)h
(handles)e(the)h(lo)n(wer)n(-le)n(v)o(el)f(details)i(of)-75
1296 y(programming)22 b(a)27 b(processor')-5 b(s)25 b(MMU.)g(Each)h
(architecture)e(sup-)-75 1395 y(ported)30 b(by)i(the)f(operating)f
(system)i(must)g(ha)n(v)o(e)f(its)h(o)n(wn)g(pmap)-75
1495 y(module.)23 b(Each)18 b(layer)g(of)g(the)g(VM)h(system)f(does)h
(its)g(o)n(wn)f(le)n(v)o(el)g(of)-75 1595 y(mapping.)36
b(The)25 b(machine-independent)20 b(layer)k(maps)g(\223memory)-75
1694 y(objects\224)k(\(usually)f(\002les\))h(into)g(the)g(virtual)g
(address)f(space)h(of)g(a)-75 1794 y(process)e(or)g(the)g(k)o(ernel.)43
b(The)26 b(machine-dependent)c(layer)k(does)-75 1893
y(not)c(kno)n(w)f(about)g(higher)n(-le)n(v)o(el)f(concepts)h(such)h(as)
h(memory)d(ob-)-75 1993 y(jects;)h(it)g(only)e(kno)n(ws)g(ho)n(w)h(to)g
(map)g(physical)f(pages)g(of)h(memory)-75 2093 y(into)g(a)h(virtual)e
(address)h(space.)8 2202 y(One)c(important)f(aspect)h(of)g(the)g(VM)g
(system)h(is)g(ho)n(w)e(it)i(handles)-75 2302 y(memory)h(objects)h
(that)g(are)g(mapped)f(cop)o(y-on-write.)k(In)d(a)h(cop)o(y-)-75
2401 y(on-write)33 b(mapping,)i(changes)e(made)h(to)g(an)g(object')-5
b(s)34 b(mapped)-75 2501 y(pages)21 b(are)h(not)f(shared)g(\227)h(the)o
(y)f(are)h(pri)n(v)n(ate)f(to)h(the)f(process)g(that)-75
2601 y(made)27 b(the)h(changes.)47 b(The)27 b(BSD)i(VM)f(system)g
(manages)f(cop)o(y-)-75 2700 y(on-write)i(mappings)g(of)g(VM)i(objects)
f(by)g(using)f(\223shado)n(w)g(ob-)-75 2800 y(jects.)-6
b(\224)45 b(A)28 b(shado)n(w)e(object)g(is)h(an)g(anon)o(ymous)d
(memory)h(object)-75 2900 y(that)h(contains)f(the)h(modi\002ed)f(pages)
h(of)f(the)h(cop)o(y-on-write)d(ob-)-75 2999 y(ject)j(it)g(is)g(shado)n
(wing.)38 b(The)25 b(object)g(being)f(shado)n(wed)g(can)h(be)g(a)-75
3099 y(\002le)19 b(object)f(or)h(another)e(shado)n(w)g(object.)24
b(Each)18 b(time)h(an)g(object)f(is)-75 3198 y(cop)o(y-on-write)24
b(copied,)j(a)g(ne)n(w)f(shado)n(w)g(object)g(is)h(created)f(for)-75
3298 y(it.)42 b(A)26 b(link)o(ed)e(list)j(of)e(objects)h(shado)n(wing)d
(each)j(other)e(is)j(called)-75 3398 y(a)g(\223shado)n(w)f(object)g
(chain.)-6 b(\224)44 b(The)26 b(\002nal)h(object)f(on)h(the)g(chain)f
(is)-75 3497 y(the)20 b(object)f(that)g(w)o(as)i(originally)d(cop)o
(y-on-write)f(copied.)23 b(T)-7 b(o)20 b(de-)-75 3597
y(termine)28 b(which)g(page)g(of)g(memory)f(should)g(be)i(mapped)e
(into)h(a)-75 3697 y(process,)19 b(the)i(object)e(chain)h(must)g(be)g
(searched.)8 3806 y(There)34 b(are)h(se)n(v)o(eral)g(problems)e(with)i
(using)g(shado)n(w)f(object)-75 3906 y(chains)g(for)f(cop)o
(y-on-write.)63 b(First,)38 b(it)c(complicates)f(the)h(page)-75
4005 y(f)o(ault)16 b(routine)e(by)i(requiring)e(it)i(to)g(handle)f
(arbitrary)f(length)h(object)-75 4105 y(chains.)40 b(The)26
b(f)o(ault)f(routine)f(must)i(properly)d(protect)i(the)g(object)-75
4204 y(chain)g(in)g(order)f(to)i(a)n(v)n(oid)f(race)g(conditions.)38
b(Second,)26 b(if)f(an)g(ob-)-75 4304 y(ject)j(chain)e(gro)n(ws)g(too)h
(long)f(it)i(will)g(slo)n(w)f(searches)g(and)g(w)o(aste)-75
4404 y(both)c(k)o(ernel)h(and)f(sw)o(ap)i(space.)37 b(In)24
b(order)f(to)h(a)n(v)n(oid)g(long)f(object)-75 4503 y(chains,)18
b(BSD)g(VM)h(uses)f(a)g(comple)o(x)e(\223object)h(collapse\224)g
(strate)o(gy)-75 4603 y(that)i(attempts)g(to)h(compress)e(object)g
(chains)h(by)g(mer)o(ging)e(objects)-75 4703 y(together)-5
b(.)31 b(The)23 b(object)f(collapse)g(code)g(has)h(limitations)f(that)h
(can)-75 4802 y(cause)h(signi\002cant)g(performance)e(problems)h(in)h
(BSD)i(in)e(certain)-75 4902 y(cases.)h(Third,)16 b(the)h(partial)g
(unmapping)d(of)i(a)i(cop)o(y-on-write)c(area)-75 5001
y(of)20 b(memory)f(does)h(not)g(free)f(an)o(y)h(memory)e(resources)i
(associated)-75 5101 y(with)k(the)g(inaccessible)f(unmapped)e(area.)35
b(These)24 b(resources)f(are)-75 5201 y(held)e(until)g(the)g(cop)o
(y-on-write)e(area)i(of)g(memory)f(is)i(completely)-75
5300 y(unmapped.)38 b(This)26 b(can)f(cause)g(a)h(condition)e(kno)n(wn)
f(as)k(a)e(\223sw)o(ap)-75 5400 y(memory)18 b(leak.)-6
b(\224)2025 -67 y Fh(2.2)99 b(Related)26 b(V)l(irtual)f(Memory)g
(Systems)2025 104 y Fg(The)16 b(Mach)h(virtual)f(memory)f(system)i(is)h
(used)e(for)g(memory)f(man-)2025 203 y(agement)32 b(and)g(IPC)h(in)g
(the)g(Mach)f(microk)o(ernel)f(de)n(v)o(eloped)f(at)2025
303 y(Carne)o(gie)c(Mellon)g(Uni)n(v)o(ersity)g([16)o(,)h(19)o(].)46
b(BSD)28 b(VM)f(is)h(a)f(sim-)2025 403 y(pli\002ed)d(v)o(ersion)e(of)i
(Mach)f(VM.)h(Mach)f(VM)h(a)n(v)n(oids)g(data)g(cop)o(y-)2025
502 y(ing)e(by)g(using)g(tw)o(o)g(mechanisms:)29 b(cop)o(y-on-write)19
b(and)j(\223out-of-)2025 602 y(line\224)29 b(IPC)g(messages.)52
b(Mach)28 b(uses)h(a)h(more)e(comple)o(x)f(v)o(ersion)2025
702 y(of)g(the)g(BSD)h(VM)g(object)e(chaining)g(mechanism)g(for)g(cop)o
(y-on-)2025 801 y(write,)k(and)d(thus)h(suf)n(fers)f(from)g(problems)f
(similar)i(to)g(the)g(ones)2025 901 y(described)g(in)h(Section)g(2.1.)
50 b(Mach')-5 b(s)29 b(\223out-of-line\224)e(IPC)j(mes-)2025
1000 y(sage)e(passing)g(mechanism)e(allo)n(ws)j(processes)e(to)h(pass)h
(chunks)2025 1100 y(of)16 b(virtual)g(memory)e(between)i(themselv)o(es)
f(without)h(data)g(copies.)2025 1200 y(This)29 b(pro)o(vides)e
(mapping-le)n(v)o(el)f(granularity)h(and)h(is)i(similar)f(to)2025
1299 y(UVM')-5 b(s)31 b(map)g(entry)e(passing)i(mechanism.)55
b(This)31 b(mechanism)2025 1399 y(w)o(as)f(found)d(to)j(be)f(insuf)n
(\002cient)f(for)h(certain)f(types)h(of)g(IPC)h(and)2025
1499 y(later)18 b(v)o(ersions)f(of)g(Mach)h(were)g(modi\002ed)e(to)i
(allo)n(w)g(a)g(list)h(of)f(b)n(usy)2025 1598 y(pages)i(to)g(be)g(e)o
(xtracted)f(from)g(a)h(process)g(and)f(sent)h(as)h(a)g(message)2025
1698 y([2)o(].)30 b(Further)21 b(optimizations)g(along)g(these)h(lines)
g(allo)n(w)g(pages)f(to)2025 1797 y(be)h(to)f(be)h(pinned)e(in)i
(memory)e(rather)g(than)i(being)e(mark)o(ed)g(b)n(usy)-5
b(.)2025 1897 y(While)21 b(this)h(approach)c(does)j(pro)o(vide)e
(page-le)n(v)o(el)g(granularity)-5 b(,)18 b(it)2025 1997
y(is)31 b(not)f(as)h(\003e)o(xible)f(as)g(UVM')-5 b(s)31
b(page)f(loanout)f(mechanism,)i(as)2025 2096 y(all)21
b(cop)o(y-on-write)d(operations)h(must)h(be)h(done)e(through)g(Mach')-5
b(s)2025 2196 y(b)n(ulk)o(y)32 b(object-chaining)e(mechanism.)63
b(Additionally)-5 b(,)34 b(Mach')-5 b(s)2025 2296 y(IPC)16
b(operations)e(cause)i(unnecessary)d(map)i(fragmentation)e(when)2025
2395 y(e)o(xtracting)19 b(memory)f(for)i(page)f(based)h(out-of-line)e
(messages.)2108 2503 y(The)36 b(FreeBSD)g(virtual)f(memory)f(system)j
(is)f(an)g(impro)o(v)o(ed)2025 2602 y(v)o(ersion)16 b(of)h(the)g(BSD)h
(VM)g(system)f([8)o(].)25 b(W)-7 b(ork)17 b(on)f(FreeBSD)i(VM)2025
2702 y(has)34 b(focused)e(on)h(a)g(number)f(of)h(areas)h(including)d
(simplifying)2025 2802 y(data)16 b(structure)g(management,)f(data)h
(caching,)g(and)g(ef)n(\002cient)g(pag-)2025 2901 y(ing)29
b(algorithms.)53 b(FreeBSD)30 b(VM')-5 b(s)31 b(data)e(structures)h
(are)f(simi-)2025 3001 y(lar)22 b(to)f(BSD)i(VM')-5 b(s)22
b(data)f(structures,)g(although)f(some)h(structures)2025
3101 y(ha)n(v)o(e)j(been)f(eliminated.)36 b(While)25
b(FreeBSD)f(retains)g(Mach-style)2025 3200 y(shado)n(w)d(object)g
(chaining)g(for)g(cop)o(y-on-write,)e(the)j(sw)o(ap)g(mem-)2025
3300 y(ory)h(leaks)g(associated)g(with)h(BSD)h(VM')-5
b(s)24 b(poor)e(handling)f(of)j(the)2025 3399 y(object)34
b(collapse)g(problem)f(ha)n(v)o(e)g(been)h(addressed.)66
b(Man)o(y)34 b(of)2025 3499 y(FreeBSD')-5 b(s)24 b(impro)o(v)o(ements)d
(in)i(the)g(areas)h(of)f(data)g(caching)f(and)2025 3599
y(paging)27 b(algorithms)f(are)i(applicable)f(to)h(UVM,)g(thus)g
(FreeBSD)2025 3698 y(will)23 b(be)g(a)g(good)e(reference)g(for)h
(future)f(w)o(ork)h(on)g(UVM)h(in)f(these)2025 3798 y(areas.)56
b(FreeBSD)32 b(does)e(not)g(ha)n(v)o(e)g(UVM-style)h(features)f(such)
2025 3898 y(as)i(page)f(loanout)f(and)h(page)f(transfer)-5
b(.)59 b(These)31 b(features)g(could)2025 3997 y(be)24
b(added)g(to)g(FreeBSD)h(with)g(some)f(dif)n(\002culty)g(\(due)f(to)i
(the)f(use)2025 4097 y(of)d(object)f(chaining\).)25 b(Alternati)n(v)o
(ely)20 b(object)g(chaining)g(could)g(be)2025 4197 y(eliminated)f(from)
g(FreeBSD)i(and)f(UVM)g(features)g(added.)2108 4304 y(The)30
b(SunOS4)f(virtual)g(memory)f(system)i(\(also)g(used)g(in)g(So-)2025
4404 y(laris\))36 b(is)h(a)f(modern)e(VM)i(system)h(that)f(w)o(as)g
(designed)f(to)h(re-)2025 4503 y(place)e(the)g(4.3BSD)g(VM)h(system)f
(that)g(appeared)f(in)h(SunOS3)2025 4603 y([10)o(,)22
b(13)o(].)32 b(SunOS)23 b(VM)f(a)n(v)n(oids)h(data)f(cop)o(ying)f
(through)f(a)j(cop)o(y-)2025 4703 y(on-write)j(mechanism)h(based)g(on)g
(indi)n(vidual)e(pages)i(of)h(anon)o(y-)2025 4802 y(mous)i(memory)e
(\(anons\))h(grouped)f(into)i(anon)o(ymous)d(memory)2025
4902 y(maps)g(\(amaps\).)44 b(UVM)27 b(uses)g(a)g(similar)g(scheme)g
(for)f(cop)o(y-on-)2025 5001 y(write,)35 b(ho)n(we)n(v)o(er)29
b(there)j(are)f(some)h(k)o(e)o(y)f(dif)n(ferences.)58
b(First,)35 b(in)2025 5101 y(UVM)d(the)h(anon)e(is)i(a)f(general)f
(purpose)g(virtual)h(memory)e(ab-)2025 5201 y(straction)c(used)g(in)h
(both)e(cop)o(y-on-write)f(and)h(data)i(passing.)43 b(In)2025
5300 y(SunOS)19 b(the)f(anon)g(is)i(not)e(a)h(generalized)e
(abstraction)h(and)g(is)i(lim-)2025 5400 y(ited)d(to)g(certain)f(types)
h(of)f(mappings)f(that)i(require)f(cop)o(y-on-write)p
eop
%%Page: 3 3
3 2 bop -75 -67 a Fg(or)26 b(zero-\002ll)h(memory)-5
b(.)42 b(It)27 b(is)h(not)e(used)h(for)f(data)g(passing.)44
b(Sec-)-75 33 y(ond,)19 b(UVM)h(allo)n(ws)g(processes)g(to)g(share)f
(amap-based)f(cop)o(y-on-)-75 132 y(write)30 b(re)o(gions)f(with)h
(other)f(processes)h(or)f(the)h(k)o(ernel.)54 b(This)30
b(is)-75 232 y(used)18 b(in)h(map)e(entry)h(passing)g(and)g(to)g
(support)f(Mach-style)g(mem-)-75 332 y(ory)25 b(inheritance.)40
b(SunOS)26 b(lacks)g(this)g(feature.)41 b(Third,)26 b(UVM')-5
b(s)-75 431 y(amap)31 b(data)h(structure)f(contains)h(additional)e
(inde)o(x)o(es)h(to)h(speed)-75 531 y(up)i(operations)g(on)g(sparsely)h
(populated)e(amaps.)68 b(Finally)-5 b(,)38 b(as)-75 630
y(part)28 b(of)h(its)h(page)e(loanout)f(mechanism,)j(UVM)f(allo)n(ws)g
(a)g(page)-75 730 y(to)34 b(belong)e(to)i(both)e(a)i(\002le)h(object)e
(and)g(an)g(anon)g(at)h(the)f(same)-75 830 y(time.)45
b(SunOS)27 b(does)g(not)f(support)g(this)h(type)g(of)f(memory)g(shar)n
(-)-75 929 y(ing.)f(SunOS)19 b(VM)i(currently)d(does)i(not)f(pro)o
(vide)f(UVM-lik)o(e)i(fea-)-75 1029 y(tures)30 b(such)g(as)g(page)g
(loanout,)g(page)g(transfer)m(,)h(and)e(map)g(entry)-75
1129 y(passing.)42 b(Ho)n(we)n(v)o(er)m(,)26 b(SunOS')-5
b(s)26 b(anon-style)f(anon)o(ymous)e(mem-)-75 1228 y(ory)f(system)g
(and)g(modular)f(design)h(w)o(ould)g(ease)h(the)f(implemen-)-75
1328 y(tation)28 b(of)h(these)f(UVM-style)h(features.)49
b(Recent)29 b(e)o(xperimental)-75 1427 y(w)o(ork)15 b(under)g(Solaris)h
(introduces)e(tw)o(o)j(ne)n(w)e(virtual)h(memory)e(fea-)-75
1527 y(tures:)35 b(page)24 b(soft)i(locking)d(and)i(page)f(\003ipping)g
([5)o(].)40 b(These)25 b(fea-)-75 1627 y(tures)20 b(were)f(implemented)
f(in)i(the)g(machine-dependent)c(layer)j(of)-75 1726
y(the)31 b(VM)g(\(the)g(\223HA)-9 b(T\224)31 b(layer\),)h(thus)f
(bypassing)f(the)h(machine-)-75 1826 y(independent)f(part)i(of)f(the)i
(VM)f(system.)62 b(Most)32 b(of)g(the)g(UVM)-75 1926
y(w)o(ork)20 b(w)o(as)h(done)e(in)h(the)g(machine-independent)c(layer)
-5 b(.)8 2035 y(Linux)208 2005 y Ff(1)257 2035 y Fg(is)17
b(a)g(popular)e(free)h(Unix-lik)o(e)g(operating)f(system)i(writ-)-75
2134 y(ten)26 b(by)g(Linus)g(T)-7 b(orv)n(alds)25 b([18)o(].)44
b(Linux)25 b(VM)h(a)n(v)n(oids)h(data)f(cop)o(y-)-75
2234 y(ing)17 b(through)e(its)j(cop)o(y-on-write)c(mechanism.)23
b(This)17 b(mechanism)-75 2334 y(uses)f(a)h(cop)o(y-on-write)c(mapping)
h(\003ag)i(and)f(a)h(per)n(-page)e(reference)-75 2433
y(counter)31 b(to)j(determine)d(if)i(a)h(shared)e(page)g(should)g(be)h
(copied.)-75 2533 y(Lik)o(e)17 b(SunOS,)f(Linux)g(does)h(not)f(allo)n
(w)h(processes)g(to)g(share)g(cop)o(y-)-75 2633 y(on-write)e(re)o
(gions.)22 b(Additionally)-5 b(,)15 b(since)h(Linux)f(stores)h(cop)o
(y-on-)-75 2732 y(write)h(state)g(in)g(its)h(page)e(tables,)h
(mapping-le)n(v)o(el)d(granularity)g(VM)-75 2832 y(operations)37
b(on)i(cop)o(y-on-write)d(memory)h(require)h(page-le)n(v)o(el)-75
2931 y(operations.)53 b(Linux)29 b(also)i(does)f(not)f(support)g
(write-protecting)-75 3031 y(all)23 b(mappings)e(of)h(a)h(page)e(of)h
(physical)g(memory)-5 b(.)29 b(This)23 b(mak)o(es)f(it)-75
3131 y(impossible)e(to)g(transition)f(a)i(shared)e(page)h(into)g(a)h
(cop)o(y-on-write)-75 3230 y(state,)35 b(and)d(thus)g(pre)n(v)o(ents)e
(Linux)h(from)g(supporting)f(VM)i(fea-)-75 3330 y(tures)16
b(such)g(as)h(UVM')-5 b(s)17 b(page)e(loanout.)22 b(Linux)16
b(has)g(some)g(support)-75 3430 y(for)21 b(remapping)f(memory)-5
b(,)19 b(b)n(ut)j(only)f(within)h(a)g(process')f(address)-75
3529 y(space.)32 b(The)23 b(Linux-speci\002c)e Fe(mremap)h
Fg(system)h(call)g(is)h(used)e(by)-75 3629 y(some)e(v)o(ersions)f(of)h
(Linux')-5 b(s)20 b Fe(malloc)f Fg(to)i(resize)f(its)h(heap.)8
3738 y(Although)h(not)h(a)h(Unix-lik)o(e)e(operating)g(system,)i
(Microsoft')-5 b(s)-75 3838 y(W)m(indo)n(ws-NT)49 b(operating)f
(system')-5 b(s)51 b(VM)f(system)h(supports)-75 3937
y(man)o(y)23 b(of)h(the)h(same)f(features)g(as)h(Unix-lik)o(e)f
(operating)e(systems)-75 4037 y([17)o(].)64 b(NT)34 b(a)n(v)n(oids)f
(data)g(copies)h(through)d(cop)o(y-on-write)f(and)-75
4136 y(local)e(procedure)e(calls)j(\(LPCs\).)50 b(NT')-5
b(s)29 b(general)e(structure)g(and)-75 4236 y(cop)o(y-on-write)35
b(mechanism)i(are)i(similar)f(to)h(those)f(found)e(in)-75
4336 y(Linux,)16 b(and)f(thus)h(the)g(same)h(limitations)e(that)i
(apply)e(to)h(Linux)f(ap-)-75 4435 y(ply)22 b(to)h(NT)-6
b(.)22 b(LPCs)h(are)g(an)f(internal-only)e(IPC)j(f)o(acility)g(that)f
(uses)-75 4535 y(virtual)d(memory)f(features)h(in)h(some)f(cases)i(to)f
(transfer)e(data.)25 b(F)o(or)-75 4635 y(LPC)d(messages)f(of)f(less)i
(than)f(256)f(bytes)g(data)h(cop)o(ying)e(is)j(used.)-75
4734 y(F)o(or)g(LPC)g(messages)g(lar)o(ger)f(than)h(that,)g(a)g(shared)
f(object)h(is)h(allo-)-75 4834 y(cated)k(and)f(used)g(to)h(pass)h
(data.)44 b(F)o(or)27 b(v)o(ery)e(lar)o(ge)h(data)h(that)g(will)-75
4933 y(not)k(\002t)h(in)f(a)h(shared)f(section,)i(NT')-5
b(s)32 b(LPC)g(mechanism)e(allo)n(ws)-75 5033 y(the)g(serv)o(er)f(to)h
(directly)f(read)h(or)f(write)h(data)g(from)f(the)h(client')-5
b(s)-75 5133 y(address)20 b(space.)p -75 5242 780 4 v
15 5298 a Fd(1)45 5321 y Fc(W)-5 b(e)26 b(e)o(xamined)i(the)f(virtual)i
(memory)d(system)h(that)h(appears)g(in)f(the)g(most)-75
5400 y(recently)20 b(a)o(v)n(ailable)g(v)o(ersion)e(of)f(Linux)g(\227)g
(2.1.106.)2025 -67 y Fh(2.3)99 b(Related)26 b(I/O)d(and)j(IPC)e
(Subsystems)2025 104 y Fg(In)k(this)g(section)g(we)h(e)o(xamine)d
(research)i(on)f(I/O)i(and)e(IPC)i(sub-)2025 203 y(systems)22
b(that)g(can)f(tak)o(e)h(adv)n(antage)e(of)h(services)h(of)n(fered)e
(by)h(vir)n(-)2025 303 y(tual)h(memory)f(systems)h(to)h(reduce)d(data)i
(mo)o(v)o(ement)e(o)o(v)o(erheads.)2025 403 y(While)d(this)f(research)g
(shares)g(some)g(of)g(the)g(same)h(goals)f(as)h(UVM,)2025
502 y(our)h(approach)e(is)k(dif)n(ferent.)j(In)18 b(UVM)h(we)g(are)f
(interested)g(in)h(cre-)2025 602 y(ating)c(a)h(virtual)f(memory)f
(system)h(whose)g(internal)g(structure)g(pro-)2025 702
y(vides)24 b(ef)n(\002cient)h(and)f(\003e)o(xible)g(support)f(for)h
(data)g(mo)o(v)o(ement.)36 b(In)2025 801 y(I/O)18 b(and)g(IPC)g
(research,)g(the)g(focus)f(is)i(on)f(using)f(features)g(that)i(the)2025
901 y(virtual)26 b(memory)f(is)i(assumed)f(to)h(already)e(pro)o(vide.)
42 b(Thus,)27 b(I/O)2025 1000 y(and)18 b(IPC)h(research)e(addresses)i
(some)f(problems)f(that)h(UVM)h(does)2025 1100 y(not)h(address)g(such)g
(as)g(b)n(uf)n(fering)e(schemes)i(and)g(API)h(design.)2108
1208 y(Brustoloni)16 b(and)g(Steenkiste)g(from)f(Carne)o(gie)h(Mellon)g
(Uni)n(v)o(er)n(-)2025 1307 y(sity)35 b(ha)n(v)o(e)e(analyzed)g(the)h
(ef)n(fects)f(of)h(data)g(passing)g(semantics)2025 1407
y(on)28 b(k)o(ernel)f(I/O)i(and)f(IPC)h(and)e(pro)o(vide)g
(optimizations)f(that)j(re-)2025 1507 y(duce)19 b(data)g(transfer)g(o)o
(v)o(erhead)e(while)i(maintaining)f(a)i(traditional)2025
1606 y(Unix-lik)o(e)g(I/O)h(API)g([3)o(].)27 b(Implemented)19
b(under)g(Genie)i(\(a)g(proto-)2025 1706 y(type)i(I/O)g(system\),)h(tw)
o(o)f(optimizations)f(of)h(interest)h(are)f(tempo-)2025
1805 y(rary)f(cop)o(y-on-write)e(\(TCO)m(W\))k(and)e(input)g
(alignment.)32 b(TCO)m(W)-8 b(,)2025 1905 y(lik)o(e)28
b(UVM')-5 b(s)28 b(page)e(loanout,)i(allo)n(ws)g(a)g(process)e(to)i
(lend)f(wired)2025 2005 y(pages)20 b(to)g(the)g(k)o(ernel)f(without)g
(ha)n(ving)g(to)h(w)o(orry)f(about)g(the)h(page)2025
2104 y(being)h(modi\002ed)f(or)i(freed.)28 b(TCO)m(W)23
b(dif)n(fers)e(from)g(page)g(loanout)2025 2204 y(in)29
b(three)e(k)o(e)o(y)h(areas.)50 b(First,)31 b(while)d(UVM)h(allo)n(ws)f
(pages)g(to)h(be)2025 2304 y(loaned)g(out)g(as)i(either)e(wired)g(k)o
(ernel)g(memory)-5 b(,)30 b(or)g(a)g(pageable)2025 2403
y(anon)o(ymous)22 b(memory)-5 b(,)24 b(TCO)m(W)i(can)e(only)g(be)h
(used)g(with)g(wired)2025 2503 y(k)o(ernel)18 b(memory)-5
b(.)22 b(Second,)17 b(while)i(UVM')-5 b(s)19 b(page)e(loanout)h(mech-)
2025 2602 y(anism)i(w)o(as)i(implemented)c(on)i(top)g(of)h(UVM')-5
b(s)21 b(ne)n(w)f(anon-based)2025 2702 y(anon)o(ymous)e(memory)i
(system)h(that)h(pro)o(vides)d(page)i(granularity)2025
2802 y(with)h(lo)n(w)f(o)o(v)o(erhead,)e(TCO)m(W)j(w)o(as)g
(implemented)e(as)i(an)f(add-on)2025 2901 y(to)c(the)f(old)g(BSD)h(VM)g
(system,)g(and)f(thus)g(has)h(to)g(contend)d(with)j(all)2025
3001 y(the)26 b(dra)o(wbacks)f(of)h(BSD)h(VM')-5 b(s)27
b(object)e(chaining)g(mechanism.)2025 3101 y(Third,)f(while)h(we)f(ha)n
(v)o(e)g(demonstrated)e(ho)n(w)i(page)g(loanout)f(can)2025
3200 y(be)g(inte)o(grated)e(with)i(BSD')-5 b(s)24 b(mb)n(uf-based)d
(IPC)i(system,)g(TCO)m(W)2025 3300 y(is)g(a)f(prototype,)d(and)i(it)i
(has)f(only)f(be)g(demonstrated)f(with)i(Genie)2025 3399
y(\(completely)32 b(bypassing)h(the)i(traditional)e(BSD)i(IPC)g
(system\).)2025 3499 y(Input)20 b(alignment)f(is)j(a)f(technique)e
(that)i(can)f(be)h(used)f(to)h(preserv)o(e)2025 3599
y(an)d(API)h(with)f(cop)o(y)g(semantics)g(on)g(data)g(input)g(while)g
(using)g(page)2025 3698 y(remapping)k(to)i(actually)g(mo)o(v)o(e)f(the)
h(data.)38 b(In)24 b(order)f(to)h(do)g(input)2025 3798
y(alignment)16 b(either)g(the)i(input)e(request)g(must)i(be)f(issued)g
Fb(befor)m(e)g Fg(the)2025 3898 y(data)31 b(arri)n(v)o(es)f(so)h(Genie)
g(can)g(analyze)f(the)h(alignment)e(require-)2025 3997
y(ments)f(of)g(the)g(input)g(b)n(uf)n(fer)m(,)g(or)g(the)g(client)h
(must)f(query)f(Genie)2025 4097 y(about)20 b(the)h(alignment)e(of)i(b)n
(uf)n(fers)f(that)h(are)g(currently)e(w)o(aiting)h(to)2025
4197 y(be)h(transfered.)28 b(Genie)21 b(also)h(has)f(se)n(v)o(eral)g
(techniques)f(for)h(a)n(v)n(oid-)2025 4296 y(ing)e(data)g
(fragmentation)d(when)i(the)i(input)e(data)h(contains)f(pack)o(et)2025
4396 y(headers)h(from)g(netw)o(ork)g(interf)o(aces.)2108
4503 y(Druschel)25 b(and)g(Peterson')-5 b(s)25 b(f)o(ast)h(b)n(uf)n
(fers)e(\(fb)n(ufs\))g(k)o(ernel)h(sub-)2025 4603 y(system)e(is)h(an)f
(operating)e(system)i(f)o(acility)g(for)f(IPC)i(b)n(uf)n(fer)d(man-)
2025 4703 y(agement)d(de)n(v)o(eloped)e(at)j(the)g(Uni)n(v)o(ersity)e
(of)h(Arizona)g([7)o(].)25 b(Fb)n(ufs,)2025 4802 y(an)18
b(add-on)e(to)i(the)g(Mach)f(microk)o(ernel,)f(pro)o(vide)g(f)o(ast)i
(data)g(trans-)2025 4902 y(fer)24 b(across)f(protection)g(domain)f
(boundaries.)34 b(The)23 b(fb)n(uf)g(system)2025 5001
y(is)d(based)g(on)f(the)g(assumption)f(that)i(IPC)g(b)n(uf)n(fers)f
(are)g(immutable.)2025 5101 y(The)29 b(k)o(ernel)g(and)g(each)g
(process)g(on)h(the)f(system)h(share)f(a)h(\002x)o(ed)2025
5201 y(sized)22 b(area)g(of)f(virtual)g(memory)f(set)j(aside)f(as)h
(the)e(\223fb)n(uf)g(re)o(gion\224)2025 5300 y(where)h(all)g(fb)n(ufs)g
(must)h(be)f(mapped.)29 b(The)22 b(fb)n(uf)g(f)o(acility)g(has)g(tw)o
(o)2025 5400 y(useful)29 b(optimizations:)43 b(fb)n(uf)29
b(caching)g(and)g(v)n(olatile)h(fb)n(ufs.)53 b(In)p eop
%%Page: 4 4
4 3 bop -75 -67 a Fg(fb)n(uf)16 b(caching,)g(the)h(sending)f(process)g
(speci\002es)h(the)g(path)f(the)h(fb)n(uf)-75 33 y(will)26
b(tak)o(e)g(through)e(the)i(system)g(at)g(fb)n(uf)f(allocation)g(time.)
41 b(This)-75 132 y(allo)n(ws)24 b(the)g(fb)n(uf)f(system)h(to)g(reuse)
g(the)g(same)g(fb)n(uf)f(for)g(multiple)-75 232 y(IPC)k(operations.)40
b(V)-11 b(olatile)27 b(fb)n(ufs)e(are)h(fb)n(ufs)g(that)g(are)g(not)f
(write)-75 332 y(protected)f(in)i(the)g(sending)e(process,)i(sa)n(ving)
g(some)f(VM)h(opera-)-75 431 y(tions.)49 b(The)28 b(fb)n(uf)g(f)o
(acility)g(has)g(se)n(v)o(eral)g(limitations.)49 b(First,)31
b(the)-75 531 y(only)23 b(w)o(ay)i(to)f(get)g(data)g(from)f(the)h
(\002lesystem)h(into)f(an)g(fb)n(uf)f(is)i(to)-75 630
y(cop)o(y)e(it.)37 b(Second,)23 b(if)h(an)g(application)f(has)h(data)g
(that)g(it)g(w)o(ants)g(to)-75 730 y(send)j(using)h(an)f(fb)n(uf)g(b)n
(ut)h(that)g(data)g(is)g(not)g(in)g(the)f(fb)n(uf)g(re)o(gion,)-75
830 y(then)e(it)h(must)f(\002rst)h(be)f(copied)f(there.)39
b(Third,)25 b(it)h(is)g(not)f(possible)-75 929 y(to)30
b(use)g(cop)o(y-on-write)d(with)j(an)g(fb)n(uf.)54 b(It)30
b(should)f(be)h(possible)-75 1029 y(to)c(combine)f(UVM)h(features)f
(such)h(as)h(page)e(loanout)g(and)g(page)-75 1129 y(transfer)19
b(with)i(the)f(fb)n(uf)f(concept)g(to)i(lift)f(these)h(limitations.)8
1234 y(P)o(asquale,)37 b(Anderson,)e(and)f(Muller')-5
b(s)34 b(Container)f(Shipping)-75 1333 y(I/O)28 b(system)f(allo)n(ws)h
(a)g(process)f(to)h(transfer)e(data)h(without)g(ha)n(v-)-75
1433 y(ing)18 b(direct)g(access)i(to)e(it)i([15)n(].)25
b(De)n(v)o(eloped)16 b(at)j(Uni)n(v)o(ersity)f(of)g(Cal-)-75
1533 y(ifornia)29 b(\(San)g(Die)o(go\),)i(the)f(container)e(shipping)g
(API)i(allo)n(ws)g(a)-75 1632 y(process)23 b(to)g(allocate)h(a)f
(container)m(,)f(and)h(the)h(\002ll)g(it)g(with)g(pointers)-75
1732 y(to)19 b(data)f(b)n(uf)n(fers.)23 b(Once)18 b(full,)h(a)g
(container)e(can)h(be)g(shipped)f(to)i(an-)-75 1832 y(other)j(process)h
(or)f(the)h(k)o(ernel.)32 b(Rather)23 b(than)f(recei)n(ving)g(the)h
(data)-75 1931 y(directly)-5 b(,)29 b(the)f(recei)n(ving)f(party)g
(recei)n(v)o(es)h(a)h(handle)e(to)h(the)g(con-)-75 2031
y(tainer)-5 b(.)48 b(The)28 b(recei)n(v)o(er)e(can)i(choose)f(to)h(map)
f(some)h(of)g(the)f(con-)-75 2130 y(tainer')-5 b(s)21
b(b)n(uf)n(fers)g(into)g(its)h(address)f(space)h(for)e(modi\002cation,)
g(and)-75 2230 y(then)27 b(it)h(can)f(unmap)e(them.)46
b(The)27 b(container)f(can)h(be)g(passed)g(on)-75 2330
y(to)32 b(another)e(process.)60 b(By)32 b(using)g(these)g(operations)e
(processes)-75 2429 y(can)23 b(pass)h(data)f(between)f(themselv)o(es)g
(without)h(mapping)e(it)j(into)-75 2529 y(their)19 b(address)f(space.)
25 b(A)20 b(container)d(shipping)h(I/O)h(system)h(could)-75
2629 y(easily)e(tak)o(e)f(adv)n(antage)e(of)i(UVM)h(data)f(mo)o(v)o
(ement)e(mechanisms)-75 2728 y(when)20 b(loading,)e(unloading,)g(and)h
(transferring)f(containers.)-75 3006 y Fh(3)99 b(UVM)25
b(Ov)o(er)o(view)-75 3203 y Fg(Our)18 b(primary)f(objecti)n(v)o(e)g(in)
h(creating)f(UVM)i(is)g(to)g(produce)d(a)j(vir)n(-)-75
3302 y(tual)24 b(memory)f(system)h(for)g(a)g(Unix-lik)o(e)g(operating)e
(system)i(that)-75 3402 y(has)30 b(\003e)o(xible,)h(general,)g(and)f
(ef)n(\002cient)f(VM-based)g(data)g(mo)o(v)o(e-)-75 3501
y(ment)40 b(f)o(acilities)h(inte)o(grated)e(into)h(its)h(design.)85
b(The)40 b(k)o(ernel')-5 b(s)-75 3601 y(I/O)33 b(and)g(IPC)h(systems)f
(can)g(tak)o(e)g(adv)n(antage)e(of)i(these)h(f)o(acili-)-75
3701 y(ties)20 b(to)f(reduce)e(data)i(mo)o(v)o(ement)d(o)o(v)o(erhead.)
22 b(Unlik)o(e)d(man)o(y)e(other)-75 3800 y(prototype-based)k(VM)j
(research)f(projects,)h(our)g(w)o(ork)f(has)h(been)-75
3900 y(implemented)17 b(as)i(part)g(of)f(an)h(operating)e(system)i
(that)f(is)i(in)f(wide-)-75 4000 y(spread)i(use.)31 b(Thus,)22
b(we)g(ha)n(v)o(e)f(designed)g(our)g(ne)n(w)h(virtual)f(mem-)-75
4099 y(ory)29 b(features)g(so)i(that)f(their)f(presence)g(in)h(the)g(k)
o(ernel)f(does)h(not)-75 4199 y(disrupt)22 b(other)g(k)o(ernel)f
(subsystems.)32 b(This)23 b(allo)n(ws)g(e)o(xperimental)-75
4298 y(changes)j(to)h(be)g(introduced)e(into)i(the)g(I/O)g(and)f(IPC)i
(subsystem)-75 4398 y(gradually)-5 b(,)24 b(thus)i(easing)f(the)h
(adoption)d(of)j(these)g(features.)40 b(Our)-75 4498
y(w)o(ork)20 b(centers)f(around)g(se)n(v)o(eral)g(major)h(goals:)8
4603 y Fa(Allo)o(w)28 b(a)f(pr)o(ocess)h(to)f(safely)g(let)h(a)f(shar)o
(ed)h(copy-on-write)-75 4703 y(copy)g(of)f(its)i(memory)e(be)i(used)g
(either)f(by)g(other)g(pr)o(ocesses,)-75 4802 y(the)22
b(I/O)g(system,)g(or)f(the)h(IPC)g(system.)29 b Fg(The)22
b(mechanism)e(used)-75 4902 y(to)33 b(do)g(this)h(should)e(allo)n(w)h
(copied)f(memory)g(to)h(come)g(from)f(a)-75 5001 y(memory)24
b(mapped)h(\002le,)j(anon)o(ymous)c(memory)-5 b(,)25
b(or)h(a)g(combina-)-75 5101 y(tion)21 b(of)g(the)g(tw)o(o.)28
b(It)22 b(should)e(pro)o(vide)f(copied)i(memory)e(either)i(as)-75
5201 y(wired)k(pages)h(for)f(the)h(k)o(ernel')-5 b(s)25
b(I/O)h(or)g(IPC)g(subsystems,)h(or)f(as)-75 5300 y(pageable)g(anon)o
(ymous)e(memory)i(for)g(transfer)h(to)g(another)f(pro-)-75
5400 y(cess.)65 b(It)33 b(should)f(gracefully)f(preserv)o(e)h(cop)o
(y-on-write)e(in)k(the)2025 -67 y(presence)19 b(of)g(page)g(f)o(aults,)
h(pageouts,)f(and)g(memory)f(\003ushes.)25 b(Fi-)2025
33 y(nally)-5 b(,)17 b(it)h(should)e(operate)h(in)g(such)g(a)h(w)o(ay)g
(that)f(it)h(pro)o(vides)e(access)2025 132 y(to)g(memory)e(at)i
(page-le)n(v)o(el)d(granularity)h(without)h(fragmenting)e(or)2025
232 y(disrupting)19 b(the)i(VM)g(system')-5 b(s)22 b(higher)n(-le)n(v)o
(el)c(memory)h(mapping)2025 332 y(data)f(structures.)24
b(Section)18 b(4.1)g(describes)g(ho)n(w)g(UVM)g(meets)h(this)2025
431 y(goal)h(through)e(the)i(page)f(loanout)g(mechanism.)2108
531 y Fa(Allo)o(w)h(pages)f(of)g(memory)g(fr)o(om)f(the)i(I/O)g
(system,)f(the)h(IPC)2025 630 y(system,)38 b(or)c(fr)o(om)f(other)h(pr)
o(ocesses)g(to)g(be)h(inserted)g(easily)2025 730 y(into)17
b(a)g(pr)o(ocess')g(addr)o(ess)g(space.)24 b Fg(Once)17
b(the)g(pages)g(are)g(inserted)2025 830 y(into)24 b(the)h(process)f
(the)o(y)g(should)f(become)g(anon)o(ymous)f(memory)-5
b(.)2025 929 y(Such)15 b(anon)o(ymous)e(memory)h(should)g(be)i
(indistinguishable)e(from)2025 1029 y(anon)o(ymous)27
b(memory)h(allocated)h(by)g(traditional)g(means.)53 b(The)2025
1129 y(mechanism)22 b(used)h(to)h(do)f(this)g(should)g(be)g(able)g(to)h
(handle)e(pages)2025 1228 y(that)f(ha)n(v)o(e)g(been)f(copied)g(from)g
(another)g(process')g(address)h(space)2025 1328 y(using)35
b(the)h(pre)n(vious)f(mechanism)g(\(page)g(loanout\).)70
b(Also,)40 b(if)2025 1427 y(the)29 b(operating)f(system)h(is)i(allo)n
(wed)d(to)i(choose)e(the)h(virtual)g(ad-)2025 1527 y(dress)h(where)f
(the)g(inserted)g(pages)h(are)f(placed,)i(then)e(it)i(should)2025
1627 y(be)g(able)g(to)g(insert)g(them)g(without)f(fragmenting)f(or)h
(disrupting)2025 1726 y(the)19 b(VM)h(system')-5 b(s)19
b(higher)n(-le)n(v)o(el)e(memory)h(mapping)f(data)i(struc-)2025
1826 y(tures.)68 b(Section)34 b(4.2)g(describes)g(ho)n(w)g(UVM)h(meets)
g(this)g(goal)2025 1926 y(through)18 b(the)i(page)g(transfer)f
(mechanism.)2108 2025 y Fa(Allo)o(w)41 b(pr)o(ocesses)f(and)h(the)f(k)o
(er)o(nel)h(to)f(exchange)f(lar)o(ge)2025 2125 y(chunks)d(of)e(their)h
(virtual)f(addr)o(ess)h(spaces)g(using)h(the)f(VM)2025
2224 y(system')m(s)18 b(higher)m(-le)o(v)o(el)g(memory)g(mapping)g
(data)g(structur)o(es.)2025 2324 y Fg(Such)23 b(a)h(mechanism)f(should)
f(be)i(able)f(to)h(cop)o(y)-5 b(,)23 b(mo)o(v)o(e,)g(or)g(share)2025
2424 y(an)o(y)18 b(range)f(of)h(a)h(virtual)f(address)g(space.)24
b(This)19 b(can)f(be)g(a)h(problem)2025 2523 y(for)29
b(some)g(VM)g(systems)h(because)f(it)h(introduces)e(the)h(possibil-)
2025 2623 y(ity)21 b(of)f(allo)n(wing)g(a)h(cop)o(y-on-write)d(area)j
(of)f(memory)f(to)i(become)2025 2723 y(shared)32 b(with)h(another)f
(process.)63 b(The)32 b(per)n(-page)f(cost)j(for)e(this)2025
2822 y(mechanism)g(should)g(be)i(minimized.)63 b(Section)32
b(4.3)h(describes)2025 2922 y(ho)n(w)22 b(UVM)g(meets)g(this)h(goals)f
(through)e(the)i(map)g(entry)f(passing)2025 3021 y(mechanism.)2025
3252 y Fh(3.1)99 b(UVM)25 b(Structur)n(e)2025 3407 y
Fg(When)i(designing)f(UVM,)i(we)g(focused)e(our)h(ef)n(forts)g(on)g
(the)g(as-)2025 3507 y(pects)36 b(of)g(the)h(VM)f(system)h(that)f
(directly)g(ef)n(fect)f(data)h(mo)o(v)o(e-)2025 3607
y(ment.)79 b(F)o(or)38 b(VM)h(design)f(elements)g(not)g(directly)g
(related)f(to)2025 3706 y(data)21 b(mo)o(v)o(ement)d(we)j(reused)f
(useful)h(parts)g(of)f(the)h(BSD)h(VM)f(de-)2025 3806
y(sign)35 b(to)f(a)n(v)n(oid)h(rein)m(v)o(enting)c(the)k(wheel)f(and)g
(to)h(ease)g(UVM')-5 b(s)2025 3906 y(inte)o(gration)35
b(into)i(the)g(NetBSD)h(source)f(tree.)75 b(F)o(or)37
b(e)o(xample,)2025 4005 y(we)f(reused)f(BSD)i(VM')-5
b(s)36 b(VM)g(map)f(structure)g(and)g(machine-)2025 4105
y(dependent)24 b(pmap)h(layer)-5 b(.)42 b(Reusing)26
b(the)g(pmap)f(layer)h(allo)n(ws)g(us)2025 4204 y(to)i(tak)o(e)g(adv)n
(antage)d(of)j(e)o(xisting)f(machine-dependent)c(w)o(ork)k(in)2025
4304 y(both)19 b(BSD)j(VM)e(and)g(Mach.)2108 4404 y(UVM')-5
b(s)45 b(machine-independent)40 b(layer)k(handles)g(all)h(high-)2025
4503 y(le)n(v)o(el)26 b(VM)h(functions.)43 b(These)26
b(functions)g(are)g(centered)f(around)2025 4603 y(eight)18
b(major)g(machine-independent)13 b(data)19 b(structures,)f(sho)n(wn)f
(in)2025 4703 y(Figure)j(1.)2108 4802 y(All)49 b(processes)f(ha)n(v)o
(e)f(a)i Fe(vmspace)e Fg(structure)g(that)h(con-)2025
4902 y(tains)f(pointers)e(to)h(the)g(machine-dependent)c(and)k
(machine-)2025 5001 y(independent)35 b(data)i(structures)g(that)h
(de\002ne)f(the)g(mappings)f(in)2025 5101 y(a)d(process')f(address)g
(space.)63 b(Lo)n(w-le)n(v)o(el)31 b(machine-dependent)2025
5201 y(mappings)48 b(are)h(contained)f(in)h(the)g(pmap)g(structure.)111
b(The)2025 5300 y(machine-independent)22 b(mappings)j(are)i(stored)f
(in)g(the)h Fe(vm)p 3801 5300 25 4 v 30 w(map)2025 5400
y Fg(structure.)75 b(All)37 b(processes)g(and)g(the)g(k)o(ernel)f(ha)n
(v)o(e)g(their)h(o)n(wn)p eop
%%Page: 5 5
5 4 bop -58 2029 a @beginspecial 0 @llx 0 @lly 460 @urx
523 @ury 2300 @rwi @setspecial
%%BeginDocument: ../figures/vmglance.eps
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-46.0 604.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 10098 m 0 0 l 8461 0 l 8461 10098 l cp clip
 0.06000 0.06000 sc
/Helvetica ff 180.00 scf sf
6750 9900 m
gs 1 -1 sc (swap space) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
6300 3600 m
gs 1 -1 sc (\(points to process 4's) col0 sh gr
% Polyline
7.500 slw
n 6225 5100 m 6375 5100 l 6375 5250 l 6225 5250 l cp gs col0 s gr 
% Polyline
n 6450 5100 m 6600 5100 l 6600 5250 l 6450 5250 l cp gs col0 s gr 
% Polyline
n 6675 5100 m 6825 5100 l 6825 5250 l 6675 5250 l cp gs col0 s gr 
% Polyline
n 6900 5100 m 7050 5100 l 7050 5250 l 6900 5250 l cp gs col0 s gr 
% Ellipse
n 4350 5625 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 5250 5625 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6300 5625 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6750 5625 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6975 5625 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 4275 7350 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 4500 7350 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 4725 7350 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6525 7350 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6975 7350 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6750 9825 675 225 0 360 DrawEllipse gs col0 s gr

% Polyline
n 3146 2550 m 3154 2550 l gs col0 s gr
% Polyline
gs  clippath
3143 2462 m 3143 2523 l 3114 2469 l 3139 2568 l 3168 2561 l cp
clip
n 3000 1950 m 3150 2550 l gs col0 s gr gr

% arrowhead
n 3143 2462 m 3143 2523 l 3114 2469 l 3129 2466 l 3143 2462 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3900 2100 m 4350 2100 l 4350 2325 l 3900 2325 l cp gs col0 s gr 
% Polyline
n 2775 1725 m 3525 1725 l 3525 1950 l 2775 1950 l cp gs col0 s gr 
% Polyline
n 6071 2550 m 6079 2550 l gs col0 s gr
% Polyline
n 6825 2100 m 7275 2100 l 7275 2325 l 6825 2325 l cp gs col0 s gr 
% Polyline
n 5700 1725 m 6450 1725 l 6450 1950 l 5700 1950 l cp gs col0 s gr 
% Polyline
gs  clippath
6746 2138 m 6796 2173 l 6735 2166 l 6831 2202 l 6841 2174 l cp
clip
n 6222 1958 m 6822 2183 l gs col0 s gr gr

% arrowhead
n 6746 2138 m 6796 2173 l 6735 2166 l 6741 2152 l 6746 2138 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
3821 2138 m 3871 2173 l 3810 2166 l 3906 2202 l 3916 2174 l cp
clip
n 3297 1958 m 3897 2183 l gs col0 s gr gr

% arrowhead
n 3821 2138 m 3871 2173 l 3810 2166 l 3816 2152 l 3821 2138 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6068 2462 m 6068 2523 l 6039 2469 l 6064 2568 l 6093 2561 l cp
clip
n 5925 1950 m 6075 2550 l gs col0 s gr gr

% arrowhead
n 6068 2462 m 6068 2523 l 6039 2469 l 6054 2466 l 6068 2462 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 2850 2550 m 3450 2550 l 3450 2775 l 2850 2775 l cp gs col0 s gr 
% Polyline
gs  clippath
3768 3068 m 3798 3075 l 3768 3083 l 3840 3083 l 3840 3068 l cp
3657 3083 m 3627 3075 l 3657 3068 l 3585 3068 l 3585 3083 l cp
clip
n 3600 3075 m 3825 3075 l gs col0 s gr gr

% arrowhead
n 3657 3083 m 3627 3075 l 3657 3068 l 3657 3075 l 3657 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 3768 3068 m 3798 3075 l 3768 3083 l 3768 3075 l 3768 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3300 3000 m 3600 3000 l 3600 3150 l 3300 3150 l cp gs col0 s gr 
% Polyline
n 3825 3000 m 4125 3000 l 4125 3150 l 3825 3150 l cp gs col0 s gr 
% Polyline
n 4350 3000 m 4650 3000 l 4650 3150 l 4350 3150 l cp gs col0 s gr 
% Polyline
n 4875 3000 m 5175 3000 l 5175 3150 l 4875 3150 l cp gs col0 s gr 
% Polyline
n 5775 2550 m 6375 2550 l 6375 2775 l 5775 2775 l cp gs col0 s gr 
% Polyline
n 6225 3000 m 6525 3000 l 6525 3150 l 6225 3150 l cp gs col0 s gr 
% Polyline
n 6750 3000 m 7050 3000 l 7050 3150 l 6750 3150 l cp gs col0 s gr 
% Polyline
n 7275 3000 m 7575 3000 l 7575 3150 l 7275 3150 l cp gs col0 s gr 
% Polyline
n 7800 3000 m 8100 3000 l 8100 3150 l 7800 3150 l cp gs col0 s gr 
% Polyline
gs  clippath
3243 3068 m 3273 3075 l 3243 3083 l 3315 3083 l 3315 3068 l cp
3143 2832 m 3150 2802 l 3158 2832 l 3158 2760 l 3143 2760 l cp
clip
n 3150 2775 m 3150 3075 l 3300 3075 l gs col0 s gr gr

% arrowhead
n 3143 2832 m 3150 2802 l 3158 2832 l 3150 2832 l 3143 2832 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 3243 3068 m 3273 3075 l 3243 3083 l 3243 3075 l 3243 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4293 3068 m 4323 3075 l 4293 3083 l 4365 3083 l 4365 3068 l cp
4182 3083 m 4152 3075 l 4182 3068 l 4110 3068 l 4110 3083 l cp
clip
n 4125 3075 m 4350 3075 l gs col0 s gr gr

% arrowhead
n 4182 3083 m 4152 3075 l 4182 3068 l 4182 3075 l 4182 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 4293 3068 m 4323 3075 l 4293 3083 l 4293 3075 l 4293 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4818 3068 m 4848 3075 l 4818 3083 l 4890 3083 l 4890 3068 l cp
4707 3083 m 4677 3075 l 4707 3068 l 4635 3068 l 4635 3083 l cp
clip
n 4650 3075 m 4875 3075 l gs col0 s gr gr

% arrowhead
n 4707 3083 m 4677 3075 l 4707 3068 l 4707 3075 l 4707 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 4818 3068 m 4848 3075 l 4818 3083 l 4818 3075 l 4818 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6693 3068 m 6723 3075 l 6693 3083 l 6765 3083 l 6765 3068 l cp
6582 3083 m 6552 3075 l 6582 3068 l 6510 3068 l 6510 3083 l cp
clip
n 6525 3075 m 6750 3075 l gs col0 s gr gr

% arrowhead
n 6582 3083 m 6552 3075 l 6582 3068 l 6582 3075 l 6582 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 6693 3068 m 6723 3075 l 6693 3083 l 6693 3075 l 6693 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6168 3068 m 6198 3075 l 6168 3083 l 6240 3083 l 6240 3068 l cp
6068 2832 m 6075 2802 l 6083 2832 l 6083 2760 l 6068 2760 l cp
clip
n 6075 2775 m 6075 3075 l 6225 3075 l gs col0 s gr gr

% arrowhead
n 6068 2832 m 6075 2802 l 6083 2832 l 6075 2832 l 6068 2832 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 6168 3068 m 6198 3075 l 6168 3083 l 6168 3075 l 6168 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7218 3068 m 7248 3075 l 7218 3083 l 7290 3083 l 7290 3068 l cp
7107 3083 m 7077 3075 l 7107 3068 l 7035 3068 l 7035 3083 l cp
clip
n 7050 3075 m 7275 3075 l gs col0 s gr gr

% arrowhead
n 7107 3083 m 7077 3075 l 7107 3068 l 7107 3075 l 7107 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 7218 3068 m 7248 3075 l 7218 3083 l 7218 3075 l 7218 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7743 3068 m 7773 3075 l 7743 3083 l 7815 3083 l 7815 3068 l cp
7632 3083 m 7602 3075 l 7632 3068 l 7560 3068 l 7560 3083 l cp
clip
n 7575 3075 m 7800 3075 l gs col0 s gr gr

% arrowhead
n 7632 3083 m 7602 3075 l 7632 3068 l 7632 3075 l 7632 3083 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 7743 3068 m 7773 3075 l 7743 3083 l 7743 3075 l 7743 3068 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6390 3288 m 6375 3348 l 6360 3288 l 6360 3390 l 6390 3390 l cp
clip
n 6375 3150 m 6375 3375 l gs col0 s gr gr

% arrowhead
n 6390 3288 m 6375 3348 l 6360 3288 l 6375 3288 l 6390 3288 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6915 3288 m 6900 3348 l 6885 3288 l 6885 3390 l 6915 3390 l cp
clip
n 6900 3150 m 6900 3375 l gs col0 s gr gr

% arrowhead
n 6915 3288 m 6900 3348 l 6885 3288 l 6900 3288 l 6915 3288 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7965 3288 m 7950 3348 l 7935 3288 l 7935 3390 l 7965 3390 l cp
clip
n 7950 3150 m 7950 3375 l gs col0 s gr gr

% arrowhead
n 7965 3288 m 7950 3348 l 7935 3288 l 7950 3288 l 7965 3288 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7440 3288 m 7425 3348 l 7410 3288 l 7410 3390 l 7440 3390 l cp
clip
n 7425 3150 m 7425 3375 l gs col0 s gr gr

% arrowhead
n 7440 3288 m 7425 3348 l 7410 3288 l 7425 3288 l 7440 3288 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3900 4575 m 4500 4575 l 4500 4800 l 3900 4800 l cp gs col0 s gr 
% Polyline
n 5100 4575 m 5700 4575 l 5700 4800 l 5100 4800 l cp gs col0 s gr 
% Polyline
n 6300 4575 m 6900 4575 l 6900 4800 l 6300 4800 l cp gs col0 s gr 
% Polyline
n 5175 5100 m 5325 5100 l 5325 5250 l 5175 5250 l cp gs col0 s gr 
% Polyline
n 5475 5100 m 5625 5100 l 5625 5250 l 5475 5250 l cp gs col0 s gr 
% Polyline
n 4275 5100 m 4425 5100 l 4425 5250 l 4275 5250 l cp gs col0 s gr 
% Polyline
gs  clippath
4358 5043 m 4350 5073 l 4343 5043 l 4343 5115 l 4358 5115 l cp
clip
n 4350 4800 m 4350 5100 l gs col0 s gr gr

% arrowhead
n 4358 5043 m 4350 5073 l 4343 5043 l 4350 5043 l 4358 5043 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
5258 5043 m 5250 5073 l 5243 5043 l 5243 5115 l 5258 5115 l cp
clip
n 5250 4800 m 5250 5100 l gs col0 s gr gr

% arrowhead
n 5258 5043 m 5250 5073 l 5243 5043 l 5250 5043 l 5258 5043 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
5558 5043 m 5550 5073 l 5543 5043 l 5543 5115 l 5558 5115 l cp
clip
n 5550 4800 m 5550 5100 l gs col0 s gr gr

% arrowhead
n 5558 5043 m 5550 5073 l 5543 5043 l 5550 5043 l 5558 5043 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6321 5047 m 6306 5073 l 6307 5043 l 6289 5113 l 6304 5116 l cp
clip
n 6375 4800 m 6300 5100 l gs col0 s gr gr

% arrowhead
n 6321 5047 m 6306 5073 l 6307 5043 l 6314 5045 l 6321 5047 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6533 5043 m 6525 5073 l 6518 5043 l 6518 5115 l 6533 5115 l cp
clip
n 6525 4800 m 6525 5100 l gs col0 s gr gr

% arrowhead
n 6533 5043 m 6525 5073 l 6518 5043 l 6525 5043 l 6533 5043 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6743 5043 m 6743 5073 l 6729 5047 l 6746 5116 l 6761 5113 l cp
clip
n 6675 4800 m 6750 5100 l gs col0 s gr gr

% arrowhead
n 6743 5043 m 6743 5073 l 6729 5047 l 6736 5045 l 6743 5043 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6956 5046 m 6962 5075 l 6943 5052 l 6975 5117 l 6988 5110 l cp
clip
n 6825 4800 m 6975 5100 l gs col0 s gr gr

% arrowhead
n 6956 5046 m 6962 5075 l 6943 5052 l 6950 5049 l 6956 5046 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
5013 4635 m 5073 4650 l 5013 4665 l 5115 4665 l 5115 4635 l cp
clip
n 4500 3150 m 4875 4650 l 5100 4650 l gs col0 s gr gr

% arrowhead
n 5013 4635 m 5073 4650 l 5013 4665 l 5013 4650 l 5013 4635 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6213 4635 m 6273 4650 l 6213 4665 l 6315 4665 l 6315 4635 l cp
clip
n 5025 3150 m 6075 4650 l 6300 4650 l gs col0 s gr gr

% arrowhead
n 6213 4635 m 6273 4650 l 6213 4665 l 6213 4650 l 6213 4635 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 4875 4650 m 4875 5850 l gs col0 s gr 
% Polyline
n 6075 4650 m 6075 5850 l gs col0 s gr 
% Polyline
gs  clippath
3813 4635 m 3873 4650 l 3813 4665 l 3915 4665 l 3915 4635 l cp
clip
n 3993 3146 m 3675 4650 l 3900 4650 l gs col0 s gr gr

% arrowhead
n 3813 4635 m 3873 4650 l 3813 4665 l 3813 4650 l 3813 4635 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3468 3146 m 2475 4650 l 2700 4650 l gs col0 s gr 
% Polyline
n 2700 4725 m 2700 4575 l gs col0 s gr 
% Polyline
gs  clippath
4358 5493 m 4350 5523 l 4343 5493 l 4343 5565 l 4358 5565 l cp
clip
n 4350 5250 m 4350 5550 l gs col0 s gr gr

% arrowhead
n 4358 5493 m 4350 5523 l 4343 5493 l 4350 5493 l 4358 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
5258 5493 m 5250 5523 l 5243 5493 l 5243 5565 l 5258 5565 l cp
clip
n 5250 5250 m 5250 5550 l gs col0 s gr gr

% arrowhead
n 5258 5493 m 5250 5523 l 5243 5493 l 5250 5493 l 5258 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
5558 5493 m 5550 5523 l 5543 5493 l 5543 5565 l 5558 5565 l cp
clip
n 5550 5250 m 5550 5550 l gs col0 s gr gr

% arrowhead
n 5558 5493 m 5550 5523 l 5543 5493 l 5550 5493 l 5558 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 4800 5850 m 4950 5850 l gs col0 s gr 
% Polyline
n 6000 5850 m 6150 5850 l gs col0 s gr 
% Polyline
gs  clippath
6308 5493 m 6300 5523 l 6293 5493 l 6293 5565 l 6308 5565 l cp
clip
n 6300 5250 m 6300 5550 l gs col0 s gr gr

% arrowhead
n 6308 5493 m 6300 5523 l 6293 5493 l 6300 5493 l 6308 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6533 5493 m 6525 5523 l 6518 5493 l 6518 5565 l 6533 5565 l cp
clip
n 6525 5250 m 6525 5550 l gs col0 s gr gr

% arrowhead
n 6533 5493 m 6525 5523 l 6518 5493 l 6525 5493 l 6533 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6758 5493 m 6750 5523 l 6743 5493 l 6743 5565 l 6758 5565 l cp
clip
n 6750 5250 m 6750 5550 l gs col0 s gr gr

% arrowhead
n 6758 5493 m 6750 5523 l 6743 5493 l 6750 5493 l 6758 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6983 5493 m 6975 5523 l 6968 5493 l 6968 5565 l 6983 5565 l cp
clip
n 6975 5250 m 6975 5550 l gs col0 s gr gr

% arrowhead
n 6983 5493 m 6975 5523 l 6968 5493 l 6975 5493 l 6983 5493 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4188 7110 m 4248 7125 l 4188 7140 l 4290 7140 l 4290 7110 l cp
clip
n 2475 4650 m 2475 7125 l 4275 7125 l gs col0 s gr gr

% arrowhead
n 4188 7110 m 4248 7125 l 4188 7140 l 4188 7125 l 4188 7110 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 4050 7500 m 4950 7500 l 4500 6750 l cp gs col0 s gr 
% Polyline
gs  clippath
4263 7035 m 4323 7050 l 4263 7065 l 4365 7065 l 4365 7035 l cp
clip
n 3675 4650 m 3675 7050 l 4350 7050 l gs col0 s gr gr

% arrowhead
n 4263 7035 m 4323 7050 l 4263 7065 l 4263 7050 l 4263 7035 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 6300 7500 m 7200 7500 l 6750 6750 l cp gs col0 s gr 
% Polyline
gs  clippath
6987 7065 m 6927 7050 l 6987 7035 l 6885 7035 l 6885 7065 l cp
clip
n 6900 7050 m 7500 7050 l gs col0 s gr gr

% arrowhead
n 6987 7065 m 6927 7050 l 6987 7035 l 6987 7050 l 6987 7065 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7062 7140 m 7002 7125 l 7062 7110 l 6960 7110 l 6960 7140 l cp
clip
n 6975 7125 m 7500 7125 l gs col0 s gr gr

% arrowhead
n 7062 7140 m 7002 7125 l 7062 7110 l 7062 7125 l 7062 7140 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4983 8097 m 5008 8153 l 4960 8116 l 5022 8196 l 5046 8178 l cp
clip
n 4500 7500 m 5025 8175 l gs col0 s gr gr

% arrowhead
n 4983 8097 m 5008 8153 l 4960 8116 l 4972 8106 l 4983 8097 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 4800 8175 m 5400 8175 l 5400 8400 l 4800 8400 l cp gs col0 s gr 
% Polyline
gs  clippath
5261 8155 m 5199 8164 l 5249 8127 l 5155 8167 l 5167 8195 l cp
clip
n 6750 7500 m 5175 8175 l gs col0 s gr gr

% arrowhead
n 5261 8155 m 5199 8164 l 5249 8127 l 5255 8141 l 5261 8155 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3600 8175 m 4200 8175 l 4200 8400 l 3600 8400 l cp gs col0 s gr 
% Polyline
n 6000 8175 m 6600 8175 l 6600 8400 l 6000 8400 l cp gs col0 s gr 
% Polyline
n 6450 9150 m 7050 9150 l 7050 9300 l 6450 9300 l cp gs col0 s gr 
% Polyline
gs  clippath
6739 9062 m 6742 9124 l 6711 9071 l 6740 9169 l 6769 9160 l cp
clip
n 6525 8400 m 6750 9150 l gs col0 s gr gr

% arrowhead
n 6739 9062 m 6742 9124 l 6711 9071 l 6725 9067 l 6739 9062 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6765 9513 m 6750 9573 l 6735 9513 l 6735 9615 l 6765 9615 l cp
6735 9387 m 6750 9327 l 6765 9387 l 6765 9285 l 6735 9285 l cp
clip
n 6750 9300 m 6750 9600 l gs col0 s gr gr

% arrowhead
n 6735 9387 m 6750 9327 l 6765 9387 l 6750 9387 l 6735 9387 l  cp gs 0.00 setgray ef gr  col0 s
% arrowhead
n 6765 9513 m 6750 9573 l 6735 9513 l 6750 9513 l 6765 9513 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
 [15 45] 45 sd
gs  clippath
6259 9597 m 6283 9653 l 6235 9615 l 6297 9696 l 6321 9678 l cp
clip
n 5550 5625 m 5550 8700 l 6300 9675 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 6259 9597 m 6283 9653 l 6235 9615 l 6247 9606 l 6259 9597 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
 [15 45] 45 sd
n 6525 5625 m 5550 6900 l gs col0 s gr  [] 0 sd
/Helvetica-Bold ff 180.00 scf sf
2400 2700 m
gs 1 -1 sc (vm_map) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 3150 m
gs 1 -1 sc (map entry) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
3150 1500 m
gs 1 -1 sc (process 1 \(init\)) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
6075 1500 m
gs 1 -1 sc (process 4 \(sh\)) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 1875 m
gs 1 -1 sc (vmspace) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 2250 m
gs 1 -1 sc (pmap) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 4725 m
gs 1 -1 sc (vm_amap) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 5175 m
gs 1 -1 sc (vm_anon) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 5700 m
gs 1 -1 sc (vm_page \(anon\)) dup sw pop neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 7200 m
gs 1 -1 sc (uvm_object) dup sw pop neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
4500 6675 m
gs 1 -1 sc (/sbin/init) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
6750 6675 m
gs 1 -1 sc (/bin/sh) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 7425 m
gs 1 -1 sc (vm_page \(object\)) dup sw pop neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
7575 7275 m
gs 1 -1 sc (process 4) col0 sh gr
/Helvetica ff 180.00 scf sf
7575 7050 m
gs 1 -1 sc (from) col0 sh gr
/Helvetica-Bold ff 180.00 scf sf
2400 8400 m
gs 1 -1 sc (uvm_pagerops) dup sw pop neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
3900 8700 m
gs 1 -1 sc (device) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
5100 8700 m
gs 1 -1 sc (vnode) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
6300 8700 m
gs 1 -1 sc (aobj) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 180.00 scf sf
7200 9300 m
gs 1 -1 sc (swap i/o fns) col0 sh gr
/Helvetica ff 180.00 scf sf
6300 3825 m
gs 1 -1 sc (  amaps and objects\)) col0 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial -75 2212 a Fg(Figure)20 b(1:)27 b(UVM)21
b(data)g(structures)g(at)g(a)h(glance.)k(Note)21 b(that)g(there)-75
2311 y(is)c(one)f Fe(vm)p 239 2311 25 4 v 29 w(aref)g
Fg(data)g(structure)f(within)h(each)g(map)g(entry)f(struc-)-75
2411 y(ture.)34 b(The)23 b(page)f(queues)h(and)f(object-of)n(fset)g
(hash)h(table)g(are)g(not)-75 2511 y(sho)n(wn.)-75 2887
y Fe(vm)p 30 2887 V 30 w(map)30 b Fg(structure)g(that)h(contains)f(a)i
(list)g(of)e(map)h(entries)f(that)-75 2987 y(de\002ne)25
b(mapped)g(areas)h(in)g(their)f(virtual)g(address)h(spaces.)42
b(Each)-75 3087 y(map)26 b(entry)f(maps)h(an)g(area)g(of)g(virtual)f
(address)h(space)g(to)g(mem-)-75 3186 y(ory)h(objects.)46
b(In)27 b(BSD)h(VM,)g(the)f(map)g(entry)g(points)g(to)g(an)g(ob-)-75
3286 y(ject)22 b(chain,)g(as)h(described)d(in)j(Section)e(2.1.)30
b(UVM,)22 b(on)f(the)h(other)-75 3386 y(hand,)c(has)i(a)g(tw)o(o-le)n
(v)o(el)e(memory)g(mapping)f(scheme.)24 b(Each)19 b(map)-75
3485 y(entry)25 b(points)h(to)g(an)g(anon)o(ymous)e(memory)g(map)i
(\(amap\))f(and)g(a)-75 3585 y(single,)k(non-chained,)d(memory)f
(object.)46 b(The)27 b(tw)o(o-le)n(v)o(el)f(map-)-75
3684 y(ping)15 b(scheme)g(greatly)g(simpli\002es)h(the)g
(implementation)e(of)h(mem-)-75 3784 y(ory)26 b(lookup,)h(object)g
(management,)f(and)h(UVM')-5 b(s)28 b(page)e(granu-)-75
3884 y(lar)c(data)f(mo)o(v)o(ement)e(mechanisms.)27 b(Note)21
b(that)h(some)f(mappings)-75 3983 y(may)f(only)f(mak)o(e)h(use)g(of)g
(one)g(of)g(the)g(tw)o(o)g(layers.)8 4105 y(F)o(or)35
b(the)g(upper)n(-le)n(v)o(el)d(amap)j(layer)m(,)i(a)f(map)e(entry)g
(contains)-75 4204 y(a)g Fe(vm)p 101 4204 V 30 w(aref)g
Fg(structure)f(\227)i(a)f(small)h(structure)e(that)h(points)f(to)-75
4304 y(an)26 b(of)n(fset)g(in)h(an)g(anon)o(ymous)c(memory)i(map)h(\()p
Fe(vm)p 1457 4304 V 29 w(amap)p Fg(\).)44 b(An)-75 4404
y(amap)26 b(describes)g(an)g(area)h(of)f(anon)o(ymous)e(memory)-5
b(.)42 b(The)26 b(area)-75 4503 y(may)20 b(ha)n(v)o(e)g(\223holes\224)h
(in)f(it)i(that)f(allo)n(w)f(references)g(to)h(f)o(all)g(through)-75
4603 y(to)e(the)g(underlying)e(object)h(layer)-5 b(.)25
b(The)19 b(amap)f(structure)g(contains)-75 4703 y(a)h(list)h(of)e
Fe(vm)p 295 4703 V 30 w(anon)g Fg(structures)g(that)h(are)g(currently)e
(mapped)g(into)-75 4802 y(it.)24 b(Each)16 b(anon)g(represents)f(a)i
(single)f(virtual)g(page)f(of)h(anon)o(ymous)-75 4902
y(memory)-5 b(.)22 b(An)17 b(anon')-5 b(s)17 b(data)g(may)g(reside)g
(in)g(a)h(resident)e Fe(vm)p 1651 4902 V 30 w(page)-75
5001 y Fg(of)31 b(memory)-5 b(,)32 b(or)g(it)g(may)f(be)g(paged)g(out)g
(to)h(to)g(the)f(sw)o(ap)h(area.)-75 5101 y(All)16 b(UVM)f(cop)o
(y-on-write)e(operations)h(are)h(handled)e(through)h(the)-75
5201 y(anon)i(structure.)23 b(While)17 b(the)g(design)f(of)h(UVM')-5
b(s)17 b(amap)f(layer)h(w)o(as)-75 5300 y(inspired)i(by)g(SunOS')-5
b(s)20 b(anon)o(ymous)d(memory)h(layer)m(,)h(there)g(are)h(a)-75
5400 y(fe)n(w)g(k)o(e)o(y)g(dif)n(ferences)e(\(see)j(Section)e(2.2\).)
2108 -67 y(F)o(or)25 b(the)f(lo)n(wer)n(-le)n(v)o(el)g(object)g(layer)m
(,)h(a)h(map)e(entry)g(contains)g(a)2025 33 y(pointer)h(to)i(a)g
Fe(uvm)p 2598 33 V 29 w(object)f Fg(structure.)43 b(A)27
b(UVM)f(object)g(rep-)2025 132 y(resents)d(a)g(\002le,)h(a)g
(zero-\002ll)e(memory)f(area,)j(or)e(a)i(de)n(vice)e(that)h(can)2025
232 y(be)30 b(mapped)f(into)h(a)g(virtual)g(address)f(space.)55
b(Each)30 b(UVM)g(ob-)2025 332 y(ject)23 b(contains)f(a)h(list)h(of)f
Fe(vm)p 2851 332 V 29 w(page)g Fg(structures)f(that)h(belong)e(to)i(it)
2025 431 y(and)k(a)h(pointer)e(to)i(a)g Fe(uvm)p 2814
431 V 29 w(pagerops)f Fg(structure.)46 b(The)27 b(UVM)2025
531 y(pagerops)18 b(are)j(used)f(to)g(access)h(backing)d(store.)2108
633 y(Finally)-5 b(,)25 b(a)h Fe(vm)p 2553 633 V 29 w(page)f
Fg(structure)f(describes)g(a)h(page)f(of)h(phys-)2025
733 y(ical)f(memory)-5 b(.)31 b(These)23 b(structures)g(are)g
(allocated)f(when)h(the)g(sys-)2025 832 y(tem)31 b(is)g(booted.)55
b(In)30 b(addition)f(to)i(being)f(referenced)e(by)i(UVM)2025
932 y(objects)e(and)g(anons,)i(pages)e(are)h(also)g(referenced)d(by)j
(the)f(page)2025 1032 y(queues)d(and)h(the)g(object-of)n(fset)e(hash)i
(table.)42 b(The)26 b(page)f(queues)2025 1131 y(are)g(used)g(by)f(the)h
(pagedaemon)d(to)k(identify)d(pages)i(whose)g(data)2025
1231 y(can)h(be)h(paged)e(out)i(so)g(that)f(the)h(page)f(can)g(be)h
(used)f(else)n(where.)2025 1331 y(The)16 b(object-of)n(fset)f(hash)h
(table)h(allo)n(ws)g(UVM)f(to)h(quickly)e(lookup)2025
1430 y(a)21 b(page)e(in)h(an)h(object.)2025 1683 y Fh(3.2)99
b(UVM)25 b(Data)g(Structur)n(e)i(Locking)2025 1844 y
Fg(Data)i(structure)g(locking)e(is)j(an)f(important)f(aspect)h(of)g(a)g
(virtual)2025 1943 y(memory)19 b(system)i(since)g(man)o(y)f(processes)g
(can)h(access)h(VM)f(data)2025 2043 y(concurrently)26
b(and)i(we)h(w)o(ant)g(to)g(a)n(v)n(oid)f(data)h(structure)f(corrup-)
2025 2143 y(tion)g(and)f(deadlock.)47 b(As)29 b(we)f(ha)n(v)o(e)f
(signi\002cantly)g(changed)g(the)2025 2242 y(data)16
b(structures)g(in)g(UVM,)g(we)h(had)e(to)i(replace)e(BSD)i(VM')-5
b(s)17 b(lock-)2025 2342 y(ing)k(strate)o(gy)g(with)g(a)h(ne)n(w)f
(one.)28 b(UVM)21 b(data)h(structures)e(must)i(be)2025
2441 y(lock)o(ed)30 b(in)h(the)g(follo)n(wing)e(order:)45
b(map,)33 b(amap,)f(object,)h(anon,)2025 2541 y(and)18
b(\002nally)g(the)g(page)g(queues.)23 b(All)c(the)g(data)f(structure)f
(locks)i(are)2025 2641 y(spin)26 b(locks)h(with)f(the)h(e)o(xception)d
(of)j(the)f(map)g(lock.)43 b(Functions)2025 2740 y(that)18
b(need)g(to)g(lock)g(data)g(structure)f(in)i(the)f(wrong)f(order)g
(must)h(use)2025 2840 y(non-blocking)13 b(lock)k(attempts)g(and)f(gi)n
(v)o(e)g(up)h(\(or)f(start)i(o)o(v)o(er\))d(if)j(the)2025
2940 y(non-blocking)f(lock)i(attempt)h(f)o(ails.)2025
3192 y Fh(3.3)99 b(UVM)25 b(Copy-On-Write)2025 3353 y
Fg(Cop)o(y-on-write)f(is)j(achie)n(v)o(ed)d(in)i(UVM)h(using)e(the)h
(amap)g(layer)-5 b(.)2025 3453 y(Cop)o(y-on-write)17
b(data)i(is)h(originally)e(mapped)f(in)j(read-only)d(from)2025
3552 y(a)22 b(backing)e Fe(uvm)p 2524 3552 V 29 w(object)p
Fg(.)28 b(When)21 b(cop)o(y-on-write)d(data)k(is)g(\002rst)2025
3652 y(written,)i(the)f(page)g(f)o(ault)g(routine)f(allocates)h(a)h(ne)
n(w)f(anon)g(with)g(a)2025 3752 y(ne)n(w)28 b(page,)h(copies)f(the)g
(data)g(from)f(the)h Fe(uvm)p 3411 3752 V 29 w(object)p
Fg(')-5 b(s)28 b(page)2025 3851 y(into)e(the)h(ne)n(w)f(page,)h(and)f
(then)g(installs)h(the)g(anon)e(in)i(the)f(amap)2025
3951 y(for)21 b(that)g(mapping.)27 b(When)21 b(UVM')-5
b(s)22 b(f)o(ault)g(routine)e(copies)h(cop)o(y-)2025
4051 y(on-write)36 b(data)i(from)f(a)h(lo)n(wer)n(-layer)e
Fe(uvm)p 3368 4051 V 29 w(object)h Fg(into)h(an)2025
4150 y(upper)n(-layer)17 b(anon)h(it)h(is)h(called)f(a)g
(\223promotion.)-6 b(\224)22 b(Once)d(cop)o(y-on-)2025
4250 y(write)g(data)f(has)g(been)g(promoted)e(to)j(the)f(amap)g(layer)m
(,)f(it)j(becomes)2025 4349 y(anon)o(ymous)13 b(memory)-5
b(.)22 b(Anon)o(ymous)13 b(memory)i(also)h(can)g(be)g(sub-)2025
4449 y(ject)23 b(to)f(the)h(cop)o(y-on-write)c(operation.)30
b(An)22 b(anon)f(can)h(be)h(cop)o(y-)2025 4549 y(on-write)k(copied)g
(by)h(write-protecting)e(its)j(data)f(and)f(adding)g(a)2025
4648 y(reference)21 b(to)i(the)g(anon.)31 b(When)23 b(the)f(page)g(f)o
(ault)h(routine)e(detects)2025 4748 y(a)h(write)g(to)g(an)g(anon)f
(with)h(a)g(reference)e(count)h(greater)g(than)g(one,)2025
4848 y(it)g(will)g(cop)o(y-on-write)c(the)j(anon.)2025
5110 y Fh(4)99 b(UVM)25 b(Data)g(Mo)o(v)o(ement)2025
5300 y Fg(This)j(section)f(describes)g(the)h(design)f(and)g(function)f
(of)h(UVM')-5 b(s)2025 5400 y(page)34 b(loan)f(out,)38
b(page)33 b(transfer)m(,)k(and)c(map)h(entry)g(passing)g(in-)p
eop
%%Page: 6 6
6 5 bop -75 -67 a Fg(terf)o(aces.)82 b(All)41 b(three)d(interf)o(aces)h
(allo)n(w)h(a)f(process)g(to)h(mo)o(v)o(e)-75 33 y(data)c(using)g
(virtual)f(memory)g(operations)g(rather)g(than)h(costly)-75
132 y(data)22 b(copies.)31 b(These)22 b(interf)o(aces)g(pro)o(vide)e
(\003e)o(xible)h(and)h(ef)n(\002cient)-75 232 y(b)n(uilding)30
b(blocks)g(on)g(which)h(adv)n(anced)e(I/O)i(and)f(IPC)i(subsys-)-75
332 y(tems)21 b(can)f(be)g(b)n(uilt.)-75 574 y Fh(4.1)99
b(P)o(age)25 b(Loanout)-75 731 y Fg(Under)g(a)h(traditional)e(k)o
(ernel,)i(sending)e(data)i(from)e(one)h(process)-75 831
y(to)17 b(another)f(process)h(or)g(a)g(de)n(vice)g(is)h(a)f(tw)o
(o-step)g(procedure.)22 b(First)-75 930 y(the)e(data)g(is)h(copied)e
(from)h(the)g(process')f(address)h(space)g(to)g(a)h(k)o(er)n(-)-75
1030 y(nel)g(b)n(uf)n(fer)-5 b(.)25 b(Then)19 b(the)i(k)o(ernel)f(b)n
(uf)n(fer)f(is)i(handed)e(of)n(f)h(to)h(its)h(desti-)-75
1129 y(nation)17 b(\(either)g(a)h(de)n(vice)e(dri)n(v)o(er)g(or)i(the)f
(IPC)i(layer\).)k(The)17 b(cop)o(y)g(of)-75 1229 y(the)f(data)g(from)f
(the)h(process')f(address)h(space)g(to)g(the)g(k)o(ernel)f(b)n(uf)n
(fer)-75 1329 y(adds)22 b(o)o(v)o(erhead)e(to)j(the)g(I/O)g(operation.)
30 b(It)23 b(w)o(ould)f(be)h(more)f(ef)n(\002-)-75 1428
y(cient)i(if)h(I/O)g(could)e(be)i(performed)d(directly)h(from)h(the)g
(process')-75 1528 y(address)g(space,)i(b)n(ut)e(in)h(a)g(traditional)f
(k)o(ernel)g(it)h(is)g(necessary)f(to)-75 1628 y(cop)o(y)h(the)h(data)f
(for)g(three)h(reasons:)36 b(the)25 b(data)h(may)f(not)h(be)f(resi-)-75
1727 y(dent)20 b(in)h(main)g(memory)-5 b(,)19 b(a)i(process)f(may)h
(modify)e(its)j(data)f(while)-75 1827 y(the)g(I/O)f(operation)f(is)i
(in)g(progress,)e(or)i(the)f(data)h(may)f(be)g(\003ushed)-75
1926 y(or)g(paged)f(out)h(by)g(another)e(process)i(or)g(the)g(page)g
(daemon.)8 2027 y(P)o(age)28 b(loanout)f(is)i(a)g(feature)e(of)h(UVM)g
(that)g(addresses)g(these)-75 2126 y(issues)23 b(by)f(allo)n(wing)f(a)i
(process)e(to)i(safely)f(loan)g(out)f(its)j(pages)d(to)-75
2226 y(another)26 b(process)i(or)g(the)f(k)o(ernel.)48
b(This)28 b(allo)n(ws)g(the)g(process)f(to)-75 2326 y(send)e(data)g
(directly)f(from)g(its)i(memory)d(to)i(a)g(de)n(vice)f(or)h(another)-75
2425 y(process)c(without)g(ha)n(ving)g(to)h(cop)o(y)e(the)i(data)g(to)f
(an)h(intermediate)-75 2525 y(k)o(ernel)f(b)n(uf)n(fer)-5
b(.)29 b(This)22 b(reduces)f(the)g(o)o(v)o(erhead)f(of)h(I/O)h(and)f
(allo)n(ws)-75 2625 y(the)k(k)o(ernel)g(to)g(spend)g(more)g(time)g
(doing)f(useful)h(w)o(ork)g(and)f(less)-75 2724 y(time)c(cop)o(ying)f
(data.)8 2825 y(At)32 b(an)f(abstract)f(le)n(v)o(el,)j(loaning)d(a)i
(page)e(of)h(memory)e(out)i(is)-75 2924 y(not)23 b(o)o(v)o(erly)e
(comple)o(x.)31 b(T)-7 b(o)23 b(loan)f(out)h(a)g(page,)g(UVM)g(must)g
(mak)o(e)-75 3024 y(the)g(page)g(read-only)e(and)i(increment)f(the)i
(page')-5 b(s)23 b(\223loan)g(count.)-6 b(\224)-75 3124
y(Then)17 b(the)h(page)f(can)h(safely)g(be)f(mapped)g(\(read-only\).)k
(The)c(com-)-75 3223 y(ple)o(xity)30 b(of)h(page)g(loanout)e(arises)j
(when)f(handling)e(the)i(special)-75 3323 y(cases)i(where)f(some)g
(other)f(process)h(needs)g(to)g(mak)o(e)g(use)g(of)g(a)-75
3422 y(page)24 b(currently)f(loaned)h(out.)38 b(In)25
b(that)g(case)g(the)g(loan)f(may)g(ha)n(v)o(e)-75 3522
y(to)c(be)g(brok)o(en.)-75 3748 y Fa(4.1.1)81 b(Loan)20
b(T)-6 b(ypes)21 b(and)g(Attrib)n(utes)-75 3905 y Fg(A)c(page)f(of)g
(memory)f(loaned)h(out)g(by)g(a)h(process)f(must)h(come)f(from)-75
4004 y(one)21 b(of)g(UVM')-5 b(s)22 b(tw)o(o)g(mapping)e(layers.)28
b(As)23 b(sho)n(wn)d(in)i(Figure)f(2,)-75 4104 y(a)28
b(process)g(can)g(loan)f(its)i(memory)d(out)i(to)g(either)g(the)g(k)o
(ernel)f(or)-75 4204 y(to)h(another)e(process.)46 b(T)-7
b(o)28 b(loan)f(memory)f(to)h(the)h(k)o(ernel,)g(UVM)-75
4303 y(creates)g(an)g(array)f(of)h(pointers)f(to)h(wired)g
Fe(vm)p 1300 4303 25 4 v 29 w(page)g Fg(structures)-75
4403 y(that)18 b(can)g(be)g(mapped)f(into)h(the)g(k)o(ernel')-5
b(s)18 b(address)f(space.)25 b(T)-7 b(o)18 b(loan)-75
4503 y(memory)d(to)i(other)g(processes,)g(UVM)g(creates)g(an)g(array)f
(of)h(point-)-75 4602 y(ers)k(to)f(anon)g(structures)f(that)i(can)f(be)
g(entered)f(into)h(an)h(amap)e(that)-75 4702 y(belongs)j(to)h(the)g
(tar)o(get)f(process.)32 b(The)23 b(tar)o(get)f(process)g(treats)i(the)
-75 4801 y(loaned)31 b(memory)g(lik)o(e)h(normal)f(anon)o(ymous)e
(memory)-5 b(.)59 b(There)-75 4901 y(are)26 b(four)e(possible)i(types)f
(of)h(loans:)36 b(object)25 b(to)h(k)o(ernel,)g(anon)e(to)-75
5001 y(k)o(ernel,)31 b(object)e(to)g(anon,)h(and)f(anon)g(to)g(anon.)52
b(Note)29 b(that)h(it)g(is)-75 5100 y(possible)18 b(for)f(a)h(page)g
(from)f(a)h Fe(uvm)p 952 5100 V 29 w(object)g Fg(to)g(be)g(loaned)f(to)
h(an)-75 5200 y(anon)h(and)h(then)g(later)g(loaned)f(from)g(that)h
(anon)f(to)i(the)f(k)o(ernel.)8 5300 y(Before)j(a)i(page)e(can)g(be)h
(loaned)f(out,)h(it)h(must)e(be)h(made)f(read-)-75 5400
y(only)i(\(immutable\).)39 b(This)26 b(in)m(v)n(olv)o(es)f
(write-protecting)e(in)j(hard-)2128 615 y @beginspecial
0 @llx 0 @lly 465 @urx 204 @ury 2092 @rwi @setspecial
%%BeginDocument: ../figures/loan.eps
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-27.0 218.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 3673 m 0 0 l 8232 0 l 8232 3673 l cp clip
 0.06000 0.06000 sc
/Helvetica-Bold ff 300.00 scf sf
1950 450 m
gs 1 -1 sc (virtual address space) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
4500 1455 m
gs 1 -1 sc (wired kernel pages) col0 sh gr
% Polyline
30.000 slw
n 1200 600 m 1200 3600 l gs col0 s gr 
% Polyline
n 2700 600 m 2700 3600 l gs col0 s gr 
% Polyline
n 1200 900 m 2700 900 l gs col0 s gr 
% Polyline
n 1200 1500 m 2700 1500 l gs col0 s gr 
% Polyline
n 1200 2100 m 2700 2100 l gs col0 s gr 
% Polyline
n 1200 2700 m 2700 2700 l gs col0 s gr 
% Polyline
n 1200 3300 m 2700 3300 l gs col0 s gr 
% Polyline
7.500 slw
gs  clippath
4050 899 m 4173 905 l 4062 958 l 4221 926 l 4209 868 l cp
clip
n 2700 1200 m 4200 900 l gs col0 s gr gr

% arrowhead
n 4050 899 m 4173 905 l 4062 958 l 4056 929 l 4050 899 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4050 1499 m 4173 1505 l 4062 1558 l 4221 1526 l 4209 1468 l cp
clip
n 2700 1800 m 4200 1500 l gs col0 s gr gr

% arrowhead
n 4050 1499 m 4173 1505 l 4062 1558 l 4056 1529 l 4050 1499 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4062 2642 m 4173 2694 l 4050 2701 l 4209 2732 l 4221 2674 l cp
clip
n 2700 2400 m 4200 2700 l gs col0 s gr gr

% arrowhead
n 4062 2642 m 4173 2694 l 4050 2701 l 4056 2671 l 4062 2642 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
4062 3242 m 4173 3294 l 4050 3301 l 4209 3332 l 4221 3274 l cp
clip
n 2700 3000 m 4200 3300 l gs col0 s gr gr

% arrowhead
n 4062 3242 m 4173 3294 l 4050 3301 l 4056 3271 l 4062 3242 l  cp gs 0.00 setgray ef gr  col0 s
/Helvetica ff 300.00 scf sf
1950 1275 m
gs 1 -1 sc (obj page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 1875 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 2475 m
gs 1 -1 sc (obj page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 3075 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
4500 2925 m
gs 1 -1 sc (page loanout to pageable) col0 sh gr
/Helvetica ff 300.00 scf sf
4500 3255 m
gs 1 -1 sc (anonymous memory \(anons\)) col0 sh gr
/Helvetica ff 300.00 scf sf
4500 1125 m
gs 1 -1 sc (page loanout to) col0 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 2621 798 a(Figure)20 b(2:)25 b(P)o(age)20
b(loanout)2025 1175 y(w)o(are)h(all)g(writable)f(mappings)f(of)i(the)g
(page.)k(Ho)n(we)n(v)o(er)19 b(there)i(are)2025 1275
y(man)o(y)16 b(cases)i(where)f(pages)g(are)g(already)f(read-only)-5
b(,)15 b(for)i(e)o(xample)2025 1374 y(a)h(video)e(serv)o(er)g(may)h
(transmits)g(data)g(from)f(a)h(\002le)h(that)f(is)h(mapped)2025
1474 y(read-only)-5 b(.)2108 1587 y(In)23 b(order)f(to)i(modify)e(data)
h(in)h(a)g(loaned)e(out)h(page,)h(the)f(k)o(ernel)2025
1687 y(must)31 b(terminate)e(or)i(\223break\224)e(the)i(loan.)55
b(Breaking)30 b(a)h(loan)f(in-)2025 1786 y(v)n(olv)o(es)25
b(allocating)g(a)h(ne)n(w)f(page)g(of)n(f)g(the)h(free)f(list,)j(cop)o
(ying)c(the)2025 1886 y(data)17 b(from)g(the)g(loaned)f(page)h(to)g
(the)h(ne)n(w)f(page,)g(and)g(then)g(replac-)2025 1986
y(ing)23 b(the)h(old)g(page)f(with)g(the)h(ne)n(w)g(one.)35
b(Note)23 b(that)h(the)g(old)f(page)2025 2085 y(remains)29
b(allocated)f(and)h(immutable)f(because)h(it)h(is)g(still)h(being)2025
2185 y(used)24 b(for)g(loanout.)36 b(When)24 b(replacing)f(an)h(old)g
(page)g(with)g(a)h(ne)n(w)2025 2284 y(one)h(it)h(is)g(possible)f(for)g
(the)g(old)g(page)g(to)g(become)f(\223o)n(wnerless\224)2025
2384 y(because)j(it)i(is)f(no)g(longer)e(associated)i(with)g(a)g
(memory)e(object.)2025 2484 y(Ownerless)f(pages)f(are)h(freed)e(when)h
(the)h(\002nal)g(loan)f(on)g(them)h(is)2025 2583 y(dropped.)2108
2696 y(Memory)17 b(pages)i(loaned)f(to)h(the)f(k)o(ernel)h(ha)n(v)o(e)f
(three)g(important)2025 2796 y(properties.)40 b(First,)28
b(pages)d(loaned)g(to)g(the)h(k)o(ernel)f(must)h(be)f(resi-)2025
2896 y(dent.)42 b(If)25 b(the)h(data)g(is)h(on)e(backing)g(store)g
(then)h(it)g(is)h(fetched)e(be-)2025 2995 y(fore)19 b(the)h(loanout)e
(proceeds.)24 b(Second,)18 b(each)i(page)f(loaned)g(to)h(the)2025
3095 y(k)o(ernel)e(is)i(\223wired\224)e(to)h(pre)n(v)o(ent)e(the)i
(pagedaemon)d(from)i(attempt-)2025 3195 y(ing)j(to)g(pageout)e(a)i
(page)g(loaned)e(to)i(the)g(k)o(ernel)f(while)h(the)g(k)o(ernel)2025
3294 y(is)27 b(still)g(using)f(it.)43 b(This)26 b(is)h(important)e
(because)g(if)h(the)g(pagedae-)2025 3394 y(mon)i(w)o(as)i(allo)n(wed)e
(to)h(pageout)e(the)i(page)f(then)g(the)h(ne)o(xt)f(time)2025
3494 y(the)e(k)o(ernel)g(accessed)g(the)g(loaned)f(page)h(an)g
(unresolv)n(able)e(page)2025 3593 y(f)o(ault)34 b(w)o(ould)g(be)h
(generated)e(\(and)g(the)i(system)g(w)o(ould)e(crash\).)2025
3693 y(Third,)25 b(pages)f(loaned)g(to)h(the)f(k)o(ernel)g(are)h
(entered)f(into)g(the)h(k)o(er)n(-)2025 3792 y(nel')-5
b(s)17 b(pmap)g(with)g(a)g(special)g(function)f(that)h(pre)n(v)o(ents)f
(page-based)2025 3892 y(pmap)25 b(operations)f(from)g(af)n(fecting)g
(the)i(k)o(ernel)e(mapping.)39 b(This)2025 3992 y(allo)n(ws)f(UVM)h(to)
f(perform)f(normal)g(VM)h(operations)f(on)h(the)2025
4091 y(loaned-out)22 b(page)i(without)g(ha)n(ving)g(to)h(w)o(orry)f
(about)f(disrupting)2025 4191 y(the)28 b(k)o(ernel')-5
b(s)28 b(loaned)f(mapping)f(and)i(causing)f(an)h(unresolv)n(able)2025
4291 y(page)20 b(f)o(ault.)2108 4404 y(Memory)28 b(pages)h(loaned)f
(from)h(an)g(object)g(to)g(an)h(anon)e(ha)n(v)o(e)2025
4503 y(tw)o(o)18 b(important)e(properties.)23 b(First,)c(a)f
Fe(uvm)p 3288 4503 V 29 w(object)p Fg(')-5 b(s)18 b(page)f(can)2025
4603 y(only)27 b(be)g(loaned)g(to)g(one)g(anon)g(at)h(a)g(time.)47
b(Future)27 b(loans)g(to)h(an)2025 4703 y(anon)j(need)g(only)g(gain)f
(a)j(reference)d(to)h(the)h(anon)f(the)h(page)f(is)2025
4802 y(already)17 b(loaned)g(to)h(\(rather)f(than)g(allocating)h(a)g
(ne)n(w)g(anon)f(to)h(loan)2025 4902 y(to\).)47 b(Second,)29
b(while)e(most)h(pages)f(are)h(referenced)e(by)h(either)g(a)2025
5001 y Fe(uvm)p 2180 5001 V 29 w(object)d Fg(or)g(an)g(anon,)g(pages)g
(loaned)f(from)g(an)i(object)e(to)2025 5101 y(an)g(anon)f(are)h
(referenced)e(by)h(both.)33 b(Although)21 b(both)i(object)f(and)2025
5201 y(anon)d(reference)g(the)h(page,)g(the)g(object)g(is)h(al)o(w)o
(ays)g(considered)d(to)2025 5300 y(be)d(the)h(o)n(wner)e(of)h(the)h
(page.)22 b(Thus,)16 b(the)f(object)g(must)h(be)f(lock)o(ed)f(in)2025
5400 y(order)20 b(to)h(access)g(the)g(page')-5 b(s)21
b(\002elds.)28 b(All)21 b(data)g(structure)f(locking)p
eop
%%Page: 7 7
7 6 bop -75 -67 a Fg(must)20 b(follo)n(w)g(the)g(locking)f(protocol)f
(presented)h(in)h(Section)g(3.2.)8 39 y(An)g(anon)f(that)h(has)h(a)f
(page)g(on)g(loan)f(from)g(an)h(object)g(does)g(not)-75
138 y(hold)28 b(a)h(reference)f(to)h(that)g(object.)50
b(Thus,)31 b(when)d(locking)g(data)-75 238 y(structures,)18
b(it)i(is)g(possible)f(for)f(the)h(object)g(to)g(terminate)f(between)
-75 337 y(the)g(time)h(the)f(page')-5 b(s)18 b(object)f(\002eld)i(is)g
(read)f(and)f(the)h(time)h(the)f(lock)-75 437 y(on)32
b(the)g(object)g(is)i(attempted.)60 b(In)32 b(order)g(to)g(pre)n(v)o
(ent)f(this,)36 b(the)-75 537 y(page)15 b(queues)f(must)i(be)f(lock)o
(ed)f(before)g(trying)h(to)g(lock)g(the)g(object.)-75
636 y(Locking)31 b(the)i(page)e(queues)h(pre)n(v)o(ents)f(the)i(page')
-5 b(s)32 b(loan)h(count)-75 736 y(from)26 b(changing)f(and)h(thus)h
(ensures)g(that)g(the)g(object)g(cannot)f(be)-75 836
y(terminated)19 b(until)h(the)g(page)g(queues)f(are)h(unlock)o(ed.)-75
1089 y Fa(4.1.2)81 b(Handling)20 b(Loaned)g(Out)h(P)o(ages)-75
1256 y Fg(There)k(are)h(se)n(v)o(eral)f(places)h(in)g(UVM)g(where)g
(loaned)e(out)i(pages)-75 1355 y(ha)n(v)o(e)h(to)h(be)f(treated)g
(specially)-5 b(.)47 b(First,)30 b(when)d(locking)f(an)i(anon)-75
1455 y(that)19 b(points)f(to)h(a)g(page)f(that)h(is)g(o)n(wnerless,)g
(the)f(anon)g(should)g(tak)o(e)-75 1554 y(o)o(v)o(er)26
b(as)i(o)n(wner)e(of)i(the)f(page.)46 b(This)27 b(allo)n(ws)h(objects)f
(to)h(donate)-75 1654 y(data)i(to)g(anons)f(without)g(the)h(need)f(for)
g(a)h(data)g(cop)o(y)-5 b(.)53 b(Second,)-75 1754 y(when)24
b(freeing)g(a)h(page)f(with)h(a)h(non-zero)c(loan)j(count,)f(the)h
(page)-75 1853 y(becomes)e(o)n(wnerless)h(and)g(should)f(not)h(be)g
(freed)f(until)h(all)h(loans)-75 1953 y(to)d(it)g(are)g(terminated.)29
b(Third,)21 b(when)g(there)g(is)i(a)f(write)g(f)o(ault)g(on)f(a)-75
2053 y(loaned)16 b(page)h(care)h(must)f(be)h(tak)o(en)f(to)g(map)g(in)h
(pages)f(with)h(a)g(non-)-75 2152 y(zero)23 b(loan)g(count)f(read-only)
-5 b(.)32 b(If)24 b(the)f(write)h(f)o(ault)f(is)h(on)f(a)h(shared)-75
2252 y(mapping)17 b(or)i(an)h(anon)e(with)h(a)h(reference)e(count)g(of)
h(one,)g(then)g(the)-75 2351 y(loan)h(must)h(be)f(brok)o(en)f(before)g
(the)i(f)o(ault)f(can)h(be)f(resolv)o(ed.)25 b(Note)-75
2451 y(that)d(page)f(loanout)f(to)i(anons)e(mak)o(es)i(use)g(of)f(the)h
(cop)o(y-on-write)-75 2551 y(feature)d(of)h(UVM')-5 b(s)21
b(anon)o(ymous)c(memory)i(layer)-5 b(.)-75 2804 y Fa(4.1.3)81
b(Using)21 b(P)o(age)e(Loanout)-75 2971 y Fg(P)o(age)30
b(loanout)e(can)i(be)g(used)g(in)g(a)h(number)d(of)i(w)o(ays.)55
b(F)o(or)29 b(e)o(x-)-75 3070 y(ample,)h(to)e(quickly)f(transfer)h(a)h
(chunk)e(of)h(data)g(from)g(one)g(pro-)-75 3170 y(cess)j(to)f(another)f
(the)g(data)h(can)g(be)g(loaned)f(out)h(to)g(anons,)h(and)-75
3270 y(those)19 b(anons)f(can)h(then)g(be)g(inserted)g(into)g(an)g
(amap)g(belonging)d(to)-75 3369 y(the)26 b(tar)o(get)f(process.)42
b(P)o(age)26 b(loanout)e(to)i(the)g(k)o(ernel)g(can)f(also)i(be)-75
3469 y(used)g(to)h(impro)o(v)o(e)e(both)g(netw)o(ork)h(and)g(de)n(vice)
g(I/O.)g(F)o(or)h(e)o(xam-)-75 3569 y(ple,)17 b(when)f(a)h(process)g(w)
o(ants)g(to)f(send)h(data)f(out)h(o)o(v)o(er)e(the)i(netw)o(ork)-75
3668 y(the)k(k)o(ernel)g(w)o(ould)f(normally)g(cop)o(y)g(the)h(data)g
(from)f(the)h(process')-75 3768 y(memory)d(into)g(k)o(ernel)h(netw)o
(ork)f(b)n(uf)n(fers)g(\(mb)n(ufs\).)23 b(Ho)n(we)n(v)o(er)m(,)18
b(in-)-75 3867 y(stead)33 b(of)f(cop)o(ying)f(the)i(process')f(pages,)j
(the)e(pages)f(could)g(be)-75 3967 y(loaned)d(out)g(to)h(the)f(k)o
(ernel)g(and)g(then)g(associated)h(with)f(mb)n(ufs,)-75
4067 y(thus)22 b(a)n(v)n(oiding)f(a)i(costly)f(data)h(cop)o(y)-5
b(.)30 b(P)o(age)22 b(loanout)f(can)h(also)h(be)-75 4166
y(used)28 b(by)f(de)n(vices.)47 b(F)o(or)28 b(e)o(xample,)g(an)g(audio)
f(de)n(vice)g(could)g(di-)-75 4266 y(rectly)i(access)i(pages)e(of)h
(audio)f(data)g(loaned)g(out)h(from)e(a)j(user)-75 4366
y(process.)e(This)21 b(w)o(ould)g(eliminate)g(the)h(need)f(to)h(cop)o
(y)e(the)i(data)f(to)-75 4465 y(a)g(pri)n(v)n(ate)e(k)o(ernel)g(b)n(uf)
n(fer)-5 b(.)-75 4735 y Fh(4.2)99 b(P)o(age)25 b(T)-7
b(ransfer)-75 4902 y Fg(Under)24 b(a)h(traditional)f(BSD)i(k)o(ernel,)f
(when)f(the)h(k)o(ernel)f(w)o(ants)h(to)-75 5001 y(mo)o(v)o(e)g(some)h
(of)h(its)g(data)f(from)g(a)h(k)o(ernel)f(b)n(uf)n(fer)f(to)h(a)h(user)
g(pro-)-75 5101 y(cess')e(virtual)e(address)h(space)g(it)g(uses)h(the)f
Fe(copyout)g Fg(function.)-75 5201 y(This)17 b(function)f(copies)h(the)
g(data)g(w)o(ord)g(by)g(w)o(ord)f(to)i(a)g(user)f(b)n(uf)n(fer)-5
b(.)-75 5300 y(If)22 b(the)g(user')-5 b(s)22 b(b)n(uf)n(fer)e(is)j(not)
e(resident,)h(then)f(a)h(page)g(f)o(ault)f(is)i(trig-)-75
5400 y(gered)34 b(and)h(the)h(the)f(b)n(uf)n(fer)f(is)j(paged)d(in)i
(before)e(the)h(cop)o(y)g(is)2128 615 y @beginspecial
0 @llx 0 @lly 465 @urx 204 @ury 2092 @rwi @setspecial
%%BeginDocument: ../figures/xfer.eps
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-27.0 506.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 8473 m 0 0 l 8232 0 l 8232 8473 l cp clip
 0.06000 0.06000 sc
/Helvetica-Bold ff 300.00 scf sf
1950 5250 m
gs 1 -1 sc (virtual address space) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
4500 6255 m
gs 1 -1 sc (donated kernel pages) col0 sh gr
/Helvetica ff 300.00 scf sf
4500 7725 m
gs 1 -1 sc (page transfer from pageable) col0 sh gr
/Helvetica ff 300.00 scf sf
4500 8055 m
gs 1 -1 sc (anonymous memory \(anons\)) col0 sh gr
% Polyline
30.000 slw
n 1200 5400 m 1200 8400 l gs col0 s gr 
% Polyline
n 2700 5400 m 2700 8400 l gs col0 s gr 
% Polyline
n 1200 5700 m 2700 5700 l gs col0 s gr 
% Polyline
n 1200 6300 m 2700 6300 l gs col0 s gr 
% Polyline
n 1200 6900 m 2700 6900 l gs col0 s gr 
% Polyline
n 1200 7500 m 2700 7500 l gs col0 s gr 
% Polyline
n 1200 8100 m 2700 8100 l gs col0 s gr 
% Polyline
7.500 slw
gs  clippath
2850 6001 m 2726 5994 l 2838 5942 l 2679 5974 l 2691 6032 l cp
clip
n 2700 6000 m 4200 5700 l gs col0 s gr gr

% arrowhead
n 2850 6001 m 2726 5994 l 2838 5942 l 2844 5971 l 2850 6001 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
2850 6601 m 2726 6594 l 2838 6542 l 2679 6574 l 2691 6632 l cp
clip
n 2700 6600 m 4200 6300 l gs col0 s gr gr

% arrowhead
n 2850 6601 m 2726 6594 l 2838 6542 l 2844 6571 l 2850 6601 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
2838 7258 m 2726 7205 l 2850 7199 l 2691 7168 l 2679 7226 l cp
clip
n 2700 7200 m 4200 7500 l gs col0 s gr gr

% arrowhead
n 2838 7258 m 2726 7205 l 2850 7199 l 2844 7229 l 2838 7258 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
2838 7858 m 2726 7805 l 2850 7799 l 2691 7768 l 2679 7826 l cp
clip
n 2700 7800 m 4200 8100 l gs col0 s gr gr

% arrowhead
n 2838 7858 m 2726 7805 l 2850 7799 l 2844 7829 l 2838 7858 l  cp gs 0.00 setgray ef gr  col0 s
/Helvetica ff 300.00 scf sf
1950 6075 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 6675 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 7275 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
1950 7875 m
gs 1 -1 sc (anon page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica ff 300.00 scf sf
4500 5925 m
gs 1 -1 sc (page transfer from) col0 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 2619 798 a(Figure)19 b(3:)26 b(P)o(age)20
b(transfer)2025 1163 y(started.)50 b(This)28 b(may)g(result)h(in)f(the)
h(paged-in)e(data)h(being)f(com-)2025 1263 y(pletely)20
b(replaced)f(by)g(the)i(copied)e(data.)2108 1371 y(F)o(or)35
b(lar)o(ge)e(chunks)h(of)h(data)g(all)g(this)g(cop)o(ying)f(can)g(get)h
(e)o(x-)2025 1470 y(pensi)n(v)o(e.)43 b(P)o(age)27 b(transfer)f(pro)o
(vides)f(the)h(k)o(ernel)g(a)i(w)o(ay)e(to)h(w)o(ork)2025
1570 y(around)16 b(this)i(data)g(cop)o(y)f(by)g(allo)n(wing)g(the)g(k)o
(ernel)g(to)h(inject)g(pages)2025 1669 y(of)36 b(memory)e(into)i(a)h
(process')e(virtual)g(address)h(space.)73 b(P)o(age)2025
1769 y(transfer)30 b(tak)o(es)i(k)o(ernel)f(pages)g(or)g(anons)f(and)h
(installs)h(them)f(at)2025 1869 y(either)25 b(a)i(virtual)e(address)g
(speci\002ed)h(by)f(the)h(user)g(or)f(in)h(an)g(area)2025
1968 y(of)d(virtual)g(memory)e(reserv)o(ed)h(for)h(page)f(transfer)-5
b(.)34 b(UVM)24 b(k)o(eeps)2025 2068 y(a)19 b(pool)f(of)g(amaps,)g
(preallocated)f(for)h(reuse)g(by)g(the)h(page)e(transfer)2025
2168 y(mechanism,)27 b(in)f(the)h(page)f(transfer)f(area)i(of)f(memory)
-5 b(.)42 b(Once)26 b(a)2025 2267 y(page)20 b(has)i(been)e(transfered)g
(into)g(a)i(process')e(address)h(space)g(it)h(is)2025
2367 y(treated)e(lik)o(e)g(an)o(y)g(other)f(page)g(of)h(anon)o(ymous)e
(memory)-5 b(.)2025 2631 y Fa(4.2.1)81 b(P)o(age)20 b(T)-6
b(ransfer)20 b(T)-6 b(ypes)2025 2802 y Fg(There)34 b(are)g(tw)o(o)h
(types)g(of)f(page)g(transfer)g(operations:)52 b(k)o(ernel)2025
2901 y(page)29 b(transfer)h(and)f(anon)o(ymous)f(page)h(transfer)-5
b(.)55 b(These)29 b(oper)n(-)2025 3001 y(ations)f(are)g(sho)n(wn)f(in)h
(Figure)f(3.)48 b(In)27 b(k)o(ernel)g(page)h(transfer)f(the)2025
3101 y(k)o(ernel)35 b(donates)g(pages)h(to)g(a)g(process)g(from)e(one)i
(of)f(its)i(page)2025 3200 y(pools)23 b(or)h(from)f(its)i(address)e
(space.)36 b(These)24 b(pages)f(become)g(part)2025 3300
y(of)31 b(that)g(process')f(anon)o(ymous)e(memory)-5
b(.)54 b(T)-7 b(o)32 b(perform)c(k)o(ernel)2025 3400
y(page)i(transfer)g(the)h(k)o(ernel)g(\002rst)g(locates)h(the)f
Fe(vm)p 3531 3400 25 4 v 29 w(page)g Fg(struc-)2025 3499
y(tures)h(of)g(the)h(b)n(uf)n(fer)e(being)g(transfered.)60
b(Ne)o(xt,)34 b(if)f(an)o(y)f(of)g(the)2025 3599 y(pages)k(are)g
(mapped)f(into)h(the)h(k)o(ernel')-5 b(s)36 b(address)f(space)i(those)
2025 3698 y(mappings)22 b(are)i(remo)o(v)o(ed.)32 b(The)24
b(pages)f(are)g(then)g(remo)o(v)o(ed)f(from)2025 3798
y(an)o(y)27 b(k)o(ernel-related)f(data)i(structures)g(that)g(the)o(y)g
(are)g(associated)2025 3898 y(with.)52 b(At)30 b(this)g(point)f(a)g(ne)
n(w)h(anon)e(is)i(allocated)f(and)f(attached)2025 3997
y(to)i(each)f(page)h(being)e(transfered.)53 b(Finally)-5
b(,)31 b(the)f(anons)f(are)h(in-)2025 4097 y(serted)d(into)g(the)g
(recei)n(ving)f(process')h(address)f(space)i(in)f(one)g(of)2025
4197 y(tw)o(o)i(w)o(ays.)51 b(If)28 b(the)h(recei)n(ving)e(process)h
(speci\002ed)h(a)g(tar)o(get)f(vir)n(-)2025 4296 y(tual)c(address)g
(range,)g(then)f(UVM)i(\002rst)g(ensures)e(that)h(that)h(range)2025
4396 y(of)31 b(memory)f(has)h(amaps)g(associated)g(with)h(it)g
(\(allocating)e(ne)n(w)2025 4495 y(amaps)22 b(if)g(necessary\))f(and)g
(then)h(inserts)g(the)g(anons)f(into)h(the)g(ap-)2025
4595 y(propriate)g(amaps,)j(replacing)d(an)o(y)h(pre)n(viously)f
(allocated)h(anons)2025 4695 y(in)d(that)g(area.)25 b(On)20
b(the)g(other)g(hand,)e(if)j(the)f(recei)n(ving)e(process)i(did)2025
4794 y(not)h(specify)g(a)g(tar)o(get)g(virtual)f(address,)h(then)g(UVM)
h(locates)f(free)2025 4894 y(space)30 b(in)g(the)g(page)f(transfer)g
(area)g(for)h(the)f(anons)g(and)h(installs)2025 4994
y(them)20 b(there.)25 b(Once)20 b(this)h(is)h(done)d(the)h(transfer)g
(is)h(complete.)k(The)2025 5093 y(pages)18 b(are)g(no)n(w)g(part)g(of)h
(the)f(recei)n(ving)f(process')g(normal)h(anon)o(y-)2025
5193 y(mous)i(memory)e(pool.)2108 5300 y(In)23 b(anon)o(ymous)e(page)i
(transfer)g(the)h(data)g(being)e(transfered)h(is)2025
5400 y(already)28 b(in)h(anon)f(structures.)50 b(T)-7
b(ypically)28 b(these)h(anons)f(are)h(the)p eop
%%Page: 8 8
8 7 bop -75 -67 a Fg(result)33 b(of)f(a)h(page)f(loanout)f(operation.)
60 b(In)33 b(this)g(type)f(of)g(page)-75 33 y(transfer)m(,)19
b(UVM)h(does)h(not)e(ha)n(v)o(e)h(to)h(remo)o(v)o(e)d(the)i(pages)g
(from)g(the)-75 132 y(k)o(ernel)i(or)h(other)g(processes.)33
b(Instead,)23 b(it)h(only)f(has)g(to)g(insert)h(the)-75
232 y(anons)18 b(into)g(the)h(recei)n(ving)e(process')g(address)i
(space)f(in)h(the)f(same)-75 332 y(w)o(ay)i(as)h(described)e(abo)o(v)o
(e.)-75 601 y Fa(4.2.2)81 b(Disposing)21 b(of)f(T)-6
b(ransfer)o(ed)19 b(Data)-75 774 y Fg(Processes)27 b(recei)n(ving)e
(data)i(via)g(page)f(transfer)g(need)g(to)h(release)-75
873 y(these)33 b(pages)f(when)g(the)o(y)g(are)h(no)f(longer)g(needed)f
(in)i(order)e(to)-75 973 y(a)n(v)n(oid)26 b(accumulating)f(too)h(much)g
(memory)-5 b(.)43 b(This)26 b(can)h(be)g(done)-75 1072
y(in)21 b(three)g(w)o(ays.)28 b(First,)22 b(a)g(process)f(may)g(unmap)e
(transferred)h(data)-75 1172 y(using)26 b(the)g(standard)f
Fe(munmap)h Fg(system)h(call.)44 b(A)27 b(problem)d(with)-75
1272 y(this)c(is)g(that)f Fe(munmap)g Fg(will)h(free)f(both)g(the)g
(transfered)f(anons)g(and)-75 1371 y(the)23 b(amap)g(containing)f
(them.)34 b(This)24 b(forces)f(UVM)g(to)h(allocate)f(a)-75
1471 y(ne)n(w)c(amap)g(the)g(ne)o(xt)g(time)h(pages)f(are)g(transfered)
f(to)h(to)h(the)f(same)-75 1571 y(virtual)25 b(space.)40
b(A)25 b(second)g(w)o(ay)g(to)g(dispose)g(of)g(transfered)f(data)-75
1670 y(is)h(to)g(use)g(the)f(ne)n(w)g Fe(anflush)g Fg(system)h(call.)38
b(This)24 b(system)h(call)-75 1770 y(remo)o(v)o(es)18
b(anons)g(from)g(a)i(speci\002ed)f(virtual)g(address)g(range)f(with-)
-75 1869 y(out)23 b(freeing)f(the)i(amap)f(allocated)g(to)g(it.)36
b(This)24 b(allo)n(ws)g(the)f(amap)-75 1969 y(to)h(be)h(reused)e(for)h
(future)f(transfers.)36 b(The)24 b(\002nal)g(w)o(ay)h(to)f(dispose)-75
2069 y(of)g(transfered)e(data)i(is)h(to)f(push)f(the)h(anon)f(pages)g
(do)n(wn)g(into)h(the)-75 2168 y(object)d(mapping)f(layer)-5
b(.)30 b(This)22 b(can)f(be)h(done)f(either)g(by)g(donating)-75
2268 y(the)c(o)n(wnership)d(of)j(the)f(anons')g(pages)g(to)g(an)h
(object)f(\(establishing)-75 2368 y(a)21 b(loanout)e(relationship)h
(between)f(the)i(anon)f(and)g(the)g(object\),)g(or)-75
2467 y(by)f(freeing)g(the)h(anons)f(and)g(inserting)g(the)h(pages)g
(into)g(an)f(object.)-75 2737 y Fa(4.2.3)81 b(Using)21
b(P)o(age)e(T)-6 b(ransfer)-75 2909 y Fg(K)n(ernel)18
b(and)g(anon)o(ymous)e(page)i(transfer)f(can)i(be)f(used)g(in)h(se)n(v)
o(eral)-75 3009 y(w)o(ays.)37 b(F)o(or)23 b(e)o(xample,)g(k)o(ernel)h
(page)f(transfer)g(can)h(be)g(used)f(with)-75 3109 y(de)n(vice)j(dri)n
(v)o(ers)f(or)h(the)g(IPC)h(subsystem.)43 b(F)o(or)26
b(de)n(vices)g(such)g(as)-75 3208 y(audio)f(cards,)i(when)e(recording)e
(the)j(dri)n(v)o(er)f(can)g(allocate)h(pages)-75 3308
y(from)e(UVM)i(to)f(DMA)h(into.)40 b(These)25 b(pages)g(can)g(then)g
(be)g(trans-)-75 3407 y(fered)18 b(into)h(the)g(application)f(that)h
(is)i(reading)c(from)i(the)g(audio)f(de-)-75 3507 y(vice.)27
b(F)o(or)20 b(the)h(IPC)h(system,)f(mb)n(uf)f(data)g(can)h(be)g(read)f
(with)h(page)-75 3607 y(transfer)-5 b(.)32 b(There)22
b(are)h(tw)o(o)g(sizes)h(of)e(mb)n(ufs:)30 b(lar)o(ge)22
b(and)g(small.)34 b(If)-75 3706 y(lar)o(ge)18 b(mb)n(ufs)g(are)h(made)g
(page)f(sized,)h(then)f(the)o(y)h(may)f(be)h(eligible)-75
3806 y(for)28 b(k)o(ernel)g(page)g(transfer)-5 b(.)50
b(There)28 b(are)g(tw)o(o)h(possible)f(types)h(of)-75
3906 y(lar)o(ge)17 b(mb)n(ufs.)24 b(Lar)o(ge)16 b(mb)n(ufs)h(that)h(ha)
n(v)o(e)g(normal)e(page-sized)h(data)-75 4005 y(areas)i(allocated)f
(out)h(of)f(the)h(k)o(ernel)f(are)h(called)g(\223cluster\224)f(mb)n
(ufs.)-75 4105 y(Lar)o(ge)24 b(mb)n(ufs)h(that)g(refer)g(to)g(memory)f
(managed)g(by)h(other)f(sub-)-75 4204 y(systems)31 b(are)g(called)g
(\223e)o(xternal\224)e(mb)n(ufs.)56 b(P)o(ages)31 b(from)f(cluster)-75
4304 y(mb)n(ufs)21 b(that)i(ha)n(v)o(e)e(a)i(reference)d(count)h(of)h
(one)f(can)h(easily)g(be)g(do-)-75 4404 y(nated)27 b(to)h(a)h(process)e
(through)f(page)h(transfer)-5 b(.)47 b(External)27 b(mb)n(ufs)-75
4503 y(can)k(refer)g(to)g(man)o(y)f(types)i(of)f(memory)e(including)h
(a)i(netw)o(ork)-75 4603 y(interf)o(ace)c(card')-5 b(s)28
b(memory)f(or)i(pages)f(loaned)g(out)g(from)g(a)h(pro-)-75
4703 y(cess.)68 b(P)o(ages)34 b(that)h(belong)d(to)j(netw)o(orking)d
(hardw)o(are)h(cannot)-75 4802 y(be)c(transfered,)h(b)n(ut)f(e)o
(xternal)f(mb)n(ufs)g(that)h(refer)g(to)g(loaned)f(out)-75
4902 y(pages)22 b(can)g(be)h(transfered)e(by)h(adding)f(an)h
(additional)f(loan)h(to)h(an)-75 5001 y(anon)i(and)g(then)g(using)g
(that)h(anon)e(for)h(anon)o(ymous)e(page)i(trans-)-75
5101 y(fer)-5 b(.)41 b(This)25 b(is)i(an)e(e)o(xample)f(of)h(page)g
(loanout)f(and)h(page)f(transfer)-75 5201 y(being)g(used)g(together)f
(to)i(a)n(v)n(oid)f(data)h(copies.)38 b(Note)24 b(that)h(a)g(ne)n(w)-75
5300 y(API)g(is)g(required)e(in)h(order)f(for)h(a)h(process)f(to)h
(recei)n(v)o(e)e(data)h(with)-75 5400 y(page)c(transfer)-5
b(.)2108 -67 y(Anon)o(ymous)16 b(page)i(transfer)f(can)i(be)f(used)g
(with)h(page)f(loanout)2025 33 y(to)27 b(anons)f(as)h(part)g(of)f(an)h
(I/O)f(or)h(IPC)g(mechanism.)43 b(F)o(or)27 b(e)o(xam-)2025
132 y(ple,)37 b(anon)o(ymous)31 b(page)j(transfer)f(could)g(be)h(used)f
(for)h(aligned)2025 232 y(page-sized)27 b Fe(read)h Fg(operations)e(on)
i(a)h(\002le.)49 b(Rather)28 b(than)g(cop)o(y-)2025 332
y(ing)19 b(the)f(data)h(to)g(anon)o(ymous)d(memory)h(with)i
Fe(copyout)p Fg(,)g(an)f(ob-)2025 431 y(ject')-5 b(s)31
b(pages)f(can)g(be)g(loaned)f(to)i(anons)e(and)h(those)g(anons)g(can)
2025 531 y(be)g(transfered)e(into)i(the)g(reading)f(process')g(address)
h(space.)54 b(A)2025 630 y(similar)33 b(ef)n(fect)e(could)h(be)g(achie)
n(v)o(ed)e(using)i Fe(mmap)p Fg(,)j(b)n(ut)d(mmap)2025
730 y(could)19 b(fragment)e(the)j(high-le)n(v)o(el)d(memory)h(mapping)f
(structures.)2025 830 y(P)o(age)27 b(transfer)g(does)h(not)f(fragment)f
(high-le)n(v)o(el)f(memory)h(map-)2025 929 y(pings)20
b(because)f(it)i(pro)o(vides)e(page-le)n(v)o(el)f(granularity)-5
b(.)2025 1172 y Fh(4.3)99 b(Map)25 b(Entry)h(P)o(assing)2025
1329 y Fg(Under)d(a)i(traditional)e(system,)i(processes)e(often)h(e)o
(xchange)e(data)2025 1429 y(either)27 b(through)e(pipes)h(or)h(through)
e(shared)i(memory)-5 b(.)43 b(In)27 b(BSD,)2025 1528
y(pipes)41 b(are)g(implemented)f(as)i(a)f(connected)f(pair)h(of)g(sock)
o(ets.)2025 1628 y(When)15 b(the)h(sending)e(process)h(writes)h(data)f
(into)g(a)h(pipe,)g(the)f(data)h(is)2025 1727 y(copied)21
b(from)f(the)i(sending)e(process')h(address)h(space)f(into)h(a)g(k)o
(er)n(-)2025 1827 y(nel)i(b)n(uf)n(fer)f(\(an)h(mb)n(uf\).)36
b(The)24 b(mb)n(uf)f(is)i(then)f(placed)f(on)h(a)h(queue)2025
1927 y(for)16 b(the)h(recei)n(ving)d(process.)24 b(When)16
b(the)h(recei)n(ving)e(process)h(reads)2025 2026 y(from)h(the)g(pipe,)h
(the)g(data)f(is)i(copied)d(from)h(the)h(queued)e(mb)n(uf)h(into)2025
2126 y(the)j(recei)n(ving)e(process')h(b)n(uf)n(fer)-5
b(.)24 b(Thus,)c(data)g(transmitted)f(o)o(v)o(er)f(a)2025
2226 y(pipe)i(is)h(copied)e(twice.)2108 2326 y(Shared)k(memory)e(can)i
(be)h(established)f(in)g(three)g(w)o(ays.)35 b(First,)2025
2426 y(the)d(System)g(V)h(shared)e(memory)f(interf)o(ace)h(allo)n(ws)i
(a)f(process)2025 2525 y(to)c(create)g(a)g(shared)g(se)o(gment)f(of)h
(anon)o(ymous)d(memory)-5 b(.)46 b(Each)2025 2625 y(se)o(gment)34
b(of)h(shared)f(memory)g(has)h(a)h(size)f(and)g(a)h(protection.)2025
2725 y(Once)17 b(created,)f(an)o(y)g(process)h(with)g(the)g
(appropriate)d(permissions)2025 2824 y(can)29 b(attach)f(the)h(shared)g
(memory)e(se)o(gment)h(into)g(their)h(address)2025 2924
y(space.)i(The)22 b(second)f(w)o(ay)i(shared)e(memory)g(can)h(be)g
(established)2025 3024 y(is)17 b(through)c(the)j Fe(mmap)g
Fg(system)g(call.)23 b(Changes)16 b(made)f(to)h(\002les)g(that)2025
3123 y(ha)n(v)o(e)25 b(been)h(mapped)e Fe(MAP)p 2833
3123 25 4 v 29 w(SHARED)i Fg(will)h(be)e(seen)i(by)e(all)i(pro-)2025
3223 y(cesses)19 b(accessing)f(the)g(\002le.)25 b(The)17
b(\002nal)h(w)o(ay)g(shared)g(memory)e(can)2025 3322
y(be)29 b(established)g(occurs)g(is)h(when)f(a)h(forking)d(process)i
(arranges)2025 3422 y(for)h(all)h(or)f(part)g(of)h(its)g(memory)e(to)i
(be)f(shared)g(with)g(the)h(child)2025 3522 y(process.)2108
3622 y(UVM)k(pro)o(vides)f(a)i(ne)n(w)f(w)o(ay)g(for)f(processes)h(to)h
(e)o(xchange)2025 3722 y(data:)48 b(map)31 b(entry)g(passing)g(\(sho)n
(wn)g(in)g(Figure)g(4\).)59 b(F)o(or)32 b(lar)o(ge)2025
3821 y(data)23 b(sizes,)i(this)f(is)g(more)e(ef)n(\002cient)h(than)g
(pipes)g(because)f(data)i(is)2025 3921 y(mo)o(v)o(ed)g(without)i(being)
f(copied.)41 b(Map)26 b(entry)f(passing)h(also)g(has)2025
4021 y(se)n(v)o(eral)c(adv)n(antages)e(o)o(v)o(er)h(traditional)g
(memory)f(sharing)i(mech-)2025 4120 y(anisms.)27 b(Unlik)o(e)20
b(System)h(V)g(shared)f(memory)-5 b(,)18 b(map)j(entry)e(pass-)2025
4220 y(ing)34 b(is)h(not)f(restricted)g(to)h(anon)o(ymous)c(memory)-5
b(.)65 b(Map)34 b(entry)2025 4320 y(passing)c(allo)n(ws)h(a)g(range)f
(of)g(virtual)g(addresses)g(to)h(be)g(shared,)2025 4419
y(copied,)16 b(or)h(mo)o(v)o(ed.)22 b(This)c(range)e(can)h(include)f
(multiple)g(memory)2025 4519 y(mappings)g(and)i(unmapped)d(areas)j(of)g
(virtual)f(memory)-5 b(.)22 b(Map)c(en-)2025 4618 y(try)h(passing)h
(also)g(does)f(not)g(require)g(the)g(services)h(of)f(the)h(\002lesys-)
2025 4718 y(tem)36 b(layer)m(,)i(unlik)o(e)d Fe(mmap)p
Fg(.)72 b(While)36 b(page)f(loanout)f(and)h(page)2025
4818 y(transfer)20 b(ha)n(v)o(e)f(page-le)n(v)o(el)g(granularity)-5
b(,)18 b(map)i(entry)f(passing)h(has)2025 4917 y(mapping-le)n(v)o(el)d
(granularity)-5 b(.)2025 5143 y Fa(4.3.1)81 b(Map)21
b(Entry)f(P)o(assing)h(Implementation)2025 5300 y Fg(The)15
b(map)g(entry)f(passing)h(mechanism)f(operates)h(as)g(follo)n(ws.)23
b(V)-5 b(ir)n(-)2025 5400 y(tual)23 b(space)g(is)h(\002rst)g(reserv)o
(ed)e(in)h(the)g(tar)o(get)f(map)h(for)g(the)g(passed)p
eop
%%Page: 9 9
9 8 bop 54 1091 a @beginspecial 0 @llx 0 @lly 451 @urx
331 @ury 2029 @rwi @setspecial
%%BeginDocument: ../figures/pass2.eps
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-76.0 457.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 7648 m 0 0 l 8811 0 l 8811 7648 l cp clip
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 2025 6150 m 2625 6150 l 2625 6450 l 2025 6450 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 7425 2925 m 8025 2925 l 8025 3975 l 7425 3975 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 2025 7050 m 2625 7050 l 2625 7425 l 2025 7425 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 2025 3600 m 2625 3600 l 2625 3750 l 2025 3750 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 7425 5625 m 8025 5625 l 8025 6225 l 7425 6225 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 7425 4650 m 8025 4650 l 8025 4800 l 7425 4800 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 7425 6825 m 8025 6825 l 8025 7425 l 7425 7425 l cp gs col7 0.50 shd ef gr gs col0 s gr 
% Polyline
n 2025 4575 m 2625 4575 l 2625 5400 l 2025 5400 l cp gs col7 0.50 shd ef gr gs col0 s gr 
/Helvetica-Bold ff 300.00 scf sf
2325 2670 m
gs 1 -1 sc (address space) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica-Bold ff 300.00 scf sf
7725 2325 m
gs 1 -1 sc (target virtual) dup sw pop 2 div neg 0 rm  col0 sh gr
/Helvetica-Bold ff 300.00 scf sf
7725 2670 m
gs 1 -1 sc (address space) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 7425 3975 m 8025 3975 l 8025 4650 l 7425 4650 l cp gs col0 s gr 
% Polyline
n 7425 4800 m 8025 4800 l 8025 5100 l 7425 5100 l cp gs col0 s gr 
% Polyline
n 7425 5100 m 8025 5100 l 8025 5625 l 7425 5625 l cp gs col0 s gr 
% Polyline
30.000 slw
n 7425 2775 m 7425 7575 l gs col0 s gr 
% Polyline
n 8025 2775 m 8025 7575 l gs col0 s gr 
% Polyline
7.500 slw
n 7425 6225 m 8025 6225 l 8025 6825 l 7425 6825 l cp gs col0 s gr 
/Helvetica ff 300.00 scf sf
3375 5025 m
gs 1 -1 sc (map entry passing) col0 sh gr
/Helvetica ff 300.00 scf sf
3375 5355 m
gs 1 -1 sc (\(copy, share, or donate\)) col0 sh gr
% Polyline
gs  clippath
3003 2895 m 3123 2925 l 3003 2955 l 3165 2955 l 3165 2895 l cp
clip
n 2700 2925 m 3150 2925 l gs col0 s gr gr

% arrowhead
n 3003 2895 m 3123 2925 l 3003 2955 l 3003 2925 l 3003 2895 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
3003 4545 m 3123 4575 l 3003 4605 l 3165 4605 l 3165 4545 l cp
clip
n 2700 4575 m 3150 4575 l gs col0 s gr gr

% arrowhead
n 3003 4545 m 3123 4575 l 3003 4605 l 3003 4575 l 3003 4545 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 3225 2925 m 3375 2925 l 3375 4575 l 3225 4575 l gs col0 s gr 
% Polyline
 [15 45] 45 sd
gs  clippath
6544 4727 m 6649 4791 l 6526 4784 l 6680 4833 l 6698 4776 l cp
clip
n 3375 3750 m 6675 4800 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 6544 4727 m 6649 4791 l 6526 4784 l 6535 4755 l 6544 4727 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7203 3945 m 7323 3975 l 7203 4005 l 7365 4005 l 7365 3945 l cp
clip
n 6900 3975 m 7350 3975 l gs col0 s gr gr

% arrowhead
n 7203 3945 m 7323 3975 l 7203 4005 l 7203 3975 l 7203 3945 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 6825 3975 m 6675 3975 l 6675 5625 l 6825 5625 l gs col0 s gr 
% Polyline
30.000 slw
n 2025 2775 m 2025 7575 l gs col0 s gr 
% Polyline
7.500 slw
gs  clippath
7203 5595 m 7323 5625 l 7203 5655 l 7365 5655 l 7365 5595 l cp
clip
n 6900 5625 m 7350 5625 l gs col0 s gr gr

% arrowhead
n 7203 5595 m 7323 5625 l 7203 5655 l 7203 5625 l 7203 5595 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
30.000 slw
n 2625 2775 m 2625 7575 l gs col0 s gr 
% Polyline
7.500 slw
n 2025 2925 m 2625 2925 l 2625 3600 l 2025 3600 l cp gs col0 s gr 
% Polyline
n 2025 3750 m 2625 3750 l 2625 4050 l 2025 4050 l cp gs col0 s gr 
% Polyline
n 2025 4050 m 2625 4050 l 2625 4575 l 2025 4575 l cp gs col0 s gr 
% Polyline
n 2025 5400 m 2625 5400 l 2625 6150 l 2025 6150 l cp gs col0 s gr 
% Polyline
n 2025 6450 m 2625 6450 l 2625 7050 l 2025 7050 l cp gs col0 s gr 
/Helvetica-Bold ff 300.00 scf sf
2325 2325 m
gs 1 -1 sc (source virtual) dup sw pop 2 div neg 0 rm  col0 sh gr
$F2psEnd
rs
%%EndDocument
 @endspecial 429 1274 a Fg(Figure)20 b(4:)25 b(Map)20
b(entry)g(passing)-75 1626 y(memory)-5 b(.)40 b(Then)26
b(the)g(source)f(map')-5 b(s)26 b(entry)f(list)i(is)g(searched)e(for)
-75 1726 y(the)18 b(\002rst)h(map)e(entry)h(that)g(contains)f(the)h
(starting)g(virtual)f(address.)-75 1825 y(There)k(are)g(four)f
(possible)h(w)o(ays)h(for)f(a)g(recei)n(ving)f(process)h(to)h(get)-75
1925 y(passed)h(memory)-5 b(.)32 b(The)23 b(memory)f(can)h(be)g
(shared,)h(copied)e(\(with)-75 2025 y(cop)o(y-on-write\),)e(donated,)i
(or)h(donated)f(with)h(zero-\002ll.)33 b(Donat-)-75 2124
y(ing)24 b(the)h(memory)e(causes)h(it)i(to)e(be)h(remo)o(v)o(ed)d(from)
h(the)i(sending)-75 2224 y(process')g(virtual)h(address)g(space)g(and)f
(placed)h(in)g(the)g(recei)n(ving)-75 2323 y(process')21
b(space.)29 b(After)21 b(the)g(memory)f(has)i(been)f(passed)g(the)h
(vir)n(-)-75 2423 y(tual)16 b(space)f(in)h(the)g(sending)e(process)h
(will)i(be)e(unmapped.)21 b(Donate)-75 2523 y(with)h(zero-\002ll)f(is)i
(the)f(same)g(as)g(donate,)f(e)o(xcept)g(that)h(rather)f(than)-75
2622 y(lea)n(ving)e(the)h(e)o(xported)e(range)h(of)g(virtual)h(space)g
(unmapped)d(after)-75 2722 y(it)k(has)f(been)g(passed)g(it)h(is)g
(reset)f(to)h(be)f(zero-\002ll)g(memory)-5 b(.)8 2823
y(Each)36 b(source)f(map)h(entry)g(that)g(is)h(in)g(the)f(virtual)f
(range)h(is)-75 2922 y(copied)c(into)g(a)i(list)g(of)e(map)h(entries)g
(that)g(will)g(be)g(inserted)f(in)-75 3022 y(the)20 b(destination)g
(map)g(\(if)g(the)g(memory)f(is)i(being)f(donated)e(rather)-75
3122 y(than)f(copied)g(or)g(shared)g(then)g(the)h(source)f(map)g(entry)
f(is)j(remo)o(v)o(ed)-75 3221 y(from)g(the)h(source)g(map\).)k(When)c
(the)g(end)f(of)h(the)g(virtual)g(range)f(is)-75 3321
y(reached,)f(the)g(ne)n(w)h(map)f(entries)h(are)g(inserted)f(in)h(the)g
(destination)-75 3420 y(map)h(at)g(the)h(virtual)e(address)h(pre)n
(viously)e(reserv)o(ed.)8 3521 y(The)43 b(function)f(that)h(e)o
(xtracts)g(the)g(map)g(entries)g(from)g(the)-75 3621
y(source)30 b(map)g(has)h(a)g(special)g(mode)f(of)g(operation)f(that)i
(is)h(used)-75 3720 y(for)c(short-term)g(shared)g(map)h(entry)f
(passing)h(of)g(a)g(small)h(num-)-75 3820 y(ber)22 b(of)g(pages.)30
b(This)22 b(mode)f(is)i(called)f(\223quick)f(reference)g(mode.)-6
b(\224)-75 3920 y(Normally)h(,)26 b(using)h(map)f(entry)g(passing)g(to)
h(pass)g(small)g(areas)g(of)-75 4019 y(memory)i(w)o(ould)h(be)h(inef)n
(\002cient)f(because)h(it)g(w)o(ould)g(cause)g(the)-75
4119 y(source)c(map')-5 b(s)28 b(lar)o(ger)e(entries)i(to)g(be)g
(fragmented)d(into)j(smaller)-75 4218 y(mappings)14 b(in)j(order)d(to)i
(satisfy)h(the)f(map)f(entry)h(passing)f(requests.)-75
4318 y(Quick)24 b(reference)g(mode)g(tak)o(es)h(adv)n(antage)e(of)h
(the)h(f)o(act)h(that)f(the)-75 4418 y(passed)32 b(memory)d(is)k(going)
d(to)i(be)g(brie\003y)f(used)g(and)g(then)g(un-)-75 4517
y(mapped.)22 b(This)17 b(allo)n(ws)h(UVM)f(to)g(relax)g(the)g
(management)d(of)j(ref-)-75 4617 y(erences)22 b(to)g(object)g(and)g
(amap)f(structures)h(and)g(a)n(v)n(oid)g(fragment-)-75
4717 y(ing)d(the)g(source)f(map.)24 b(Quick)18 b(references)g(are)h
(currently)e(used)i(by)-75 4816 y(the)g Fe(ptrace)g Fg(system)g(call)h
(to)f(read)g(and)f(write)i(the)f(memory)e(of)i(a)-75
4916 y(process)h(that)g(is)h(being)e(deb)n(ugged.)-75
5143 y Fa(4.3.2)81 b(Using)21 b(Map)g(Entry)f(P)o(assing)-75
5300 y Fg(Map)26 b(entry)f(passing)h(can)g(be)g(used)g(to)g(e)o
(xchange)e(data)i(between)-75 5400 y(processes)21 b(and)g(the)h(k)o
(ernel.)28 b(F)o(or)21 b(e)o(xample,)g(we)h(b)n(uilt)f(a)h(memory)2025
-67 y Fe(export)p Fg(/)p Fe(import)16 b Fg(IPC)i(f)o(acility)g(on)f
(top)g(of)g(UVM')-5 b(s)18 b(map)f(entry)2025 33 y(passing)25
b(mechanism)f(that)h(allo)n(ws)g(a)h(process)e(to)i(e)o(xport)d(ranges)
2025 132 y(of)k(its)h(virtual)f(address)g(space)g(to)g(other)g
(processes.)45 b(A)28 b(process)2025 232 y(with)k(the)h(appropriate)c
(permission)j(can)g(import)f(one)g(of)h(these)2025 332
y(virtual)24 b(address)g(ranges)f(into)h(its)i(address)e(space.)37
b(This)25 b(IPC)g(f)o(a-)2025 431 y(cility)e(is)h(similar)f(to)f
(System)h(V)g(shared)f(memory)-5 b(,)21 b(ho)n(we)n(v)o(er)g(it)j(is)
2025 531 y(more)19 b(generalized.)2025 785 y Fh(5)99
b(Measur)n(ements)2025 973 y Fg(In)32 b(this)h(section)f(we)h(describe)
f(\002)n(v)o(e)g(sets)h(of)g(tests)g(designed)e(to)2025
1073 y(measure)22 b(the)g(performance)d(of)k(UVM')-5
b(s)23 b(ne)n(w)f(features.)31 b(The)22 b(re-)2025 1173
y(sults)j(of)g(these)f(measurements)f(sho)n(w)i(that)f(page)g(loanout,)
g(page)2025 1272 y(transfer)m(,)k(and)e(map)h(entry)f(passing)h(can)g
(signi\002cantly)g(impro)o(v)o(e)2025 1372 y(I/O)20 b(and)g(IPC)h
(performance)c(o)o(v)o(er)i(traditional)g(systems.)2108
1473 y(All)25 b(our)f(tests)h(were)g(performed)d(on)i(200)f(MHz)i
(Pentium)f(Pro)2025 1573 y(processors)15 b(running)g(NetBSD)i(1.3A)e
(with)i(either)f(UVM)g(or)h(BSD)2025 1672 y(VM.)g(Our)f(Pentium)g(Pros)
g(ha)n(v)o(e)g(a)h(16K)f(le)n(v)o(el-one)f(cache,)i(a)g(256K)2025
1772 y(le)n(v)o(el-tw)o(o)h(cache,)h(and)g(32MB)h(of)f(physical)f
(memory)-5 b(.)23 b(The)c(main)2025 1872 y(memory)f(bandwidth)g(of)i
(our)f(Pentium)g(Pros)h(is)h(225)e(MB/sec)h(for)2025
1971 y(reads,)j(82)f(MB/sec)h(for)f(writes,)h(and)f(50)g(MB/sec)h(for)f
(copies,)h(as)2025 2071 y(reported)16 b(by)i(the)g Fe(lmbench)f
Fg(memory)g(bandwidth)f(benchmarks)2025 2170 y(\(v)o(ersion)j(1.2\))g
([12)n(].)2025 2416 y Fh(5.1)99 b(P)o(age)25 b(Loanout)h(P)n(erf)n
(ormance)2025 2574 y Fg(A)i(con)m(v)o(enient)c(place)j(to)h(measure)e
(the)i(ef)n(fect)e(of)h(page)g(loanout)2025 2673 y(on)i(I/O)g(is)h(in)g
(the)f(transfer)f(of)h(data)g(from)f(a)i(user)f(process)g(to)g(a)2025
2773 y(de)n(vice.)e(In)20 b(a)i(traditional)e(system,)h(this)h(w)o
(ould)e(in)m(v)n(olv)o(e)f(cop)o(ying)2025 2873 y(the)29
b(data)g(from)f(the)h(user')-5 b(s)29 b(address)g(space)g(to)g(a)g(k)o
(ernel)f(b)n(uf)n(fer)m(,)2025 2972 y(and)20 b(then)f(performing)e(I/O)
k(on)e(that)h(b)n(uf)n(fer)-5 b(.)24 b(W)m(ith)d(page)e(loanout,)2025
3072 y(such)24 b(an)g(I/O)h(operation)d(could)h(be)i(done)e(by)h
(loaning)f(the)h(pages)2025 3172 y(from)k(the)h(user')-5
b(s)29 b(address)f(space)h(directly)f(to)h(the)g(de)n(vice,)h(thus)2025
3271 y(a)n(v)n(oiding)20 b(the)i(data)f(cop)o(y)-5 b(.)28
b(Netw)o(orking)20 b(de)n(vices)h(are)h(often)e(cho-)2025
3371 y(sen)27 b(for)f(such)h(measurements,)g(so)g(we)g(measured)f(the)h
(ef)n(fect)f(of)2025 3471 y(page)21 b(loanout)f(on)h(the)h(speed)f
(with)g(which)g(data)h(can)f(be)h(pumped)2025 3570 y(through)c(the)i
(BSD)h(netw)o(orking)e(subsystem.)2108 3671 y(One)30
b(problem)e(with)h(measuring)f(the)i(performance)d(of)i(page)2025
3771 y(loanout)20 b(with)h(the)h(netw)o(orking)d(subsystem)i(is)h(that)
g(current)e(pro-)2025 3870 y(cessors)34 b(can)f(easily)h(generate)e
(data)i(f)o(aster)f(than)g(current)f(gen-)2025 3970 y(eration)27
b(netw)o(ork)h(interf)o(aces)f(can)i(transmit)f(it)3427
3940 y Ff(2)3460 3970 y Fg(.)50 b(F)o(or)28 b(e)o(xample,)2025
4070 y(the)e(Pentium)f(Pro)h(processor)f(on)h(our)f(test)i(machine)e
(can)g(easily)2025 4169 y(sw)o(amp)18 b(the)h(netw)o(ork)e(interf)o
(aces)h(we)h(ha)n(v)o(e)f(a)n(v)n(ailable)g(\(100Mbps)2025
4269 y(f)o(ast)k(Ethernet)d(and)i(155Mbps)e(A)-9 b(TM)21
b(cards\).)27 b(This)21 b(results)g(in)g(ei-)2025 4369
y(ther)c(the)g(transmitting)f(process)h(being)g(stalled)g(until)g(the)h
(netw)o(ork)2025 4468 y(interf)o(ace)25 b(layer)g(can)h(catch)g(up,)g
(or)g(in)g(data)g(being)e(discarded)h(at)2025 4568 y(the)d(netw)o(ork)g
(interf)o(ace)f(layer)h(due)g(to)h(a)g(full)f(netw)o(ork)f(queue.)31
b(If)2025 4667 y(one)17 b(of)g(these)h(netw)o(ork)f(interf)o(ace)f
(cards)i(w)o(as)g(used)f(in)h(measuring)2025 4767 y(page)f(loanout,)g
(an)o(y)g(positi)n(v)o(e)g(results)h(achie)n(v)o(ed)e(by)i(page)f
(loanout)2025 4867 y(w)o(ould)22 b(be)h(seen)g(as)h(a)f(reduction)f(in)
h(processor)e(load)i(rather)f(than)2025 4966 y(increased)29
b(bandwidth.)54 b(In)30 b(order)f(to)h(a)n(v)n(oid)g(being)g(limited)g
(by)2025 5066 y(netw)o(ork)15 b(interf)o(ace)g(hardw)o(are)g(a)i(ne)n
(w)f(\223null\224)g(protocol)e(layer)i(w)o(as)2025 5166
y(introduced)e(into)i(the)g(BSD)h(k)o(ernel.)22 b(This)17
b(protocol)d(discards)i(data)p 2025 5242 780 4 v 2115
5298 a Fd(2)2145 5321 y Fc(Ne)o(xt-generation)37 b(netw)o(ork)d(interf)
o(aces)j(such)c(as)g(Gigabit)h(Ethernet)h(and)2025 5400
y(higher)o(-speed)19 b(A)-7 b(TM)16 b(interf)o(aces)k(can)e(transmit)g
(data)h(at)e(higher)h(speeds.)p eop
%%Page: 10 10
10 9 bop 92 1153 a @beginspecial 43 @llx 43 @lly 528
@urx 434 @ury 1940 @rwi @setspecial
%%BeginDocument: ../plots/plot1/Plot1.eps
80 dict begin
/languagelevel where
{pop /gs_languagelevel languagelevel def}
{/gs_languagelevel 1 def} ifelse
gs_languagelevel 1 gt {
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<0000000000000000000000000000000000000000000000000000000000000000>} image end }
			>> 	matrix makepattern /Pat0 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111000044440000111100004444000011110000444400001111000044440000>} image end }
			>> 	matrix makepattern /Pat1 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111444411114444111144441111444411114444111144441111444411114444>} image end }
			>> 	matrix makepattern /Pat2 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555>} image end }
			>> 	matrix makepattern /Pat3 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbb>} image end }
			>> 	matrix makepattern /Pat4 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffff>} image end }
			>> 	matrix makepattern /Pat5 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<f77dffffbeeffffff77dffffbeeffffff77dffffbeeffffff77dffffbeefffff>} image end }
			>> 	matrix makepattern /Pat6 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff>} image end }
			>> 	matrix makepattern /Pat7 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<e1e1f0f078783c3c1e1e0f0f8787c3c3e1e1f0f078783c3c1e1e0f0f8787c3c3>} image end }
			>> 	matrix makepattern /Pat8 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<87870f0f1e1e3c3c7878f0f0e1e1c3c387870f0f1e1e3c3c7878f0f0e1e1c3c3>} image end }
			>> 	matrix makepattern /Pat9 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc>} image end }
			>> 	matrix makepattern /Pat10 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<00000000ffffffff00000000ffffffff00000000ffffffff00000000ffffffff>} image end }
			>> 	matrix makepattern /Pat11 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e>} image end }
			>> 	matrix makepattern /Pat12 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebf>} image end }
			>> 	matrix makepattern /Pat13 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7e>} image end }
			>> 	matrix makepattern /Pat14 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fffffbdff3dfebdfdbdfbbdf7bdffbdefbddfbdbfbd7fbcffbdfffffffffffff>} image end }
			>> 	matrix makepattern /Pat15 exch def 
}{
/Pat0 { 0.000000 setgray } def
/Pat1 { 0.062500 setgray } def
/Pat2 { 0.125000 setgray } def
/Pat3 { 0.187500 setgray } def
/Pat4 { 0.250000 setgray } def
/Pat5 { 0.312500 setgray } def
/Pat6 { 0.375000 setgray } def
/Pat7 { 0.437500 setgray } def
/Pat8 { 0.500000 setgray } def
/Pat9 { 0.562500 setgray } def
/Pat10 { 0.625000 setgray } def
/Pat11 { 0.687500 setgray } def
/Pat12 { 0.750000 setgray } def
/Pat13 { 0.812500 setgray } def
/Pat14 { 0.875000 setgray } def
/Pat15 { 0.937500 setgray } def
/setpattern { } def
} ifelse
/m {moveto} bind def
/l {lineto} bind def
/s {stroke} bind def
% Symbol fill
/f { gsave fill grestore stroke } bind def
% Opaque symbol
/o { gsave 1.000000 1.000000 1.000000 setrgbcolor
     fill grestore stroke } bind def
% Circle symbol
/a { 3 -1 roll 0 360 arc } bind def
/da { a s } bind def
/fa { a f } bind def
/oa { a o } bind def
% Square symbol
/sq { moveto dup dup rmoveto 2 mul
      dup neg 0 rlineto dup neg 0 exch rlineto
      0 rlineto closepath } bind def
/dsq { sq s } bind def
/fsq { sq f } bind def
/osq { sq o } bind def
% Triangle symbols
/t1 { moveto dup 0 exch rmoveto
      dup neg dup 2 mul rlineto 2 mul 0 rlineto
      closepath } bind def
/dt1 { t1 s } bind def
/ft1 { t1 f } bind def
/ot1 { t1 o } bind def
/t2 { moveto dup neg 0 rmoveto
      dup dup 2 mul exch neg rlineto
      2 mul 0 exch rlineto closepath } bind def
/dt2 { t2 s } bind def
/ft2 { t2 f } bind def
/ot2 { t2 o } bind def
/t3 { moveto dup neg 0 exch rmoveto
      dup dup 2 mul rlineto neg 2 mul 0 rlineto
      closepath } bind def
/dt3 { t3 s } bind def
/ft3 { t3 f } bind def
/ot3 { t3 o } bind def
/t4 { moveto dup 0 rmoveto
      dup dup -2 mul exch rlineto
      -2 mul 0 exch rlineto closepath } bind def
/dt4 { t4 s } bind def
/ft4 { t4 f } bind def
/ot4 { t4 o } bind def
% Diamond symbol
/di { moveto dup 0 exch rmoveto
      dup neg dup rlineto dup dup neg rlineto
      dup dup rlineto closepath } bind def
/ddi { di s } bind def
/fdi { di f } bind def
/odi { di o } bind def
% Plus symbol
/pl { dup 0 rmoveto dup -2 mul 0 rlineto
      dup dup rmoveto -2 mul 0 exch rlineto
    } bind def
/dpl { m pl s } bind def
% x symbol
/x { dup dup rmoveto dup -2 mul dup rlineto
     2 mul dup 0 rmoveto dup neg exch rlineto
   } bind def
/dx { m x s } bind def
% Splat symbol
/dsp { m dup pl dup 0 exch rmoveto 0.707 mul x s
     } bind def
/RJ {
 stringwidth neg exch neg exch
 rmoveto
} bind def
/CS {
 stringwidth
 2 div neg exch 2 div neg exch
 rmoveto
} bind def
0.24 0.24 scale
1 setlinecap

	mark             
	/ISOLatin1Encoding 
	  8#000 1 8#054 {StandardEncoding exch get} for 
	  /minus 
	  8#056 1 8#217 {StandardEncoding exch get} for 
	  /dotlessi 
	  8#301 1 8#317 {StandardEncoding exch get} for 
	  /space /exclamdown /cent /sterling /currency /yen /brokenbar /section 
	  /dieresis /copyright /ordfeminine /guillemotleft /logicalnot /hyphen 
	  /registered /macron /degree /plusminus /twosuperior /threesuperior /acute 
	  /mu /paragraph /periodcentered /cedilla /onesuperior /ordmasculine 
	  /guillemotright /onequarter /onehalf /threequarters /questiondown /Agrave 
	  /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla /Egrave /Eacute
	  /Ecircumflex /Edieresis /Igrave /Iacute /Icircumflex /Idieresis /Eth /Ntilde
	  /Ograve /Oacute /Ocircumflex /Otilde /Odieresis /multiply /Oslash /Ugrave 
	  /Uacute /Ucircumflex /Udieresis /Yacute /Thorn /germandbls /agrave /aacute 
	  /acircumflex /atilde /adieresis /aring /ae /ccedilla /egrave /eacute 
	  /ecircumflex /edieresis /igrave /iacute /icircumflex /idieresis /eth /ntilde
	  /ograve /oacute /ocircumflex /otilde /odieresis /divide /oslash /ugrave 
	  /uacute /ucircumflex /udieresis /yacute /thorn /ydieresis 
	  /ISOLatin1Encoding where not {256 array astore def} if 
	 cleartomark 

	/makeISOEncoded 
	{ findfont /curfont exch def 
	  /newfont curfont maxlength dict def  
	  /ISOLatin1 (-ISOLatin1) def
	  /curfontname curfont /FontName get dup length string cvs def 
	  /newfontname curfontname length ISOLatin1 length add string 
    	 dup 0                  curfontname putinterval 
    	 dup curfontname length ISOLatin1   putinterval 
	  def 
	  curfont   
	  { exch dup /FID ne  
    	{ dup /Encoding eq  
    	  { exch pop ISOLatin1Encoding exch }  
    	  if  
    	  dup /FontName eq  
    	  { exch pop newfontname exch }  
    	  if  
    	  exch newfont 3 1 roll put  
    	}  
    	{ pop pop }  
    	ifelse  
	  }  
	  forall 
	  newfontname newfont definefont 
	} def 

	/Times-Roman makeISOEncoded pop 
	/Times-Bold makeISOEncoded pop 
	/Times-Italic makeISOEncoded pop 
	/Times-BoldItalic makeISOEncoded pop 
	/Helvetica makeISOEncoded pop 
	/Helvetica-Bold makeISOEncoded pop 
	/Helvetica-Oblique makeISOEncoded pop 
	/Helvetica-BoldOblique makeISOEncoded pop 
s
0.000000 0.000000 0.000000 setrgbcolor
1 setlinewidth
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
[] 0 setdash
435 375 m
435 385 l
561 375 m
561 385 l
635 375 m
635 385 l
687 375 m
687 385 l
728 375 m
728 385 l
761 375 m
761 385 l
789 375 m
789 385 l
814 375 m
814 385 l
835 375 m
835 385 l
854 375 m
854 385 l
981 375 m
981 385 l
1055 375 m
1055 385 l
1107 375 m
1107 385 l
1148 375 m
1148 385 l
1181 375 m
1181 385 l
1209 375 m
1209 385 l
1234 375 m
1234 385 l
1255 375 m
1255 385 l
1275 375 m
1275 385 l
1401 375 m
1401 385 l
1475 375 m
1475 385 l
1527 375 m
1527 385 l
1568 375 m
1568 385 l
1601 375 m
1601 385 l
1629 375 m
1629 385 l
1654 375 m
1654 385 l
1675 375 m
1675 385 l
1694 375 m
1694 385 l
1821 375 m
1821 385 l
1895 375 m
1895 385 l
1947 375 m
1947 385 l
1988 375 m
1988 385 l
2021 375 m
2021 385 l
2049 375 m
2049 385 l
2074 375 m
2074 385 l
2095 375 m
2095 385 l
2115 375 m
2115 385 l
435 1775 m
435 1765 l
561 1775 m
561 1765 l
635 1775 m
635 1765 l
687 1775 m
687 1765 l
728 1775 m
728 1765 l
761 1775 m
761 1765 l
789 1775 m
789 1765 l
814 1775 m
814 1765 l
835 1775 m
835 1765 l
854 1775 m
854 1765 l
981 1775 m
981 1765 l
1055 1775 m
1055 1765 l
1107 1775 m
1107 1765 l
1148 1775 m
1148 1765 l
1181 1775 m
1181 1765 l
1209 1775 m
1209 1765 l
1234 1775 m
1234 1765 l
1255 1775 m
1255 1765 l
1275 1775 m
1275 1765 l
1401 1775 m
1401 1765 l
1475 1775 m
1475 1765 l
1527 1775 m
1527 1765 l
1568 1775 m
1568 1765 l
1601 1775 m
1601 1765 l
1629 1775 m
1629 1765 l
1654 1775 m
1654 1765 l
1675 1775 m
1675 1765 l
1694 1775 m
1694 1765 l
1821 1775 m
1821 1765 l
1895 1775 m
1895 1765 l
1947 1775 m
1947 1765 l
1988 1775 m
1988 1765 l
2021 1775 m
2021 1765 l
2049 1775 m
2049 1765 l
2074 1775 m
2074 1765 l
2095 1775 m
2095 1765 l
2115 1775 m
2115 1765 l
s
435 375 m
435 395 l
854 375 m
854 395 l
1275 375 m
1275 395 l
1694 375 m
1694 395 l
2115 375 m
2115 395 l
435 1775 m
435 1755 l
854 1775 m
854 1755 l
1275 1775 m
1275 1755 l
1694 1775 m
1694 1755 l
2115 1775 m
2115 1755 l
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
435 325 m
gsave
435 325 translate
0 rotate
0 -20  m
(1) CS
(1) show
grestore
newpath
854 325 m
gsave
854 325 translate
0 rotate
0 -20  m
(10) CS
(10) show
grestore
newpath
1275 325 m
gsave
1275 325 translate
0 rotate
0 -20  m
(100) CS
(100) show
grestore
newpath
1694 325 m
gsave
1694 325 translate
0 rotate
0 -20  m
(1000) CS
(1000) show
grestore
newpath
2115 325 m
gsave
2115 325 translate
0 rotate
0 -20  m
(10000) CS
(10000) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1275 225 m
gsave
1275 225 translate
0 rotate
0 0  m
(write size \(kbytes\)) CS
(write size \(kbytes\)) show
grestore
newpath
435 375 m
445 375 l
435 550 m
445 550 l
435 725 m
445 725 l
435 900 m
445 900 l
435 1075 m
445 1075 l
435 1250 m
445 1250 l
435 1425 m
445 1425 l
435 1600 m
445 1600 l
435 1775 m
445 1775 l
2115 375 m
2105 375 l
2115 550 m
2105 550 l
2115 725 m
2105 725 l
2115 900 m
2105 900 l
2115 1075 m
2105 1075 l
2115 1250 m
2105 1250 l
2115 1425 m
2105 1425 l
2115 1600 m
2105 1600 l
2115 1775 m
2105 1775 l
s
435 375 m
455 375 l
435 725 m
455 725 l
435 1075 m
455 1075 l
435 1425 m
455 1425 l
435 1775 m
455 1775 l
2115 375 m
2095 375 l
2115 725 m
2095 725 l
2115 1075 m
2095 1075 l
2115 1425 m
2095 1425 l
2115 1775 m
2095 1775 l
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
397 375 m
gsave
397 375 translate
0 rotate
0 -20  m
(0) RJ
(0) show
grestore
newpath
397 725 m
gsave
397 725 translate
0 rotate
0 -20  m
(200) RJ
(200) show
grestore
newpath
397 1075 m
gsave
397 1075 translate
0 rotate
0 -20  m
(400) RJ
(400) show
grestore
newpath
397 1425 m
gsave
397 1425 translate
0 rotate
0 -20  m
(600) RJ
(600) show
grestore
newpath
397 1775 m
gsave
397 1775 translate
0 rotate
0 -20  m
(800) RJ
(800) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
246 1075 m
gsave
246 1075 translate
90 rotate
0 0  m
(bandwidth \(MB/sec\)) CS
(bandwidth \(MB/sec\)) show
grestore
newpath
435 529 m
561 586 l
687 616 l
814 641 l
940 660 l
1067 668 l
1193 671 l
1320 672 l
1446 671 l
1572 675 l
1699 675 l
1825 675 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 435 529 fa
14 561 586 fa
14 687 616 fa
14 814 641 fa
14 940 660 fa
14 1067 668 fa
14 1193 671 fa
14 1320 672 fa
14 1446 671 fa
14 1572 675 fa
14 1699 675 fa
14 1825 675 fa
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
435 457 m
561 539 l
687 694 l
814 877 l
940 1122 l
1067 1354 l
1193 1570 l
1320 1633 l
1446 1669 l
1572 1679 l
1699 1688 l
1825 1693 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
12 435 457 fsq
12 561 539 fsq
12 687 694 fsq
12 814 877 fsq
12 940 1122 fsq
12 1067 1354 fsq
12 1193 1570 fsq
12 1320 1633 fsq
12 1446 1669 fsq
12 1572 1679 fsq
12 1699 1688 fsq
12 1825 1693 fsq
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
435 375 m
435 1775 l
2115 1775 l
2115 375 l
435 375 l
s
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1694 1513 m
1834 1513 l
s
14 1694 1513 fa
14 1834 1513 fa
1869 1513 m
gsave
1869 1513 translate
0 rotate
0 -20  m
(copy) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
1694 1439 m
1834 1439 l
s
12 1694 1439 fsq
12 1834 1439 fsq
0.000000 0.000000 0.000000 setrgbcolor
1869 1439 m
gsave
1869 1439 translate
0 rotate
0 -20  m
(loan) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
687 550 m
gsave
687 550 translate
0 rotate
0 -20  m
(4K) CS
(4K) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
end
showpage
%%EndDocument
 @endspecial -75 1336 a Fg(Figure)35 b(5:)56 b(Comparison)34
b(of)h(cop)o(y)g(and)g(loan)g(procedures)e(for)-75 1436
y(writing)20 b(to)g(a)h(null)f(sock)o(et)-75 1797 y(rather)15
b(than)g(passing)h(it)g(to)g(a)g(netw)o(ork)f(interf)o(ace.)23
b(This)16 b(allo)n(ws)g(the)-75 1896 y(data)i(transfer)f(o)o(v)o
(erhead)e(of)i(cop)o(ying)f(v)o(erses)i(page)f(loanout)g(to)h(be)-75
1996 y(directly)h(measured.)8 2101 y(T)-7 b(o)30 b(measure)f(the)h(ef)n
(fect)f(of)g(page)h(loanout)e(we)i(wrote)f(a)i(test)-75
2201 y(program)15 b(that)i(uses)g(the)g(null)g(protocol)e(to)i
(transmit)g(lar)o(ge)f(chunks)-75 2300 y(of)k(data)h(through)d(the)j
(sock)o(et)f(layer)-5 b(.)26 b(The)21 b(actions)f(performed)e(by)-75
2400 y(the)24 b(test)h(program)d(are)i(similar)h(to)f(programs)e(such)i
(as)h(ftp,)g(web,)-75 2500 y(and)20 b(video)g(serv)o(ers.)27
b(Such)20 b(programs)f(operate)h(by)h(opening)e(data)-75
2599 y(\002les)31 b(and)e(transmitting)g(the)h(\002le')-5
b(s)31 b(content)e(o)o(v)o(er)g(the)h(netw)o(ork.)-75
2699 y(The)k(test)g(program)e(transmits)i(data)g(using)f(either)h(the)g
(normal)-75 2799 y Fe(write)16 b Fg(system)g(call)h(to)f(cop)o(y)f
(data)h(from)f(user)h(space)g(into)g(k)o(ernel)-75 2898
y(b)n(uf)n(fers,)i(or)h(using)g(a)g(modi\002ed)f Fe(write)h
Fg(system)h(call)f(that)h(mo)o(v)o(es)-75 2998 y(user)e(data)g(into)g
(the)g(netw)o(orking)e(system)j(through)d(page)h(loanout.)8
3103 y(The)26 b(test)h(program)d(w)o(as)j(run)f(using)g(a)g(tw)o(o)h
(me)o(gabyte)d(b)n(uf)n(fer)-75 3203 y(that)29 b(w)o(as)h(transmitted)e
(1024)f(times.)51 b(Thus,)31 b(tw)o(o)e(gigabytes)e(of)-75
3302 y(data)18 b(w)o(as)i(transmitted)d(for)h(each)g(run)g(of)g(the)h
(test)g(program.)j(Each)-75 3402 y(run)f(of)h(the)g(program)e(w)o(as)j
(timed)f(so)g(that)g(the)h(bandwidth)d(of)i(the)-75 3502
y(null)e(sock)o(et)g(could)f(be)g(determined.)k(The)d(write)g(size)h(w)
o(as)g(v)n(aried)-75 3601 y(from)28 b(1K)h(to)h(2048K.)d(The)i(results)
h(of)e(the)i(test)g(using)e(cop)o(ying)-75 3701 y(and)20
b(page)f(loanout)g(are)h(sho)n(wn)g(in)g(Figure)f(5.)8
3806 y(F)o(or)j(write)h(sizes)h(that)f(are)f(less)i(than)e(the)h(hardw)
o(are)e(page)h(size)-75 3906 y(\(4K\),)k(cop)o(ying)g(the)i(data)f
(produces)f(a)h(higher)g(bandwidth)e(than)-75 4005 y(using)d(page)g
(loanout.)31 b(This)22 b(is)i(due)e(to)h(the)f(page)g(loanout)g(mech-)
-75 4105 y(anism)k(being)e(used)i(to)f(loan)h(out)f(pages)g(that)h(are)
f(only)g(partially)-75 4204 y(full)f(of)h(v)n(alid)f(data.)37
b(F)o(or)24 b(e)o(xample,)g(when)g(the)g(write)h(size)g(is)h(1K)-75
4304 y(for)j(each)h(page)f(loaned)f(out)i(there)f(is)i(3K)e(of)h(data)g
(in)f(the)h(page)-75 4404 y(that)k(is)h(not)f(being)f(used.)67
b(Once)34 b(the)g(write)g(size)h(reaches)f(the)-75 4503
y(page)26 b(size,)i(page)e(loanout')-5 b(s)25 b(bandwidth)g(o)o(v)o
(ertak)o(es)g(data)h(cop)o(y-)-75 4603 y(ing.)33 b(As)24
b(the)g(write)f(size)h(is)g(increased)e(to)h(allo)n(w)g(multiple)g
(pages)-75 4703 y(to)g(be)g(transmitted)g(in)g(a)g(single)g
Fe(write)g Fg(call,)h(the)f(data)g(cop)o(ying)-75 4802
y(bandwidth)g(increases)h(until)g(the)h(write)f(size)h(reaches)f(32K.)g
(The)-75 4902 y(data)c(cop)o(y)f(bandwidth)f(ne)n(v)o(er)g(e)o(xceeds)h
(172)g(MB/sec.)26 b(Note)19 b(that)-75 5001 y(the)h(data)g(cop)o(y)f
(bene\002ts)h(from)e(the)i(f)o(act)g(that)g(a)h(streaming)e(sock)o(et)
-75 5101 y(w)o(as)29 b(used.)50 b(This)28 b(allo)n(ws)h(the)f(sock)o
(et)h(layer)f(to)g(break)g(up)g(lar)o(ge)-75 5201 y(writes)c(into)f
(smaller)g(ones)g(that)g(\002t)h(into)f(the)g(processor')-5
b(s)22 b(cache.)-75 5300 y(If)f(a)g(datagram)f(sock)o(et)g(is)i(used,)f
(then)g(the)g(data)f(cop)o(y)g(bandwidth)-75 5400 y(drops)d(to)h(50)g
(MB/sec,)h(the)f(bandwidth)e(limit)i(obtained)f(from)g(lm-)2025
-67 y(bench.)30 b(Meanwhile,)22 b(the)g(loanout)f(bandwidth)f(rises)k
(sharply)d(as)2025 33 y(the)33 b(write)f(size)i(is)f(increased.)61
b(When)33 b(the)f(write)h(size)g(is)h(32K)2025 132 y(the)25
b(loanout)f(bandwidth)g(is)i(560)f(MB/sec.)41 b(The)25
b(loanout)f(band-)2025 232 y(width)17 b(le)n(v)o(els)f(of)n(f)g(at)i
(750)e(MB/sec)h(when)g(the)f(write)h(size)h(is)g(512K.)2025
332 y(Clearly)-5 b(,)20 b(page)f(loanout)g(impro)o(v)o(ed)f(the)i(I/O)g
(performance)e(of)i(the)2025 431 y(test)30 b(program)e(by)h(reducing)e
(data)i(cop)o(y)g(o)o(v)o(erhead.)50 b(Thus,)31 b(ap-)2025
531 y(plications)g(that)h(transmit)f(data)g(without)g(touching)f(it,)35
b(such)c(as)2025 630 y(the)21 b(multimedia)f(video)g(serv)o(er)g
(described)g(in)h([4],)g(could)f(bene\002t)2025 730 y(from)f(page)h
(loanout.)2025 960 y Fh(5.2)99 b(P)o(age)25 b(T)-7 b(ransfer)26
b(P)n(erf)n(ormance)2025 1116 y Fg(P)o(age)36 b(transfer)g(mo)o(v)o(es)
g(data)g(in)h(the)g(opposite)f(direction)f(than)2025
1216 y(page)18 b(loanout)f(does.)24 b(In)18 b(page)g(loanout,)g(a)h
(process)f(loans)g(its)i(data)2025 1315 y(out)h(to)h(some)g(other)e
(process)i(or)f(the)h(k)o(ernel.)28 b(In)22 b(page)f(transfer)m(,)f(a)
2025 1415 y(process)j(recei)n(v)o(es)g(pages)h(from)f(other)g
(processes)g(or)h(the)g(k)o(ernel.)2025 1515 y(The)18
b(pages)h(recei)n(v)o(ed)e(may)h(either)g(be)h(loaned)f(from)f(another)
h(pro-)2025 1614 y(cess)k(or)g(donated)e(from)g(the)i(k)o(ernel.)28
b(The)21 b(bene\002t)g(of)g(using)g(page)2025 1714 y(transfer)16
b(is)j(that)e(the)h(transferred)d(data)i(is)i(mo)o(v)o(ed)c(into)i(the)
h(recei)n(v-)2025 1813 y(ing)23 b(process')f(virtual)h(address)g(space)
g(without)g(the)g(o)o(v)o(erhead)e(of)2025 1913 y(a)g(data)f(cop)o(y)-5
b(.)2108 2013 y(The)22 b(ef)n(fect)g(of)h(page)f(transfer)f(on)i(the)f
(o)o(v)o(erhead)e(of)j(I/O)f(oper)n(-)2025 2112 y(ations)f(can)h(be)f
(measured)f(using)h(the)h(k)o(ernel')-5 b(s)21 b(netw)o(orking)e(sub-)
2025 2212 y(system)32 b(in)g(a)g(w)o(ay)g(that)g(is)g(similar)g(to)g
(the)g(procedure)d(used)i(to)2025 2312 y(measure)19 b(the)h(ef)n(fect)g
(of)g(page)f(loanout.)k(In)d(a)h(traditional)e(system,)2025
2411 y(when)30 b(data)g(is)h(read)f(from)g(a)h(sock)o(et)f(it)h(is)g
(copied)f(from)f(a)i(k)o(er)n(-)2025 2511 y(nel)23 b(mb)n(uf)g(into)f
(the)i(recei)n(ving)d(process')i(virtual)f(address)h(space.)2025
2610 y(W)m(ith)31 b(page)g(transfer)m(,)h(the)f(netw)o(ork)f(read)g
(operation)f(on)i(lar)o(ger)2025 2710 y(chunks)19 b(of)g(data)h(can)g
(be)g(done)f(by)g(using)h(page)f(transfer)g(to)h(trans-)2025
2810 y(fer)29 b(a)g(lar)o(ge)f(mb)n(uf)5 b(')-5 b(s)28
b(data)g(area)h(from)f(the)h(k)o(ernel)f(directly)g(into)2025
2909 y(the)f(recei)n(ving)e(process')h(virtual)g(address)g(pace,)i
(bypassing)e(the)2025 3009 y(cop)o(y)-5 b(.)39 b(F)o(or)25
b(this)h(to)f(be)g(feasible,)h(the)g(k)o(ernel)e(should)h(be)g
(con\002g-)2025 3109 y(ured)30 b(so)h(that)f(the)h(b)n(uf)n(fer)e(size)
i(of)g(a)g(cluster)f(mb)n(uf)g(is)h(equal)f(to)2025 3208
y(the)23 b(system)g(page)f(size.)34 b(T)-7 b(o)23 b(measure)g(the)g(ef)
n(fect)f(of)h(page)f(trans-)2025 3308 y(fer)29 b(a)g(ne)n(w)f
(\223null\224)h(sock)o(et)f(read)h(call)g(w)o(as)h(introduced)c(into)j
(the)2025 3407 y(BSD)g(k)o(ernel.)47 b(When)28 b(the)g(sock)o(et)f
(layer)h(detects)g(a)g(null)g(sock)o(et)2025 3507 y(read,)22
b(it)g(allocates)g(an)g(mb)n(uf)f(chain)g(of)h(the)g(requested)e(size)j
(\(con-)2025 3607 y(taining)h(random)f(data\))h(and)h(uses)g(it)h(to)e
(satisfy)i(the)e(sock)o(et)h(read)2025 3706 y(request.)54
b(This)30 b(allo)n(ws)h(us)f(to)h(directly)e(measure)g(the)h(ef)n(fect)
g(of)2025 3806 y(page)21 b(transfer)h(on)f(I/O)i(o)o(v)o(erhead)c(by)j
(observing)e(the)i(bandwidth)2025 3906 y(of)k(null)g(sock)o(et)g
(reads.)42 b(Note)26 b(that)g(unused)f(portions)g(of)h(a)h(clus-)2025
4005 y(ter)20 b(mb)n(uf)5 b(')-5 b(s)18 b(data)h(area)h(are)f(zeroed)f
(to)i(ensure)e(data)i(security)e(\(this)2025 4105 y(is)23
b(a)g(concern)e(when)h(we)h(are)f(transferring)f(real)h(data)g(rather)g
(than)2025 4204 y(null-sock)o(et)d(data\).)2108 4304
y(W)-7 b(e)18 b(wrote)f(a)h(test)g(program)d(that)j(uses)f(null)g(sock)
o(et)g(reads)g(to)h(re-)2025 4404 y(cei)n(v)o(e)h(lar)o(ge)g(chunks)g
(of)g(data)h(through)d(the)j(sock)o(et)g(layer)f(to)h(mea-)2025
4503 y(sure)25 b(page)f(transfer)g(performance.)37 b(Thus,)26
b(the)f(test)h(program)d(is)2025 4603 y(similar)g(to)g(programs)e(that)
i(recei)n(v)o(e)f(lar)o(ge)g(chunks)g(of)h(data)g(from)2025
4703 y(the)c(netw)o(ork)f(or)h(from)f(other)h(processes.)24
b(The)19 b(test)h(program)d(w)o(as)2025 4802 y(used)27
b(to)h(transfer)f(1GB)h(of)f(data)g(\002rst)i(using)e(data)g(cop)o
(ying)f(and)2025 4902 y(then)k(using)g(page)g(transfer)-5
b(.)55 b(The)30 b(read)g(size)h(w)o(as)g(v)n(aried)f(from)2025
5001 y(4K)18 b(\(one)f(page\))g(to)h(2048K,)e(and)h(the)h(bandwidth)e
(w)o(as)j(measured.)2025 5101 y(The)h(results)g(of)g(the)g(test)i(are)e
(sho)n(wn)f(in)h(Figure)g(6.)2108 5201 y(When)40 b(cop)o(ying)e(data,)
45 b(smaller)39 b(reads)h(produce)e(a)j(greater)2025
5300 y(bandwidth.)26 b(As)c(the)f(read)g(size)h(increases,)f(the)g
(null)g(sock)o(et)g(read)2025 5400 y(bandwidth)c(decreases)i(from)f
(315)g(MB/sec)i(to)f(50)g(MB/sec.)25 b(This)p eop
%%Page: 11 11
11 10 bop 92 1153 a @beginspecial 43 @llx 43 @lly 528
@urx 434 @ury 1940 @rwi @setspecial
%%BeginDocument: ../plots/plot2/Plot2.eps
80 dict begin
/languagelevel where
{pop /gs_languagelevel languagelevel def}
{/gs_languagelevel 1 def} ifelse
gs_languagelevel 1 gt {
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<0000000000000000000000000000000000000000000000000000000000000000>} image end }
			>> 	matrix makepattern /Pat0 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111000044440000111100004444000011110000444400001111000044440000>} image end }
			>> 	matrix makepattern /Pat1 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111444411114444111144441111444411114444111144441111444411114444>} image end }
			>> 	matrix makepattern /Pat2 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555>} image end }
			>> 	matrix makepattern /Pat3 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbb>} image end }
			>> 	matrix makepattern /Pat4 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffff>} image end }
			>> 	matrix makepattern /Pat5 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<f77dffffbeeffffff77dffffbeeffffff77dffffbeeffffff77dffffbeefffff>} image end }
			>> 	matrix makepattern /Pat6 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff>} image end }
			>> 	matrix makepattern /Pat7 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<e1e1f0f078783c3c1e1e0f0f8787c3c3e1e1f0f078783c3c1e1e0f0f8787c3c3>} image end }
			>> 	matrix makepattern /Pat8 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<87870f0f1e1e3c3c7878f0f0e1e1c3c387870f0f1e1e3c3c7878f0f0e1e1c3c3>} image end }
			>> 	matrix makepattern /Pat9 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc>} image end }
			>> 	matrix makepattern /Pat10 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<00000000ffffffff00000000ffffffff00000000ffffffff00000000ffffffff>} image end }
			>> 	matrix makepattern /Pat11 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e>} image end }
			>> 	matrix makepattern /Pat12 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebf>} image end }
			>> 	matrix makepattern /Pat13 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7e>} image end }
			>> 	matrix makepattern /Pat14 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fffffbdff3dfebdfdbdfbbdf7bdffbdefbddfbdbfbd7fbcffbdfffffffffffff>} image end }
			>> 	matrix makepattern /Pat15 exch def 
}{
/Pat0 { 0.000000 setgray } def
/Pat1 { 0.062500 setgray } def
/Pat2 { 0.125000 setgray } def
/Pat3 { 0.187500 setgray } def
/Pat4 { 0.250000 setgray } def
/Pat5 { 0.312500 setgray } def
/Pat6 { 0.375000 setgray } def
/Pat7 { 0.437500 setgray } def
/Pat8 { 0.500000 setgray } def
/Pat9 { 0.562500 setgray } def
/Pat10 { 0.625000 setgray } def
/Pat11 { 0.687500 setgray } def
/Pat12 { 0.750000 setgray } def
/Pat13 { 0.812500 setgray } def
/Pat14 { 0.875000 setgray } def
/Pat15 { 0.937500 setgray } def
/setpattern { } def
} ifelse
/m {moveto} bind def
/l {lineto} bind def
/s {stroke} bind def
% Symbol fill
/f { gsave fill grestore stroke } bind def
% Opaque symbol
/o { gsave 1.000000 1.000000 1.000000 setrgbcolor
     fill grestore stroke } bind def
% Circle symbol
/a { 3 -1 roll 0 360 arc } bind def
/da { a s } bind def
/fa { a f } bind def
/oa { a o } bind def
% Square symbol
/sq { moveto dup dup rmoveto 2 mul
      dup neg 0 rlineto dup neg 0 exch rlineto
      0 rlineto closepath } bind def
/dsq { sq s } bind def
/fsq { sq f } bind def
/osq { sq o } bind def
% Triangle symbols
/t1 { moveto dup 0 exch rmoveto
      dup neg dup 2 mul rlineto 2 mul 0 rlineto
      closepath } bind def
/dt1 { t1 s } bind def
/ft1 { t1 f } bind def
/ot1 { t1 o } bind def
/t2 { moveto dup neg 0 rmoveto
      dup dup 2 mul exch neg rlineto
      2 mul 0 exch rlineto closepath } bind def
/dt2 { t2 s } bind def
/ft2 { t2 f } bind def
/ot2 { t2 o } bind def
/t3 { moveto dup neg 0 exch rmoveto
      dup dup 2 mul rlineto neg 2 mul 0 rlineto
      closepath } bind def
/dt3 { t3 s } bind def
/ft3 { t3 f } bind def
/ot3 { t3 o } bind def
/t4 { moveto dup 0 rmoveto
      dup dup -2 mul exch rlineto
      -2 mul 0 exch rlineto closepath } bind def
/dt4 { t4 s } bind def
/ft4 { t4 f } bind def
/ot4 { t4 o } bind def
% Diamond symbol
/di { moveto dup 0 exch rmoveto
      dup neg dup rlineto dup dup neg rlineto
      dup dup rlineto closepath } bind def
/ddi { di s } bind def
/fdi { di f } bind def
/odi { di o } bind def
% Plus symbol
/pl { dup 0 rmoveto dup -2 mul 0 rlineto
      dup dup rmoveto -2 mul 0 exch rlineto
    } bind def
/dpl { m pl s } bind def
% x symbol
/x { dup dup rmoveto dup -2 mul dup rlineto
     2 mul dup 0 rmoveto dup neg exch rlineto
   } bind def
/dx { m x s } bind def
% Splat symbol
/dsp { m dup pl dup 0 exch rmoveto 0.707 mul x s
     } bind def
/RJ {
 stringwidth neg exch neg exch
 rmoveto
} bind def
/CS {
 stringwidth
 2 div neg exch 2 div neg exch
 rmoveto
} bind def
0.24 0.24 scale
1 setlinecap

	mark             
	/ISOLatin1Encoding 
	  8#000 1 8#054 {StandardEncoding exch get} for 
	  /minus 
	  8#056 1 8#217 {StandardEncoding exch get} for 
	  /dotlessi 
	  8#301 1 8#317 {StandardEncoding exch get} for 
	  /space /exclamdown /cent /sterling /currency /yen /brokenbar /section 
	  /dieresis /copyright /ordfeminine /guillemotleft /logicalnot /hyphen 
	  /registered /macron /degree /plusminus /twosuperior /threesuperior /acute 
	  /mu /paragraph /periodcentered /cedilla /onesuperior /ordmasculine 
	  /guillemotright /onequarter /onehalf /threequarters /questiondown /Agrave 
	  /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla /Egrave /Eacute
	  /Ecircumflex /Edieresis /Igrave /Iacute /Icircumflex /Idieresis /Eth /Ntilde
	  /Ograve /Oacute /Ocircumflex /Otilde /Odieresis /multiply /Oslash /Ugrave 
	  /Uacute /Ucircumflex /Udieresis /Yacute /Thorn /germandbls /agrave /aacute 
	  /acircumflex /atilde /adieresis /aring /ae /ccedilla /egrave /eacute 
	  /ecircumflex /edieresis /igrave /iacute /icircumflex /idieresis /eth /ntilde
	  /ograve /oacute /ocircumflex /otilde /odieresis /divide /oslash /ugrave 
	  /uacute /ucircumflex /udieresis /yacute /thorn /ydieresis 
	  /ISOLatin1Encoding where not {256 array astore def} if 
	 cleartomark 

	/makeISOEncoded 
	{ findfont /curfont exch def 
	  /newfont curfont maxlength dict def  
	  /ISOLatin1 (-ISOLatin1) def
	  /curfontname curfont /FontName get dup length string cvs def 
	  /newfontname curfontname length ISOLatin1 length add string 
    	 dup 0                  curfontname putinterval 
    	 dup curfontname length ISOLatin1   putinterval 
	  def 
	  curfont   
	  { exch dup /FID ne  
    	{ dup /Encoding eq  
    	  { exch pop ISOLatin1Encoding exch }  
    	  if  
    	  dup /FontName eq  
    	  { exch pop newfontname exch }  
    	  if  
    	  exch newfont 3 1 roll put  
    	}  
    	{ pop pop }  
    	ifelse  
	  }  
	  forall 
	  newfontname newfont definefont 
	} def 

	/Times-Roman makeISOEncoded pop 
	/Times-Bold makeISOEncoded pop 
	/Times-Italic makeISOEncoded pop 
	/Times-BoldItalic makeISOEncoded pop 
	/Helvetica makeISOEncoded pop 
	/Helvetica-Bold makeISOEncoded pop 
	/Helvetica-Oblique makeISOEncoded pop 
	/Helvetica-BoldOblique makeISOEncoded pop 
s
0.000000 0.000000 0.000000 setrgbcolor
1 setlinewidth
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
[] 0 setdash
435 375 m
435 385 l
561 375 m
561 385 l
635 375 m
635 385 l
687 375 m
687 385 l
728 375 m
728 385 l
761 375 m
761 385 l
789 375 m
789 385 l
814 375 m
814 385 l
835 375 m
835 385 l
854 375 m
854 385 l
981 375 m
981 385 l
1055 375 m
1055 385 l
1107 375 m
1107 385 l
1148 375 m
1148 385 l
1181 375 m
1181 385 l
1209 375 m
1209 385 l
1234 375 m
1234 385 l
1255 375 m
1255 385 l
1275 375 m
1275 385 l
1401 375 m
1401 385 l
1475 375 m
1475 385 l
1527 375 m
1527 385 l
1568 375 m
1568 385 l
1601 375 m
1601 385 l
1629 375 m
1629 385 l
1654 375 m
1654 385 l
1675 375 m
1675 385 l
1694 375 m
1694 385 l
1821 375 m
1821 385 l
1895 375 m
1895 385 l
1947 375 m
1947 385 l
1988 375 m
1988 385 l
2021 375 m
2021 385 l
2049 375 m
2049 385 l
2074 375 m
2074 385 l
2095 375 m
2095 385 l
2115 375 m
2115 385 l
435 1775 m
435 1765 l
561 1775 m
561 1765 l
635 1775 m
635 1765 l
687 1775 m
687 1765 l
728 1775 m
728 1765 l
761 1775 m
761 1765 l
789 1775 m
789 1765 l
814 1775 m
814 1765 l
835 1775 m
835 1765 l
854 1775 m
854 1765 l
981 1775 m
981 1765 l
1055 1775 m
1055 1765 l
1107 1775 m
1107 1765 l
1148 1775 m
1148 1765 l
1181 1775 m
1181 1765 l
1209 1775 m
1209 1765 l
1234 1775 m
1234 1765 l
1255 1775 m
1255 1765 l
1275 1775 m
1275 1765 l
1401 1775 m
1401 1765 l
1475 1775 m
1475 1765 l
1527 1775 m
1527 1765 l
1568 1775 m
1568 1765 l
1601 1775 m
1601 1765 l
1629 1775 m
1629 1765 l
1654 1775 m
1654 1765 l
1675 1775 m
1675 1765 l
1694 1775 m
1694 1765 l
1821 1775 m
1821 1765 l
1895 1775 m
1895 1765 l
1947 1775 m
1947 1765 l
1988 1775 m
1988 1765 l
2021 1775 m
2021 1765 l
2049 1775 m
2049 1765 l
2074 1775 m
2074 1765 l
2095 1775 m
2095 1765 l
2115 1775 m
2115 1765 l
s
435 375 m
435 395 l
854 375 m
854 395 l
1275 375 m
1275 395 l
1694 375 m
1694 395 l
2115 375 m
2115 395 l
435 1775 m
435 1755 l
854 1775 m
854 1755 l
1275 1775 m
1275 1755 l
1694 1775 m
1694 1755 l
2115 1775 m
2115 1755 l
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
435 325 m
gsave
435 325 translate
0 rotate
0 -20  m
(1) CS
(1) show
grestore
newpath
854 325 m
gsave
854 325 translate
0 rotate
0 -20  m
(10) CS
(10) show
grestore
newpath
1275 325 m
gsave
1275 325 translate
0 rotate
0 -20  m
(100) CS
(100) show
grestore
newpath
1694 325 m
gsave
1694 325 translate
0 rotate
0 -20  m
(1000) CS
(1000) show
grestore
newpath
2115 325 m
gsave
2115 325 translate
0 rotate
0 -20  m
(10000) CS
(10000) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1275 225 m
gsave
1275 225 translate
0 rotate
0 0  m
(read size \(kbytes\)) CS
(read size \(kbytes\)) show
grestore
newpath
435 375 m
445 375 l
435 550 m
445 550 l
435 725 m
445 725 l
435 900 m
445 900 l
435 1075 m
445 1075 l
435 1250 m
445 1250 l
435 1425 m
445 1425 l
435 1600 m
445 1600 l
435 1775 m
445 1775 l
2115 375 m
2105 375 l
2115 550 m
2105 550 l
2115 725 m
2105 725 l
2115 900 m
2105 900 l
2115 1075 m
2105 1075 l
2115 1250 m
2105 1250 l
2115 1425 m
2105 1425 l
2115 1600 m
2105 1600 l
2115 1775 m
2105 1775 l
s
435 375 m
455 375 l
435 725 m
455 725 l
435 1075 m
455 1075 l
435 1425 m
455 1425 l
435 1775 m
455 1775 l
2115 375 m
2095 375 l
2115 725 m
2095 725 l
2115 1075 m
2095 1075 l
2115 1425 m
2095 1425 l
2115 1775 m
2095 1775 l
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
397 375 m
gsave
397 375 translate
0 rotate
0 -20  m
(0) RJ
(0) show
grestore
newpath
397 725 m
gsave
397 725 translate
0 rotate
0 -20  m
(200) RJ
(200) show
grestore
newpath
397 1075 m
gsave
397 1075 translate
0 rotate
0 -20  m
(400) RJ
(400) show
grestore
newpath
397 1425 m
gsave
397 1425 translate
0 rotate
0 -20  m
(600) RJ
(600) show
grestore
newpath
397 1775 m
gsave
397 1775 translate
0 rotate
0 -20  m
(800) RJ
(800) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
246 1075 m
gsave
246 1075 translate
90 rotate
0 0  m
(bandwidth \(MB/sec\)) CS
(bandwidth \(MB/sec\)) show
grestore
newpath
687 926 m
814 765 l
940 773 l
1067 775 l
1193 756 l
1320 595 l
1446 475 l
1572 467 l
1699 464 l
1825 463 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 926 fa
14 814 765 fa
14 940 773 fa
14 1067 775 fa
14 1193 756 fa
14 1320 595 fa
14 1446 475 fa
14 1572 467 fa
14 1699 464 fa
14 1825 463 fa
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
687 714 m
814 875 l
940 1109 l
1067 1313 l
1193 1468 l
1320 1578 l
1446 1637 l
1572 1655 l
1699 1665 l
1825 1578 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
12 687 714 fsq
12 814 875 fsq
12 940 1109 fsq
12 1067 1313 fsq
12 1193 1468 fsq
12 1320 1578 fsq
12 1446 1637 fsq
12 1572 1655 fsq
12 1699 1665 fsq
12 1825 1578 fsq
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
435 375 m
435 1775 l
2115 1775 l
2115 375 l
435 375 l
s
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1694 1425 m
1834 1425 l
s
14 1694 1425 fa
14 1834 1425 fa
1869 1425 m
gsave
1869 1425 translate
0 rotate
0 -20  m
(copy) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
1694 1351 m
1834 1351 l
s
12 1694 1351 fsq
12 1834 1351 fsq
0.000000 0.000000 0.000000 setrgbcolor
1869 1351 m
gsave
1869 1351 translate
0 rotate
0 -20  m
(transfer) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
687 637 m
gsave
687 637 translate
0 rotate
0 -20  m
(4K) CS
(4K) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
end
showpage
%%EndDocument
 @endspecial -75 1336 a Fg(Figure)23 b(6:)31 b(Comparison)22
b(of)h(cop)o(y)f(and)h(transfer)f(procedures)f(for)-75
1436 y(reading)e(from)g(a)i(null)e(sock)o(et)-75 1789
y(decrease)i(is)h(due)f(to)h(data)f(caching)f(on)h(the)h(Pentium)f
(Pro.)28 b(Mem-)-75 1888 y(ory)18 b(accesses)h(to)f(the)h(cache)f(are)g
(signi\002cantly)g(f)o(aster)g(than)g(mem-)-75 1988 y(ory)30
b(accesses)i(to)f(main)f(memory)-5 b(.)55 b(If)31 b(an)g(application')
-5 b(s)30 b(b)n(uf)n(fer)-75 2088 y(entirely)g(\002ts)j(within)d(a)i
(cache)f(then)f(memory)g(references)g(to)h(it)-75 2187
y(will)i(be)f(f)o(aster)g(than)g(the)g(bandwidth)e(of)i(main)f(memory)
-5 b(.)59 b(F)o(or)-75 2287 y(e)o(xample,)27 b(when)f(the)g(test)i
(program)c(uses)j(4K)g(b)n(uf)n(fers)f(both)g(the)-75
2387 y(source)i(and)h(destination)f(b)n(uf)n(fers)g(of)h(the)g(data)g
(cop)o(y)f(\002t)i(within)-75 2486 y(the)19 b(le)n(v)o(el-one)e(cache)i
(producing)d(a)k(bandwidth)d(of)i(315)f(MB/sec.)-75 2586
y(When)27 b(the)h(size)g(of)f(the)h(test)g(program')-5
b(s)26 b(b)n(uf)n(fers)g(are)i(increased)-75 2685 y(to)34
b(8K)f(the)o(y)g(no)g(longer)f(\002t)j(within)e(the)h(le)n(v)o(el-one)d
(cache,)37 b(b)n(ut)-75 2785 y(the)o(y)32 b(do)f(\002t)i(within)f(the)h
(le)n(v)o(el-tw)o(o)e(cache.)61 b(This)32 b(results)h(in)f(a)-75
2885 y(bandwidth)c(drop)g(to)i(225)f(MB/sec.)55 b(The)29
b(bandwidth)f(remains)-75 2984 y(nearly)f(constant)g(for)h(read)f
(sizes)i(from)e(8K)h(to)g(64K.)g(Ho)n(we)n(v)o(er)m(,)-75
3084 y(between)14 b(128K)h(and)f(256K)h(the)g(bandwidth)e(drops)i(to)g
(50)g(MB/sec)-75 3184 y(as)j(the)f(size)i(of)e(the)g(data)g(b)n(uf)n
(fers)g(becomes)f(lar)o(ger)g(than)h(the)g(le)n(v)o(el-)-75
3283 y(tw)o(o)25 b(cache.)37 b(Finally)-5 b(,)25 b(the)f(bandwidth)f(e)
n(v)o(entually)f(le)n(v)o(els)j(out)f(at)-75 3383 y(50)18
b(MB/sec)h(\(the)f(same)g(v)n(alue)g(we)g(got)g(from)f
Fe(lmbench)p Fg(')-5 b(s)18 b(mem-)-75 3482 y(ory)e(cop)o(y)g
(benchmark\).)21 b(The)c(4K)g(read)f(size)i(gets)f(the)g(full)g
(bene\002t)-75 3582 y(of)h(the)g(high)f(bandwidth)g(of)h(the)g(Pentium)
f(Pro')-5 b(s)19 b(le)n(v)o(el-one)d(cache)-75 3682 y(since)25
b(it)h(w)o(as)f(the)g(only)f(process)g(running)f(on)h(the)h(system)g
(when)-75 3781 y(the)c(measurements)e(were)i(tak)o(en)f(\(so)h(its)h
(data)e(w)o(as)i(al)o(w)o(ays)f(fresh)-75 3881 y(in)f(the)h(cache\).)8
3982 y(On)37 b(the)h(other)f(hand,)j(the)e(cache)f(does)g(not)g(play)g
(as)h(great)-75 4082 y(a)44 b(role)g(in)g(page)f(transfer)-5
b(.)95 b(The)44 b(bandwidth)e(starts)i(around)-75 4181
y(190)19 b(MB/sec)i(for)f(page)f(sized)h(transfers,)g(and)f(then)h
(increases)g(up)-75 4281 y(to)27 b(730)g(MB/sec)h(for)e(a)i(1MB)f(page)
g(transfer)-5 b(.)45 b(The)27 b(\002nal)h(dip)e(in)-75
4381 y(the)c(page)f(transfer)g(curv)o(e)g(is)i(due)f(to)g(the)g(cache.)
30 b(As)22 b(the)g(transfer)-75 4480 y(size)e(gets)f(lar)o(ger)m(,)f
(the)h(page)g(transfer)f(code)h(touches)f(more)g(k)o(ernel)-75
4580 y(data)k(structures,)g(and)f(at)i(some)f(point)f(this)i(causes)f
(touched)f(data)-75 4680 y(structures)f(to)g(e)o(xceed)f(the)h(size)h
(of)f(the)g(le)n(v)o(el)g(one)g(cache.)-75 4926 y Fh(5.3)99
b(Using)45 b(UVM)h(to)f(T)-7 b(ransfer)47 b(Data)e(Between)149
5042 y(Pr)n(ocesses)-75 5201 y Fg(In)17 b(the)g(pre)n(vious)e(tw)o(o)i
(sections)g(we)h(discussed)e(the)h(ef)n(fect)g(of)f(page)-75
5300 y(loanout)f(and)h(page)g(transfer)g(on)g(the)g(mo)o(v)o(ement)f
(of)h(data)g(between)-75 5400 y(a)h(process)f(and)g(a)g(netw)o(ork)g
(interf)o(ace.)22 b(In)16 b(this)h(section,)g(we)g(e)o(xam-)2025
-67 y(ine)k(using)f(UVM)h(to)g(mo)o(v)o(e)e(data)i(between)f(tw)o(o)h
(processes)f(using)2025 33 y(a)k(pipe.)34 b(In)23 b(a)h(traditional)e
(system,)i(a)g(pipe)f(is)h(implemented)e(as)i(a)2025
132 y(pair)e(of)f(connected)f(sock)o(ets.)31 b(Each)21
b(byte)g(of)h(data)g(written)f(to)i(the)2025 232 y(pipe)e(is)i(copied)e
(twice.)30 b(UVM')-5 b(s)22 b(page)f(loanout)g(and)g(page)g(trans-)2025
332 y(fer)j(mechanisms)f(can)i(be)f(used)g(to)h(reduce)e(k)o(ernel)g(o)
o(v)o(erhead)f(by)2025 431 y(eliminating)d(both)g(these)i(copies.)2108
533 y(The)15 b(k)o(ernel')-5 b(s)15 b(sock)o(et)h(layer)f(w)o(as)h
(further)e(modi\002ed)g(in)i(order)e(to)2025 633 y(use)j(UVM)g(to)g
(eliminate)f(data)h(copies)f(when)g(using)g(pipes.)24
b(While)2025 732 y(the)e(page)g(loanout)e(modi\002cations)h(described)g
(earlier)h(w)o(as)h(suf)n(\002-)2025 832 y(cient)29 b(for)g(use)g(with)
g(a)h(pipe,)g(the)f(page)g(transfer)f(modi\002cations)2025
932 y(for)k(the)g(null)g(sock)o(et)g(read)g(operation)e(were)i(not.)61
b(In)32 b(order)f(to)2025 1031 y(support)20 b(page)g(transfer)g(for)g
(pipes,)h(the)g(sock)o(et)f(recei)n(v)o(e)g(function)2025
1131 y(w)o(as)i(modi\002ed)e(to)h(use)g(page)f(transfer)g(on)h(lar)o
(ge)f(mb)n(ufs)g(when)h(re-)2025 1231 y(quested.)41 b(The)25
b(modi\002cations)f(allo)n(ws)i(the)g(sock)o(et)f(layer)h(to)f(use)2025
1330 y(page)33 b(transfer)g(for)h(both)f(cluster)h(mb)n(ufs)f(and)g(e)o
(xternal)g(mb)n(ufs)2025 1430 y(whose)26 b(b)n(uf)n(fers)g(are)g(pages)
g(loaned)f(out)h(from)g(some)g(other)g(pro-)2025 1529
y(cess.)2108 1631 y(T)-7 b(o)35 b(measure)f(the)g(ef)n(fect)h(of)f
(both)g(page)g(loanout)f(and)h(page)2025 1731 y(transfer)19
b(on)h(the)h(transfer)e(of)h(data)g(between)f(tw)o(o)i(processes)f(o)o
(v)o(er)2025 1831 y(a)29 b(pipe,)h(we)e(wrote)g(a)h(test)h(program)c
(that)i(operates)g(as)h(follo)n(ws.)2025 1930 y(The)e(parameters)f(are)
h(parsed)g(and)f(a)i(pipe)f(is)h(created.)45 b(A)28 b(child)2025
2030 y(process)20 b(is)h(then)f(fork)o(ed)e(of)n(f.)24
b(The)c(child)g(process)g(writes)g(a)h(spec-)2025 2129
y(i\002ed)31 b(amount)e(of)i(data)f(into)h(the)f(pipe,)j(using)d(page)g
(loanout)f(if)2025 2229 y(requested.)23 b(Once)d(the)f(data)h(is)g
(written)f(the)h(child)f(process)g(closes)2025 2329 y(the)h(pipe)g(and)
g(e)o(xits.)25 b(The)20 b(parent)f(process)h(reads)g(data)g(out)g(of)g
(the)2025 2428 y(pipe,)25 b(using)f(page)f(transfer)h(if)h(requested.)
36 b(After)24 b(a)h(read)f(opera-)2025 2528 y(tion,)i(the)f(data)g(is)h
(released)e(using)h(the)g Fe(anflush)f Fg(system)h(call.)2025
2628 y(Once)32 b(all)g(data)g(is)h(read,)h(the)e(parent)f(process)g(e)o
(xits.)60 b(The)32 b(test)2025 2727 y(program)18 b(tak)o(es)j(as)g
(parameters)f(the)g(amount)f(of)h(data)h(to)f(transfer)2025
2827 y(o)o(v)o(er)f(the)h(pipe)g(and)f(the)i(read)e(and)h(write)g
(sizes.)2108 2929 y(W)-7 b(e)29 b(used)f(the)g(test)h(program)c(to)j
(produce)e(four)h(sets)i(of)f(data.)2025 3028 y(F)o(or)21
b(each)f(set)i(of)f(data)g(we)h(transfered)d(1GB)j(of)e(data)h(v)n
(arying)f(the)2025 3128 y(read)i(and)f(write)i(sizes)g(from)e(4K)h(to)h
(2048K.)d(The)i(four)f(data)h(sets)2025 3228 y(are:)2025
3401 y Fa(copy:)40 b Fg(Data)24 b(w)o(as)g(copied)e(on)h(both)g(the)g
(sending)f(and)h(recei)n(ving)2191 3500 y(ends)d(of)g(the)g(pipe.)2025
3676 y Fa(transfer:)40 b Fg(Data)21 b(w)o(as)g(copied)f(on)g(the)g
(sending)g(side)h(and)f(mo)o(v)o(ed)2191 3775 y(with)g(page)g(transfer)
f(on)h(the)g(recei)n(ving)f(side)h(of)g(the)g(pipe.)2025
3951 y Fa(loan:)40 b Fg(Data)22 b(w)o(as)h(loaned)d(out)h(on)g(the)h
(sending)e(side)i(and)f(copied)2191 4051 y(on)f(the)g(recei)n(ving)f
(side)h(of)g(the)g(pipe.)2025 4226 y Fa(both:)41 b Fg(Data)20
b(w)o(as)h(loaned)e(out)h(on)g(the)g(sending)f(side)i(and)f(mo)o(v)o
(ed)2191 4326 y(with)g(page)g(transfer)f(on)h(the)g(recei)n(ving)f
(side)h(of)g(the)g(pipe.)2025 4499 y(The)g(results)g(of)g(this)h(test)g
(are)f(sho)n(wn)g(in)g(Figure)g(7.)2108 4601 y(F)o(or)29
b(page)g(sized)h(data)f(transfers)g(\(4K\))g(cop)o(ying)f(produces)g(a)
2025 4700 y(bandwidth)34 b(of)i(40)g(MB/sec,)k(while)c(page)g(transfer)
f(and)g(page)2025 4800 y(loanout)18 b(produce)f(bandwidths)h(of)h(33)f
(MB/sec)i(and)f(45)g(MB/sec,)2025 4900 y(respecti)n(v)o(ely)-5
b(.)30 b(Using)23 b(both)e(page)h(transfer)g(and)g(page)g(loanout)f(at)
2025 4999 y(the)27 b(same)f(time)h(with)g(page)f(sized)g(transfers)g
(produces)f(a)i(band-)2025 5099 y(width)20 b(of)g(70)g(MB/sec.)2108
5201 y(As)27 b(the)f(transfer)f(size)i(is)g(increased,)g(the)f
(bandwidth)e(of)i(data)2025 5300 y(cop)o(ying)15 b(drops)g(and)h(le)n
(v)o(els)h(of)n(f)e(at)i(26)f(MB/sec)i(due)e(to)g(the)h(ef)n(fects)2025
5400 y(of)28 b(the)g(cache.)49 b(Meanwhile,)29 b(the)f(bandwidth)e(of)i
(both)f(transfer)p eop
%%Page: 12 12
12 11 bop 92 1153 a @beginspecial 43 @llx 43 @lly 528
@urx 434 @ury 1940 @rwi @setspecial
%%BeginDocument: ../plots/plot3/Plot3.eps
80 dict begin
/languagelevel where
{pop /gs_languagelevel languagelevel def}
{/gs_languagelevel 1 def} ifelse
gs_languagelevel 1 gt {
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<0000000000000000000000000000000000000000000000000000000000000000>} image end }
			>> 	matrix makepattern /Pat0 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111000044440000111100004444000011110000444400001111000044440000>} image end }
			>> 	matrix makepattern /Pat1 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111444411114444111144441111444411114444111144441111444411114444>} image end }
			>> 	matrix makepattern /Pat2 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555>} image end }
			>> 	matrix makepattern /Pat3 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbb>} image end }
			>> 	matrix makepattern /Pat4 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffff>} image end }
			>> 	matrix makepattern /Pat5 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<f77dffffbeeffffff77dffffbeeffffff77dffffbeeffffff77dffffbeefffff>} image end }
			>> 	matrix makepattern /Pat6 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff>} image end }
			>> 	matrix makepattern /Pat7 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<e1e1f0f078783c3c1e1e0f0f8787c3c3e1e1f0f078783c3c1e1e0f0f8787c3c3>} image end }
			>> 	matrix makepattern /Pat8 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<87870f0f1e1e3c3c7878f0f0e1e1c3c387870f0f1e1e3c3c7878f0f0e1e1c3c3>} image end }
			>> 	matrix makepattern /Pat9 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc>} image end }
			>> 	matrix makepattern /Pat10 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<00000000ffffffff00000000ffffffff00000000ffffffff00000000ffffffff>} image end }
			>> 	matrix makepattern /Pat11 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e>} image end }
			>> 	matrix makepattern /Pat12 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebf>} image end }
			>> 	matrix makepattern /Pat13 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7e>} image end }
			>> 	matrix makepattern /Pat14 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fffffbdff3dfebdfdbdfbbdf7bdffbdefbddfbdbfbd7fbcffbdfffffffffffff>} image end }
			>> 	matrix makepattern /Pat15 exch def 
}{
/Pat0 { 0.000000 setgray } def
/Pat1 { 0.062500 setgray } def
/Pat2 { 0.125000 setgray } def
/Pat3 { 0.187500 setgray } def
/Pat4 { 0.250000 setgray } def
/Pat5 { 0.312500 setgray } def
/Pat6 { 0.375000 setgray } def
/Pat7 { 0.437500 setgray } def
/Pat8 { 0.500000 setgray } def
/Pat9 { 0.562500 setgray } def
/Pat10 { 0.625000 setgray } def
/Pat11 { 0.687500 setgray } def
/Pat12 { 0.750000 setgray } def
/Pat13 { 0.812500 setgray } def
/Pat14 { 0.875000 setgray } def
/Pat15 { 0.937500 setgray } def
/setpattern { } def
} ifelse
/m {moveto} bind def
/l {lineto} bind def
/s {stroke} bind def
% Symbol fill
/f { gsave fill grestore stroke } bind def
% Opaque symbol
/o { gsave 1.000000 1.000000 1.000000 setrgbcolor
     fill grestore stroke } bind def
% Circle symbol
/a { 3 -1 roll 0 360 arc } bind def
/da { a s } bind def
/fa { a f } bind def
/oa { a o } bind def
% Square symbol
/sq { moveto dup dup rmoveto 2 mul
      dup neg 0 rlineto dup neg 0 exch rlineto
      0 rlineto closepath } bind def
/dsq { sq s } bind def
/fsq { sq f } bind def
/osq { sq o } bind def
% Triangle symbols
/t1 { moveto dup 0 exch rmoveto
      dup neg dup 2 mul rlineto 2 mul 0 rlineto
      closepath } bind def
/dt1 { t1 s } bind def
/ft1 { t1 f } bind def
/ot1 { t1 o } bind def
/t2 { moveto dup neg 0 rmoveto
      dup dup 2 mul exch neg rlineto
      2 mul 0 exch rlineto closepath } bind def
/dt2 { t2 s } bind def
/ft2 { t2 f } bind def
/ot2 { t2 o } bind def
/t3 { moveto dup neg 0 exch rmoveto
      dup dup 2 mul rlineto neg 2 mul 0 rlineto
      closepath } bind def
/dt3 { t3 s } bind def
/ft3 { t3 f } bind def
/ot3 { t3 o } bind def
/t4 { moveto dup 0 rmoveto
      dup dup -2 mul exch rlineto
      -2 mul 0 exch rlineto closepath } bind def
/dt4 { t4 s } bind def
/ft4 { t4 f } bind def
/ot4 { t4 o } bind def
% Diamond symbol
/di { moveto dup 0 exch rmoveto
      dup neg dup rlineto dup dup neg rlineto
      dup dup rlineto closepath } bind def
/ddi { di s } bind def
/fdi { di f } bind def
/odi { di o } bind def
% Plus symbol
/pl { dup 0 rmoveto dup -2 mul 0 rlineto
      dup dup rmoveto -2 mul 0 exch rlineto
    } bind def
/dpl { m pl s } bind def
% x symbol
/x { dup dup rmoveto dup -2 mul dup rlineto
     2 mul dup 0 rmoveto dup neg exch rlineto
   } bind def
/dx { m x s } bind def
% Splat symbol
/dsp { m dup pl dup 0 exch rmoveto 0.707 mul x s
     } bind def
/RJ {
 stringwidth neg exch neg exch
 rmoveto
} bind def
/CS {
 stringwidth
 2 div neg exch 2 div neg exch
 rmoveto
} bind def
0.24 0.24 scale
1 setlinecap

	mark             
	/ISOLatin1Encoding 
	  8#000 1 8#054 {StandardEncoding exch get} for 
	  /minus 
	  8#056 1 8#217 {StandardEncoding exch get} for 
	  /dotlessi 
	  8#301 1 8#317 {StandardEncoding exch get} for 
	  /space /exclamdown /cent /sterling /currency /yen /brokenbar /section 
	  /dieresis /copyright /ordfeminine /guillemotleft /logicalnot /hyphen 
	  /registered /macron /degree /plusminus /twosuperior /threesuperior /acute 
	  /mu /paragraph /periodcentered /cedilla /onesuperior /ordmasculine 
	  /guillemotright /onequarter /onehalf /threequarters /questiondown /Agrave 
	  /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla /Egrave /Eacute
	  /Ecircumflex /Edieresis /Igrave /Iacute /Icircumflex /Idieresis /Eth /Ntilde
	  /Ograve /Oacute /Ocircumflex /Otilde /Odieresis /multiply /Oslash /Ugrave 
	  /Uacute /Ucircumflex /Udieresis /Yacute /Thorn /germandbls /agrave /aacute 
	  /acircumflex /atilde /adieresis /aring /ae /ccedilla /egrave /eacute 
	  /ecircumflex /edieresis /igrave /iacute /icircumflex /idieresis /eth /ntilde
	  /ograve /oacute /ocircumflex /otilde /odieresis /divide /oslash /ugrave 
	  /uacute /ucircumflex /udieresis /yacute /thorn /ydieresis 
	  /ISOLatin1Encoding where not {256 array astore def} if 
	 cleartomark 

	/makeISOEncoded 
	{ findfont /curfont exch def 
	  /newfont curfont maxlength dict def  
	  /ISOLatin1 (-ISOLatin1) def
	  /curfontname curfont /FontName get dup length string cvs def 
	  /newfontname curfontname length ISOLatin1 length add string 
    	 dup 0                  curfontname putinterval 
    	 dup curfontname length ISOLatin1   putinterval 
	  def 
	  curfont   
	  { exch dup /FID ne  
    	{ dup /Encoding eq  
    	  { exch pop ISOLatin1Encoding exch }  
    	  if  
    	  dup /FontName eq  
    	  { exch pop newfontname exch }  
    	  if  
    	  exch newfont 3 1 roll put  
    	}  
    	{ pop pop }  
    	ifelse  
	  }  
	  forall 
	  newfontname newfont definefont 
	} def 

	/Times-Roman makeISOEncoded pop 
	/Times-Bold makeISOEncoded pop 
	/Times-Italic makeISOEncoded pop 
	/Times-BoldItalic makeISOEncoded pop 
	/Helvetica makeISOEncoded pop 
	/Helvetica-Bold makeISOEncoded pop 
	/Helvetica-Oblique makeISOEncoded pop 
	/Helvetica-BoldOblique makeISOEncoded pop 
s
0.000000 0.000000 0.000000 setrgbcolor
1 setlinewidth
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
[] 0 setdash
435 375 m
435 385 l
561 375 m
561 385 l
635 375 m
635 385 l
687 375 m
687 385 l
728 375 m
728 385 l
761 375 m
761 385 l
789 375 m
789 385 l
814 375 m
814 385 l
835 375 m
835 385 l
854 375 m
854 385 l
981 375 m
981 385 l
1055 375 m
1055 385 l
1107 375 m
1107 385 l
1148 375 m
1148 385 l
1181 375 m
1181 385 l
1209 375 m
1209 385 l
1234 375 m
1234 385 l
1255 375 m
1255 385 l
1275 375 m
1275 385 l
1401 375 m
1401 385 l
1475 375 m
1475 385 l
1527 375 m
1527 385 l
1568 375 m
1568 385 l
1601 375 m
1601 385 l
1629 375 m
1629 385 l
1654 375 m
1654 385 l
1675 375 m
1675 385 l
1694 375 m
1694 385 l
1821 375 m
1821 385 l
1895 375 m
1895 385 l
1947 375 m
1947 385 l
1988 375 m
1988 385 l
2021 375 m
2021 385 l
2049 375 m
2049 385 l
2074 375 m
2074 385 l
2095 375 m
2095 385 l
2115 375 m
2115 385 l
435 1775 m
435 1765 l
561 1775 m
561 1765 l
635 1775 m
635 1765 l
687 1775 m
687 1765 l
728 1775 m
728 1765 l
761 1775 m
761 1765 l
789 1775 m
789 1765 l
814 1775 m
814 1765 l
835 1775 m
835 1765 l
854 1775 m
854 1765 l
981 1775 m
981 1765 l
1055 1775 m
1055 1765 l
1107 1775 m
1107 1765 l
1148 1775 m
1148 1765 l
1181 1775 m
1181 1765 l
1209 1775 m
1209 1765 l
1234 1775 m
1234 1765 l
1255 1775 m
1255 1765 l
1275 1775 m
1275 1765 l
1401 1775 m
1401 1765 l
1475 1775 m
1475 1765 l
1527 1775 m
1527 1765 l
1568 1775 m
1568 1765 l
1601 1775 m
1601 1765 l
1629 1775 m
1629 1765 l
1654 1775 m
1654 1765 l
1675 1775 m
1675 1765 l
1694 1775 m
1694 1765 l
1821 1775 m
1821 1765 l
1895 1775 m
1895 1765 l
1947 1775 m
1947 1765 l
1988 1775 m
1988 1765 l
2021 1775 m
2021 1765 l
2049 1775 m
2049 1765 l
2074 1775 m
2074 1765 l
2095 1775 m
2095 1765 l
2115 1775 m
2115 1765 l
s
435 375 m
435 395 l
854 375 m
854 395 l
1275 375 m
1275 395 l
1694 375 m
1694 395 l
2115 375 m
2115 395 l
435 1775 m
435 1755 l
854 1775 m
854 1755 l
1275 1775 m
1275 1755 l
1694 1775 m
1694 1755 l
2115 1775 m
2115 1755 l
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
435 325 m
gsave
435 325 translate
0 rotate
0 -20  m
(1) CS
(1) show
grestore
newpath
854 325 m
gsave
854 325 translate
0 rotate
0 -20  m
(10) CS
(10) show
grestore
newpath
1275 325 m
gsave
1275 325 translate
0 rotate
0 -20  m
(100) CS
(100) show
grestore
newpath
1694 325 m
gsave
1694 325 translate
0 rotate
0 -20  m
(1000) CS
(1000) show
grestore
newpath
2115 325 m
gsave
2115 325 translate
0 rotate
0 -20  m
(10000) CS
(10000) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1275 225 m
gsave
1275 225 translate
0 rotate
0 0  m
(transfer size \(kbytes\)) CS
(transfer size \(kbytes\)) show
grestore
newpath
435 375 m
445 375 l
435 515 m
445 515 l
435 655 m
445 655 l
435 795 m
445 795 l
435 935 m
445 935 l
435 1075 m
445 1075 l
435 1215 m
445 1215 l
435 1355 m
445 1355 l
435 1495 m
445 1495 l
435 1635 m
445 1635 l
435 1775 m
445 1775 l
2115 375 m
2105 375 l
2115 515 m
2105 515 l
2115 655 m
2105 655 l
2115 795 m
2105 795 l
2115 935 m
2105 935 l
2115 1075 m
2105 1075 l
2115 1215 m
2105 1215 l
2115 1355 m
2105 1355 l
2115 1495 m
2105 1495 l
2115 1635 m
2105 1635 l
2115 1775 m
2105 1775 l
s
435 375 m
455 375 l
435 655 m
455 655 l
435 935 m
455 935 l
435 1215 m
455 1215 l
435 1495 m
455 1495 l
435 1775 m
455 1775 l
2115 375 m
2095 375 l
2115 655 m
2095 655 l
2115 935 m
2095 935 l
2115 1215 m
2095 1215 l
2115 1495 m
2095 1495 l
2115 1775 m
2095 1775 l
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
397 375 m
gsave
397 375 translate
0 rotate
0 -20  m
(0) RJ
(0) show
grestore
newpath
397 655 m
gsave
397 655 translate
0 rotate
0 -20  m
(100) RJ
(100) show
grestore
newpath
397 935 m
gsave
397 935 translate
0 rotate
0 -20  m
(200) RJ
(200) show
grestore
newpath
397 1215 m
gsave
397 1215 translate
0 rotate
0 -20  m
(300) RJ
(300) show
grestore
newpath
397 1495 m
gsave
397 1495 translate
0 rotate
0 -20  m
(400) RJ
(400) show
grestore
newpath
397 1775 m
gsave
397 1775 translate
0 rotate
0 -20  m
(500) RJ
(500) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
246 1075 m
gsave
246 1075 translate
90 rotate
0 0  m
(bandwidth \(MB/sec\)) CS
(bandwidth \(MB/sec\)) show
grestore
newpath
687 486 m
814 508 l
940 523 l
1067 515 l
1193 480 l
1320 452 l
1446 447 l
1572 446 l
1699 447 l
1825 446 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 486 fa
14 814 508 fa
14 940 523 fa
14 1067 515 fa
14 1193 480 fa
14 1320 452 fa
14 1446 447 fa
14 1572 446 fa
14 1699 447 fa
14 1825 446 fa
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
687 466 m
814 495 l
940 518 l
1067 535 l
1193 539 l
1320 508 l
1446 495 l
1572 494 l
1699 494 l
1825 494 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
12 687 466 fsq
12 814 495 fsq
12 940 518 fsq
12 1067 535 fsq
12 1193 539 fsq
12 1320 508 fsq
12 1446 495 fsq
12 1572 494 fsq
12 1699 494 fsq
12 1825 494 fsq
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
0.000000 1.000000 0.000000 setrgbcolor
687 500 m
814 559 l
940 624 l
1067 678 l
1193 680 l
1320 539 l
1446 496 l
1572 494 l
1699 494 l
1825 494 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 500 fdi
14 814 559 fdi
14 940 624 fdi
14 1067 678 fdi
14 1193 680 fdi
14 1320 539 fdi
14 1446 496 fdi
14 1572 494 fdi
14 1699 494 fdi
14 1825 494 fdi
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
0.000000 0.000000 1.000000 setrgbcolor
687 569 m
814 739 l
940 912 l
1067 1069 l
1193 1354 l
1320 1500 l
1446 1518 l
1572 1508 l
1699 1508 l
1825 1491 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 569 ft1
14 814 739 ft1
14 940 912 ft1
14 1067 1069 ft1
14 1193 1354 ft1
14 1320 1500 ft1
14 1446 1518 ft1
14 1572 1508 ft1
14 1699 1508 ft1
14 1825 1491 ft1
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
435 375 m
435 1775 l
2115 1775 l
2115 375 l
435 375 l
s
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1654 1215 m
1794 1215 l
s
14 1654 1215 fa
14 1794 1215 fa
1829 1215 m
gsave
1829 1215 translate
0 rotate
0 -20  m
(copy) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
1654 1141 m
1794 1141 l
s
12 1654 1141 fsq
12 1794 1141 fsq
0.000000 0.000000 0.000000 setrgbcolor
1829 1141 m
gsave
1829 1141 translate
0 rotate
0 -20  m
(transfer) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 1.000000 0.000000 setrgbcolor
1654 1067 m
1794 1067 l
s
14 1654 1067 fdi
14 1794 1067 fdi
0.000000 0.000000 0.000000 setrgbcolor
1829 1067 m
gsave
1829 1067 translate
0 rotate
0 -20  m
(loan) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 1.000000 setrgbcolor
1654 993 m
1794 993 l
s
14 1654 993 ft1
14 1794 993 ft1
0.000000 0.000000 0.000000 setrgbcolor
1829 993 m
gsave
1829 993 translate
0 rotate
0 -20  m
(both) show
grestore
newpath
end
showpage
%%EndDocument
 @endspecial -75 1336 a Fg(Figure)18 b(7:)24 b(Comparison)17
b(of)h(cop)o(y)-5 b(,)17 b(transfer)m(,)g(loan,)h(and)g(both)g(pro-)-75
1436 y(cedures)h(for)h(mo)o(ving)e(data)i(o)o(v)o(er)f(a)i(pipe)-75
1792 y(and)15 b(loanout)f(le)n(v)o(els)i(of)n(f)f(at)h(43)f(MB/sec)h
(as)h(the)e(transfer)g(size)h(is)h(in-)-75 1892 y(creased.)23
b(Since)15 b(both)g(these)g(tests)h(still)h(ha)n(v)o(e)e(data)g(cop)o
(ying)e(at)j(one)-75 1991 y(end)27 b(of)g(the)g(pipe,)i(the)o(y)e(are)g
(ef)n(fected)f(by)h(caching)f(in)i(the)f(same)-75 2091
y(w)o(ay)k(as)h(data)g(cop)o(ying,)g(ho)n(we)n(v)o(er)d(their)i
(bandwidth)e(is)k(almost)-75 2190 y(double)22 b(that)i(of)f(cop)o(ying)
f(because)h(the)o(y)g(are)h(only)f(touching)f(the)-75
2290 y(data)h(on)f(one)g(end.)32 b(The)22 b(page)g(loanout)g(curv)o(e)f
(rises)j(higher)d(than)-75 2390 y(the)g(page)f(transfer)g(curv)o(e)g
(in)h(mid-range)d(transfer)i(sizes)i(because)-75 2489
y(page)30 b(loanout)g(has)h(less)h(o)o(v)o(erhead)c(than)i(page)g
(transfer)-5 b(.)57 b(P)o(age)-75 2589 y(transfer)16
b(has)g(the)h(added)e(complication)g(of)h(ha)n(ving)f(to)i(replace)f
(the)-75 2689 y(data)25 b(page)f(remo)o(v)o(ed)f(from)h(cluster)g(mb)n
(ufs)h(with)g(another)f(page.)-75 2788 y(The)c(bandwidth)f(of)h(the)h
(test)g(in)g(which)f(both)g(loanout)f(and)h(trans-)-75
2888 y(fer)j(are)g(used)g(rises)i(sharply)d(and)h(le)n(v)o(els)g(of)n
(f)g(at)h(400)e(MB/sec)i(for)-75 2988 y(lar)o(ge)f(transfer)g(sizes.)38
b(In)24 b(this)h(case)f(the)g(data)g(is)h(not)f(touched)f(or)-75
3087 y(copied)c(at)i(all,)f(instead)g(a)h(cop)o(y-on-write)c(mapping)i
(to)h(the)g(send-)-75 3187 y(ing)g(process')f(page)h(is)h(added)e(to)h
(the)g(recei)n(ving)f(process.)-75 3442 y Fh(5.4)99 b(Map)25
b(Entry)h(P)o(assing)e(P)n(erf)n(ormance)-75 3604 y Fg(Data)29
b(passing)g(between)f(programs)g(through)f(pipes)i(or)f(sock)o(ets)-75
3703 y(is)h(quite)f(common)e(on)i(Unix-lik)o(e)f(systems.)50
b(If)28 b(an)g(application)-75 3803 y(passes)f(lar)o(ge)f(amounts)f(of)
i(data)f(o)o(v)o(er)f(a)i(pipe,)h(it)f(might)f(bene\002t)-75
3902 y(from)15 b(map)g(entry)g(passing.)23 b(T)-7 b(o)16
b(measure)f(the)h(ef)n(fect)f(of)h(map)f(entry)-75 4002
y(passing,)j(we)i(wrote)e(tw)o(o)h(test)h(programs)d(that)h(pass)i(a)f
(\002x)o(ed-sized)-75 4102 y(chunk)27 b(of)i(data)g(between)f(tw)o(o)h
(processes)f(a)i(speci\002ed)e(number)-75 4201 y(of)23
b(times.)34 b(One)23 b(test)h(program)d(passes)j(data)f(between)f
(processes)-75 4301 y(by)f(sending)f(it)j(o)o(v)o(er)d(a)i(local)f
(sock)o(et.)29 b(This)21 b(causes)h(the)g(k)o(ernel)e(to)-75
4401 y(cop)o(y)e(the)i(data)f(from)f(the)h(sending)f(process)h(into)g
(an)g(mb)n(uf)f(chain,)-75 4500 y(and)29 b(then)f(to)i(cop)o(y)e(it)i
(from)e(the)h(mb)n(uf)f(chain)h(to)g(the)g(recei)n(ving)-75
4600 y(process.)39 b(The)24 b(other)g(test)i(program)d(passes)j(data)f
(between)f(pro-)-75 4699 y(cesses)j(by)f(using)f(map)g(entry)h
(passing.)41 b(The)26 b(test)h(program)d(can)-75 4799
y(optionally)d(\223touch\224)h(the)g(data)h(after)g(it)g(arri)n(v)o(es)
f(to)h(simulate)g(data)-75 4899 y(processing.)8 5001
y(Each)j(test)i(program)c(w)o(as)j(run)f(using)g(transfer)g(sizes)h
(ranging)-75 5101 y(from)15 b(4K)i(to)f(4096K.)f(The)h(number)f(of)h
(times)h(the)f(data)h(w)o(as)g(trans-)-75 5201 y(ferred)23
b(from)g(parent)g(to)h(child)g(process)f(and)h(back)f(w)o(as)i
(adjusted)-75 5300 y(so)18 b(that)g(the)g(test)h(program)d(ran)h(for)g
(at)i(least)f(thirty)f(seconds.)24 b(Each)-75 5400 y(run)e(of)h(the)g
(program)e(w)o(as)i(timed)g(so)g(that)h(the)e(bandwidth)g(could)2192
1153 y @beginspecial 43 @llx 43 @lly 528 @urx 434 @ury
1940 @rwi @setspecial
%%BeginDocument: ../plots/plot4/Plot4a.eps
80 dict begin
/languagelevel where
{pop /gs_languagelevel languagelevel def}
{/gs_languagelevel 1 def} ifelse
gs_languagelevel 1 gt {
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<0000000000000000000000000000000000000000000000000000000000000000>} image end }
			>> 	matrix makepattern /Pat0 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111000044440000111100004444000011110000444400001111000044440000>} image end }
			>> 	matrix makepattern /Pat1 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111444411114444111144441111444411114444111144441111444411114444>} image end }
			>> 	matrix makepattern /Pat2 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555>} image end }
			>> 	matrix makepattern /Pat3 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbb>} image end }
			>> 	matrix makepattern /Pat4 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffff>} image end }
			>> 	matrix makepattern /Pat5 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<f77dffffbeeffffff77dffffbeeffffff77dffffbeeffffff77dffffbeefffff>} image end }
			>> 	matrix makepattern /Pat6 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff>} image end }
			>> 	matrix makepattern /Pat7 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<e1e1f0f078783c3c1e1e0f0f8787c3c3e1e1f0f078783c3c1e1e0f0f8787c3c3>} image end }
			>> 	matrix makepattern /Pat8 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<87870f0f1e1e3c3c7878f0f0e1e1c3c387870f0f1e1e3c3c7878f0f0e1e1c3c3>} image end }
			>> 	matrix makepattern /Pat9 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc>} image end }
			>> 	matrix makepattern /Pat10 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<00000000ffffffff00000000ffffffff00000000ffffffff00000000ffffffff>} image end }
			>> 	matrix makepattern /Pat11 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e>} image end }
			>> 	matrix makepattern /Pat12 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebf>} image end }
			>> 	matrix makepattern /Pat13 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7e>} image end }
			>> 	matrix makepattern /Pat14 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fffffbdff3dfebdfdbdfbbdf7bdffbdefbddfbdbfbd7fbcffbdfffffffffffff>} image end }
			>> 	matrix makepattern /Pat15 exch def 
}{
/Pat0 { 0.000000 setgray } def
/Pat1 { 0.062500 setgray } def
/Pat2 { 0.125000 setgray } def
/Pat3 { 0.187500 setgray } def
/Pat4 { 0.250000 setgray } def
/Pat5 { 0.312500 setgray } def
/Pat6 { 0.375000 setgray } def
/Pat7 { 0.437500 setgray } def
/Pat8 { 0.500000 setgray } def
/Pat9 { 0.562500 setgray } def
/Pat10 { 0.625000 setgray } def
/Pat11 { 0.687500 setgray } def
/Pat12 { 0.750000 setgray } def
/Pat13 { 0.812500 setgray } def
/Pat14 { 0.875000 setgray } def
/Pat15 { 0.937500 setgray } def
/setpattern { } def
} ifelse
/m {moveto} bind def
/l {lineto} bind def
/s {stroke} bind def
% Symbol fill
/f { gsave fill grestore stroke } bind def
% Opaque symbol
/o { gsave 1.000000 1.000000 1.000000 setrgbcolor
     fill grestore stroke } bind def
% Circle symbol
/a { 3 -1 roll 0 360 arc } bind def
/da { a s } bind def
/fa { a f } bind def
/oa { a o } bind def
% Square symbol
/sq { moveto dup dup rmoveto 2 mul
      dup neg 0 rlineto dup neg 0 exch rlineto
      0 rlineto closepath } bind def
/dsq { sq s } bind def
/fsq { sq f } bind def
/osq { sq o } bind def
% Triangle symbols
/t1 { moveto dup 0 exch rmoveto
      dup neg dup 2 mul rlineto 2 mul 0 rlineto
      closepath } bind def
/dt1 { t1 s } bind def
/ft1 { t1 f } bind def
/ot1 { t1 o } bind def
/t2 { moveto dup neg 0 rmoveto
      dup dup 2 mul exch neg rlineto
      2 mul 0 exch rlineto closepath } bind def
/dt2 { t2 s } bind def
/ft2 { t2 f } bind def
/ot2 { t2 o } bind def
/t3 { moveto dup neg 0 exch rmoveto
      dup dup 2 mul rlineto neg 2 mul 0 rlineto
      closepath } bind def
/dt3 { t3 s } bind def
/ft3 { t3 f } bind def
/ot3 { t3 o } bind def
/t4 { moveto dup 0 rmoveto
      dup dup -2 mul exch rlineto
      -2 mul 0 exch rlineto closepath } bind def
/dt4 { t4 s } bind def
/ft4 { t4 f } bind def
/ot4 { t4 o } bind def
% Diamond symbol
/di { moveto dup 0 exch rmoveto
      dup neg dup rlineto dup dup neg rlineto
      dup dup rlineto closepath } bind def
/ddi { di s } bind def
/fdi { di f } bind def
/odi { di o } bind def
% Plus symbol
/pl { dup 0 rmoveto dup -2 mul 0 rlineto
      dup dup rmoveto -2 mul 0 exch rlineto
    } bind def
/dpl { m pl s } bind def
% x symbol
/x { dup dup rmoveto dup -2 mul dup rlineto
     2 mul dup 0 rmoveto dup neg exch rlineto
   } bind def
/dx { m x s } bind def
% Splat symbol
/dsp { m dup pl dup 0 exch rmoveto 0.707 mul x s
     } bind def
/RJ {
 stringwidth neg exch neg exch
 rmoveto
} bind def
/CS {
 stringwidth
 2 div neg exch 2 div neg exch
 rmoveto
} bind def
0.24 0.24 scale
1 setlinecap

	mark             
	/ISOLatin1Encoding 
	  8#000 1 8#054 {StandardEncoding exch get} for 
	  /minus 
	  8#056 1 8#217 {StandardEncoding exch get} for 
	  /dotlessi 
	  8#301 1 8#317 {StandardEncoding exch get} for 
	  /space /exclamdown /cent /sterling /currency /yen /brokenbar /section 
	  /dieresis /copyright /ordfeminine /guillemotleft /logicalnot /hyphen 
	  /registered /macron /degree /plusminus /twosuperior /threesuperior /acute 
	  /mu /paragraph /periodcentered /cedilla /onesuperior /ordmasculine 
	  /guillemotright /onequarter /onehalf /threequarters /questiondown /Agrave 
	  /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla /Egrave /Eacute
	  /Ecircumflex /Edieresis /Igrave /Iacute /Icircumflex /Idieresis /Eth /Ntilde
	  /Ograve /Oacute /Ocircumflex /Otilde /Odieresis /multiply /Oslash /Ugrave 
	  /Uacute /Ucircumflex /Udieresis /Yacute /Thorn /germandbls /agrave /aacute 
	  /acircumflex /atilde /adieresis /aring /ae /ccedilla /egrave /eacute 
	  /ecircumflex /edieresis /igrave /iacute /icircumflex /idieresis /eth /ntilde
	  /ograve /oacute /ocircumflex /otilde /odieresis /divide /oslash /ugrave 
	  /uacute /ucircumflex /udieresis /yacute /thorn /ydieresis 
	  /ISOLatin1Encoding where not {256 array astore def} if 
	 cleartomark 

	/makeISOEncoded 
	{ findfont /curfont exch def 
	  /newfont curfont maxlength dict def  
	  /ISOLatin1 (-ISOLatin1) def
	  /curfontname curfont /FontName get dup length string cvs def 
	  /newfontname curfontname length ISOLatin1 length add string 
    	 dup 0                  curfontname putinterval 
    	 dup curfontname length ISOLatin1   putinterval 
	  def 
	  curfont   
	  { exch dup /FID ne  
    	{ dup /Encoding eq  
    	  { exch pop ISOLatin1Encoding exch }  
    	  if  
    	  dup /FontName eq  
    	  { exch pop newfontname exch }  
    	  if  
    	  exch newfont 3 1 roll put  
    	}  
    	{ pop pop }  
    	ifelse  
	  }  
	  forall 
	  newfontname newfont definefont 
	} def 

	/Times-Roman makeISOEncoded pop 
	/Times-Bold makeISOEncoded pop 
	/Times-Italic makeISOEncoded pop 
	/Times-BoldItalic makeISOEncoded pop 
	/Helvetica makeISOEncoded pop 
	/Helvetica-Bold makeISOEncoded pop 
	/Helvetica-Oblique makeISOEncoded pop 
	/Helvetica-BoldOblique makeISOEncoded pop 
s
0.000000 0.000000 0.000000 setrgbcolor
1 setlinewidth
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
[] 0 setdash
435 375 m
435 385 l
561 375 m
561 385 l
635 375 m
635 385 l
687 375 m
687 385 l
728 375 m
728 385 l
761 375 m
761 385 l
789 375 m
789 385 l
814 375 m
814 385 l
835 375 m
835 385 l
854 375 m
854 385 l
981 375 m
981 385 l
1055 375 m
1055 385 l
1107 375 m
1107 385 l
1148 375 m
1148 385 l
1181 375 m
1181 385 l
1209 375 m
1209 385 l
1234 375 m
1234 385 l
1255 375 m
1255 385 l
1275 375 m
1275 385 l
1401 375 m
1401 385 l
1475 375 m
1475 385 l
1527 375 m
1527 385 l
1568 375 m
1568 385 l
1601 375 m
1601 385 l
1629 375 m
1629 385 l
1654 375 m
1654 385 l
1675 375 m
1675 385 l
1694 375 m
1694 385 l
1821 375 m
1821 385 l
1895 375 m
1895 385 l
1947 375 m
1947 385 l
1988 375 m
1988 385 l
2021 375 m
2021 385 l
2049 375 m
2049 385 l
2074 375 m
2074 385 l
2095 375 m
2095 385 l
2115 375 m
2115 385 l
435 1775 m
435 1765 l
561 1775 m
561 1765 l
635 1775 m
635 1765 l
687 1775 m
687 1765 l
728 1775 m
728 1765 l
761 1775 m
761 1765 l
789 1775 m
789 1765 l
814 1775 m
814 1765 l
835 1775 m
835 1765 l
854 1775 m
854 1765 l
981 1775 m
981 1765 l
1055 1775 m
1055 1765 l
1107 1775 m
1107 1765 l
1148 1775 m
1148 1765 l
1181 1775 m
1181 1765 l
1209 1775 m
1209 1765 l
1234 1775 m
1234 1765 l
1255 1775 m
1255 1765 l
1275 1775 m
1275 1765 l
1401 1775 m
1401 1765 l
1475 1775 m
1475 1765 l
1527 1775 m
1527 1765 l
1568 1775 m
1568 1765 l
1601 1775 m
1601 1765 l
1629 1775 m
1629 1765 l
1654 1775 m
1654 1765 l
1675 1775 m
1675 1765 l
1694 1775 m
1694 1765 l
1821 1775 m
1821 1765 l
1895 1775 m
1895 1765 l
1947 1775 m
1947 1765 l
1988 1775 m
1988 1765 l
2021 1775 m
2021 1765 l
2049 1775 m
2049 1765 l
2074 1775 m
2074 1765 l
2095 1775 m
2095 1765 l
2115 1775 m
2115 1765 l
s
435 375 m
435 395 l
854 375 m
854 395 l
1275 375 m
1275 395 l
1694 375 m
1694 395 l
2115 375 m
2115 395 l
435 1775 m
435 1755 l
854 1775 m
854 1755 l
1275 1775 m
1275 1755 l
1694 1775 m
1694 1755 l
2115 1775 m
2115 1755 l
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
435 325 m
gsave
435 325 translate
0 rotate
0 -20  m
(1) CS
(1) show
grestore
newpath
854 325 m
gsave
854 325 translate
0 rotate
0 -20  m
(10) CS
(10) show
grestore
newpath
1275 325 m
gsave
1275 325 translate
0 rotate
0 -20  m
(100) CS
(100) show
grestore
newpath
1694 325 m
gsave
1694 325 translate
0 rotate
0 -20  m
(1000) CS
(1000) show
grestore
newpath
2115 325 m
gsave
2115 325 translate
0 rotate
0 -20  m
(10000) CS
(10000) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1275 225 m
gsave
1275 225 translate
0 rotate
0 0  m
(transfer size \(kbytes\)) CS
(transfer size \(kbytes\)) show
grestore
newpath
435 375 m
445 375 l
435 515 m
445 515 l
435 655 m
445 655 l
435 795 m
445 795 l
435 935 m
445 935 l
435 1075 m
445 1075 l
435 1215 m
445 1215 l
435 1355 m
445 1355 l
435 1495 m
445 1495 l
435 1635 m
445 1635 l
435 1775 m
445 1775 l
2115 375 m
2105 375 l
2115 515 m
2105 515 l
2115 655 m
2105 655 l
2115 795 m
2105 795 l
2115 935 m
2105 935 l
2115 1075 m
2105 1075 l
2115 1215 m
2105 1215 l
2115 1355 m
2105 1355 l
2115 1495 m
2105 1495 l
2115 1635 m
2105 1635 l
2115 1775 m
2105 1775 l
s
435 375 m
455 375 l
435 655 m
455 655 l
435 935 m
455 935 l
435 1215 m
455 1215 l
435 1495 m
455 1495 l
435 1775 m
455 1775 l
2115 375 m
2095 375 l
2115 655 m
2095 655 l
2115 935 m
2095 935 l
2115 1215 m
2095 1215 l
2115 1495 m
2095 1495 l
2115 1775 m
2095 1775 l
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
397 375 m
gsave
397 375 translate
0 rotate
0 -20  m
(0) RJ
(0) show
grestore
newpath
397 655 m
gsave
397 655 translate
0 rotate
0 -20  m
(20) RJ
(20) show
grestore
newpath
397 935 m
gsave
397 935 translate
0 rotate
0 -20  m
(40) RJ
(40) show
grestore
newpath
397 1215 m
gsave
397 1215 translate
0 rotate
0 -20  m
(60) RJ
(60) show
grestore
newpath
397 1495 m
gsave
397 1495 translate
0 rotate
0 -20  m
(80) RJ
(80) show
grestore
newpath
397 1775 m
gsave
397 1775 translate
0 rotate
0 -20  m
(100) RJ
(100) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
246 1075 m
gsave
246 1075 translate
90 rotate
0 0  m
(bandwidth \(MB/sec\)) CS
(bandwidth \(MB/sec\)) show
grestore
newpath
687 842 m
814 754 l
940 728 l
1067 726 l
1193 692 l
1320 613 l
1446 554 l
1572 546 l
1699 545 l
1825 545 l
1952 545 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 842 fa
14 814 754 fa
14 940 728 fa
14 1067 726 fa
14 1193 692 fa
14 1320 613 fa
14 1446 554 fa
14 1572 546 fa
14 1699 545 fa
14 1825 545 fa
14 1952 545 fa
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
687 699 m
814 920 l
940 1218 l
1067 1499 l
1193 1718 l
1320 1338 l
1446 1070 l
1572 861 l
1699 857 l
1825 855 l
1952 855 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
12 687 699 fsq
12 814 920 fsq
12 940 1218 fsq
12 1067 1499 fsq
12 1193 1718 fsq
12 1320 1338 fsq
12 1446 1070 fsq
12 1572 861 fsq
12 1699 857 fsq
12 1825 855 fsq
12 1952 855 fsq
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
435 375 m
435 1775 l
2115 1775 l
2115 375 l
435 375 l
s
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1694 1635 m
1834 1635 l
s
14 1694 1635 fa
14 1834 1635 fa
1869 1635 m
gsave
1869 1635 translate
0 rotate
0 -20  m
(copy) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
1694 1561 m
1834 1561 l
s
12 1694 1561 fsq
12 1834 1561 fsq
0.000000 0.000000 0.000000 setrgbcolor
1869 1561 m
gsave
1869 1561 translate
0 rotate
0 -20  m
(m.e.p.) show
grestore
newpath
end
showpage
%%EndDocument
 @endspecial 2025 1336 a(Figure)39 b(8:)66 b(Comparison)38
b(of)i(cop)o(y)f(and)h(map)g(entry)f(passing)2025 1436
y(\(m.e.p.\))23 b(transferring)18 b(memory)h(between)g(tw)o(o)i
(processes)2025 1795 y(be)f(determined.)2108 1899 y(As)k(sho)n(wn)e(in)
h(Figure)f(8,)i(the)f(bandwidth)e(curv)o(es)g(for)i(the)g(test)2025
1999 y(program)c(that)i(uses)g(data)g(cop)o(ying)e(via)i(the)g(sock)o
(et)g(pair)g(start)g(of)n(f)2025 2098 y(near)15 b(35)h(MB/sec)h(for)e
(a)h(one)g(page)f(transfer)g(size.)24 b(The)15 b(bandwidth)2025
2198 y(decreases)26 b(as)g(the)h(transfer)e(size)h(increases)g(due)g
(to)g(caching)f(ef-)2025 2298 y(fects.)35 b(The)24 b(bandwidth)d(of)j
(the)f(data-cop)o(ying)e(tests)k(le)n(v)o(el)e(of)n(f)g(at)2025
2397 y(12)18 b(MB/sec.)26 b(On)18 b(the)h(other)f(hand,)g(the)g
(bandwidth)f(curv)o(e)g(for)i(the)2025 2497 y(map)28
b(entry)f(passing)h(test)h(program)d(peaks)i(around)e(96)i(MB/sec)2025
2597 y(for)23 b(a)h(transfer)f(size)h(of)g(64K)f(and)g(then)h(caching)e
(ef)n(fects)i(on)f(k)o(er)n(-)2025 2696 y(nel)37 b(VM)h(data)f
(structures)g(cause)g(it)h(to)f(f)o(all)h(and)f(le)n(v)o(el)g(of)n(f)f
(at)2025 2796 y(34)20 b(MB/sec.)2108 2900 y(If)f(the)g(application)f
(does)g(not)h(touch)f(the)h(data)g(after)g(it)h(is)g(trans-)2025
3000 y(fered)36 b(then)h(the)g(bandwidth)e(for)h(data)h(cop)o(ying)e
(le)n(v)o(els)i(of)n(f)f(at)2025 3099 y(18)27 b(MB/sec)i(rather)d(than)
i(12)f(MB/sec.)48 b(On)28 b(the)f(other)g(hand,)h(if)2025
3199 y(the)18 b(map)g(entry)f(passing)h(test)g(program)e(does)i(not)g
(touch)f(the)h(data,)2025 3299 y(then)27 b(the)h(bandwidth)e(rises)j
(rapidly)-5 b(,)28 b(reaching)e(18500)g(MB/sec)2025 3398
y(for)h(a)h(transfer)f(size)i(of)e(4096K.)f(This)i(high)f(bandwidth)f
(occurs)2025 3498 y(because)33 b(the)g(data)g(being)g(transfered)f(is)i
(accessed)f(neither)g(by)2025 3597 y(the)20 b(application)f(program)f
(nor)i(the)g(k)o(ernel,)f(so)i(the)f(data)h(is)g(ne)n(v)o(er)2025
3697 y(loaded)e(into)h(the)g(processor)f(from)g(main)h(memory)-5
b(.)2108 3801 y(Another)17 b(test)i(program)d(we)j(wrote)f(combines)f
(the)h(use)h(of)f(map)2025 3901 y(entry)h(passing)g(with)h(page)f
(loanout.)24 b(The)19 b(test)i(program)c(consists)2025
4001 y(of)e(three)g(processes.)23 b(The)15 b(\002rst)h(process)f
(allocates)g(and)g(initializes)2025 4100 y(a)32 b(data)g(b)n(uf)n(fer)e
(of)h(a)h(speci\002ed)f(size)i(and)e(then)g(sends)g(it)i(to)f(the)2025
4200 y(second)22 b(process.)32 b(The)22 b(second)g(process)g
(modi\002es)g(the)h(data)f(and)2025 4299 y(then)16 b(sends)h(it)g(to)g
(the)g(third)f(process.)24 b(The)16 b(third)g(process)g(recei)n(v)o(es)
2025 4399 y(the)f(data)h(and)f(writes)h(it)g(to)g(a)f(null)h(protocol)d
(sock)o(et.)24 b(Then)14 b(the)i(\002rst)2025 4499 y(process)21
b(can)f(generate)g(another)f(b)n(uf)n(fers)h(w)o(orth)h(of)f(data.)28
b(Such)20 b(a)2025 4598 y(data)h(pipeline)e(application)g(is)j(similar)
f(to)g(the)f(multimedia)g(\223I/O-)2025 4698 y(pipeline)f(model\224)g
(described)g(in)i([15)n(].)2108 4802 y(In)k(the)h(test)h(program)c(the)
j(data)f(can)h(be)f(e)o(xchanged)e(between)2025 4902
y(the)28 b(processes)g(either)g(with)g(data)g(cop)o(ying)f(or)g(with)i
(map)e(entry)2025 5001 y(passing.)d(The)17 b(\002nal)g(process)g(can)g
(write)h(the)f(data)g(out)g(with)h(either)2025 5101 y(data)g(cop)o
(ying)d(or)j(page)f(loanout.)23 b(W)-7 b(e)18 b(ran)g(the)f(test)i
(program)c(with)2025 5201 y(transfer)26 b(sizes)i(from)d(4K)i(\(one)f
(page\))g(to)h(4096K.)e(The)h(number)2025 5300 y(of)20
b(transfers)g(w)o(as)h(adjusted)f(so)h(that)f(the)h(test)g(program)d
(ran)i(for)g(at)2025 5400 y(least)k(thirty)f(seconds.)35
b(The)23 b(results)h(of)f(the)h(the)f(tests)i(are)e(sho)n(wn)p
eop
%%Page: 13 13
13 12 bop 112 1153 a @beginspecial 55 @llx 43 @lly 528
@urx 434 @ury 1892 @rwi @setspecial
%%BeginDocument: ../plots/plot5/Plot5.eps
80 dict begin
/languagelevel where
{pop /gs_languagelevel languagelevel def}
{/gs_languagelevel 1 def} ifelse
gs_languagelevel 1 gt {
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<0000000000000000000000000000000000000000000000000000000000000000>} image end }
			>> 	matrix makepattern /Pat0 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111000044440000111100004444000011110000444400001111000044440000>} image end }
			>> 	matrix makepattern /Pat1 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<1111444411114444111144441111444411114444111144441111444411114444>} image end }
			>> 	matrix makepattern /Pat2 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555aaaa5555>} image end }
			>> 	matrix makepattern /Pat3 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbbeeeebbbb>} image end }
			>> 	matrix makepattern /Pat4 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<eeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffffeeeeffffbbbbffff>} image end }
			>> 	matrix makepattern /Pat5 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<f77dffffbeeffffff77dffffbeeffffff77dffffbeeffffff77dffffbeefffff>} image end }
			>> 	matrix makepattern /Pat6 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff>} image end }
			>> 	matrix makepattern /Pat7 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<e1e1f0f078783c3c1e1e0f0f8787c3c3e1e1f0f078783c3c1e1e0f0f8787c3c3>} image end }
			>> 	matrix makepattern /Pat8 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<87870f0f1e1e3c3c7878f0f0e1e1c3c387870f0f1e1e3c3c7878f0f0e1e1c3c3>} image end }
			>> 	matrix makepattern /Pat9 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc>} image end }
			>> 	matrix makepattern /Pat10 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<00000000ffffffff00000000ffffffff00000000ffffffff00000000ffffffff>} image end }
			>> 	matrix makepattern /Pat11 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e7e7ebdbddbdbe7e7e7e7dbdbbdbd7e7e>} image end }
			>> 	matrix makepattern /Pat12 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebfbfdfdfefeff7f7fbfbfdfd7e7ebf>} image end }
			>> 	matrix makepattern /Pat13 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7efbfdf7fbeff7dfefbfdf7ebffd7e>} image end }
			>> 	matrix makepattern /Pat14 exch def 
<</PaintType 1 /PatternType 1 /TilingType 1
			/BBox [0 0 12 12] /XStep 12 /YStep 12 /PaintProc{ begin 
			12 12 scale 16 16 1 [16 0 0 16 0 0] 
{<fffffbdff3dfebdfdbdfbbdf7bdffbdefbddfbdbfbd7fbcffbdfffffffffffff>} image end }
			>> 	matrix makepattern /Pat15 exch def 
}{
/Pat0 { 0.000000 setgray } def
/Pat1 { 0.062500 setgray } def
/Pat2 { 0.125000 setgray } def
/Pat3 { 0.187500 setgray } def
/Pat4 { 0.250000 setgray } def
/Pat5 { 0.312500 setgray } def
/Pat6 { 0.375000 setgray } def
/Pat7 { 0.437500 setgray } def
/Pat8 { 0.500000 setgray } def
/Pat9 { 0.562500 setgray } def
/Pat10 { 0.625000 setgray } def
/Pat11 { 0.687500 setgray } def
/Pat12 { 0.750000 setgray } def
/Pat13 { 0.812500 setgray } def
/Pat14 { 0.875000 setgray } def
/Pat15 { 0.937500 setgray } def
/setpattern { } def
} ifelse
/m {moveto} bind def
/l {lineto} bind def
/s {stroke} bind def
% Symbol fill
/f { gsave fill grestore stroke } bind def
% Opaque symbol
/o { gsave 1.000000 1.000000 1.000000 setrgbcolor
     fill grestore stroke } bind def
% Circle symbol
/a { 3 -1 roll 0 360 arc } bind def
/da { a s } bind def
/fa { a f } bind def
/oa { a o } bind def
% Square symbol
/sq { moveto dup dup rmoveto 2 mul
      dup neg 0 rlineto dup neg 0 exch rlineto
      0 rlineto closepath } bind def
/dsq { sq s } bind def
/fsq { sq f } bind def
/osq { sq o } bind def
% Triangle symbols
/t1 { moveto dup 0 exch rmoveto
      dup neg dup 2 mul rlineto 2 mul 0 rlineto
      closepath } bind def
/dt1 { t1 s } bind def
/ft1 { t1 f } bind def
/ot1 { t1 o } bind def
/t2 { moveto dup neg 0 rmoveto
      dup dup 2 mul exch neg rlineto
      2 mul 0 exch rlineto closepath } bind def
/dt2 { t2 s } bind def
/ft2 { t2 f } bind def
/ot2 { t2 o } bind def
/t3 { moveto dup neg 0 exch rmoveto
      dup dup 2 mul rlineto neg 2 mul 0 rlineto
      closepath } bind def
/dt3 { t3 s } bind def
/ft3 { t3 f } bind def
/ot3 { t3 o } bind def
/t4 { moveto dup 0 rmoveto
      dup dup -2 mul exch rlineto
      -2 mul 0 exch rlineto closepath } bind def
/dt4 { t4 s } bind def
/ft4 { t4 f } bind def
/ot4 { t4 o } bind def
% Diamond symbol
/di { moveto dup 0 exch rmoveto
      dup neg dup rlineto dup dup neg rlineto
      dup dup rlineto closepath } bind def
/ddi { di s } bind def
/fdi { di f } bind def
/odi { di o } bind def
% Plus symbol
/pl { dup 0 rmoveto dup -2 mul 0 rlineto
      dup dup rmoveto -2 mul 0 exch rlineto
    } bind def
/dpl { m pl s } bind def
% x symbol
/x { dup dup rmoveto dup -2 mul dup rlineto
     2 mul dup 0 rmoveto dup neg exch rlineto
   } bind def
/dx { m x s } bind def
% Splat symbol
/dsp { m dup pl dup 0 exch rmoveto 0.707 mul x s
     } bind def
/RJ {
 stringwidth neg exch neg exch
 rmoveto
} bind def
/CS {
 stringwidth
 2 div neg exch 2 div neg exch
 rmoveto
} bind def
0.24 0.24 scale
1 setlinecap

	mark             
	/ISOLatin1Encoding 
	  8#000 1 8#054 {StandardEncoding exch get} for 
	  /minus 
	  8#056 1 8#217 {StandardEncoding exch get} for 
	  /dotlessi 
	  8#301 1 8#317 {StandardEncoding exch get} for 
	  /space /exclamdown /cent /sterling /currency /yen /brokenbar /section 
	  /dieresis /copyright /ordfeminine /guillemotleft /logicalnot /hyphen 
	  /registered /macron /degree /plusminus /twosuperior /threesuperior /acute 
	  /mu /paragraph /periodcentered /cedilla /onesuperior /ordmasculine 
	  /guillemotright /onequarter /onehalf /threequarters /questiondown /Agrave 
	  /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla /Egrave /Eacute
	  /Ecircumflex /Edieresis /Igrave /Iacute /Icircumflex /Idieresis /Eth /Ntilde
	  /Ograve /Oacute /Ocircumflex /Otilde /Odieresis /multiply /Oslash /Ugrave 
	  /Uacute /Ucircumflex /Udieresis /Yacute /Thorn /germandbls /agrave /aacute 
	  /acircumflex /atilde /adieresis /aring /ae /ccedilla /egrave /eacute 
	  /ecircumflex /edieresis /igrave /iacute /icircumflex /idieresis /eth /ntilde
	  /ograve /oacute /ocircumflex /otilde /odieresis /divide /oslash /ugrave 
	  /uacute /ucircumflex /udieresis /yacute /thorn /ydieresis 
	  /ISOLatin1Encoding where not {256 array astore def} if 
	 cleartomark 

	/makeISOEncoded 
	{ findfont /curfont exch def 
	  /newfont curfont maxlength dict def  
	  /ISOLatin1 (-ISOLatin1) def
	  /curfontname curfont /FontName get dup length string cvs def 
	  /newfontname curfontname length ISOLatin1 length add string 
    	 dup 0                  curfontname putinterval 
    	 dup curfontname length ISOLatin1   putinterval 
	  def 
	  curfont   
	  { exch dup /FID ne  
    	{ dup /Encoding eq  
    	  { exch pop ISOLatin1Encoding exch }  
    	  if  
    	  dup /FontName eq  
    	  { exch pop newfontname exch }  
    	  if  
    	  exch newfont 3 1 roll put  
    	}  
    	{ pop pop }  
    	ifelse  
	  }  
	  forall 
	  newfontname newfont definefont 
	} def 

	/Times-Roman makeISOEncoded pop 
	/Times-Bold makeISOEncoded pop 
	/Times-Italic makeISOEncoded pop 
	/Times-BoldItalic makeISOEncoded pop 
	/Helvetica makeISOEncoded pop 
	/Helvetica-Bold makeISOEncoded pop 
	/Helvetica-Oblique makeISOEncoded pop 
	/Helvetica-BoldOblique makeISOEncoded pop 
s
0.000000 0.000000 0.000000 setrgbcolor
1 setlinewidth
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
[] 0 setdash
435 375 m
435 385 l
561 375 m
561 385 l
635 375 m
635 385 l
687 375 m
687 385 l
728 375 m
728 385 l
761 375 m
761 385 l
789 375 m
789 385 l
814 375 m
814 385 l
835 375 m
835 385 l
854 375 m
854 385 l
981 375 m
981 385 l
1055 375 m
1055 385 l
1107 375 m
1107 385 l
1148 375 m
1148 385 l
1181 375 m
1181 385 l
1209 375 m
1209 385 l
1234 375 m
1234 385 l
1255 375 m
1255 385 l
1275 375 m
1275 385 l
1401 375 m
1401 385 l
1475 375 m
1475 385 l
1527 375 m
1527 385 l
1568 375 m
1568 385 l
1601 375 m
1601 385 l
1629 375 m
1629 385 l
1654 375 m
1654 385 l
1675 375 m
1675 385 l
1694 375 m
1694 385 l
1821 375 m
1821 385 l
1895 375 m
1895 385 l
1947 375 m
1947 385 l
1988 375 m
1988 385 l
2021 375 m
2021 385 l
2049 375 m
2049 385 l
2074 375 m
2074 385 l
2095 375 m
2095 385 l
2115 375 m
2115 385 l
435 1775 m
435 1765 l
561 1775 m
561 1765 l
635 1775 m
635 1765 l
687 1775 m
687 1765 l
728 1775 m
728 1765 l
761 1775 m
761 1765 l
789 1775 m
789 1765 l
814 1775 m
814 1765 l
835 1775 m
835 1765 l
854 1775 m
854 1765 l
981 1775 m
981 1765 l
1055 1775 m
1055 1765 l
1107 1775 m
1107 1765 l
1148 1775 m
1148 1765 l
1181 1775 m
1181 1765 l
1209 1775 m
1209 1765 l
1234 1775 m
1234 1765 l
1255 1775 m
1255 1765 l
1275 1775 m
1275 1765 l
1401 1775 m
1401 1765 l
1475 1775 m
1475 1765 l
1527 1775 m
1527 1765 l
1568 1775 m
1568 1765 l
1601 1775 m
1601 1765 l
1629 1775 m
1629 1765 l
1654 1775 m
1654 1765 l
1675 1775 m
1675 1765 l
1694 1775 m
1694 1765 l
1821 1775 m
1821 1765 l
1895 1775 m
1895 1765 l
1947 1775 m
1947 1765 l
1988 1775 m
1988 1765 l
2021 1775 m
2021 1765 l
2049 1775 m
2049 1765 l
2074 1775 m
2074 1765 l
2095 1775 m
2095 1765 l
2115 1775 m
2115 1765 l
s
435 375 m
435 395 l
854 375 m
854 395 l
1275 375 m
1275 395 l
1694 375 m
1694 395 l
2115 375 m
2115 395 l
435 1775 m
435 1755 l
854 1775 m
854 1755 l
1275 1775 m
1275 1755 l
1694 1775 m
1694 1755 l
2115 1775 m
2115 1755 l
/Times-Italic-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
435 325 m
gsave
435 325 translate
0 rotate
0 -20  m
(1) CS
(1) show
grestore
newpath
854 325 m
gsave
854 325 translate
0 rotate
0 -20  m
(10) CS
(10) show
grestore
newpath
1275 325 m
gsave
1275 325 translate
0 rotate
0 -20  m
(100) CS
(100) show
grestore
newpath
1694 325 m
gsave
1694 325 translate
0 rotate
0 -20  m
(1000) CS
(1000) show
grestore
newpath
2115 325 m
gsave
2115 325 translate
0 rotate
0 -20  m
(10000) CS
(10000) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1275 225 m
gsave
1275 225 translate
0 rotate
0 0  m
(transfer size \(kbytes\)) CS
(transfer size \(kbytes\)) show
grestore
newpath
435 375 m
445 375 l
435 515 m
445 515 l
435 655 m
445 655 l
435 795 m
445 795 l
435 935 m
445 935 l
435 1075 m
445 1075 l
435 1215 m
445 1215 l
435 1355 m
445 1355 l
435 1495 m
445 1495 l
435 1635 m
445 1635 l
435 1775 m
445 1775 l
2115 375 m
2105 375 l
2115 515 m
2105 515 l
2115 655 m
2105 655 l
2115 795 m
2105 795 l
2115 935 m
2105 935 l
2115 1075 m
2105 1075 l
2115 1215 m
2105 1215 l
2115 1355 m
2105 1355 l
2115 1495 m
2105 1495 l
2115 1635 m
2105 1635 l
2115 1775 m
2105 1775 l
s
435 375 m
455 375 l
435 655 m
455 655 l
435 935 m
455 935 l
435 1215 m
455 1215 l
435 1495 m
455 1495 l
435 1775 m
455 1775 l
2115 375 m
2095 375 l
2115 655 m
2095 655 l
2115 935 m
2095 935 l
2115 1215 m
2095 1215 l
2115 1495 m
2095 1495 l
2115 1775 m
2095 1775 l
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
s
397 375 m
gsave
397 375 translate
0 rotate
0 -20  m
(0) RJ
(0) show
grestore
newpath
397 655 m
gsave
397 655 translate
0 rotate
0 -20  m
(10) RJ
(10) show
grestore
newpath
397 935 m
gsave
397 935 translate
0 rotate
0 -20  m
(20) RJ
(20) show
grestore
newpath
397 1215 m
gsave
397 1215 translate
0 rotate
0 -20  m
(30) RJ
(30) show
grestore
newpath
397 1495 m
gsave
397 1495 translate
0 rotate
0 -20  m
(40) RJ
(40) show
grestore
newpath
397 1775 m
gsave
397 1775 translate
0 rotate
0 -20  m
(50) RJ
(50) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
293 1075 m
gsave
293 1075 translate
90 rotate
0 0  m
(bandwidth \(MB/sec\)) CS
(bandwidth \(MB/sec\)) show
grestore
newpath
687 923 m
814 915 l
940 921 l
1067 896 l
1193 854 l
1320 734 l
1446 689 l
1572 678 l
1699 681 l
1825 681 l
1952 681 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
14 687 923 fa
14 814 915 fa
14 940 921 fa
14 1067 896 fa
14 1193 854 fa
14 1320 734 fa
14 1446 689 fa
14 1572 678 fa
14 1699 681 fa
14 1825 681 fa
14 1952 681 fa
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
687 692 m
814 924 l
940 1165 l
1067 1382 l
1193 1509 l
1320 1324 l
1446 1189 l
1572 1124 l
1699 1090 l
1825 1092 l
1952 1094 l
/Helvetica-ISOLatin1 findfont 44 scalefont setfont
s
12 687 692 fsq
12 814 924 fsq
12 940 1165 fsq
12 1067 1382 fsq
12 1193 1509 fsq
12 1320 1324 fsq
12 1446 1189 fsq
12 1572 1124 fsq
12 1699 1090 fsq
12 1825 1092 fsq
12 1952 1094 fsq
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
0.000000 0.000000 0.000000 setrgbcolor
435 375 m
435 1775 l
2115 1775 l
2115 375 l
435 375 l
s
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1694 1635 m
1834 1635 l
s
14 1694 1635 fa
14 1834 1635 fa
1869 1635 m
gsave
1869 1635 translate
0 rotate
0 -20  m
(copy) show
grestore
newpath
/Helvetica-ISOLatin1 findfont 60 scalefont setfont
1.000000 0.000000 0.000000 setrgbcolor
1694 1561 m
1834 1561 l
s
12 1694 1561 fsq
12 1834 1561 fsq
0.000000 0.000000 0.000000 setrgbcolor
1869 1561 m
gsave
1869 1561 translate
0 rotate
0 -20  m
(pipeline) show
grestore
newpath
end
showpage
%%EndDocument
 @endspecial -75 1336 a Fg(Figure)19 b(9:)26 b(Comparison)18
b(of)i(cop)o(y)g(and)f(map)h(entry)f(passing/page)-75
1436 y(loanout)g(pipeline)-75 1849 y(in)h(Figure)g(9.)8
1981 y(When)45 b(using)h(data)f(cop)o(ying,)50 b(the)c(bandwidth)e
(started)h(at)-75 2081 y(20)21 b(MB/sec)i(and)e(then)g(dropped)e(and)i
(le)n(v)o(eled)g(of)n(f)f(at)j(11)e(MB/sec)-75 2180 y(once)42
b(the)h(cache)f(size)h(w)o(as)h(e)o(xceeded.)90 b(When)43
b(using)f(map)-75 2280 y(entry)35 b(passing)h(and)f(page)h(loanout,)i
(the)e(bandwidth)e(starts)j(at)-75 2380 y(11)16 b(MB/sec)g(for)g(a)g
(page-sized)f(transfer)m(,)g(and)h(increases)g(to)g(a)g(peak)-75
2479 y(of)25 b(40)f(MB/sec)i(for)e(a)i(64K)e(transfer)g(size.)40
b(It)25 b(then)g(le)n(v)o(els)g(of)n(f)f(at)-75 2579
y(26)f(MB/sec)i(as)f(the)f(k)o(ernel)g(data)h(structures)f(e)o(xceed)f
(the)i(size)g(of)-75 2678 y(the)c(cache.)-75 3092 y Fh(5.5)99
b(UVM)25 b(Compar)n(ed)h(to)f(Related)g(W)-7 b(ork)-75
3308 y Fg(Comparing)49 b(the)h(performance)e(of)i(UVM)h(data)f(mo)o(v)o
(ement)-75 3407 y(mechanisms)24 b(with)i(related)f(w)o(ork)f(is)i(dif)n
(\002cult)f(due)g(to)g(the)h(wide)-75 3507 y(v)n(ariety)36
b(of)h(hardw)o(are)e(platforms)h(and)g(dif)n(ferent)g(testing)h(pro-)
-75 3607 y(cedures)j(used)i(across)f(projects.)88 b(Ho)n(we)n(v)o(er)m
(,)44 b(we)e(can)f(mak)o(e)-75 3706 y(some)e(rough)e(estimates)i(of)f
(relati)n(v)o(e)g(performance)e(impro)o(v)o(e-)-75 3806
y(ments)16 b(based)g(on)f(our)h(results)g(and)g(results)g(published)f
(in)h(the)g(liter)n(-)-75 3906 y(ature.)26 b(F)o(or)20
b(e)o(xample,)f(the)i(Solaris)g(zero-cop)o(y)d(TCP)k(mechanism)-75
4005 y(with)c(checksum)e(in)i(hardw)o(are)f([5)o(])h(produces)e(a)i(f)o
(actor)f(of)h(1.4)f(im-)-75 4105 y(pro)o(v)o(ement)e(o)o(v)o(er)i(data)
h(cop)o(ying.)23 b(UVM')-5 b(s)18 b(page)g(loanout)f(f)o(acility)-75
4204 y(\(without)27 b(the)h(o)o(v)o(erhead)d(of)j(protocol)e
(processing\))h(produces)f(a)-75 4304 y(f)o(actor)k(of)g(2.6)f(impro)o
(v)o(ement)e(for)j(the)g(same)h(transfer)e(size.)56 b(In)-75
4404 y(the)28 b(Container)e(Shipping)g(project)h([1)o(])h(the)g
(performance)c(of)k(an)-75 4503 y(IPC)23 b(pipe)g(using)f(the)g
(container)g(shipping)f(mechanism)g(to)i(send,)-75 4603
y(recei)n(v)o(e,)34 b(and)d(both)g(send)h(and)f(recei)n(v)o(e)g(w)o(as)
i(compared)c(to)k(the)-75 4703 y(performance)17 b(of)i(using)h(data)g
(cop)o(ying.)j(The)c(reported)f(impro)o(v)o(e-)-75 4802
y(ment)31 b(f)o(actors)f(are)i(1.2,)h(1.6,)f(and)f(8.3,)i(respecti)n(v)
o(ely)-5 b(.)56 b(A)31 b(com-)-75 4902 y(parable)25 b(e)o(xperiment)f
(under)g(UVM)j(using)e(page)g(loanout,)h(page)-75 5001
y(transfer)m(,)g(and)f(both)g(mechanisms)g(at)h(the)g(same)g(time)g
(produced)-75 5101 y(impro)o(v)o(ement)18 b(f)o(actors)i(of)h(2.1,)f
(1.7,)g(and)g(14.)26 b(Other)21 b(projects)f(re-)-75
5201 y(port)h(results)h(that)g(appear)f(to)h(be)f(comparable.)28
b(Our)21 b(rough)f(com-)-75 5300 y(parisons)31 b(sho)n(w)g(that)h(UVM)g
(produces)e(impro)o(v)o(ements)e(on)k(the)-75 5400 y(same)20
b(order)f(of)h(magnitude)e(as)j(the)g(related)e(w)o(ork.)2025
-67 y Fh(6)99 b(Conclusions)2025 131 y Fg(UVM)24 b(reduces)e(or)h
(eliminates)h(the)f(need)g(to)h(cop)o(y)e(data)h(thus)h(re-)2025
231 y(ducing)e(the)h(time)g(spent)g(within)g(the)g(k)o(ernel)f(and)h
(freeing)f(up)g(c)o(y-)2025 330 y(cles)f(for)f(application)g
(processing.)25 b(Unlik)o(e)20 b(the)h(approaches)d(that)2025
430 y(focus)34 b(e)o(xclusi)n(v)o(ely)f(on)i(the)f(netw)o(orking)f
(subsystem,)38 b(our)c(ap-)2025 530 y(proach)28 b(pro)o(vides)g(a)i
(general)e(solution)h(that)g(can)g(impro)o(v)o(e)f(ef)n(\002-)2025
629 y(cienc)o(y)19 b(of)h(the)g(entire)g(I/O)h(subsystem.)2108
735 y(UVM)32 b(pro)o(vides)f(the)h(BSD)h(k)o(ernel)f(with)g(three)g(ne)
n(w)g(mech-)2025 835 y(anisms)d(that)h(allo)n(w)f(processes)g(to)g(e)o
(xchange)e(and)i(share)g(page-)2025 935 y(sized)f(and)f(mapping-sized)e
(chunks)h(of)i(memory)e(without)h(data)2025 1034 y(copies:)d(page)18
b(loanout,)f(page)g(transfer)m(,)g(and)h(map)g(entry)f(passing.)2025
1134 y(While)f(it)h(w)o(ould)f(be)g(foolish)f(to)h(use)g(these)g
(mechanisms)f(on)h(small)2025 1233 y(data)j(chunks,)f(our)g
(measurements)g(clearly)g(sho)n(w)h(that)g(for)g(lar)o(ger)2025
1333 y(chunks)k(of)g(data)h(the)o(y)g(pro)o(vide)e(a)i(signi\002cant)g
(reduction)e(in)i(k)o(er)n(-)2025 1433 y(nel)j(o)o(v)o(erhead)e(as)j
(compared)d(to)j(data)f(cop)o(ying.)45 b(F)o(or)27 b(e)o(xample:)2025
1532 y(UVM')-5 b(s)28 b(page)e(loanout)g(mechanism)g(pro)o(vides)f
(processes)i(with)2025 1632 y(the)h(ability)g(to)g(a)n(v)n(oid)f
(costly)h(data)g(copies)f(by)h(loaning)e(a)j(cop)o(y-)2025
1732 y(on-write)e(cop)o(y)h(of)g(their)h(memory)e(out)h(to)h(the)f(k)o
(ernel)g(or)g(other)2025 1831 y(processes.)36 b(UVM')-5
b(s)24 b(page)g(transfer)f(mechanism)f(allo)n(ws)i(a)h(pro-)2025
1931 y(cess)33 b(to)f(recei)n(v)o(e)g(anon)o(ymous)d(pages)j(of)g
(memory)e(from)h(other)2025 2031 y(processes)g(or)h(the)g(k)o(ernel)f
(without)g(ha)n(ving)f(to)i(cop)o(y)f(the)h(data.)2025
2130 y(UVM')-5 b(s)23 b(map)g(entry)e(passing)i(mechanism)e(allo)n(ws)i
(processes)f(to)2025 2230 y(easily)d(cop)o(y)-5 b(,)17
b(share,)i(and)f(e)o(xchange)e(chunks)i(of)g(virtual)g(memory)2025
2329 y(from)26 b(their)g(address)h(space.)44 b(In)27
b(addition)e(to)i(being)f(used)h(sepa-)2025 2429 y(rately)-5
b(,)25 b(we)g(ha)n(v)o(e)f(sho)n(wn)g(that)h(these)g(mechanisms)f(can)g
(be)h(used)2025 2529 y(together)-5 b(.)2108 2635 y(UVM)42
b(is)g(no)n(w)f(part)g(of)g(the)g(standard)f(NetBSD)i(distrib)n(u-)2025
2734 y(tion)28 b(and)f(is)i(scheduled)e(to)h(replace)f(the)h(BSD)h(VM)f
(system)g(for)2025 2834 y(NetBSD)33 b(release)e(1.4.)59
b Fb(\(Note)o(,)35 b(some)d(of)g(the)f(data)g(mo)o(vement)2025
2934 y(r)m(elated)h(code)g(is)i(curr)m(ently)e(being)g(mer)m(g)o(ed)g
(in,)k(all)d(should)f(be)2025 3033 y(mer)m(g)o(ed)24
b(in)h(befor)m(e)f(the)g(1.4)g(r)m(elease)g(and)g(befor)m(e)g(OSDI.\))f
Fg(UVM)2025 3133 y(already)29 b(runs)h(on)f(almost)h(all)h(of)f
(NetBSD')-5 b(s)31 b(platforms)e(and)h(is)2025 3233 y(e)o(xpected)19
b(to)h(run)g(on)g(e)n(v)o(ery)e(NetBSD)k(platform)c(soon.)25
b(A)c(port)e(to)2025 3332 y(OpenBSD)h(is)h(also)g(e)o(xpected.)2108
3438 y(UVM)27 b(can)g(impro)o(v)o(e)d(the)j(performance)d(of)i(current)
g(applica-)2025 3538 y(tions)g(through)f(the)h(page)g(loanout)f
(mechanism)g(and)g(secondary)2025 3638 y(impro)o(v)o(ements)c(to)k(the)
f(VM.)g(Further)g(w)o(ork)f(to)i(introduce)d(APIs)2025
3737 y(for)d(page)g(transfer)g(and)g(map)g(entry)f(passing)i(will)g
(allo)n(w)g(applica-)2025 3837 y(tions)g(to)h(tak)o(e)f(adv)n(antage)e
(of)i(these)g(mechanisms)g(as)g(well.)2025 4120 y Fh(Refer)n(ences)2067
4318 y Fg([1])40 b(E.)24 b(Anderson.)41 b Fb(Container)23
b(Shipping:)31 b(A)24 b(Uniform)h(Inter)n(-)2205 4418
y(face)33 b(for)g(F)-6 b(ast,)36 b(Ef)o(\002cient,)e(High-Bandwidth)c
(I/O)p Fg(.)70 b(PhD)2205 4517 y(thesis,)20 b(Uni)n(v)o(ersity)f(of)h
(California,)f(San)i(Die)o(go,)e(1995.)2067 4710 y([2])40
b(J.)32 b(Barrera.)65 b(A)32 b(f)o(ast)g(Mach)g(netw)o(ork)e(IPC)i
(implementa-)2205 4809 y(tion.)62 b(In)31 b Fb(Pr)l(oceedings)e(of)i
(the)g(USENIX)f(Mac)o(h)g(Sympo-)2205 4909 y(sium)p Fg(,)20
b(pages)g(1\22611,)f(No)o(v)o(ember)e(1991.)2067 5101
y([3])40 b(J.)31 b(Brustoloni)f(and)g(P)-9 b(.)31 b(Steenkiste.)63
b(Cop)o(y)30 b(emulation)f(in)2205 5201 y(checksummed,)35
b(multiple-pack)o(et)d(communication.)71 b(In)2205 5300
y Fb(Pr)l(oceedings)23 b(of)i(IEEE)f(INFOCOM)i(1997)p
Fg(,)e(pages)g(1124\226)2205 5400 y(1132,)18 b(April)i(1997.)p
eop
%%Page: 14 14
14 13 bop -33 -67 a Fg([4])40 b(M.)20 b(Buddhik)o(ot,)e(X.)i(Chen,)g
(D.)g(W)l(u,)h(and)e(G.)h(P)o(arulkar)-5 b(.)28 b(En-)105
33 y(hancements)k(to)i(4.4)e(BSD)j(UNIX)e(for)g(netw)o(ork)o(ed)f(mul-)
105 132 y(timedia)d(in)i(project)e(MARS.)61 b(In)30 b
Fb(Pr)l(oceedings)f(of)h(IEEE)105 232 y(Multimedia)19
b(Systems'98)p Fg(,)g(June)h(1998.)-33 414 y([5])40 b(H.)19
b(Chu.)27 b(Zero-cop)o(y)16 b(TCP)k(in)f(Solaris.)27
b(In)19 b Fb(Pr)l(oceedings)e(of)105 513 y(the)30 b(USENIX)g(Confer)m
(ence)p Fg(,)i(pages)e(253\226264.)d(USENIX,)105 613
y(1996.)-33 794 y([6])40 b(C.)28 b(Cranor)-5 b(.)52 b
Fb(Design)27 b(and)f(Implementation)f(of)j(the)f(UVM)105
894 y(V)-6 b(irtual)16 b(Memory)h(System)p Fg(.)k(PhD)c(thesis,)h(W)-7
b(ashington)16 b(Uni-)105 994 y(v)o(ersity)-5 b(,)19
b(August)g(1998.)-33 1175 y([7])40 b(P)-9 b(.)51 b(Druschel)e(and)h(L.)
h(Peterson.)126 b(Fb)n(ufs:)86 b(A)51 b(high-)105 1275
y(bandwidth)16 b(cross-domain)g(transfer)h(f)o(acility)-5
b(.)24 b(In)17 b Fb(Pr)l(oceed-)105 1374 y(ings)h(of)g(the)h(F)-9
b(ourteenth)17 b(A)n(CM)h(Symposium)f(on)h(Oper)o(ating)105
1474 y(Systems)i(Principles)p Fg(,)g(December)f(1993.)-33
1656 y([8])40 b(J.)20 b(Dyson,)e(D.)i(Greenman,)d(et)j(al.)27
b(The)19 b(FreeBSD)h(VM)f(sys-)105 1755 y(tem.)55 b(See)28
b Fe(http://www.freebsd.org)d Fg(for)i(more)105 1855
y(information.)-33 2037 y([9])40 b(K.)35 b(F)o(all)g(and)f(J.)h(P)o
(asquale.)74 b(Exploiting)33 b(in-k)o(ernel)g(data)105
2136 y(paths)26 b(to)h(impro)o(v)o(e)d(I/O)j(throughput)d(and)i(CPU)h
(a)n(v)n(ailabil-)105 2236 y(ity)-5 b(.)60 b(In)30 b
Fb(Pr)l(oceedings)f(of)h(USENIX)g(W)-5 b(inter)31 b(Confer)m(ence)p
Fg(,)105 2335 y(pages)20 b(327\226333.)d(USENIX,)j(January)f(1993.)-75
2517 y([10])40 b(R.)21 b(Gingell,)g(J.)g(Moran,)f(and)g(W)-8
b(.)22 b(Shannon.)30 b(V)-5 b(irtual)20 b(mem-)105 2617
y(ory)15 b(architecture)e(in)j(SunOS.)j(In)c Fb(Pr)l(oceedings)f(of)i
(USENIX)105 2716 y(Summer)39 b(Confer)m(ence)p Fg(,)j(pages)d
(81\22694.)e(USENIX,)i(June)105 2816 y(1987.)-75 2998
y([11])h(J.)32 b(Hennessy)f(and)h(D.)g(P)o(atterson.)65
b Fb(Computer)31 b(Ar)m(c)o(hitec-)105 3097 y(tur)m(e:)38
b(A)27 b(Quantitative)e(Appr)l(oac)o(h)p Fg(.)48 b(Mor)o(gan)24
b(Kaufmann,)105 3197 y(San)c(Francisco,)f(CA,)i(2nd)f(edition,)f(1996.)
-75 3378 y([12])40 b(L.)30 b(McV)-11 b(o)o(y)30 b(and)g(C.)h(Staelin.)
61 b(lmbench:)44 b(Portable)30 b(tools)105 3478 y(for)20
b(performance)d(analysis.)29 b(In)20 b Fb(Pr)l(oceedings)g(of)g(USENIX)
105 3578 y(Confer)m(ence)p Fg(,)f(pages)h(279\226294.)d(USENIX,)j
(1996.)-75 3759 y([13])40 b(J.)33 b(Moran.)69 b(SunOS)33
b(virtual)f(memory)f(implementation.)105 3859 y(In)f
Fb(Pr)l(oceedings)g(of)h(the)f(Spring)g(1988)f(Eur)l(opean)g(UNIX)105
3959 y(User)o(s)21 b(Gr)l(oup)f(Confer)m(ence)p Fg(,)f(April)h(1988.)
-75 4140 y([14])40 b(J.)25 b(Ousterhout.)40 b(Why)24
b(aren')o(t)f(operating)g(systems)h(getting)105 4240
y(f)o(aster)17 b(as)h(f)o(ast)f(as)h(hardw)o(are?)28
b(In)17 b Fb(Pr)l(oceedings)f(of)h(USENIX)105 4339 y(Summer)f(Confer)m
(ence)p Fg(,)g(pages)g(247\226256.)d(USENIX,)j(1990.)-75
4521 y([15])40 b(J.)29 b(P)o(asquale,)i(E.)e(Anderson,)g(and)g(P)-9
b(.)29 b(Muller)-5 b(.)58 b(Container)105 4621 y(Shipping:)24
b(Operating)19 b(system)i(support)e(for)h(I/O)h(intensi)n(v)o(e)105
4720 y(applications.)28 b Fb(Computer)p Fg(,)19 b(27\(3\),)g(March)g
(1994.)-75 4902 y([16])40 b(R.)54 b(Rashid,)61 b(A.)54
b(T)-6 b(e)n(v)n(anian,)59 b(M.)54 b(Y)-9 b(oung,)59
b(D.)54 b(Golub,)105 5001 y(R.)49 b(Baron,)55 b(D.)48
b(Black,)56 b(W)-8 b(.)49 b(Bolosk)o(y)-5 b(,)54 b(and)48
b(J.)h(Che)n(w)-5 b(.)105 5101 y(Machine-independent)38
b(virtual)j(memory)g(management)105 5201 y(for)28 b(paged)g
(uniprocessor)e(and)j(multiprocessor)e(architec-)105
5300 y(tures.)45 b Fb(IEEE)25 b(T)-5 b(r)o(ansactions)24
b(on)h(Computing)p Fg(,)g(37\(8\),)g(Au-)105 5400 y(gust)20
b(1988.)2025 -67 y([17])40 b(D.)28 b(Solomon.)51 b Fb(Inside)27
b(W)-5 b(indows)28 b(NT)p Fg(.)54 b(Microsoft)27 b(Press,)2205
33 y(2nd)17 b(edition,)h(1998.)24 b(Based)19 b(on)f(the)h(\002rst)g
(edition)f(by)g(Helen)2205 132 y(Custer)-5 b(.)2025 298
y([18])40 b(L.)26 b(T)-7 b(orv)n(alds)25 b(et)i(al.)49
b(The)26 b(Linux)f(operating)f(system.)49 b(See)2205
398 y Fe(http://www.linux.org)17 b Fg(for)i(more)h(information.)2025
564 y([19])40 b(M.)24 b(Y)-9 b(oung,)24 b(A.)g(T)-6 b(e)n(v)n(anian,)24
b(R.)h(Rashid,)g(D.)g(Golub,)f(J.)h(Ep-)2205 664 y(pinger)m(,)18
b(J.)i(Che)n(w)-5 b(,)20 b(W)-8 b(.)20 b(Bolosk)o(y)-5
b(,)19 b(D.)h(Black,)g(and)f(R.)h(Baron.)2205 763 y(The)d(duality)g(of)
h(memory)e(and)h(communication)e(in)j(the)g(im-)2205
863 y(plementation)c(of)h(a)i(multiprocessor)d(operating)g(system.)20
b(In)2205 962 y Fb(Pr)l(oceedings)e(of)i(the)f(Ele)o(venth)g(A)n(CM)h
(Symposium)e(on)h(Op-)2205 1062 y(er)o(ating)26 b(Systems)h(Principles)
p Fg(,)i(pages)d(63\22676,)h(No)o(v)o(ember)2205 1162
y(1987.)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
