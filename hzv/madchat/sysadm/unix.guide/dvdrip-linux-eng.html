<html><head><title>DVD ripping and transcoding with Linux</title></head><body>
http://www.bunkus.org/dvdripping4linux/single/index.html<p>
<h1>DVD ripping and transcoding with Linux</h1>

<font color="#ff0000">This guide was updated on June 3, 2002.</font><p>

</p><ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#introduction">Introduction</a></li>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software">Required software</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software_codecs">A word on codecs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software_common">Common libraries / codecs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software_mplayer"><em>MPlayer</em></a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software_transcode"><em>transcode</em></a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#software_rpms">getting RPMs</a></li>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#ripping">Ripping the VOBs</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#ripping_interlace">Interlaced video</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#ripping_cmdline">...using the command line interface</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#ripping_dvdrip">...using <em>dvd::rip</em></a></li>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#transcoding">Transcoding the DVD to an AVI</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#transcoding_ar">Aspect ratios</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#transcoding_dvdrip">Using <em>dvd::rip</em></a></li>
  <ol>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_clipping">Clipping and zooming</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_params">Chosing encoding parameters</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_preview">Generating a quick preview</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_avsync">Preventing audio/video desynchronization</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_doit">Doing the whole thing</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_dvdrip_commandline">For advanced users: <em>transcode</em> command line arguments</a></li>
  </ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#transcoding_mplayer">Using <em>MEncoder</em></a></li>
  <ol>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_mplayer_audio">Encoding the audio</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_mplayer_preview1">Generating a preview (first pass)</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_mplayer_preview2">Generating a preview (second pass)</a></li>
   <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tc_mplayer_final">Generating the final AVI (both passes)</a></li>
  </ol>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tricks">Additional tricks</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tricks_sync">Fixing desynched audio</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tricks_split">Splitting AVIs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tricks_extractaudio">Extracting audio from VOBs/MPEGs/AVIs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#tricks_extraaudio">Using separate audio files</a></li>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links">Links</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links_libs">Libraries, codecs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links_players">Media players</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links_encoders">Media encoders</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links_docs">Other documentation</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#links_mls">Mailing lists</a></li>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary">Glossary</a></li>
 <ol>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_vbrcbr">CBR, VBR and ABR</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_gmc">Global Motion Compensation (GMC)</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glosarry_letterbox">Letterboxing</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_bframes">P/I/B-Frames, GOPs</a></li>
  <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_qpel">Quarter Pixel (QP)</a></li>
 </ol>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#changelog">Changelog</a></li>
 <li><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#about">About</a></li>
</ol>
<a name="introduction">
</a><h2><a name="introduction">1. Introduction</a></h2>

<a name="introduction">So you've bought a shiny new DVD. You think it ultimately rocks and want to
be sure that no matter what happens you still have a copy of this movie.
But how the heck do you get it from that big DVD onto such a small CD? And
in good quality, mind you? Just read on.</a><p>

<a name="introduction"><b>WARNING!</b> This guide is not for the faint hearted. It involes a lot
of compiling code, installing software, doing things on the command line.
If you don't know how to do <code>configure; make; make install</code> then
read some other docs and learn about it. If you don't want to then please
install Windows and use all those formidable DVD ripping utilities available
for it. I won't start a flame war about "Linux vs Windows". It's simply a
fact that the process is rather difficult under Linux.</a></p><p>

<a name="introduction">You're still with me? Great! You're about to embark on a journey to a
beautiful land...

</a></p><p>
<a name="introduction"><font size="-2">Back to the </font></a><font size="-2"><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="software">
</a><h2><a name="software">2. Required software</a></h2>

<a name="software">First let me introduce you to some tools you'll use.<br>

</a><ul>
<li><a name="software"><em>MPlayer</em> is a multimedia player which supports a very broad
  range of file formats and media codecs: MPEG1, AVIs
  (including all Windows codecs, all DivX codecs), DVDs, VCDs, SVCDs
  and so on. I use it for watching all kind of files.</a></li>
<li><a name="software"><em>MEncoder</em> is part of the <em>MPlayer</em> package and is used
  for encoding video and sound. It is capable of transcoding DVDs.</a></li>
<li><a name="software"><em>transcode</em> is a set of tools that allow to transcode from
  a broad list of formats to a broad list of other formats including
  transcoding from DVD to AVI or (S)VCD.</a></li>
<li><a name="software">You know that most DVDs are encrypted. <em>libdvdcss</em> is a library
  that unencrypts DVD contents.</a></li>
<li><a name="software">DVDs contain information about the titles / chapters / angles and
  audio languages contained in the files. These information are stored
  in <code>.IFO</code> files. <em>libdvdread</em> is often used to parse
  these files and extract the informations that are needed.</a></li>
<li><a name="software"><em>lame</em> (Lame Ain't an MP3 Encoder) encodes MP2/WAV audio
  to the MP3 format.</a></li>
<li><a name="software"><em>vobcopy</em> can be used to copy VOBs from a DVD. Unencryption
  is done on the fly.</a></li>
<li><a name="software"><em>dvd::rip</em> is a graphical frontend for <em>transcode</em>.</a></li>
</ul>

<a name="software">I'll present you two methods for DVD transcoding - using <em>MEncoder</em>
and <em>transcode</em>. Nevertheless you need some files for both method.</a><p>

<a name="software_codecs">
</a></p><h3><a name="software_codecs">2.1. A word on codecs</a></h3>

<a name="software_codecs">In an ideal world there would be only one codec - the best one. But this
world is far from ideal. The result is that there is a wide range of
video and audio codecs to chose from. First I'll explain the different
types of codecs:

</a><ul>
<a name="software_codecs"> <li><em>Native codecs</em> are normal Linux binaries (most often shared
   objects, libCODECNAME.so). Support for them is trivial.</li>
 <li><em>Windows codecs</em> are the original or slightly modified
   Windows dynamic libraries (DLLs, AX and the likes). These codecs do
   not work natively under Linux - you need a special library to use
   these codecs. This library is called <em>avifile</em>. Some months
   ago this was the only way to watch AVIs under Linux.</li>
</a></ul>

<a name="software_codecs">Today most codecs come with a native version for Linux (like <em>XviD</em>,
<em>DivX 4/5</em> and others).</a><p>

<a name="software_codecs">Here's a list of supported video codecs:

</a></p><ul>
<a name="software_codecs"> <li><em>MPEG4</em> is an official video compression standard. There is no
   codec whose name is simply MPEG4. If you talk about MPEG4 you don't
   talk about a specific codec - you talk about a set of techniques to
   compress videos. <em>MPEG4 compliant</em> means that a codec produces
   files that can be played by other MPEG4 compliant codecs.</li>
 <li><em>DivX ;-)</em> is the "original" hacked Microsoft MPEG4 codec that
   started all those ripping franzies. It does not support all MPEG4 features
   like b-frames<sup></sup></li></a><sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_bframes">*</a></sup> or
   global movement compensation (GMC<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_gmc">
   *</a></sup>). Some still use it
   under Windows with the excellent tool <em>Nandub</em>. It is seldom used
   under Linux because there are codecs that provide better quality. It comes
   as a Windows dynamic library (<code>divx.dll</code> and some others) and
   requires <em>avifile</em>.
 <li><em>DivX 4 and 5</em> are the official successors. <em>DivX 5</em>
   replaces <em>DivX 4</em>. That's why you can't have both codecs installed
   at the same time (well technically you can, but you shouldn't, for
   obvious reasons). These are native Linux shared objects called
   <code>libdivxdecore.so</code> and <code>libdivxencore.so</code>. This
   is closed source. For Windows there are different versions available and
   only the commercial version supports all encoding options like
   b-frames<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_bframes">*</a></sup>,
   GMC<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_gmc">*</a></sup>
   or quarter PEL<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_qpel">*</a></sup>. The
   free version can still be used to view all files
   created with even the commercial version. Unfortunately there's only
   the free version for Linux which doesn't support all those nice options.
   DivXNetworks are thinking about providing a commercial solution for
   Linux aswell. But don't expect that codec to be available soon.</li>
 <li><em>XviD</em> (it's <code>DivX</code> read backwards) is an Open
   Source MPEG4 implementation that is really good considering compression
   and picture quality. Support for advanced MPEG4 features
   (b-frames<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_bframes">*</a></sup>,
   GMC<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_gmc">*</a></sup>)
   is being worked on or has already been implemented.</li>
 <li><em>libavcodec</em> or short <em>lavc</em> is another Open Source MPEG4
   compliant video codec which is superior in performance and quality to
   <em>DivX 5</em> and even to <em>XviD</em>. This codec suppports
   b-frames<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_bframes">*</a></sup>. It is part
   of the <em>ffmpeg</em> project.</li>
 <li>Of course there are the MPEG1 compliant codecs that you need for
   VCDs and the MPEG2 compliant codecs for SVCDs or DVDs. At the moment
   this guide aims at producing AVIs so I won't go into detail about
   either one of these.</li>
 <li>Most other codecs are either outdated (like <em>Intel Indeo 5</em>) or
   other cracked version of Microsoft's MPEG4 codec (like <em>AngelPotion</em>).
   Still other codecs are under heavy development (like <em>VP4</em>) and do
   not present a workable solution for us here.</li>
</ul>

This guide tries to focus on two codecs: <em>XviD</em> and <em>lavc</em>.
Reasons are that both provide excellent quality, both are fast and you only
need a MPEG4 compliant decoder (like <em>DivX 5</em> or <em>XviD</em>) on a
Windows system for playback. Playback under Linux is no problem at all - 
<em>MPlayer</em> or <em>Xine</em> do happily play <em>DivX 4/5, XviD</em> and
<em>lavc</em> encoded movies.<p>

Again a list, this time for audio codecs:

</p><ul>
 <li><em>MP3</em> is short for <em>MPEG1 layer 3</em> and is an official
   audio compression standard. If you talk about <em>MP3</em> you actually
   talk about a compression technique, not about a codec in particular. There
   are more codecs for <em>MP3</em> than I can name in a full day.</li>
 <li><em>lame</em> is an acronym for "Lame Ain't an MP3 Encoder" (although
   it is ;-)). It provides a encoder that produces high quality MP3 files.
   Both <em>transcode</em> and <em>MEncoder</em> use <em>lame</em> for
   audio compression.</li>
 <li><em>AC3</em> is again an official audio compression standard. Almost all
   DVDs contain <em>AC3</em> encoded audio. Today there are decoders for
   both Windows and Linux that work with <em>AC3</em> sound inside AVIs.
   The advantage is that no re-compression is necessary (recompressing
   always loses quality) and that multi channel sound (Dolby Surround and
   the likes) will be preserved. The disadvantage is that <em>AC3</em> sound
   needs more space than <em>MP3</em> encoded sound.</li>
 <li><em>Ogg</em> is a new Open Source audio compression. It is available
   for both Windows and Linux. Its advantages are a better quality : size
   ratio compared to <em>MP3</em> and multi channel support. I have absolutely
   no experiance with <em>Ogg</em> sound - that's why you won't find any
   examples for it in this guide. If you can give me some tips regarding
   <em>Ogg</em> sound please drop me a line.</li>
</ul>

I hope this clears things up a bit.

<a name="software_common">
</a><h3><a name="software_common">2.2. Common libraries / codecs</a></h3>

<a name="software_common">I won't go into too much detail in this chapter. There is more documentation
on how to install included with each package. Refer to that if you have
problems. Also note that <em>MPlayer</em> has rather strong requirements
regarding versions of gcc, binutils and other central system components.
Refer to </a><a href="http://www.mplayerhq.hu/DOCS/#1.3" target="_blank">the
MPlayer installation documentation</a>.<p>

<b>Note:</b> Before downloading software check if your distribution
already contains that software. I use Debian Woody (testing) and have found
that a lot of software is already available prepackaged.

</p><ul>
  <li><em>libdvdcss</em> - Head over to
    <a href="http://www.dtek.chalmers.se/groups/dvd/downloads.shtml" target="_blank">the Ogle project page</a> and download
    <code>libdvdcss-0.0.3.ogle3.tar.gz</code> (note that version numbers may
    differ as software is always under development). Un-tar-gz it, compile
    it, and install it in <code>/usr/local</code></li>. Please note that
    there different versions of this library floating around (0.0.3,
    1.0.1). <em>MPlayer</em> still suggests that you use 0.0.3.
  <li><em>libdvdread</em> - Get it from the same web page as <em>libdvdcss</em>.
    Note that Debian Woody already contains <em>libdvdread</em>. A simple
    <code>apt-get install libdvdread2 libdvdread2-dev</code> should do the trick.
    </li>
  <li><em>XviD codec</em> - Needed if you want to use <em>transcode</em>.
    Short instructions taken from the <em>MPlayer</em> documentation:<br>
    <ul>
      <li><code>cvs -z3 -d:pserver:anonymous@cvs.xvid.org:/xvid login</code> 
        When asked for a password simply hit enter.</li>
      <li><code>cvs -z3 -d:pserver:anonymous@cvs.xvid.org:/xvid co xvidcore
        </code></li>
      <li><code>cd xvidcore/build/generic</code></li>
      <li>Edit Makefile.linux to fit your needs.</li>
      <li><code>make -f Makefile.linux</code></li>
      <li>Copy the <code>xvidcore/src/divx4.h</code> file to
        <code>/usr/local/include/decore.h</code> and to
        <code>/usr/local/include/encore2.h</code>. Be sure to make a backup
        of the files you will overwrite!</li>
      <li>Copy <code>libxvidcore.so</code> and <code>libcore.a</code> to
        <code>/usr/local/lib/<code></code></code></li>
    </ul>
    For the compilation you might need a special version of <em>nasm</em>
    which you can get
    <a href="http://homepage1.nifty.com/herumi/soft/petit/nasmsse2.tgz" target="_blank">here</a>.</li>
  <li><em>vobcopy</em> - Get it from
    <a href="http://lin-prog-newbie.sourceforge.net/projects/c/index.html" target="_blank">the homepage</a>.</li>
  <li><em>avifile</em> - As explained it is needed to access Windows
    codecs for which there are no native Linux binaries. Head over to
    the <a href="http://avifile.sourceforge.net/" target="_blank">homepage</a>.
    Before you do that check again if your Linux distribution already 
    provides <em>avifile</em> (Debian Woody does). You still need the
    Windows codecs from the <em>avifile</em> homepage or directly
    from
    <a href="http://www2.mplayerhq.hu/MPlayer/releases/w32codec-0.60.tar.bz2" taget="_blank"><em>MPlayer</em>'s homepage</a>.</li>
  <li><em>DivX 5</em> - although this guide does not focus on <em>DivX 5</em>
    you can get it from <a href="http://www.divx.com/" target="_blank">
    http://www.divx.com/</a>. If you have some time to spare than I suggest
    make some comparisons between <em>DivX 5</em> and <em>XviD</em> or
    <em>lavc</em> and see for yourself that it is worse than the two latter
    codecs.</li>
</ul>

<a name="software_mplayer">
</a><h3><a name="software_mplayer">2.3. <em>MPlayer</em></a></h3>

<a name="software_mplayer">You need <em>MPlayer</em>. It doesn't matter if you'll use <em>MEncoder</em>
or <em>transcode</em> later on - you still need this. So get <em>MPlayer</em>
from </a><a href="http://www.mplayerhq.hu/" target="_blank">
http://www.mplayerhq.hu/</a>. <b>I prefer the CVS version as it often has
features that the official releases lack! In fact I base this guide on
features have been commited to CVS just a few days earlier (today is Aril 30,
2002). Just do the same - be brave and get the CVS version.</b><p>

If you want to encode using <em>MEncoder</em> I suggest you also get
a version of <em>libavcode</em> for encoding. You only need to download it
if you are using a CVS version of <em>MPlayer</em>. Releases come pre-packaged
with <em>libavcodec</em>. These instructions are taken from the
<em>MPlayer</em> documentation:
</p><ul>
  <li>Check out the <em>ffmpeg</em> project from CVS:
    <code>cvs -d:pserver:anonymous@cvs.ffmpeg.sourceforge.net:/cvsroot/ffmpeg
    login</code>. Just hit enter when you're prompted for a login or
    password. 
  </li><li><code>cvs
    -d:pserver:anonymous@cvs.ffmpeg.sourceforge.net:/cvsroot/ffmpeg co
    ffmpeg</code></li>
  <li>Move the libavcodec directory from the FFmpeg sources to the root of the
    MPlayer CVS tree. Symlinking is not enough, you have to copy/move it!!!
    </li>
</ul><p>

<b>A note on compiling:</b> Be sure <b>not to include</b> XviD support.
Instead include support for <b>libavcodec</b>. Installation instructions
are provided in the <em>MPlayer</em> docs. Yes, you've read correctly:
compile <em>transcode</em> <b>with</b> XviD and <em>MPlayer</em>
<b>without</b> <em>XviD</em> but <b>with</b> <em>libavcodec</em>. The
reason is that <em>MPlayer</em> can't contain support for both codecs at
the same time as both use variables that have the same name.

<a name="software_transcode">
</a></p><h3><a name="software_transcode">2.4. <em>transcode</em></a></h3>

<a name="software_transcode">Get <em>transcode</em> from the
</a><a href="http://www.theorie.physik.uni-goettingen.de/%7Eostreich/transcode/" target="_blank">homepage</a>. Make sure that it compiles with <em>XviD</em>
support as well as with support for <em>MPlayer</em>'s post processing
functions. <b>Again I advice you to chose the CVS version.</b><p>

Additionally you really want to download <em>dvd::rip</em>, an excellent
Gtk+ based frontend for <em>transcode</em>. Get it from
<a href="http://www.exit1.org/dvdrip/" target="_blank">here</a>. Installation
instructions are included.

<a name="software_rpms">
</a></p><h3><a name="software_rpms">2.5. getting RPMs</a></h3>

<a name="software_rpms">I know of at least two places where you can find some RPMs for the software 
mentioned above:

</a><ul>
<a name="software_rpms"> <li></li></a><a href="http://plf.zarb.org/" target="_blank">Penguin Liberation 
  Front lair</a> - RPMs for Mandrake
 <li><a href="http://home.elka.pw.edu.pl/%7Edmierzej/mplayer.html" target="_blank">http://home.elka.pw.edu.pl/~dmierzej/mplayer.html</a> -
  RPMs for Redhat 7.2</li>
</ul><p>
<font size="-2">Back to the <a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="ripping">
</a><h2><a name="ripping">3. Ripping the VOBs</a></h2>

<a name="ripping">This part is rather easy. All you need is some free space (a <em>lot</em>
of free space actually). Depending on what you want to transcode you should
have 10G of free space available. If you don't spend some bucks on a new
drive, they are really cheap at the moment (like 150&#8364; for a 80G drive).</a><p>

<a name="ripping">Before you do anything else think about the region code. All drives shipped 
today have RPC mode 2 protection - that means that you can only switch your 
region code five times before it is locked. You can get information about how 
to remove the region code from your drive over at </a><a href="http://www.digital-digest.com/" target="_blank">Digital Digest</a>. So why am I mentioning this? 
The ripping methods mentioned below rely on the drive to have the correct 
region code (read: the same as the DVD that's inserted) or no region code at 
all. All error messages are kind of cryptic and it's often not very clear that 
you have a region code related problem when ripping fails. So keep that in 
mind.</p><p>

First test the DVD. Fire up <em>MPlayer</em> and watch the first title:
<code>mplayer -dvd 1</code>. Do you like it? Cool. Make sure you
remember whether the video is <b>interlaced</b> or not (see below). Close
<em>MPlayer</em>.</p><p>

<a name="ripping_interlace">
</a></p><h3><a name="ripping_interlace">3.1. Interlaced video</a></h3>

<a name="ripping_interlace">What you see on television are not 25 frames per second. In fact you
see 50 half-frames per second. One frame contains the odd rows, one
frame contains the even rows. That way you'll get 25 fps. The problem is
that those half frames are taken from different times. If you have fast
horizontal movement you will then see that an object (or person) is at
one position for the odd rows and at another for the even rows. These
are artifacts you don't want to have in your final video. Now take a look at
</a><a href="http://www.bunkus.org/dvdripping4linux/images/interlaced.png" target="_blank">this interlaced picture</a>
taken from my Ally McBeal DVD. With the appropriate filters you can eliminate
the effect of interlacing (called de-interlacing... what a surprise ;)).
Here's the <a href="http://www.bunkus.org/dvdripping4linux/images/deinterlaced-tc.png" target="_blank">same
picture with de-interlacing enabled</a>.<p>

Now that you have an idea what interlacing looks like you should be able to
decide for yourself whether your DVD contains interlaced material or not.</p><p>

For the rest of this guide I'm assuming the following:<br>
</p><ul>
  <li>The DVD drive is available under <code>/dvd</code>. There is an
    entry in <code>/etc/fstab</code> for <code>/dvd</code>.</li>
  <li>You have a lot of free space under <code>/space</code>.</li>
  <li>Your DVD's titlte 1 is the one you want (Robos, creator of
    <em>vobcopy</em>, told me that on most DVDs the main title is
    number 2. Your mileage may vary.).</li>
</ul>
Please substitute these paths with paths that apply to your system.<p>

There are a lot of ways to rip the VOBs. I'll present two: using a command
line tool (<em>vobcopy</em>) and using the <em>transcode</em> GUI
<em>dvd::rip</em>. You don't have to do both :-)

<a name="ripping_cmdline">
</a></p><h3><a name="ripping_cmdline">3.2. ...using the command line interface</a></h3>

<a name="ripping_cmdline">Now run <em>vobcopy</em>. It will automagically copy all VOBs that belong
to the title with the most chapters onto your hard disk.
</a><ul>
<a name="ripping_cmdline">  <li>First, mount your DVD: <code>mount /dvd</code></li>
  <li>Let <em>vobcopy</em> grab those VOBs:
    <code>vobcopy -i /dvd</code></li>
</a></ul>
<a name="ripping_cmdline">This will copy the VOBs from the DVD, decrypt them (this is where
<em>libdvdcss</em> is needed) and write them to the current directory (which
you can alter with e.g. <code>-o /space</code>). They will be named after the
DVD's title (e.g. I have <code>ALLY_MCBEAL_DISC21-1.vob</code>,
<code>ALLY_MCBEAL_DISC21-2.vob</code> etc.). It will take some time. Just be
patient.</a><p>

<a name="ripping_cmdline"><b>Note from the author (Robos):</b> <em>vobcopy</em> has some problems
following angles. You might get duplicate scenes with e.g. "The Matrix". I'm
working on it.

</a><a name="ripping_dvdrip">
</a></p><h3><a name="ripping_dvdrip">3.3. ...using <em>dvd::rip</em></a></h3>

<a name="ripping_dvdrip"><em>dvd::rip</em> can do the same job for you.<br>

Fire up <em>dvd::rip</em> by typing <code>dvdrip</code>. You'll see the main
window. Chose <code>Edit / Preferences</code> and <em>dvd::rip</em> will come
up with the </a><a href="http://www.bunkus.org/dvdripping4linux/images/dvdrip-prefs.png" target="_blank">preferences
dialog</a>. Here you'll have to enter your paths. The first is the path to the
DVD <b>device</b> and not the <b>mount point</b>. Often it is
<code>/dev/dvd</code> which is a symlink to the real device, e.g.
<code>/dev/hdc</code>.<p>

Close that dialog. Now start a new project (<code>File / New Project</code>).
It will start with the <a href="http://www.bunkus.org/dvdripping4linux/images/dvdrip-storage.png" target="_blank">storage tab</a>. Again enter the correct paths. Note how the
other name fields change when you change the project title.</p><p>

Change over to the <a href="http://www.bunkus.org/dvdripping4linux/images/dvdrip-riptitle.png" target="_blank">Rip
Title tab</a> and press the <code>Read DVD Table of Contents</code> button.
After a second or two the list below will be populated with the titles that are
stored on the DVD. Just select the title you want to rip (you can select
multiple titles by holding <code>CTRL</code> and clicking on them). Chose the
languange and the angle. Leave <code>Specify Chapter Mode</code> on
<code>No</code>. Last step: press <code>Rip selected
Title(s)/Chapter(s)</code>. Again be patient. Drink some milk. Have a nice chat
with your girlfriend.</p><p>

The rest of <em>dvd::rip</em> will be covered later in
<a href="http://www.bunkus.org/dvdripping4linux/single/index.html#transcoding_dvdrip">chapter 4</a>.
</p><p>
<font size="-2">Back to the <a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="transcoding">
</a><h2><a name="transcoding">4. Transcoding the DVD to an AVI</a></h2>

<a name="transcoding">Here you really have two choices - it's either <em>transcode</em> or
<em>MEncoder</em>. Both have pros and cons. Here's a very short list that
is true at least for the CVS versions from April 28, 2002:

</a><ul>
<a name="transcoding">  <li><em>MEncoder</em> can't adjust audio delays. If audio and video are
    not synchronized when you play it back with <em>MPlayer</em> then
    you should use <em>transcode</em> instead.</li>
  <li><em>transcode</em> can't handle
    VBR/ABR<sup></sup></li></a><sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_vbrcbr">*</a></sup> MP3, only
    CBR<sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_vbrcbr">*</a></sup>. If you
    <em>really</em> need VBR MP3 audio then you'll have to stick with
    <em>MEncoder</em>. Note that the AVI tools that come with <em>transcode</em>
    won't work with AVIs that contain VBR MP3 audio. Therefore you cannot
    fix synch probs in <em>MEncoder</em> generated AVIs with the
    <code>avisync</code> utility.
  <li>According to the documentation <em>MEncoder</em> should only be used
    with VBR/ABR MP3 encoding. CBR encoded files won't play on Windows
    systems (while they play fine with <em>MPlayer</em>).</li>
  <li>There's no nice GUI for <em>MEncoder</em> at the moment. This makes
    cropping/resizing rather painful.</li>
</ul>

<a name="transcoding_ar">
</a><h3><a name="transcoding_ar">4.1. Aspect ratios</a></h3>

<a name="transcoding_ar">Before we start let me introduce you to the most common aspect ratios you
might encounter. DVDs are always encoded at 720x576 (5:4) although the
picture will be scaled at playback. Common video formats are 4:3 = 1.33
for TV, 16:9 = 1.78 for normal cinema movies and 2.35:1 for Cinemascope.</a><p>

<a name="transcoding_ar">Here is a list of common scenarios:
</a></p><ul>
<a name="transcoding_ar"> <li>4:3 movies that fill the whole picture (no letterboxing<sup></sup></li></a><sup><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#glossary_letterboxing">*</a></sup>): scale 5:4 to 4:3
 <li>16:9 movies that fill the whole picture (again no letterboxing):
  scale 5:4 to 16:9</li>
 <li>16:9 movies that are letterboxed: scale 5:4 to 4:3 and cut away
  some of the black bars</li>
 <li>2.35 movies that are letterboxed: scale 5:4 to 16:9 and cut away
  some of the black bars</li>
</ul>

Don't worry if you don't understand all that at once. Take a look at
<em>dvd::rip</em>'s clipping and scaling options for a more intuitive
overview.

<a name="transcoding_dvdrip">
</a><h3><a name="transcoding_dvdrip">4.2. Using <em>dvd::rip</em></a></h3>

<a name="transcoding_dvdrip">Using <em>dvd::rip</em> is by far the best and easiest method to get your
AVI. As stated earlier it relies heavily on transcode to do its job.</a><p>

<a name="transcoding_dvdrip">After starting <em>dvd::rip</em> you rip the titles you wish to transcode
to your hard disk. Refer to </a><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#ripping_dvdrip">chapter 
3</a> for a detailed description.

<a name="tc_dvdrip_clipping">
</a></p><h4><a name="tc_dvdrip_clipping">4.2.1. Clipping and zooming</a></h4>

<a name="tc_dvdrip_clipping">Now head over to the </a><a href="http://www.bunkus.org/dvdripping4linux/images/dvdrip-clipzoom.png" target="_blank">Clip &amp; Zoom</a> tab. Here's where you set all parameters 
regarding picture size and cropping (called "clipping" here). First get 
yourself a picture to work with: simply enter a frame number (like 200) 
into the <code>Grab Preview Frame</code> input line and press <code>Grab 
Frame from ripped VOB</code>. After a few seconds the three views below 
show the frame you requested.<p>

<em>transcode</em> uses three steps to bring the picture to its final size:
first it clips the unscaled image, then it does resizing and last it
clips again. Each of this steps can be left out by selecting 0 for clipping
and the original width and height for resizing. Each window shows the result
of those three steps. If you want to see how big the pictures really are
then just click onto any of them and a pop-up window will be opened containing
the result.</p><p>

You may have noticed the drop-down listbox below the three preview windows.
<em>dvd::rip</em> offers a wide rage of presets for you to work with. Simply
select one of those gives you a place to start. You can still change the
values manually after selecting such a preset. All presets that are named
"autoadjust..." try to guess the correct clipping regions. After selecting
a preset hit the <code>Apply Preset Values</code> button. Now adjust the
values you got until you're happy.</p><p>

The <code>big frame</code>, <code>medium frame</code> and <code>small 
frame</code> parts refer to the final image size that is to be achieved. 
<code>big</code> keeps almost full DVD resolution, <code>medium</code> is 
somewhere between 500 to 600 for the width and <code>small</code> is somewhere 
around 350.</p>

One note about resizing: <code>Use fast resizing</code> has a big impact upon
image processing but requires that the target width and height are dividable by
32. Don't worry, <em>dvd::rip</em> will tell you if you can't use fast
resizing. Note also that while it is possible to actually enlarge the picture I
strongly advise against it. There are several drawbacks: the encoder needs a
lot more bits to achieve the same quality you'd get when encoding a smaller
picture and then scaling it up while playing it back, and you might even get
distorted pictures (Peter Schuller reported such a case to me). Always scale
down.

<a name="tc_dvdrip_params">
</a><h4><a name="tc_dvdrip_params">4.2.2. Chosing encoding parameters</a></h4>

<a name="tc_dvdrip_params">We're done with this tab. Open the </a><a href="http://www.bunkus.org/dvdripping4linux/images/dvdrip-transcode.png" target="_blank">Transcode</a> tab. First decide about the video codec you
want to use. If you've installed <em>DivX5 for Linux</em> then you can use
that, but I would recommend using <em>XviD</em>. If you've downloaded
<em>XviD</em> from CVS then the option to chose is <code>xvidcvs</code>
(obviously). If <em>transcode</em> later aborts with some obscure error
then you can try <code>xvid</code>.<p>

Do you remember that I asked you to check if the video was interlaced? Now we
need it. If your video is not interlaced then simply leave
<code>deinterlacing</code> to and <code>antialias</code> off. Otherwise
select <code>3 - Zoom To Full Frame</code>. This is the slowest but best
looking deinterlacer. Again here's the <a href="http://www.bunkus.org/dvdripping4linux/images/interlaced.png" target="_blank">interlaced sample</a> from Ally McBeal. You can see
the result from <code>3 - Zoom To Full Frame</code> in the
<a href="http://www.bunkus.org/dvdripping4linux/images/deinterlaced-tc.png" target="_blank">first deinterlaced
picture</a>.</p><p>

Another filter for deinterlacing is provided by an external plugin (don't
worry you've already installed it with <em>transcode</em> itself).
Have a look at the lower right. There's a input box labeled
<code>transcode options</code>. All options entered here are simply passed
along to transcode. We can use this for deinterlacing. Here's the same
picture as above <a href="http://www.bunkus.org/dvdripping4linux/images/deinterlaced-dilyuvmmx.png" target="_blank">
deinterlaced with other deinterlacer</a>. This deinterlacer
is faster than the <code>3 - Zoom To Full Frame</code> option. If you want
to use this deinterlacer then set <code>deinterlace</code> to <code>off</code>
and enter <code>-J dilyuvmmx</code> in the input line.</p><p>

<em>dvd::rip</em> tries to autodetect your framerate. If it failed you can
correct it here. <code>Use YUV internal</code> should always be
<code>yes</code> unless the output codec does not support YUV modes.
<em>XviD</em> does. Leaving it on gives a huge speed boost. <code>DivX
multipass</code> should be <code>yes</code> aswell unless you only want
to do a preview. For final results always chose two pass encoding. Although
this is labeled <code>DivX multipass</code> it works nicely with <em>XviD</em>
aswell.</p><p>

The audio options should be self explanatory. You chose either to reencode
the audio to MP3 using the specified bitrate or to use the original AC3
sound without reencoding. AC3 audio provides surround sound and all those
advantages but is bigger than MP3 sound. It's really your choice. If you
use MP3 then make sure that the <code>MP3 Quality</code> setting is at
<code>2</code>. According to <em>lame</em>'s documentation (<em>lame</em>
is used for MP3 compression) higher quality settings like <code>1</code> or
<code>0 - best but slower</code> are at lot slower but do not produce
significantly higher quality. The <code>volume rescale</code> allows
normalization the audio which does not require a separate (external) program.
<en>dvd::rip</en> automagically scans the sound and provides a rescale value.</p><p>

In the upper right is the bitrate option. You can easily chose the rip size
by selecting the count and size of CDs you want to use. Manipulating
the <code>Target Size</code> or the <code>Video Bitrate</code> works aswell.
<en>dvd::rip</en> automatically updates the calculated values below so
finding the optimal bitrate is rather easy.

<a name="tc_dvdrip_preview">
</a></p><h4><a name="tc_dvdrip_preview">4.2.3. Generating a quick preview</a></h4>

<a name="tc_dvdrip_preview">Most of the times you should let <em>dvd::rip</em> generate a small preview.
You do that by providing a <code>Frame Range</code>. I usually take a 30 second
sample which would be 750 frames at 25fps (&lt;number of seconds&gt; *
&lt;fps&gt; = &lt;number of frames to encode&gt;) and start sometime into the
movie (like 200, 300 frames). Good values might be <code>200 - 950</code>. You
should also give <em>transcode</em> a high nice level (which results in a low
process priority) so it will only use spare time. If you really want your
preview right here right now you can also temporarily disable <code>DivX
Multipass</code>. Just remember to turn it back on later!</a><p>

<a name="tc_dvdrip_preview">When you're done click <code>Transcode</code>. After a couple of minutes
at most your AVI/MPEG will be ready. Now have a look at it (like
<code>mplayer my-new-file.avi</code>). This is a good moment to see if
deinterlacing works as expected and to check if audio and video are in
synch. If they are, you're set. If they aren't, then read on:

</a><a name="tc_dvdrip_avsync">
</a></p><h4><a name="tc_dvdrip_avsync">4.2.4. Preventing audio/video desynchronization</a></h4>

<a name="tc_dvdrip_avsync">If your audio and video are not synchronized in the preview (or when you
play back the DVD itself) then you can give <em>transcode</em> a frame
offset for the a/v synch. You do that by providing the parameter <code>-D nr
</code> in the <code>transcode options</code> input line on the
<code>Transcode</code>tab. The <code>nr</code> is the number of frames the
audio is delayed. This number can be negative. A frame is 40msecs long
at 25fps. In general the frame length is (1000 / fps)msecs long. For my
Ally McBeal DVD I need a correction of -2 which amounts to -80msecs:
<code>-D -2</code>. Now regenerate your preview video (the other parameters
should still be the same) and check the audio again. If needed redo this
step until you're satisfied.

</a><a name="tc_dvdrip_doit">
</a><h4><a name="tc_dvdrip_doit">4.2.5. Doing the whole thing</a></h4>

<a name="tc_dvdrip_doit">When the preview is fine you can start your transcode. Make sure that
<code>DivX Multipass</code>  is turned on again if you disabled it for
the preview. Either click on <code>Transcode</code> or on <code>Transcode
+ Split</code> if you want your files to be split automatically according
to the settings under <code>Video Bitrate Calculation</code>.</a><p>

<a name="tc_dvdrip_doit">Now is really a fine time for some socialising :-)

</a><a name="tc_dvdrip_commandline">
</a></p><h4><a name="tc_dvdrip_commandline">4.2.6. For advanced users: <em>transcode</em> command line arguments</a></h4>

<a name="tc_dvdrip_commandline">This chapter explains the <em>transcode</em> command line options used by
<em>dvd::rip</em>. It is not crucial to the trascoding process so you may
as well skip it. I provide it for those who wish to have some deeper insight
into what <em>dvd::rip</em> and <em>transcode</em> do.</a><p>

<a name="tc_dvdrip_commandline">In <em>dvd::rip</em> press <code>CTRL-t</code> to see what the commands
<em>dvd::rip</em> executes look like. For now let's concentrate on the last
set of commands, <code>Transcode command</code>. Here's an example for my
<em>Star Trek: The Next Generation</em> DVD without all those <code>mkdir</code>
and <code>cd</code> commands:
</a></p><ol>
<a name="tc_dvdrip_commandline"> <li><code>transcode -i /space/tng-biggoodbye/vob/004 -w 4357,250,100
   -a 1 -b 128,0,0 -s 3.311 -V  -f 25 -B 12,10,8 -R 1 -x vob,null -o /dev/null
   -y xvidcvs,null</code></li>
 <li><code>transcode -i /space/tng-biggoodbye/vob/004 -w 4357,250,100
   -a 1 -b 128,0,0 -s 3.311 -V  -f 25 -B 12,10,8 -R 2 -x vob
   -o /space/tng-biggoodbye/avi/004/tng-biggoodbye-004.avi -y xvidcvs</code>
   </li>
</a></ol>

<a name="tc_dvdrip_commandline">Let's take a look at the first command and its parameters:
</a><ul>
<a name="tc_dvdrip_commandline"> <li><code>-i /space/tng-biggoodbye/vob/004</code> obviously tells
  <em>transcode</em> where to find the files. It can be a file, a device
  or a directory containing the files.</li>
 <li><code>-w 4357,250,100</code> sets the video encoding parameters: bit rate,
  maximum key frame interval and crispness.</li>
 <li><code>-a 1</code> selects audio track number 1 (starting with 0).</li>
 <li><code>-b 128,0,0</code> sets the audio encoding parameters for
  <em>lame</em>: bit rate, vbr and quality. Have a look at <em>lame</em>'s
  man page for an explanation of the parameters <code>-V</code> and
  -q.</li>
 <li><code>-s 3.311</code> causes <em>lame</em> to scale the audio
  and thus normalizing it on the fly.</li>
 <li><code>-V</code> causes <em>transcode</em> to do image processing
  in the YUV color space. Without <code>-V</code> images would be converted
  to the RGB color space. Note that some external filters only work with
  either color space. YUV processing gives a huge speed boost.</li>
 <li><code>-f 25</code> sets the frame rate.</li>
 <li><code>-B 12,10,8</code> sets the fast scaling options: the picture
  will be scaled down to <code>height - 12 * 8</code> rows and to
  <code>width - 10 * 8</code> columns.</li>
 <li><code>-R 1</code> is the marker for the first (of two) encoding pass.</li>
 <li><code>-x vob,null</code> - the video input comes from VOB files and
  the audio input will be skipped (it isn't needed for the first pass anyway).
  </li>
 <li><code>-o /dev/null</code> - We don't need the video either, so just
  discard it.</li>
 <li><code>-y xvidcvs,null</code> - Output video using <em>XviD</em> and
  discard audio.</li>
</a></ul>

<a name="tc_dvdrip_commandline">The second command line is not that different. It just skips all options
that would discard output (like <code>-o real-file-name</code> and
<code>-y xvidcvs</code>). For a more complete reference have a look at
<em>transcode</em>'s and <em>lame</em>'s man pages.</a><p>

<a name="tc_dvdrip_commandline">As a last note you will find that <em>transcode</em> as of version
0.6.0pre6-20020529 contains support for <em>libavcodec</em> via a still 
experimental export module writte by me. You can activate it by using <code>-y 
ffmpeg4</code> (remember: <em>libavcodec</em> is part of <em>ffmpeg</em>) 
instead of your previous codec. <em>dvd::rip</em> does not support it at the 
moment (read: it is not in the list of selectable codecs).

</a><a name="transcoding_mplayer">
</a></p><h3><a name="transcoding_mplayer">4.3. Using <em>MEncoder</em></a></h3>

<a name="transcoding_mplayer">As mentioned earlier there is no GUI for <em>MEncoder</em> at the moment.
Therefore I won't provide screenshots and you have to do everything by hand.
This is a process called "three pass encoding".

</a><a name="tc_mplayer_audio">
</a><h4><a name="tc_mplayer_audio">4.3.1. Encoding the audio</a></h4>

<a name="tc_mplayer_audio">The first step is to encode only the audio. Make sure you know what audio
language you want to use - you need either the audio id (which is 128 for
the first stream, 129 for the second etc.) or the two-letter country code
(like <code>en</code> for Englisch or <code>de</code> for German). You can
find out about these codes by running <em>MPlayer</em> in verbose mode:
<code>mplayer -dvd 1 -v</code>. It should print a lot of lines. Search
these for lines similar to:<br>
<code>[open] audio stream: 0 audio format: ac3 language: en aid: 128<br>
[open] audio stream: 1 audio format: ac3 language: de aid: 129<br>
[open] audio stream: 2 audio format: ac3 language: es aid: 130</code><br>
Here I have three audio streams: English, German, Spanish and their ids.</a><p>

<a name="tc_mplayer_audio">Now call <em>MEncoder</em> to encode the audio for you:<br>
<code>nice -+19 cat /space/*vob | nice-+19 mencoder -ovc frameno
 -o frameno.avi -oac mp3lame -lameopts abr:br=128 -alang de -</code><br>
Here's an explanation for the command line arguments used:
</a></p><ul>
<a name="tc_mplayer_audio">  <li><code>nice -+19</code> - Gives <em>MEncoder</em> the lowest process
    priority so it won't disrupt your normal work.</li>
  <li><code>-ovc frameno</code> - Output Video Codec is <code>frameno</code>
    which means that no video data is actually written or processed at all.
    </li>
  <li><code>-o frameno.avi</code> - Write the output to the file called
    <code>frameno.avi</code>. The audio <b>must</b> be written to a file
    with that name as <em>MEncoder</em> wil read the audio from exactly
    this file with the exact name in the next step.</li>
  <li><code>-oac mp3lame</code> - Output Audio Codec is the <em>lame</em>
    encoder library.</li>
  <li><code>-lameopts abr:br=128</code> - options for <en>lame</en>. It tells
    <en>lame</en> to produce a ABR (average bitrate, it's a variable bitrate
    setting with the average supplied by the user) with the average bitrate
    of 128kbit/s.</li>
  <li><code>-alang de</code></li> - use the German sound track. An alternative
    is using <code>-aid 129</code>.
</a></ul>

<a name="tc_mplayer_audio">Wait some time and you'll have your audio. <em>MEncoder</em> even prints
some suggestions for the video bitrate:<br><code>
Recommended video bitrate for 650MB CD: 1845<br>
Recommended video bitrate for 700MB CD: 1992<br>
Recommended video bitrate for 800MB CD: 2287</code><br>
As you can see these values are rather high - but that's because an Ally
McBeal episode is only 41minutes long. So I'd go for two episodes per
CD and give the video a bitrate of about 1000.

</a><a name="tc_mplayer_preview1">
</a><h4><a name="tc_mplayer_preview1">4.3.2. Generating a preview (first pass)</a></h4>

<a name="tc_mplayer_preview1">Now's the time to decide about the video codec you're going to use. I'm
assuming that AVI is the desired result with one of the different <em>DivX</em>
encoders. <em>MEncoder</em> has support for <em>DivX 4</em> <b>or</b>
<em>DivX 5</em> (same under Windows actually, you have either v4 or v5
running) as well as for <em>XviD</em> or <em>lavc</em>. Although most of you
won't have heard of <em>libavcodec</em> or the <em>ffmpeg-project</em> before
you should be advised that <em>lavc</em> is far superior to <em>DivX 4 or 5</em>
and at least as good as <em>XviD</em>. So I will only provide examples
for <em>lavc</em> as you don't even need special codecs for playback:
<em>MPlayer</em> plays them just fine (naturally), and for Windows you simply
need <em>DivX 5</em> (free edition is absolutely sufficient). So here we go.</a><p>

<a name="tc_mplayer_preview1">Let's assemble the command line options one by one:
</a></p><ul>
<a name="tc_mplayer_preview1">  <li><code>-nosound</code> - We don't need sound in the first pass, so let's
    just disable it.</li>
  <li><code>-o /dev/null</code> - The output of the first pass isn't needed
    either, so just dump it.</li>
  <li><code>-ovc lavc</code> - chose <em>lavc</em> as the Output Video
    Codec.</li>
  <li><code>-lavcopts vcodec=mpeg4:vbitrate=1000:vhq:vqmin=1:vqmax=31:vpass=1
    </code> - 
    <em>libavcodec</em> actually supports a handful of different video codecs.
    With <code>vcodec=mpeg4</code> we chose the MPEG4 compliant encoder.
    <code>vbitrate=1000</code> is the desired bitrate. <code>vhq</code>
    (very high quality) tells the encoder to spend a lot of time
    optimizing the results. It is worth it. <code>vpass=1</code> finally
    tells the encoder that this is the first pass only. Using
    <code>vqmin</code> and <code>vqmax</code> tells the codec how much
    it may compress the video at least and at most. Keeping these
    at their defaults (see <code>man mencoder</code>) restricts the
    achievable output bitrate a lot so I advice chosing a broader range.
    Note that I'm no expert on quantizers. If I'm wrong here please
    </li></a><a href="mailto:moritz@bunkus.org">drop me a line</a>.
  <li><code>-vop scale=640:480</code> - scale the picture down to
    640 by 480 pixels. I've read on the mailing list that a new switch 
    has been added that automatically calculates the height from the width
    or the other way round so that the aspect ratio will be kept. I haven't
    tried it myself but it should look like this: <code>-vop scale -xy 640
    </code>. Note that while it is possible to actually enlarge the picture
    I strongly advise against it. There are several drawbacks: the encoder
    needs a lot more bits to achieve the same quality you'd get when
    encoding a smaller picture and then scaling it up while playing it back,
    and you might even get distorted pictures (Peter Schuller reported
    such a case to me). Always scale down.</li>
  <li>If your picture is interlaced you can deinterlace it with
    <code>-npp lb</code>.</li>
  <li>We only want a preview so we provide the start position and the length:
    <code>-ss 0:20</code> specifies 20seconds into the movie as our beginning,
    and <code>-endpos 0:30</code> says that we want 30seconds to be processed.
    This parameter is named badly as it's not the end position but the
    duration that it specifies.</li>
</ul>
Put together the complete command line looks like this:<br>
<code>nice -+19 mencoder -nosound -o /dev/null -ovc lavc -lavcopts
vcodec=mpeg4:vbitrate=1000:vhq:vpass=1 -vop scale=640:480 -npp lb
-ss 0:20 -endpos 0:30 /space/first.vob
</code><br>

<a name="tc_mplayer_preview2">
</a><h4><a name="tc_mplayer_preview2">4.3.3. Generating a preview (second pass)</a></h4>

<a name="tc_mplayer_preview2">For this step we can keep most of our previous command line. Of course
we change the <code>vpass=1</code> to <code>vpass=2</code> to tell the encoder
that it's the second pass this time. Additionally we leave out the <code>
-nosound</code> and replace it with <code>-oac copy</code> which simply
copies the audio from the <code>frameno.avi</code> file we created in step
one. Of course we should save the final output and replace <code>-o /dev/null
</code> with something usefule, e.g. <code>-o ally-preview.avi</code>.</a><p>

<a name="tc_mplayer_preview2">Here's the command line:<br>
<code>nice -+19 mencoder -oac copy -o ally-preview.avi -ovc lavc -lavcopts
vcodec=mpeg4:vbitrate=1000:vhq:vpass=2 -vop scale=640:480 -npp lb
-ss 0:20 -endpos 0:30 /space/first.vob
</code><br>
After <em>MEncoder</em> finishes take a look at your preview. Adjust parameters
if needed. Redo the preview until you're happy with it.

</a><a name="tc_mplayer_final">
</a></p><h4><a name="tc_mplayer_final">4.3.4. Generating the final AVI (both passes)</a></h4>

<a name="tc_mplayer_final">The calls for the final options simply leave out <code>-ss</code> and
<code>-endpos</code>. Unfortunately <em>MEncoder</em> can't handle multiple
input files on the command line. That's what the <code>cat</code> is for.
Just enter:<br><code>
cat /space/*vob | nice -+19 mencoder -nosound -o /dev/null -ovc lavc -lavcopts
vcodec=mpeg4:vbitrate=1000:vhq:vpass=1:vqmin=1:vqmax=31 -vop scale=640:480
-npp lb -<br>
cat /space/*vob | nice -+19 mencoder -oac copy -o ally.avi -ovc lavc -lavcopts
vcodec=mpeg4:vbitrate=1000:vhq:vpass=2:vqmin=1:vqmax=31 -vop scale=640:480
-npp lb -</code><br>
Note that <code>-ss</code> does not seem to work with the <code>cat *vob |
mencoder...</code> variant. So for the preview just specify the first
vob as the last argument on the command line (just look up).</a><p>

<a name="tc_mplayer_final">Now go get a beer and a nice book.
</a></p><p>
<a name="tc_mplayer_final"><font size="-2">Back to the </font></a><font size="-2"><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="tricks">
</a><h2><a name="tricks">5. Additional tricks</a></h2>

<a name="tricks">There are some more topics involved in video production.

</a><a name="tricks_sync">
</a><h3><a name="tricks_sync">5.1. Fixing desynched audio</a></h3>

<a name="tricks_sync">This does not work with AVIs that use VBR/ABR MP3s. This step uses
<code>avisync</code> which is part of the <em>transcode</em> package.</a><p>

<code><a name="tricks_sync">avisync</a></code><a name="tricks_sync"> is easy to use: just provide an input file
(<code>-i name.avi</code>), an output file (<code>-o newname.avi</code>)
and the synch offset in frames (<code>-n count</code>). From <code>
avisync</code>'s help: <code>count&gt;0: audio starts with frame 'count'.
count&gt;0: prepend 'count' padding audio frames</code>. An example:<br>
<code>avisync -i ally-not-synched.avi -o ally-synched.avi -n -2</code>

</a><a name="tricks_split">
</a></p><h3><a name="tricks_split">5.2. Splitting AVIs</a></h3>

<a name="tricks_split">This does not work with AVIs that use VBR/ABR MP3s. This step uses
<code>avisplit</code> which is part of the <em>transcode</em> package. Use 
it only with AVIs generated by <em>transcode</em>.</a><p>

<code><a name="tricks_split">avisplit</a></code><a name="tricks_split"> is easy to use: just provide an input file
(<code>-i name.avi</code>) and when it should split. You can split after
a fixed size (<code>-s size_in_megs</code>), after a number of frames
(<code>-f f1-f2</code>) or after a number of seconds (<code>-t s1-s2</code>).
An example:<br>
<code>avisplit -i ally-big-file.avi -o ally -s 700</code><br>
This will produce files named <code>ally-0000.avi, ally-0001.avi</code> etc.
that are each 100megs big at most.

</a><a name="tricks_extractaudio">
</a></p><h3><a name="tricks_extractaudio">5.3. Extracting audio from VOBs/MPEGs/AVIs</a></h3>

<a name="tricks_extractaudio"><em>MPlayer</em> can be used easily to extract sound. The <code>-vo null</code>
options tells <em>MPlayer</em> not to show the video.

</a><ul>
<a name="tricks_extractaudio"> <li>VOB -&gt; AC3: <code>mplayer -vo null -nogui -alang de -dumpaudio
   -dumpfile lang-de.ac3 *vob</code><br>This will extract the German audio to
   a file called <code>lang-de.ac3</code>.</li>
 <li>VOB -&gt; WAV: <code>mplayer -vo null -nogui -aid 128 -ao pcm 
   -aofile lang-de.wav *vob</code><br>This will extract audio track no. 128,
   downmix the AC3 sound to PCM and write the results to
   <code>lang-de.wav</code>.</li>
 <li>MPG -&gt; MP2: <code>mplayer -vo null -nogui -dumpaudio
   -dumpfile audio.mp2 myvideo.mpg</code><br>This will extract the audio to
   a file called <code>audio.mp2</code>.</li>
 <li>AVI -&gt; WAV: <code>mplayer -vo null -nogui -ao pcm -aofile audio.wav
   myvideo.avi</code><br>This will extract the audio, convert it to PCM
   and write the resulting .WAV to <code>audio.wav</code>.</li>
</a></ul>

<a name="tricks_extractaudio">I'm not listing all possible options. Generally use <code>-dumpaudio -dumpfile
newaudio.extension</code> if you want to extract the audio without processing
and <code>-ao pcm -aofile newaudio.wav</code> if you want the WAV itself.

</a><a name="tricks_extraaudio">
</a><h3><a name="tricks_extraaudio">5.4. Using separate audio files</a></h3>

<a name="tricks_extraaudio">Sometimes you want to play another audio file along with your video.
<em>MPlayer</em> makes this rather easy: <code>mplayer -audiofile
anotherlang.mp3 myvideo.avi</code> plays video from <code>myvideo.avi</code>
and audio from <code>anotherlang.mp3</code>. A lot of Windows media players
support external audio files, too. This way you can provide sevaral language
versions as separate audio files. A combination often used is to have the AVI
include the English audio track and to provide additional audio tracks in
separate files.
</a><p>
<a name="tricks_extraaudio"><font size="-2">Back to the </font></a><font size="-2"><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="links">
</a><h2><a name="links">6 Links</a></h2>

<a name="links_libs">
</a><h3><a name="links_libs">6.1. Libraries, codecs</a></h3>

<ul>
<a name="links_libs"> <li>libdvdread and libdvdcss:
   </li></a><a href="http://www.dtek.chalmers.se/groups/dvd/downloads.shtml" target="_blank">http://www.dtek.chalmers.se/groups/dvd/downloads.shtml</a>
   
 <li>DivX 5: <a href="http://www.divx.com/" target="_blank">
   http://www.divx.com/</a></li>
 <li>XviD: <a href="http://www.xvid.org/" target="_blank">http://www.xvid.org/
   </a></li>
 <li>ffmpeg (the home of <em>libavcodec</em>):
   <a href="http://ffmpeg.sourceforge.net/" target="_blank">
   http://ffmpeg.sourceforge.net/</a></li>
</ul>

<a name="links_players">
</a><h3><a name="links_players">6.2. Media players</a></h3>

<ul>
<a name="links_players"> <li>MPlayer: </li></a><a href="http://www.mplayerhq.hu/" target="_blank">
   http://www.mplayerhq.hu/</a>
 <li>Xine: <a href="http://xine.sourceforge.net/" target="_blank">
   http://xine.sourceforge.net/</a></li>
 <li>Ogle: <a href="http://www.dtek.chalmers.se/groups/dvd/index.shtml" target="_blank">http://www.dtek.chalmers.se/groups/dvd/index.shtml</a></li>
</ul>

<a name="links_encoders">
</a><h3><a name="links_encoders">6.3. Media encoders</a></h3>

<ul>
<a name="links_encoders"> <li>MEncoder (part of MPlayer): </li></a><a href="http://www.mplayerhq.hu/" target="_blank"> http://www.mplayerhq.hu/</a>
 <li>transcode: <a href="http://www.theorie.physik.uni-goettingen.de/%7Eostreich/transcode/" target="_blank">http://www.theorie.physik.uni-goettingen.de/~ostreich/transcode/
   </a></li>
 <li>dvd::rip (GUI for transcode): <a href="http://www.exit1.org/dvdrip/" target="_blank">http://www.exit1.org/dvdrip/</a></li>
 <li>some perl scripts for transcode:
   <a href="http://www9.informatik.uni-erlangen.de/%7EVogelgsang/bp/tctools.html" target="_blank">http://www9.informatik.uni-erlangen.de/~Vogelgsang/bp/tctools.html
   </a></li>
</ul>

<a name="links_docs">
</a><h3><a name="links_docs">6.4. Other documentation</a></h3>

<a name="links_docs">Both <em>MPlayer</em> and <em>transcode</em> come with standard Unix
man pages: <code>man mplayer</code>, <code>man mencoder</code> and
<code>man transcode</code> show these pages. Additionally providing
<code>-h</code> or <code>--help</code> as the only parameter to one
of these programs will give you a listing of command line options (which
might not be complete).</a><p>

</p><ul>
<a name="links_docs"> <li>MPlayer's documentation: </li></a><a href="http://www.mplayerhq.hu/DOCS/" target="_blank">http://www.mplayerhq.hu/DOCS/</a>
 <li>transcode's documentation and examples:
   <a href="http://www.theorie.physik.uni-goettingen.de/%7Eostreich/transcode/examples.html#top" target="_blank">http://www.theorie.physik.uni-goettingen.de/~ostreich/transcode/examples.html#top
   </a></li>
 <li>The best place on the 'net for DVD ripping and conversion is
   <a href="http://www.doom9.org/" target="_blank">doom9</a>. Although it
   focuses on Windows it still provides a lot of insight on DVDs, codecs in
   general. Also the forum is quite excellent. If your really interested
   in video processing then this is the place for you.</li>
</ul>

<a name="links_mls">
</a><h3><a name="links_mls">6.5. Mailing lists</a></h3>

<a name="links_mls">I strongly suggest that you search/browse the mailing lists for information
and subscribe yourself. A lot of information is available there that has
not made it into the main documentation or the command line reference.</a><p>

</p><ul>
<a name="links_mls"> <li>MPlayer's user mailing list: </li></a><a href="http://mplayerhq.hu/mailman/listinfo/mplayer-users" target="_blank">http://mplayerhq.hu/mailman/listinfo/mplayer-users</a>
 <li>MPlayer's developer mailing list: <a href="http://mplayerhq.hu/mailman/listinfo/mplayer-dev-eng" target="_blank">http://mplayerhq.hu/mailman/listinfo/mplayer-dev-eng</a></li>
 <li>transcode's user mailing list: <a href="http://www.theorie.physik.uni-goettingen.de/pipermail/transcode-users/" target="_blank">http://www.theorie.physik.uni-goettingen.de/pipermail/transcode-users/
   </a></li>
 <li>dvd::rip's mailing list: <a href="http://www.exit1.org/dvdrip/list.cipp" target="_blank">http://www.exit1.org/dvdrip/list.cipp</a></li>
</ul>
<p>
<font size="-2">Back to the <a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="glossary">
</a><h2><a name="glossary">7. Glossary</a></h2>

<a name="glossary_vbrcbr">
</a><h3><a name="glossary_vbrcbr">7.1. CBR, VBR and ABR</a></h3>

<a name="glossary_vbrcbr">These three acronyms stand for <em>Constant Bit Rate</em>, <em>Variable
Bit Rate</em> and <em>Average Bit Rate</em>.</a><p>

<a name="glossary_vbrcbr">With <em>CBR</em> the encoder spends the same amount of bits on each
frame, regardless of how much it would really need. This has the disadvantage
that for example complete black pictures or complete silence in an audio
frame would waste a lot of bits while pictures or audio frames with a lot
of elements would benefit from these bits.</a></p><p>

<a name="glossary_vbrcbr"><em>VBR</em> now takes as much bits as it needs. So black pictures get
very few bits and complex pictures get as much as they need. While this
provides the best quality the final size can't be predicted at all.</a></p><p>

<a name="glossary_vbrcbr">This is were <em>ABR</em> kicks in. You specify an average bit rate you
want to achieve and the encoder distributes the bits it has available. Those
bits it saves on black pictures it spends on complex pictures. It is
a compromise between quality and size predictability.</a></p><p>

<a name="glossary_gmc">
</a></p><h3><a name="glossary_gmc">7.2. Global Motion Compensation (GMC)</a></h3>

<a name="glossary_gmc">Global motion compensation (GMC) helps in zooming (bringing the camera closer)
and panning (swivelling the camera), if the objects remain static in type and
only change in size and position within an image.  Activation of GMC is
advisable if nature films or landscape documentation are to be compressed.</a><p>

<a name="glosarry_letterbox">
</a></p><h3><a name="glosarry_letterbox">7.3. Letterboxing</a></h3>

<a name="glosarry_letterbox">Perhaps you've noticed that video is sometimes surrounded by black bars
prior to encoding. This process is called letterboxing. It can help to
maintain the correct aspect ratios for some players. Others use the black
bars for displaying subtitles. The disadvantage is that these bars enlarge
the picture and therefore require more bandwidth to encode although completely
black parts shouldn't need much space.

</a><a name="glossary_bframes">
</a><h3><a name="glossary_bframes">7.4. P/I/B-Frames, GOPs</a></h3>

<a name="glossary_bframes">This was taken from </a><a href="http://www.doom9.org/" target="_blank">doom9's
</a> Forum:<p>

This is a quick explaination of an MPEG "GOP", or, "Group Of Pictures".</p><p>

GOP:
</p><ul>
  <li>begins with an "I" frame, followed usually by a number of "P" 
    and "B" frames</li>
  <li>each GOP is independant: all frames needed for predictions are
    contained within each GOP</li>
  <li>GOPs can be as small as a single I frame, or as large as
    desired, but usually no more than 15 frames in length for MPEG2.
    With MPEG4 GOPs can be as large as the maximal keyframe interval
    (usually 200 - 300 frames). Most codecs permit GOPs of unlimited
    length.</li>
  <li>The longer the GOP, the more efficient, but less rubust the
    coding</li>
</ul>

I frame:
<ul>
  <li>"Intra-coded" frames : average 7:1 reduction.</li>
  <li>like JPEG, every video frame is broken into blocks of 8x8
    pixels of Y, R-Y, and B-Y</li>
  <li>blocks are grouped into "macroblocks" of 16x16</li>
  <li>The standards say that macroblocks are grouped horizontally into slices
    which have similar average block levels although real life codecs
    don't necessarily follow that rule.</li>
  <li>Again the standards say that multiple slices form a frame, and that
    these frames are the resulting "I" frames, although codecs don't
    really follow thath either.</li>
</ul>

P frame:
<ul>
  <li>P frames are predicted based on prior I or P frames plus
    the addition of data for changed macroblocks.</li>
  <li>average about 20:1 reduction, or about half the size of I
    frames</li>
</ul>

B frame:
<ul>
  <li>Bidirectionally predicted frames based on appearance and
    positions of past and future frames macroblocks.</li>
  <li>B frames require less data than P frames, averaging about
    50:1 reduction.</li>
  <li>B frames require more decoder buffer memory because 2
    frames are compared during the reconstruction process.</li>
  <li>B frames also require manipulation of the coding order:
    frames moving from the coder to the decoder are NOT in
    presentation sequence.</li>
</ul>

For every macroblock in a P frame the encoder decides whether it
already knows this block from the preceding frame or whether it's completely
new. In the former case it only encodes the differences (INTER mode). In
the latter case it encodes the whole macroblock (INTRA mode).<p>

The situation for B frames is like this: "I don't know that block" (INTRA
mode), "I know that block from the preceding I or P frame (backward mode)",
"this block looks like the block in the following frame (forward mode)" or
"this block looks like a mixture of the blocks from the preceding and the
following frames (bidirectional mode)".</p><p>

MPEG1 GOPs are always "IBBPBBPBBPBB" (this is the order in which the frames
are displayed, not necessarily the order in which they were encoded/saved).
MPEG2 GOPs look like that aswell. They may aswell contain three B frames.
The DivX5 MPEG4 codec only uses "IBPBPBPBPB" because it's easier to implement
and because B frame support for MPEG4 codecs is rather new. You may expect
to see more B frames in the future.</p><p>

<a name="glossary_qpel">
</a></p><h3><a name="glossary_qpel">7.5. Quarter Pixel (QP)</a></h3>

<a name="glossary_qpel">Quarter pel or quarter pixel affects the precision in filtering of macro
blocks. DivX 4 works with half pel (1.5, 1.5); 1.25, 1.75, etc. are possible
starting with DivX 5.  Conventional division of an image into macro blocks is
refined on the basis of integers - 16x16 or 8x8 - using the supplementary
information from what are known as virtual blocks.  This allows the motions of
objects in images to be reproduced more realistically.
</a><p>
<a name="glossary_qpel"><font size="-2">Back to the </font></a><font size="-2"><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="changelog">
</a><h2><a name="changelog">Changelog</a></h2>

<a name="changelog">TODO list:
</a><ul>
<a name="changelog"> <li>Add chapter about subtitles and letterboxing</li>
 <li>Add chapter about DVD -&gt; (S)VCD transcoding</li>
 <li>Add my software configuration (library versions etc) so that people
  have a reference of a working system</li>
 <li>Add more documentation about what to clip when you have letterboxed
  material</li>
 <li>Add information about using DivX5 despite its inferior quality because
  a lot of people want to use it :)</li>
 <li>Add chapter about including multiple audio tracks in an AVI</li>
</a></ul>

<hr>
<a name="changelog">June 3, 2002:
</a><ul>
<a name="changelog"> <li>Changed <code>mencoder ... /space/*vob</code> to <code>cat /space/*vob | 
  mencoder ... -</code> for the audio processing (thanks to E. Kevin 
  Hall).</li>
 <li>Added a note about region codes as they are a source for cryptic error 
  messages during the ripping process (thanks to Bradley Alexander).</li>
 <li>Added a note about <em>transcode's</em> new export module for
  <em>libavcodec</em>, <code>export_ffmpeg4</code>.</li>

</a><hr>

<a name="changelog">May 5, 2002:
</a><ul>
<a name="changelog"> <li>Fixed the glossary entry about P/I/B frames and GOPs (thanks to
  Christoph Lampert)</li>
 <li>Added a subchapter about aspect ratios (thanks to Christoph Lampert)</li>
 <li>Fixed some typos (VBR -&gt; ABR and others, thanks to various readers
  who reported them)</li>
 <li>Fixed mencoder command lines for multiple vob files (thanks to
  Christoph Terhechte and Frank Otto)</li>
</a></ul>

<hr>

<a name="changelog">May 3, 2002:
</a><ul>
<a name="changelog"> <li>Fixed <code>vpass=1</code> which should be <code>vpass=2</code> in 
  several places (thanks to Markus Liebl)</li>
</a></ul>

<hr>

<a name="changelog">May 2, 2002:
</a><ul>
<a name="changelog"> <li>Added explanations for transcode's command line options</li>
 <li>Added warnings about scaling pictures up (thanks to Peter Schuller)</li>
 <li>Added <code>vqmin</code> and <code>vqmax</code> to the recommended
  options for <em>libavcodec</em> (thanks to Peter Schuller)</li>
 <li>Added some links, fixed some typos</li>
</a></ul>

<hr>

<a name="changelog">May 1, 2002:
</a><ul>
<a name="changelog"> <li>Added explanations about audio and video codecs</li>
 <li>Fixed a lot of grammatical errors (thanks to Doug Shea)</li>
 <li>Added this changelog ;)</li>
 <li>Made two versions available - one big file or or file per chapter</li>
 <li>Guide available as one tar ball for download</li>
 <li>Provided an explanation and some sample images for interlaced video
   (thanks to Jason Smith)</li>
 <li>Started a glossary (thanks to Robos, creator of <em>vobcopy</em>)</li>
 <li>Added some links, fixed some errors</li>
</a></ul>

<hr>

<a name="changelog">April 30, 2002:
</a><ul>
<a name="changelog"> <li>Initial release</li>
</a></ul>
<p>
<a name="changelog"><font size="-2">Back to the </font></a><font size="-2"><a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

<a name="about">
</a><h2><a name="about">9 About</a></h2>

<a name="about">This guide was written by Moritz Bunkus. I'm a 24 year old student of
computer science at the Technical University Braunschweig, Germany.
Obviously I have too much spare time to waste :-)</a><p>

<a name="about"><b>This is the first release of this guide. Please provide feedback - what
did you like? What did you dislike? Where should I provide more information?
Please also correct mistakes that I have made. And please tell me about
programs / tools / scripts / documentation that I've missed. I can be reached
via email: </b></a><b><a href="mailto:moritz@bunkus.org">moritz@bunkus.org</a></b>
</p><p>
<font size="-2">Back to the <a href="http://www.bunkus.org/dvdripping4linux/single/index.html#toc">table of contents</a>
</font></p><p></p><hr>

</ul></body></html>
