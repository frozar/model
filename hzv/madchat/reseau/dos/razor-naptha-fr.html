<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Naphta Razor Advisories</title>
</head>

<body>

<b><font face="Verdana" size="2">Vulnérabilités DoS Naptha</font></b>
<p><font face="Verdana" size="2">Par <a href="mailto:info@razor.bindview.com">Robert
Keyes</a> pour <a href="http://razor.bindview.com">Razor</a><br>
Source : <a href="http://razor.bindview.com/publish/advisories/adv_NAPTHA.html">http://razor.bindview.com/publish/advisories/adv_NAPTHA.html</a>
<br>
Translation by <a href="mailto:eberkut@nexen.net">eberkut</a> - <a href="http://www.chez.com/keep">http://www.chez.com/keep</a></font></p>
<p style="margin-left: 0"><b><font face="Verdana" size="2">Vue d'ensemble</font></b></p>
<p style="margin-left: 0"><font face="Verdana" size="2">Une nouvelle catégorie
de vulnérabilités DoS a été découverte, et Naphta est le nom générique la
désignant. Les vulnérabilités proviennent de faiblesses dans la manière dont
la pile TCP/IP et les applications réseau manipulent l'état d'une connexion
TCP.</font>
<p style="margin-left: 0"><b><font face="Verdana" size="2">Systèmes Affectés</font></b></p>
<p style="margin-left: 0"><font face="Verdana" size="2">Une forte proportion des
applications et systèmes réseau</font></p>
<div align="left">
  <table border="0" width="101%" cellspacing="1">
    <tr>
      <th width="8%"><font face="Verdana" size="2">Constructeur</font></th>
      <th width="19%" align="center"><font face="Verdana" size="2">Produit</font></th>
      <th width="12%"><font face="Verdana" size="2">Vulnérable</font></th>
      <th width="19%"><font face="Verdana" size="2">état TCP</font></th>
      <th width="36%"><font face="Verdana" size="2">Patch/Workaround disponible
        ?</font></th>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Compaq</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Tru64 UNIX
        V4.0F</font></td>
      <td width="14%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">FreeBSD</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">FreeBSD 4.0-REL</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">General Linux</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Linux 2.0
        kernel-based systems</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Hewlett-Packard</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">HP-UX 11.00</font></td>
      <td width="14%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">IBM</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">AIX 4.3</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Non</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">N/A</font></td>
      <td width="36%"><font face="Verdana" size="2">N/A</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Microsoft</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Windows
        95,98,98SE</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">FIN-WAIT-1</font></td>
      <td width="36%"><font face="Verdana" size="2">Workaround disponible <a href="http://www.microsoft.com/technet/security/bulletin/MS00-091.asp">ici</a></font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Microsoft</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Windows NT 4.0
        SP6a</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">FIN-WAIT-1 /
        établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Patch disponible <a href="http://www.microsoft.com/Downloads/Release.asp?ReleaseID=25114">ici</a></font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Microsoft</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Windows 2000</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Non</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">N/A</font></td>
      <td width="36%"><font face="Verdana" size="2">N/A</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Novell</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Netware 5 SP1</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Red Hat</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Red Hat Linux
        7.0</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Non</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">N/A</font></td>
      <td width="36%"><font face="Verdana" size="2">N/A</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Red Hat</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Red Hat Linux
        6.1 Kernel 2.2.12</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">SGI</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">IRIX 6.5.7m</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Slackware</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Slackware Linux
        4.0</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
    <tr>
      <td width="8%"><font face="Verdana" size="2">Sun</font></td>
      <td width="19%" align="left"><font face="Verdana" size="2">Solaris 7, 8</font></td>
      <td width="12%" align="center"><font face="Verdana" size="2">Oui</font></td>
      <td width="19%" align="center"><font face="Verdana" size="2">établie</font></td>
      <td width="36%"><font face="Verdana" size="2">Pas encore de patch
        disponible</font></td>
    </tr>
  </table>
</div>
<p><font face="Verdana" size="2"><b>Notes</b></font></p>
<blockquote>
  <b><font face="Verdana" size="2">Compaq - Tru64 UNIX V4.0F</font></b>
  <p><font face="Verdana" size="2">Deux services ont été testés, portmapper
  (port TCP 111) et finger (port TCP 79). Ces services ont été choisis parce
  que le finger fonctionne de l'inetd et le portmapper fonctionne sans lui.</font></p>
  <p><font face="Verdana" size="2">Le kernel de Tru64 UNIX semble être quelque
  peu robuste contre des attaques de Naptha. L'envoi de 20000 paquets au port
  TCP 111 n'a causé aucune dégradation évidente d'exécution sur l'hôte de
  Tru64 UNIX (sauf que d'autres tentatives de requêtes sur le portmapper n'ont
  pas aboutie). La commande de netstat a montré une valeur équilibrée de 4100
  connexions ÉTABLIES.</font>
  <p><font face="Verdana" size="2">Cependant, envoyer quelques 100 paquets au
  TCP 79 a eu comme conséquence la création de trop de processus du démon
  fingerd pour que le système continue l'exécution normale. La tentative de
  commencer un nouveau processus d'un login shell a eu comme conséquence
  l'erreur &quot;no more process&quot;. Il est possible que l'attaque du démon
  fingerd aurait été moins pertinente avec une configuration différente
  d'inetd, ou avec différents paramètres du kernel.</font>
  <p><b><font face="Verdana" size="2">FreeBSD - FreeBSD 4.0-REL</font></b></p>
  <font face="Verdana" size="2">En testant FreeBSD, quelques démons/ports
  spécifiques ont été visés. Pour certains, la stabilité du système dans
  l'ensemble peut être affectée. Les démons visés lors de ce test ne sont
  pas nécessairement fautifs pour les problèmes encourus.</font>
  <p><font size="2"><b><font face="Verdana">SSH</font></b><font face="Verdana"><br>
  Est devenu inutilisable après 495 connexions au port ssh. Chaque connexion a
  commencé une instance du démon qui a rapidement épuisé les traitements
  disponibles de fichier ; le système signale &quot;too many open files in the
  system&quot;. Après approximativement 30 minutes les connexions commencent à
  se terminer et le système redevient utilisable.</font></font>
  <p><font size="2"><b><font face="Verdana">NFS</font></b><font face="Verdana"><br>
  Stoppe le fonctionnement après 964 paquets au port de NFS. Tandis que le
  reste du système ne semblait pas affecté, les connexions ne se sont pas
  terminée.</font></font>
  <p><font size="2"><b><font face="Verdana">BIND</font></b><font face="Verdana"><br>
  A pris 961 connexions de TCP avant que le kernel signale &quot;file table is
  full&quot;, et que le service TCP tombe en panne. UDP DNS a semblé inchangé.
  Ces connexions requiert un long temps d'attente avant de se terminer, au moins
  une heure.</font></font>
  <p><font size="2"><b><font face="Verdana">Note :</font></b><font face="Verdana">
  Ces services/ports peuvent être pareillement affectés sur d'autres variantes
  de Linux et d'Unix.</font> <font face="Verdana">General Linux - Linux 2.0
  kernel-based systems</font> <b><font face="Verdana">TELNET</font></b><font face="Verdana"><br>
  Le démon telnetd est mort après 500 paquets dans l'état ÉTABLI. Le démon
  telnetd n'a jamais récupéré, et ainsi beaucoup de ressources ont été
  épuisées, comme la mémoire, à tel point que le système a dû être
  relancé pour récupérer.</font></font>
  <p><font size="2"><font face="Verdana"><b>RPC</b><br>
  Le démon RPC a arrêté de répondre après 442 paquets dans l'état ÉTABLI.
  Comme l'attaque telnetd, on a compromis de la mémoire et d'autres ressources
  et le système a dû être relancé pour récupérer.</font> <font face="Verdana">Hewlett-Packard
  - HP-UX 11.00</font> <font face="Verdana">Deux services ont été testés,
  portmapper et telnet. Ces services ont été choisis parce que le telnet
  fonctionne avec inetd et le portmapper fonctionne sans lui.</font></font>
  <p><font size="2"><b><font face="Verdana">TELNET</font></b><font face="Verdana"><br>
  HP-UX semble avoir une certaine protection. Il cesse de répondre aux paquets
  de Naptha après plusieurs centaines de la même adresses IP. Cependant,
  jusqu'à ce qu'il soit possible de faire répondre le telnetd avec &quot;Telnet
  device drivers missing: No such device&quot;. Il récupère tout de même
  assez vite.</font></font>
  <p><font size="2"><font face="Verdana"><b>PORTMAPPER</b><br>
  Après plusieurs centaines de sessions de Naptha TCP, une session de telnet au
  port 111 sera immédiatement déconnectée. Cet état cassé dure beaucoup
  plus longtemps que le problème de telnet.</font> <font face="Verdana">Microsoft
  - Windows 95,98,98SE</font> <font face="Verdana">Laisser un grand nombre de
  connexions en FIN-WAIT-1 cause NetBIOS et les services WWW sur Windows 95, 98,
  et 98SE de Microsoft à échouer et à ne pas relancer.</font> <font face="Verdana">Microsoft
  - Windows NT 4.0 SP6a</font> <font face="Verdana">Exploiter l'état ÉTABLI
  sur le port 139 (netbios-ssn), cause la mort du service après 1010 paquets.
  Le port 135 (loc-srv) est mort après 7929 paquets. A noter que si le port 139
  avait été précédemment détruit par Naptha, le port 135 serai mort après
  2 paquets. Si l'attaque Naptha faisait une pause, le port 135 récupérerait
  mais serait immédiatement indisponible si l'attaque de Naptha était reprise.
  Quand le port 135 est mort, l'utilisation de l'unité de traitement
  arithmétique serait utilisée 100% et demeurerait dans cet état jusqu' à
  une réinitialisation.</font></font>
  <p><font face="Verdana" size="2">Laisser un grand nombre de connexions en
  FIN-WAIT-1 cause NetBIOS et les services WWW sur Windows NT 4.0 de Microsoft
  à échouer et à ne pas relancer.</font></p>
  <font size="2"><font face="Verdana">Novell - Netware 5 SP1</font> <font face="Verdana">Verrouillé
  après 3000 connexions ouvertes sur le port 524, utilisation à 100% des 64 Mo
  de RAM et du CPU. Le serveur n'avait toujours pas terminé les connexions ni
  récupéré de mémoire après 12 heures laissées en veille.</font> <font face="Verdana">Red
  Hat - Red Hat Linux 6.1 Kernel 2.2.12</font> <b><font face="Verdana">SSH</font></b><font face="Verdana"><br>
  En utilisant l'état ÉTABLI, le sshd est devenu inutilisable après 519
  paquets. L'utilisation de l'unité de traitement arithmétique a augmentée,
  rendant l'activité sur le système lente. Les processus démon engendrés ont
  empêcher de récupérer, bien que par la suite toutes les connexions en état
  ÉTABLI se sont terminées après environ 2 heures.</font></font>
  <p><font size="2"><b><font face="Verdana">RPC</font></b><font face="Verdana"><br>
  En utilisant l'état ÉTABLI, le démon RPC a cessé de répondre aux
  requêtes légitimes au bout d'environ 200 paquets, et est devenu inutilisable
  après 994 paquets. Le démon a dû être stoppé et relancé pour
  récupérer.</font></font>
  <p><font size="2"><b><font face="Verdana">SRP Telnet daemon</font></b><font face="Verdana"><br>
  Après 92 paquets, le démon telnet SRP-enabled a été surchargé. La reprise
  a exigé une réinitialisation pour effacer les processus et les connexions
  ÉTABLIE, qui ont eu des problèmes à se terminer toutes seules.</font> <font face="Verdana">SGI
  - IRIX 6.5.7m</font> <font face="Verdana">Deux services ont été testé,
  portmapper (port TCP 111) et sgi-dgl (port TCP 5232. Ces services ont été
  choisi parce que sgi-dgl fontionne avec inetd et portmapper fonctionne sans
  lui.</font></font>
  <p><font face="Verdana" size="2">Le kernel IRIX semble résister
  convenablement aux attaques Naptha. L'envoi de 20000 paquets au port TCP 111
  n'a causé aucune dégradation évidente d'exécution sur l'hôte Irix (sauf
  que d'autres tentatives de requêtes sur portmapper n'ont pas aboutie). La
  commande netstat a montré une valeur équilibrée de 195 connexions
  ÉTABLIES.</font>
  <p><font face="Verdana" size="2">Cependant, envoyer quelques 100 paquets au
  TCP 5232 a eu comme conséquence la création de trop de processus du démon
  dgl pour que le système continue l'exécution normale. La tentative de
  commencer un nouveau processus d'un login shell a eu comme conséquence
  l'erreur &quot;no more process&quot;. Il est possible que l'attaque du démon
  dgl aurait été moins pertinente avec une configuration différente d'inetd,
  ou avec différents paramètres du kernel.</font></p>
  <font size="2"><a name="Slackware"><font face="Verdana">Slackware - Slackware
  Linux 4.0</font> </a><b><font face="Verdana">TELNET</font></b><font face="Verdana"><br>
  Après 224 paquets ÉTABLI, le service TCP est tombé en panne et aucun autre
  processus ne peut être lancer. Un rebootage sauvage est nécessaire pour
  récupérer (ctrl-alt-suppr ne fonctionne pas).</font></font>
  <p><font size="2"><b><font face="Verdana">RPC<br>
  </font></b><font face="Verdana">Après 448 paquets ÉTABLI, le service TCP est
  tombé en panne et aucun autre processus ne peut être lancer. Comme pour
  telnet, un rebootage sauvage est nécessaire pour récupérer.</font></font>
  <h4><font size="2"><font face="Verdana">Sun - Solaris 7, 8</font> <font face="Verdana">Deux
  services ont été testé, portmapper et telnet. Ces services ont été choisi
  parce que telnet fonctionne avec inetd et portmapper fonctionne sans lui.</font></font></h4>
  <p><font size="2"><b><font face="Verdana">TELNET</font></b><font face="Verdana"><br>
  Au bout d'environ 700 sessions TCP Naptha, une session telnet sera obtenue,
  suivie du message &quot;can't grant slave pty&quot; et enfin débranchée. Au
  bout de 1700 sessions TCP Naptha, une session de telnet sera reliée mais rien
  d'autre ne se produit. Ceci n'est pas confiné au port de telnet mais bien à
  tous les ports. Si l'attaque de Naptha est arrêtée, par la suite le telnet
  récupérera. La durée pendant laquelle il est cassé dépend de la vitesse
  et de la longueur de l'attaque Naptha ainsi que d'autres facteurs. Le temps
  d'arrêt typique était une heure.</font></font>
  <p><font size="2"><b><font face="Verdana">PORTMAPPER</font></b><font face="Verdana"><br>
  Au bout d'environ 300 sessions TCP Naptha, une session telnet sur le port 111
  est immédiatement déconnectée (normalement, elle est déconnectée quand un
  utilisateur entre la clé d'entrée). Ce défaut n'affecte pas d'autres
  services. Le temps d'arrêt est variable mais dure en général 2 heures.</font></font>
</blockquote>
<p style="margin-left: 0">&nbsp;</p>
<b><font face="Verdana" size="2">Impact</font></b>
<p><font face="Verdana" size="2">En créant un nombre assez grand de connexions
TCP et en les laissant dans certains, les différentes applications ou le
système d'exploitation lui-même peuvent être mis hors service. Des attaques
exploitant les connexions de TCP de cette manière n'ont pas été mises en
application parce qu'elles épuisent aussi bien les ressources de l'attaquant
que celle de la cible. L'innovation apporté par l'attaque Naptha est qu'il est
possible de créer facilement un DoS sur la cible avec peu de consommation de
ressource de la part de l'attaquant.</font></p>
<b><font face="Verdana" size="2">Background</font></b>
<p><font size="2"><b><font face="Verdana">DoS</font></b><font face="Verdana"><br>
Une attaque DoS est une action utile pour dégrader de manière significative la
qualité et/ou la disponibilité des services d'un système.</font></font></p>
<p><font size="2"><b><font face="Verdana">DoS-&gt;RS</font></b><font face="Verdana"><br>
La Resource Starvation est un type d'attaque DoS. Ici nous avons besoin de
définir la différence entre une attaque et une vulnérabilité notable. Avec
des ressources réseau suffisantes à disposition de l'attaquant, n'importe quel
système est vulnérable à DoS-&gt;RS.<br>
Ce qui fait de DoS-&gt;RS une méthode notable est qu'elle consomme bien plus de
ressources auprès de la victime que de l'attaquant. Une différence importante
entre des niveaux de ressource indiquent une vulnérabilité dans le système de
la victime. Cette vulnérabilité s'exploite sous forme d'exploit.</font></font>
<p><font size="2"><b><font face="Verdana">DoS-&gt;RS-&gt;TCP_STATE</font></b><font face="Verdana"><br>
Le kernel log chaque connexion TCP. Un grand nombre de connexions,
indépendamment de l'activité, exigent plus de mémoire et de temps CPU. Il est
théoriquement possible pour un utilisateur sur un machine avec un grand
quantité de mémoire, une unité de traitement arithmétique rapide et un
système d'exploitation correctement configuré de perturber un peu le système
rien qu'en utilisant des programmes standard tels que Telnet, toutefois la
quantité de ressources consommées sur le système attaquant est trop
importante pour que ce ne soit pas considéré comme une vulnérabilité
sérieuse.<br>
Un programme d'attaque utilisant une API réseau tel que l'interface socket BSD
est plus efficace et donc plus dangereux, mais n'est pas habituellement assez
efficace pour exposer une vulnérabilité dangereuse sur le système de la
victime.</font></font>
<p><b><font face="Verdana" size="2">Détails</font></b>
<p><font face="Verdana" size="2">Naptha est une démonstration d'une exploit
efficace de DoS-&gt;RS-&gt;TCP_STATE. Il est efficace parce qu'il n'emploie pas
une traditionnelle API réseau pour initier une connexion TCP. À la différence
d'une vraie pile TCP/IP, il ne garde aucun enregistrement d'état de connexion.
il répond à un paquet en ce basant basé sur les seul indications de ce
paquet. Une fois en fonction, il produira des centaines ou milliers de connexion
enregistré sur la victime, il consomme très peu de ressources à l'attaquant
par rapport au niveau élevé de ressources requise à la cible. De cette
façon, il peut exploiter les vulnérabilités d'un service particulier, ou la
pile TCP/IP elle-même, sur le système de la victime.</font></p>
<p><b><font face="Verdana" size="2">Fonctionnement de Naphta</font></b></p>
<font face="Verdana" size="2">L'objectif de cette section est de décrire la
structure de base de l'attaque Naptha de sorte qu'on puissent vérifier la
possibilité et considérer avec tout le sérieux dû cette attaque.</font>
<p><font face="Verdana" size="2">Bien qu'il y eut quelques travaux sur ce sujet,
personne n'a édité ou a démontré un outil qui peut laisser des connexions
dans n'importe lequel des divers états TCP sur la machine victime (ÉTABLIE et
FIN-WAIT-1, etc...) ou une architecture à plusieurs éléments (permettant à
un de cacher une partie de l'attaque sur différents centres serveurs).<br>
Naptha tire en grande partie son efficacité du fait que l'attaque peut être
faite d'une façon distribuée.</font>
<p><font face="Verdana" size="2">La première partie envoie une séquence de
paquets SYN spoofés à tous les ports possibles à la victime. Selon les
conditions du scénario d'attaque, des copies multiples de ce programme sur le
même centre serveur pourraient être employées pour attaquer différents
centres serveurs, ou les centres serveurs multiples pourraient attaquer une
unique victime. Ceci ressemble à un SYN flood, mais il y a plus.</font>
<p><font face="Verdana" size="2">La 2ème partie fonctionne sur un réseau local
où l'adresse IP serait forgée, si c'était un vrai hôte. Le programme
s'assure d'abord que le routeur a une entrée pour cet hôte fantôme dans sa
table ARP. Ensuite, il écoute en mode promiscous les paquets entre la victime
et l'hôte fantôme. Le programme renvoie un paquet avec les flags et numéros
de séquences appropriés. Précisément, il écoute les paquets SYN/ACK et
renvoie un ACK. Il pourrait également placé le flag FIN et laisser la
connexion en état FIN-WAIT-1. Pour garder la connexion plus longtemps, il peut
détecter les paquets &quot;réguliers&quot; de données ou gardez les paquets
&quot;vivants&quot; et envoyez un ACK en réponse. Des victimes multiples
pourraient être visées par un exemple simple de ce programme.<br>
De part sa nature &quot;fantôme&quot;, il est difficile à dépister et à
éliminer.</font>
<p><font face="Verdana" size="2">Afin d'obtenir un succès asymétrique dans la
consommation de ressources, un tel programme d'attaque ne doit installer aucun
TCB (Transmission Control Block) sur le kernel de la machine attaquante. Ceci
permet de s'assurer que les activités de l'attaquant ne seront pas directement
contraintes par les limitations de grain de côté-client. Il est également
important de surveiller le nombre de processus du côté client&nbsp; afin qu'il
ne se développe avec le nombre de connexions de TCP. Naptha le fait en évitant
complètement l'utilisation de la pile de TCP/IP, et ouvre à la place ses
propres raw sockets. En fait, dans une attaque Naptha de cadence élevée, la
largeur de bande du réseau pose plus problème que les ressources de l'hôte
attaquant.</font>
<p><font face="Verdana" size="2">Naptha a également des capacités de cadence
de connexion limitée. Dans une variation de l'attaque, des connexions sont
établies à une cadence élevée et la victime est laissée avec des milliers
de ports ouverts, et toutes les ressources sont consommées avant le time out.
Dans un autre scénario, des connexions sont établies à une cadence lente pour
éviter des protections de SYN flood.<br>
Le nombre de connexions et de la cadence de l'établissement nécessaire pour
créer un DoS dépend d'un certain nombre de facteurs. Les différents systèmes
d'exploitation ont différents seuils de tolérance des nombres de connexion,
des nombres de fichier, de mémoire de processus, etc... L'application
fonctionnant sur ce port peut également avoir ses propres runlevels de
ressource. Quelques applications engendrent un nouveau processus pour chaque
connexion. La vitesse de l'unité de traitement arithmétique et de la quantité
de mémoire dans un système affecte également sa résistance à une attaque de
Naptha. Pour finir, le réseau lui-même joue son rôle.</font>
<p><font face="Verdana" size="2">En conclusion, l'attaque Naptha montre comment
une Ressource Starvation peut être sérieuse. Il n'y a pas, clairement, de
difficulté évidente pour ce problème mais un certain nombre d'idées
prometteuses.</font>
<h3><font face="Verdana" size="2">Recommendations</font></h3>
<font face="Verdana" size="2">Malheureusement, la plupart des constructeurs sont
vulnérables aux attaques Naptha, et jusqu' à ce que les constructeurs sortent
des patchs, très peu peuvent être faites en dehors des pratiques en matière
de sécurité. Nous avons donc quelques recommandations :</font>
<blockquote>
  <p><font face="Verdana" size="2">1. Limitez la quantité de services
  fonctionnant sur n'importe quel système que vous suspectez pouvoir être
  victime d'une attaque Naptha, particulièrement les services d'accès publics.</font></p>
  <p><font face="Verdana" size="2">2. Limitez l'accès des clients pouvant se
  connecter aux ports TCP exposés sur un système par l'intermédiaire des
  techniques de Firewalling. Sur les systèmes publics ceci peut être
  impossible, mais ils devraient être limité au strict minimum.</font>
  <p><font face="Verdana" size="2">3. Assurez-vous que tout le matériel, tel
  que les routeurs et firewall, est correctement configuré et vous filtrez les
  entrées et sorties. (Voir RFC 2267)</font>
  <p><font face="Verdana" size="2">4. Sur les systèmes Unix, employez inetd ou
  plus probablement tcpserver de Dan Bernstein (<a href="http://cr.yp.to/ucspi-tcp.html">http://cr.yp.to/ucspi-tcp.html</a>)
  pour limiter les processus engendrés par les démons. Bien que ceci
  n'empêchera pas les ressources d'un démon particulier d'être sur-utilisé,
  il est possible d'empêcher des démons de tomber en panne le serveur. Ceci
  peut permettre au serveur de récupérer.</font>
  <p><font size="2"><font face="Verdana">5. Sur les systèmes qui ont des
  réglages pour différentes minuteries et keep alive TCP, ceux-ci peuvent
  être ajustés pour tenir compte potentiellement d'une reprise plus rapide
  (supposant que le système n'est pas tombée en panne suite au naphta). Par
  exemple, les configurations keep alive TCP sur Linux kernel 2.2 pourraient
  accélérer le temps de reprise :<br>
  <br>
  </font><font face="Courier New"># cat /proc/sys/net/ipv4/tcp_keepalive_time<br>
  7200<br>
  # cat /proc/sys/net/ipv4/tcp_keepalive_probes<br>
  9<br>
  # cat /proc/sys/net/ipv4/tcp_max_ka_probes<br>
  5<br>
  # echo 30 &gt; /proc/sys/net/ipv4/tcp_keepalive_time<br>
  # echo 2 &gt; /proc/sys/net/ipv4/tcp_keepalive_probes<br>
  # echo 100 &gt; /proc/sys/net/ipv4/tcp_max_ka_probes</font></font>
  <p><font face="Verdana" size="2">Dans l'exemple ci-dessus le temps keepalive
  est ajusté de 2 heures sur 30 en second lieu, et le nombre de sondes
  keepalive est ajusté de 9 sur 2. Il ajuste également le nombre maximum des
  sondes envoyées pour être 100 au lieu juste de 5.</font>
  <p><font size="2"><font face="Verdana">6. Les exploits écrits pour démontrer
  l'attaque ont été distribués par le CERT mais seulement aux responsable
  sécurité des constructeurs d'OS. Le code ne sera pas distribué au public.
  Cependant, l'information ci-dessous servira une &quot;empreinte digitale&quot;
  pour que les identifications détectent le code de démonstration. Notez que
  le code lui-même pourrait être facilement modifié pour changer l'empreinte
  digitale, ainsi ce n'est pas une méthode de sécurité de détecter une
  attaque de Naphta.<br>
  <br>
  </font><font face="Courier New">IP:<br>
  TOS = Low Delay<br>
  ID = 413<br>
  TCP:<br>
  FLAGS = SYN<br>
  SEQ ID = 6060842<br>
  WINDOW = 512</font></font>
  <p><font face="Verdana" size="2">Snort (<a href="http://www.snort.org">http://www.snort.org</a>)
  est un petit IDS libre. Voici un filtre Snort pour Naptha :</font>
  <blockquote>
    <font size="2"><font face="Verdana"><br>
    </font><font face="Courier New">alert tcp any any &lt;&gt; any any (flags:S;
    seq: 6060842; id: 413; msg: &quot;Naptha DoS Attack, see http://razor.bindview.com//publish/advisories/adv_NAPTHA.html&quot;;)</font></font>
  </blockquote>
</blockquote>

</body>

</html>
